{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Fractal Configuration Schema",
  "description": "Schema for Mandelbrot, Julia, Riemann, and Rossler fractal configurations including presets, palettes, and animated dives.",
  "type": "object",
  "required": ["type", "views", "palettes"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "Reference to this schema file."
    },
    "type": {
      "type": "string",
      "enum": ["MANDELBROT", "JULIA", "RIEMANN", "ROSSLER"],
      "description": "The type of fractal this configuration is for."
    }
  },
  "allOf": [
    {
      "if": {
        "properties": { "type": { "const": "MANDELBROT" } }
      },
      "then": {
        "properties": {
          "views": {
            "type": "array",
            "items": { "$ref": "#/definitions/MandelbrotPreset" }
          },
          "palettes": {
            "type": "array",
            "items": { "$ref": "#/definitions/MandelbrotPalette" }
          },
          "removed": {
            "type": "array",
            "items": { "$ref": "#/definitions/MandelbrotPreset" }
          }
        }
      }
    },
    {
      "if": {
        "properties": { "type": { "const": "JULIA" } }
      },
      "then": {
        "properties": {
          "views": {
            "type": "array",
            "items": { "$ref": "#/definitions/JuliaPreset" }
          },
          "palettes": {
            "type": "array",
            "items": { "$ref": "#/definitions/JuliaPalette" }
          },
          "dives": {
            "type": "array",
            "items": { "$ref": "#/definitions/Dive" }
          },
          "experiments": {
            "type": "array",
            "items": { "$ref": "#/definitions/Dive" }
          },
          "removed": {
            "type": "array",
            "items": { "$ref": "#/definitions/JuliaPreset" }
          }
        }
      }
    },
    {
      "if": {
        "properties": { "type": { "const": "RIEMANN" } }
      },
      "then": {
        "properties": {
          "views": {
            "type": "array",
            "items": { "$ref": "#/definitions/RiemannView" },
            "description": "Tour points for the Riemann zeta function visualization."
          },
          "palettes": {
            "type": "array",
            "items": { "$ref": "#/definitions/RiemannPalette" }
          }
        }
      }
    },
    {
      "if": {
        "properties": { "type": { "const": "ROSSLER" } }
      },
      "then": {
        "properties": {
          "views": {
            "type": "array",
            "items": { "$ref": "#/definitions/RosslerView" },
            "description": "Preset views for the Rossler attractor."
          },
          "palettes": {
            "type": "array",
            "items": { "$ref": "#/definitions/RosslerPalette" }
          }
        }
      }
    }
  ],
  "definitions": {
    "Complex": {
      "type": "array",
      "minItems": 2,
      "maxItems": 2,
      "items": { "type": "number" },
      "description": "A complex number as [real, imaginary]."
    },
    "RGB3": {
      "type": "array",
      "minItems": 3,
      "maxItems": 3,
      "items": { "type": "number" },
      "description": "RGB values as [R, G, B]."
    },
    "InnerStops15": {
      "type": "array",
      "minItems": 15,
      "maxItems": 15,
      "items": { "type": "number" },
      "description": "5 RGB color stops (15 values total) for Julia gradient coloring."
    },
    "MandelbrotPreset": {
      "type": "object",
      "required": ["pan", "zoom"],
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "description": "Display name of the preset."
        },
        "pan": {
          "$ref": "#/definitions/Complex",
          "description": "Center coordinates [x, y] in the complex plane."
        },
        "zoom": {
          "type": "number",
          "description": "Zoom level (smaller = more zoomed in)."
        },
        "rotation": {
          "type": "number",
          "default": 0,
          "description": "Rotation angle in radians."
        },
        "speed": {
          "type": "number",
          "default": 1,
          "description": "Animation speed multiplier for travel animations."
        },
        "paletteId": {
          "type": "string",
          "description": "Palette id to determine the preset color theme."
        }
      }
    },
    "JuliaPreset": {
      "type": "object",
      "required": ["c", "pan", "zoom"],
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique display name of the view."
        },
        "c": {
          "$ref": "#/definitions/Complex",
          "description": "Julia constant [cx, cy]."
        },
        "pan": {
          "$ref": "#/definitions/Complex",
          "description": "Center coordinates [x, y] in the complex plane."
        },
        "zoom": {
          "type": "number",
          "description": "Zoom level (smaller = more zoomed in)."
        },
        "rotation": {
          "type": "number",
          "default": 0,
          "description": "Rotation angle in degrees."
        },
        "speed": {
          "type": "number",
          "default": 1,
          "description": "Animation speed multiplier for travel animations."
        },
        "paletteId": {
          "type": "string",
          "description": "Palette id to determine the preset color theme."
        }
      }
    },
    "RiemannView": {
      "type": "object",
      "required": ["id", "type", "pan", "zoom"],
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "description": "Display name of the view/tour point."
        },
        "type": {
          "type": "string",
          "enum": ["axis", "symmetry", "overview", "pole", "special", "trivial", "nontrivial", "saddle", "gram"],
          "description": "View type determining the marker style: 'axis' (horizontal line), 'symmetry' (vertical line/critical line), 'overview' (region rectangle), others (point marker)."
        },
        "pan": {
          "$ref": "#/definitions/Complex",
          "description": "Center coordinates [Re(s), Im(s)] in the complex plane."
        },
        "zoom": {
          "type": "number",
          "description": "Zoom level (larger = more zoomed out)."
        },
        "paletteId": {
          "type": "string",
          "description": "Palette id to determine the view color theme."
        },
        "description": {
          "type": "string",
          "description": "Educational description shown in the tour overlay."
        }
      }
    },
    "RiemannPalette": {
      "type": "object",
      "required": ["id", "keyColor", "theme"],
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier/name for the palette."
        },
        "keyColor": {
          "type": "string",
          "pattern": "^#[0-9A-Fa-f]{6}$",
          "description": "Representative hex color for UI display."
        },
        "theme": {
          "$ref": "#/definitions/RGB3",
          "description": "RGB multipliers for domain coloring."
        }
      }
    },
    "RosslerView": {
      "type": "object",
      "required": ["id", "params", "zoom", "pan"],
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "description": "Display name of the Rossler attractor view."
        },
        "params": {
          "$ref": "#/definitions/RGB3",
          "description": "Rossler system parameters [a, b, c]."
        },
        "zoom": {
          "type": "number",
          "description": "Zoom level for the view."
        },
        "rotation": {
          "type": "number",
          "default": 0,
          "description": "Rotation angle in radians."
        },
        "pan": {
          "$ref": "#/definitions/Complex",
          "description": "Center offset [x, y]."
        },
        "paletteId": {
          "type": "string",
          "description": "Palette id to determine the view color theme."
        }
      }
    },
    "RosslerPalette": {
      "type": "object",
      "required": ["id", "keyColor", "theme"],
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier/name for the palette."
        },
        "keyColor": {
          "type": "string",
          "pattern": "^#[0-9A-Fa-f]{6}$",
          "description": "Representative hex color for UI display."
        },
        "theme": {
          "$ref": "#/definitions/RGB3",
          "description": "RGB multipliers for coloring."
        },
        "frequency": {
          "$ref": "#/definitions/RGB3",
          "description": "Sine wave frequencies for each RGB channel."
        },
        "phase": {
          "$ref": "#/definitions/RGB3",
          "description": "Sine wave phase offsets for each RGB channel."
        }
      }
    },
    "MandelbrotPalette": {
      "type": "object",
      "required": ["id", "keyColor", "theme"],
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier/name for the palette."
        },
        "keyColor": {
          "type": "string",
          "pattern": "^#[0-9A-Fa-f]{6}$",
          "description": "Representative hex color for UI display."
        },
        "theme": {
          "$ref": "#/definitions/RGB3",
          "description": "RGB multipliers for sine-based coloring."
        },
        "frequency": {
          "$ref": "#/definitions/RGB3",
          "description": "Sine wave frequencies for each RGB channel."
        },
        "phase": {
          "$ref": "#/definitions/RGB3",
          "description": "Sine wave phase offsets for each RGB channel."
        }
      }
    },
    "JuliaPalette": {
      "type": "object",
      "required": ["id", "keyColor", "theme"],
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier/name for the palette."
        },
        "keyColor": {
          "type": "string",
          "pattern": "^#[0-9A-Fa-f]{6}$",
          "description": "Representative hex color for UI display."
        },
        "theme": {
          "$ref": "#/definitions/InnerStops15",
          "description": "5 RGB color stops (15 floats) for gradient coloring."
        }
      }
    },
    "Dive": {
      "type": "object",
      "required": ["pan", "zoom", "startC", "endC", "step", "cxDirection", "cyDirection"],
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique display name of the dive."
        },
        "pan": {
          "$ref": "#/definitions/Complex",
          "description": "View center coordinates."
        },
        "zoom": {
          "type": "number",
          "description": "Zoom level for the dive view."
        },
        "rotation": {
          "type": "number",
          "default": 0,
          "description": "Rotation angle in degrees."
        },
        "startC": {
          "$ref": "#/definitions/Complex",
          "description": "Starting Julia constant."
        },
        "endC": {
          "$ref": "#/definitions/Complex",
          "description": "Ending Julia constant (threshold for phase changes)."
        },
        "step": {
          "type": "number",
          "description": "Increment value added to C per frame."
        },
        "cxDirection": {
          "type": "integer",
          "enum": [1, -1],
          "description": "Direction on real axis: 1 = positive, -1 = negative."
        },
        "cyDirection": {
          "type": "integer",
          "enum": [1, -1],
          "description": "Direction on imaginary axis: 1 = positive, -1 = negative."
        },
        "paletteId": {
          "type": "string",
          "description": "Palette id to determine the dive color theme."
        },
        "phases": {
          "type": "array",
          "items": {
            "type": "integer",
            "enum": [1, 2, 3, 4]
          },
          "description": "Phase order: 1=cx to end, 2=cy to end, 3=cx to start, 4=cy to start."
        }
      }
    }
  }
}
