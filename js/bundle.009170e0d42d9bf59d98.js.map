{"version":3,"file":"js/bundle.009170e0d42d9bf59d98.js","mappings":"mBAcO,IAOMA,EACH,EADGA,EAGH,EASGC,EAAaD,GAAuCA,EAMpDE,EAEF,QAFEA,EAIF,QASEC,EAAM,SAACC,GAAkD,IAAzCC,EAAKC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,GACVD,GAAQ,IAAHI,OAAOJ,EAAK,IAO5C,EAyCaK,EAAiC,IAAO,GAaxCC,EAAuBV,IAAeD,GAAoB,MAAQ,IAmBlEY,EAAe,CACxBC,WAAY,EACZC,MAAO,EACPC,QAAS,GAOAC,EAAY,CAErBC,KAAM,SAACC,GAAC,OAAKA,CAAC,EAEdC,KCkXG,SAAmBC,GACtB,OAAOA,EAAO,GAAM,EAAIA,EAAOA,GAAa,EAAI,EAAIA,GAAQA,EAArB,CAC3C,EDlXIC,MC0XG,SAAwBD,GAC3B,OAAOA,EAAO,GACR,EAAIA,EAAOA,EAAOA,EAClB,EAAIE,KAAKC,KAAK,EAAIH,EAAO,EAAG,GAAK,CAC3C,ED5XII,MCoYG,SAAwBJ,GAC3B,OAAOA,EAAO,GACR,GAAKE,KAAKC,IAAIH,EAAM,GACpB,EAAIE,KAAKC,KAAK,EAAIH,EAAO,EAAG,GAAK,CAC3C,GDjYaK,GAEH,EAFGA,EAIL,EAOKC,EAAuB,UAMvBC,EAAmB,wBAkBnBC,GARsB,UAAHnB,OAJIiB,GAMC,UAAHjB,OAJI,QAWlC,CACI,GAAM,gBACN,SAAY,UACZ,MAAS,CAAC,KAAO,KAAO,KAAO,IAAM,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,EAAG,EAAG,IAAM,IAAM,KAO5FoB,EAAiC,CAAC,GAAK,IAAK,IAAM,IAAK,GAAK,KAM5DC,EAA4BC,EAAcH,EAAsBI,UAahEC,EAAsBX,KAAKW,G,aC9NxC,IAAAC,EAAAC,EAAAC,EAAA,mBAAAC,OAAAA,OAAA,GAAAC,EAAAF,EAAAG,UAAA,aAAAC,EAAAJ,EAAAK,aAAA,yBAAAC,EAAAN,EAAAE,EAAAE,EAAAE,GAAA,IAAAC,EAAAL,GAAAA,EAAAM,qBAAAC,EAAAP,EAAAO,EAAAC,EAAAC,OAAAC,OAAAL,EAAAC,WAAA,OAAAK,EAAAH,EAAA,mBAAAV,EAAAE,EAAAE,GAAA,IAAAE,EAAAC,EAAAG,EAAAI,EAAA,EAAAC,EAAAX,GAAA,GAAAY,GAAA,EAAAC,EAAA,CAAAF,EAAA,EAAAb,EAAA,EAAAgB,EAAApB,EAAAqB,EAAAC,EAAAN,EAAAM,EAAAC,KAAAvB,EAAA,GAAAsB,EAAA,SAAArB,EAAAC,GAAA,OAAAM,EAAAP,EAAAQ,EAAA,EAAAG,EAAAZ,EAAAmB,EAAAf,EAAAF,EAAAmB,CAAA,YAAAC,EAAApB,EAAAE,GAAA,IAAAK,EAAAP,EAAAU,EAAAR,EAAAH,EAAA,GAAAiB,GAAAF,IAAAV,GAAAL,EAAAgB,EAAA5C,OAAA4B,IAAA,KAAAK,EAAAE,EAAAS,EAAAhB,GAAAqB,EAAAH,EAAAF,EAAAO,EAAAhB,EAAA,GAAAN,EAAA,GAAAI,EAAAkB,IAAApB,KAAAQ,EAAAJ,GAAAC,EAAAD,EAAA,OAAAC,EAAA,MAAAD,EAAA,GAAAA,EAAA,GAAAR,GAAAQ,EAAA,IAAAc,KAAAhB,EAAAJ,EAAA,GAAAoB,EAAAd,EAAA,KAAAC,EAAA,EAAAU,EAAAC,EAAAhB,EAAAe,EAAAf,EAAAI,EAAA,IAAAc,EAAAE,IAAAlB,EAAAJ,EAAA,GAAAM,EAAA,GAAAJ,GAAAA,EAAAoB,KAAAhB,EAAA,GAAAN,EAAAM,EAAA,GAAAJ,EAAAe,EAAAf,EAAAoB,EAAAf,EAAA,OAAAH,GAAAJ,EAAA,SAAAmB,EAAA,MAAAH,GAAA,EAAAd,CAAA,iBAAAE,EAAAW,EAAAO,GAAA,GAAAR,EAAA,QAAAS,UAAA,oCAAAP,GAAA,IAAAD,GAAAK,EAAAL,EAAAO,GAAAf,EAAAQ,EAAAL,EAAAY,GAAAvB,EAAAQ,EAAA,EAAAT,EAAAY,KAAAM,GAAA,CAAAV,IAAAC,EAAAA,EAAA,GAAAA,EAAA,IAAAU,EAAAf,GAAA,GAAAkB,EAAAb,EAAAG,IAAAO,EAAAf,EAAAQ,EAAAO,EAAAC,EAAAR,GAAA,OAAAI,EAAA,EAAAR,EAAA,IAAAC,IAAAH,EAAA,QAAAL,EAAAO,EAAAF,GAAA,MAAAL,EAAAA,EAAAyB,KAAAlB,EAAAI,IAAA,MAAAa,UAAA,wCAAAxB,EAAA0B,KAAA,OAAA1B,EAAAW,EAAAX,EAAA2B,MAAAnB,EAAA,IAAAA,EAAA,YAAAA,IAAAR,EAAAO,EAAA,SAAAP,EAAAyB,KAAAlB,GAAAC,EAAA,IAAAG,EAAAa,UAAA,oCAAAnB,EAAA,YAAAG,EAAA,GAAAD,EAAAR,CAAA,UAAAC,GAAAiB,EAAAC,EAAAf,EAAA,GAAAQ,EAAAV,EAAAwB,KAAAtB,EAAAe,MAAAE,EAAA,YAAApB,GAAAO,EAAAR,EAAAS,EAAA,EAAAG,EAAAX,CAAA,SAAAe,EAAA,UAAAY,MAAA3B,EAAA0B,KAAAT,EAAA,GAAAhB,EAAAI,EAAAE,IAAA,GAAAI,CAAA,KAAAS,EAAA,YAAAV,IAAA,UAAAkB,IAAA,UAAAC,IAAA,CAAA7B,EAAAY,OAAAkB,eAAA,IAAAtB,EAAA,GAAAL,GAAAH,EAAAA,EAAA,GAAAG,QAAAW,EAAAd,EAAA,GAAAG,EAAA,yBAAAH,GAAAW,EAAAkB,EAAApB,UAAAC,EAAAD,UAAAG,OAAAC,OAAAL,GAAA,SAAAO,EAAAhB,GAAA,OAAAa,OAAAmB,eAAAnB,OAAAmB,eAAAhC,EAAA8B,IAAA9B,EAAAiC,UAAAH,EAAAf,EAAAf,EAAAM,EAAA,sBAAAN,EAAAU,UAAAG,OAAAC,OAAAF,GAAAZ,CAAA,QAAA6B,EAAAnB,UAAAoB,EAAAf,EAAAH,EAAA,cAAAkB,GAAAf,EAAAe,EAAA,cAAAD,GAAAA,EAAAK,YAAA,oBAAAnB,EAAAe,EAAAxB,EAAA,qBAAAS,EAAAH,GAAAG,EAAAH,EAAAN,EAAA,aAAAS,EAAAH,EAAAR,EAAA,yBAAAW,EAAAH,EAAA,oDAAAuB,EAAA,kBAAAC,EAAA5B,EAAA6B,EAAArB,EAAA,cAAAD,EAAAf,EAAAE,EAAAE,EAAAH,GAAA,IAAAO,EAAAK,OAAAyB,eAAA,IAAA9B,EAAA,gBAAAR,GAAAQ,EAAA,EAAAO,EAAA,SAAAf,EAAAE,EAAAE,EAAAH,GAAA,SAAAK,EAAAJ,EAAAE,GAAAW,EAAAf,EAAAE,EAAA,SAAAF,GAAA,YAAAuC,QAAArC,EAAAE,EAAAJ,EAAA,GAAAE,EAAAM,EAAAA,EAAAR,EAAAE,EAAA,CAAA0B,MAAAxB,EAAAoC,YAAAvC,EAAAwC,cAAAxC,EAAAyC,UAAAzC,IAAAD,EAAAE,GAAAE,GAAAE,EAAA,UAAAA,EAAA,WAAAA,EAAA,cAAAS,EAAAf,EAAAE,EAAAE,EAAAH,EAAA,UAAA0C,EAAAvC,EAAAH,EAAAD,EAAAE,EAAAI,EAAAe,EAAAZ,GAAA,QAAAD,EAAAJ,EAAAiB,GAAAZ,GAAAG,EAAAJ,EAAAoB,KAAA,OAAAxB,GAAA,YAAAJ,EAAAI,EAAA,CAAAI,EAAAmB,KAAA1B,EAAAW,GAAAgC,QAAAC,QAAAjC,GAAAkC,KAAA5C,EAAAI,EAAA,UAAAyC,EAAA7C,GAAA,gBAAAA,GAAA,GAAA8C,MAAAC,QAAA/C,GAAA,OAAAgD,EAAAhD,EAAA,CAAAiD,CAAAjD,IAAA,SAAAA,GAAA,uBAAAC,QAAA,MAAAD,EAAAC,OAAAE,WAAA,MAAAH,EAAA,qBAAA8C,MAAAI,KAAAlD,EAAA,CAAAmD,CAAAnD,IAAAoD,EAAApD,IAAA,qBAAAuB,UAAA,wIAAA8B,EAAA,UAAAC,EAAAtD,EAAAF,GAAA,gBAAAE,GAAA,GAAA8C,MAAAC,QAAA/C,GAAA,OAAAA,CAAA,CAAAuD,CAAAvD,IAAA,SAAAA,EAAAsB,GAAA,IAAAvB,EAAA,MAAAC,EAAA,yBAAAC,QAAAD,EAAAC,OAAAE,WAAAH,EAAA,uBAAAD,EAAA,KAAAD,EAAAI,EAAAI,EAAAI,EAAAS,EAAA,GAAAL,GAAA,EAAAV,GAAA,SAAAE,GAAAP,EAAAA,EAAAyB,KAAAxB,IAAAwD,KAAA,IAAAlC,EAAA,IAAAX,OAAAZ,KAAAA,EAAA,OAAAe,GAAA,cAAAA,GAAAhB,EAAAQ,EAAAkB,KAAAzB,IAAA0B,QAAAN,EAAAsC,KAAA3D,EAAA4B,OAAAP,EAAAhD,SAAAmD,GAAAR,GAAA,UAAAd,GAAAI,GAAA,EAAAF,EAAAF,CAAA,iBAAAc,GAAA,MAAAf,EAAA,SAAAW,EAAAX,EAAA,SAAAY,OAAAD,KAAAA,GAAA,kBAAAN,EAAA,MAAAF,CAAA,SAAAiB,CAAA,EAAAuC,CAAA1D,EAAAF,IAAAsD,EAAApD,EAAAF,IAAA,qBAAAyB,UAAA,6IAAAoC,EAAA,UAAAP,EAAApD,EAAAmB,GAAA,GAAAnB,EAAA,qBAAAA,EAAA,OAAAgD,EAAAhD,EAAAmB,GAAA,IAAApB,EAAA,GAAA6D,SAAApC,KAAAxB,GAAA6D,MAAA,uBAAA9D,GAAAC,EAAA8D,cAAA/D,EAAAC,EAAA8D,YAAAC,MAAA,QAAAhE,GAAA,QAAAA,EAAA+C,MAAAI,KAAAlD,GAAA,cAAAD,GAAA,2CAAAiE,KAAAjE,GAAAiD,EAAAhD,EAAAmB,QAAA,YAAA6B,EAAAhD,EAAAmB,IAAA,MAAAA,GAAAA,EAAAnB,EAAA7B,UAAAgD,EAAAnB,EAAA7B,QAAA,QAAA2B,EAAA,EAAAI,EAAA4C,MAAA3B,GAAArB,EAAAqB,EAAArB,IAAAI,EAAAJ,GAAAE,EAAAF,GAAA,OAAAI,CAAA,CASA,IAAI+D,GAAe,EAaZ,SAASC,EAAgBC,EAAMC,EAAIC,EAAIC,EAAMC,GAAkD,IAAxCC,EAAEtG,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,KAAMuG,EAAEvG,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,KAAMwG,EAASxG,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,KACtFyG,EAAe,SAACjD,GAClB,OAAa,MAATA,EAAsB,KAGnBkD,OAAOlD,GAAOmD,YAAY,GACrC,EAEMC,EAAS,CACXX,KAAc,MAARA,EAAeA,EAAKY,QAAQ,GAAKvG,EAAaC,WACpD2F,GAAIO,EAAaP,GACjBC,GAAIM,EAAaN,GACjBC,KAAMK,EAAaL,GACnBtE,EAAe,MAAZuE,EAAmBK,OAAOL,GAAUM,YAAY,IAAM,EACzDL,GAAIG,EAAaH,GACjBC,GAAIE,EAAaF,GACjBO,QAASN,GAKb,KAAI,CAACN,EAAIC,EAAIC,EAAMC,GAAUU,KAAK,SAAAC,GAAE,OAAU,MAANA,CAAU,IAK9Cf,IAAS3F,EAAaE,OAAS,CAAC8F,EAAIC,GAAIQ,KAAK,SAAAC,GAAE,OAAU,MAANA,CAAU,IAAjE,CAMA,IAAMC,EAAgBC,KAAKC,KAAKC,UAAUR,IAGpCS,EAAWpB,IAAS3F,EAAaE,MAAQ,SAAW,IAC1D8G,OAAOC,QAAQC,UAAU,CAAC,EAAG,GAAI,GAAFrH,OAAKkH,EAAQ,UAAAlH,OAAS8G,IAErDlB,GAAe,CATf,CAUJ,CAMO,SAAS0B,IAGZ,IACMC,EADM,IAAIC,IAAIL,OAAOM,SAASC,MACnBH,KAEjB,IAAKA,EAGD,MAAO,CAACzB,KAAM3F,EAAaC,YAI/B,IAAoDuH,EAAA1C,EAAxBsC,EAAK/B,MAAM,GAAGoC,MAAM,KAAI,GAA7C9B,EAAI6B,EAAA,GAAEE,EAAWF,EAAA,GAExB,IAAKE,EAGD,MAAO,CAAC/B,KAAe,UAATA,EAAmB3F,EAAaE,MAAQF,EAAaC,YAIvE,IACM0G,EADa,IAAIgB,gBAAgBD,GACNE,IAAI,QAErC,IAEI,IAAMC,EAAgBhB,KAAKiB,MAAMC,KAAKpB,IAKtC,OAHAlB,GAAe,EAGR,CACHE,KAAe,UAATA,EAAmB3F,EAAaE,MAAQF,EAAaC,WAC3D2F,GAAwB,MAApBiC,EAAcjC,GAAaoC,WAAWH,EAAcjC,IAAM,KAC9DC,GAAwB,MAApBgC,EAAchC,GAAamC,WAAWH,EAAchC,IAAM,KAC9DC,KAA4B,MAAtB+B,EAAc/B,KAAekC,WAAWH,EAAc/B,MAAQ,KACpEtE,EAAsB,MAAnBqG,EAAcrG,EAAYwG,WAAWH,EAAcrG,GAAK,EAC3DwE,GAAwB,MAApB6B,EAAc7B,GAAagC,WAAWH,EAAc7B,IAAM,KAC9DC,GAAwB,MAApB4B,EAAc5B,GAAa+B,WAAWH,EAAc5B,IAAM,KAC9DC,UAAW2B,EAAcrB,SAAW,KAE5C,CAAE,MAAOlF,GAIL,OAFAmE,GAAe,EAER,CAACE,KAAe,UAATA,EAAmB3F,EAAaE,MAAQF,EAAaC,WACvE,CACJ,CAGO,SAASgI,IACZ,GAAKxC,EAAL,CAIA,IAAM2B,EAAOJ,OAAOM,SAASF,KAAKK,MAAM,KAAK,GACvCS,EAAS,GAAHrI,OAAMmH,OAAOM,SAASa,OAAM,KAAAtI,OAAIuH,GAC5CJ,OAAOC,QAAQC,UAAU,CAAC,EAAG,GAAIgB,GACjCzC,GAAe,CAPU,CAQ7B,CAMO,IAAM2C,EAAgB,WAAH,MAAS,iBAAkBpB,QAAUqB,UAAUC,eAAiB,GAAKD,UAAUE,iBAAmB,CAAC,EAMtH,SAASC,IAGZ,MAFgB,CAAC,WAAY,SAAU,UAAW,QAAS,QAAS,cAAe,kBAEpE/B,KAAK,SAACgC,GACjB,OAAOJ,UAAUK,UAAUC,MAAMF,EACrC,EACJ,CASO,SAASG,EAAsB7G,GAAgC,IAA7B8G,EAASnJ,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,EAAGoJ,IAAKpJ,UAAAC,OAAA,QAAAC,IAAAF,UAAA,KAAAA,UAAA,GAGnDqJ,EAAgB,CAACC,SAAKpJ,EAAW,KAAM,IACvCqJ,EAAW,SAAC/F,GAAK,MAAsB,iBAAVA,GAAsBgG,SAAShG,EAAM,EAEpEiG,EAAW,IAEf,GAAIJ,EAActC,KAAK,SAAAvD,GAAK,OAAIA,IAAUnB,EAAE,EAAE,IAAKgH,EAActC,KAAK,SAAAvD,GAAK,OAAIA,IAAUnB,EAAE,EAAE,KAAMkH,EAASlH,EAAE,MAAQkH,EAASlH,EAAE,IAI7H,OAHAoH,GAAY,QAKZ,IAAMC,EAAcpB,WAAWjG,EAAE,GAAGwE,QAAQsC,IAAYzD,WAClDiE,EAAcrB,WAAWjG,EAAE,GAAGwE,QAAQsC,IAAYzD,WAK5D,OAJI+D,GAAY,GAAJtJ,OAAOuJ,EAAW,MAAAvJ,OAAKwJ,KAIfP,GAAkB,IAAT/G,EAAE,GAAY,KAAO,IACtD,CAQO,IAAMuH,EACQ,KADRA,EAEY,KAUZC,EAAa,SAACrG,GAAkD,OAArCxD,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG4J,KAC3BA,EA4BhB,SAAsBpG,GAElB,IAAMsG,EAAO9I,KAAK+I,OAAOvG,GAEnBwG,EAAMhJ,KAAK+I,OAAOvG,EAAQsG,GAEhC,MAAO,CAACA,KAAAA,EAAME,IAAAA,EAClB,CAnC0DC,CAAazG,GAevE,SAAsBA,GAClB,IAAM0G,EAAO1G,EAAQ2G,EACfL,EAAOI,GAAQA,EAAO1G,GACtBwG,EAAMxG,EAAQsG,EAEpB,MAAO,CAACA,KAAAA,EAAME,IAAAA,EAClB,CArBgFI,CAAa5G,EAAM,EAO7F2G,EAAoB,UAsCnB,SAASE,IACZ,MAAO,CAACC,GADatK,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,EACZuK,GADiBvK,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,EAEpC,CAUO,SAASwK,EAAOvH,EAAGwH,GACtB,IAAMC,EAAIzH,EAAIwH,EACRE,EAAKD,EAAIzH,EAEf,MAAO,CAACyH,EAAAA,EAAGE,IADE3H,GAAKyH,EAAIC,IAAQF,EAAIE,GAEtC,CAUO,SAASE,EAAY5H,EAAGwH,GAC3B,IAAMC,EAAIzH,EAAIwH,EAEd,MAAO,CAACC,EAAAA,EAAGE,IADCH,GAAKC,EAAIzH,GAEzB,CAUO,SAAS6H,EAAMC,EAAI/I,GACtB,IAAMH,EAAI2I,EAAOO,EAAGT,GAAItI,GAClBuI,EAAKQ,EAAGR,GAAK1I,EAAE+I,IACf9I,EAAI+I,EAAYhJ,EAAE6I,EAAGH,GAG3B,OAFAQ,EAAGT,GAAKxI,EAAE4I,EACVK,EAAGR,GAAKzI,EAAE8I,IACHG,CACX,CAWO,SAASC,EAAMD,EAAI/I,GAGtB,OAFA+I,EAAGT,GAAKtI,EACR+I,EAAGR,GAAK,EACDQ,CACX,CASO,SAASE,EAAQF,GACpB,OAAOA,EAAGT,GAAKS,EAAGR,EACtB,CAwBO,SAASW,EAAQjI,EAAGwH,GACvB,OAfG,SAAiBxH,EAAGwH,GACvB,IAAM5I,EAAI2I,EAAOvH,EAAEqH,GAAIG,EAAEH,IACnBC,EAAKtH,EAAEsH,GAAKE,EAAEF,GAAK1I,EAAE+I,IACrB9I,EAAI+I,EAAYhJ,EAAE6I,EAAGH,GAC3B,MAAO,CAACD,GAAIxI,EAAE4I,EAAGH,GAAIzI,EAAE8I,IAC3B,CAUWO,CAAQlI,EAAG,CAACqH,IAAKG,EAAEH,GAAIC,IAAKE,EAAEF,IACzC,CAWO,IAAMa,EAAM,SAACV,GAAC,OACjBW,OAAOX,GACFY,WAAW,IAAK,SAChBA,WAAW,IAAK,QAChBA,WAAW,IAAK,OAAO,EASzB,SAASC,EAAeC,EAAIC,GAAoB,IAAhBtC,EAASnJ,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,GAC/C,OAAOwL,EAAG,GAAG3E,QAAQsC,KAAesC,EAAG,GAAG5E,QAAQsC,IAAcqC,EAAG,GAAG3E,QAAQsC,KAAesC,EAAG,GAAG5E,QAAQsC,EAC/G,CASO,SAASuC,EAAgBC,EAAIC,GAAmB,IAAfzC,EAASnJ,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,EAChD,OAAO2L,EAAG,GAAG9E,QAAQsC,KAAeyC,EAAG,GAAG/E,QAAQsC,IAC9CwC,EAAG,GAAG9E,QAAQsC,KAAeyC,EAAG,GAAG/E,QAAQsC,IAC3CwC,EAAG,GAAG9E,QAAQsC,KAAeyC,EAAG,GAAG/E,QAAQsC,EACnD,CAqCO,SAAS0C,EAASC,EAAGpB,EAAGtH,GAC3B,IAAItB,EAAGiK,EAAGtB,EACV,GAAU,IAANC,EACA5I,EAAIiK,EAAItB,EAAIrH,MACT,CACH,IAAM4I,EAAU,SAACnJ,EAAGoJ,EAAGpK,GAGnB,OAFIA,EAAI,IAAGA,GAAK,GACZA,EAAI,IAAGA,GAAK,GACZA,EAAI,EAAI,EAAUgB,EAAc,GAAToJ,EAAIpJ,GAAShB,EACpCA,EAAI,GAAcoK,EAClBpK,EAAI,EAAI,EAAUgB,GAAKoJ,EAAIpJ,IAAM,EAAI,EAAIhB,GAAK,EAC3CgB,CACX,EACMoJ,EAAI7I,EAAI,GAAMA,GAAK,EAAIsH,GAAKtH,EAAIsH,EAAItH,EAAIsH,EACxC7H,EAAI,EAAIO,EAAI6I,EAClBnK,EAAIkK,EAAQnJ,EAAGoJ,EAAGH,EAAI,EAAI,GAC1BC,EAAIC,EAAQnJ,EAAGoJ,EAAGH,GAClBrB,EAAIuB,EAAQnJ,EAAGoJ,EAAGH,EAAI,EAAI,EAC9B,CACA,MAAO,CAAChK,EAAGiK,EAAGtB,EAClB,CASO,SAASyB,EAASpK,EAAGiK,EAAGtB,GAC3B,IACIqB,EAAGpB,EADHyB,EAAMnL,KAAKmL,IAAIrK,EAAGiK,EAAGtB,GAAI2B,EAAMpL,KAAKoL,IAAItK,EAAGiK,EAAGtB,GACxCrH,GAAK+I,EAAMC,GAAO,EAC5B,GAAID,IAAQC,EACRN,EAAIpB,EAAI,MACL,CACH,IAAIxH,EAAIiJ,EAAMC,EACd1B,EAAItH,EAAI,GAAMF,GAAK,EAAIiJ,EAAMC,GAAOlJ,GAAKiJ,EAAMC,GAE3CN,EADAK,IAAQrK,GACHiK,EAAItB,GAAKvH,GAAK6I,EAAItB,EAAI,EAAI,GACxB0B,IAAQJ,GACVtB,EAAI3I,GAAKoB,EAAI,GAEbpB,EAAIiK,GAAK7I,EAAI,EAEtB4I,GAAK,CACT,CACA,MAAO,CAACA,EAAGpB,EAAGtH,EAClB,CAQO,SAASiJ,EAASC,GAAsB,IAAjBC,EAASvM,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,IAUtC,OALmB,KAHnBsM,EAAMA,EAAIE,cAAcC,QAAQ,KAAM,KAG9BxM,SACJqM,EAAMA,EAAIvE,MAAM,IAAI2E,IAAI,SAAAC,GAAI,OAAIA,EAAOA,CAAI,GAAEC,KAAK,KAIjD,kBAAkB9G,KAAKwG,GAUrB,CACHxK,EANM+K,SAASP,EAAIQ,UAAU,EAAG,GAAI,IAM7BP,EACPR,EANMc,SAASP,EAAIQ,UAAU,EAAG,GAAI,IAM7BP,EACP9B,EANMoC,SAASP,EAAIQ,UAAU,EAAG,GAAI,IAM7BP,GAZA,IAcf,CAQO,SAAS9K,EAAc6K,GAAsB,IAC1CS,EAAMV,EAASC,EADmBtM,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,KAE3C,MAAO,CAAC+M,EAAIjL,EAAGiL,EAAIhB,EAAGgB,EAAItC,EAC9B,CA2CO,SAASuC,EAAKC,EAAOC,EAAKpM,GAC7B,OAAOmM,GAASC,EAAMD,GAASnM,CACnC,CAOO,SAASqM,EAASC,GACrB,OAAOA,GAAWzL,EAAK,IAC3B,CAOO,SAAS0L,EAAkBhH,GAC9B,IAAMiH,EAAQ,EAAI3L,EAClB,OAAQ0E,EAAWiH,EAAQA,GAASA,CACxC,CAWO,SAASC,EAAqBC,EAAMC,EAASC,GAAsB,IAAdC,EAAO3N,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,CAAC,EAC/D4N,EAAoB,EAAEC,EAAA,WAEtB,GAAIpL,OAAOH,UAAUwL,eAAexK,KAAKoK,EAAQK,GAAM,CACnD,IAAM/J,OAAqB9D,IAAjByN,EAAQI,GAAqBJ,EAAQI,GAAO,EAChDC,EAAUP,EAAQM,GAClBE,EAAUP,EAAOK,GACnBG,EAAO,EAGY,iBAAZD,GAA2C,iBAAZD,EACtCE,EAAOlN,KAAKmN,IAAIF,EAAUD,GAGrBpJ,MAAMC,QAAQoJ,IAAYrJ,MAAMC,QAAQmJ,KAE7CE,EAAOlN,KAAKoN,MAAKC,MAAVrN,KAAI2D,EAAUsJ,EAAQvB,IAAI,SAAC1J,EAAGZ,GAAC,OAAKY,GAAKgL,EAAQ5L,IAAM,EAAE,MAGpEwL,GAAqB5J,EAAIkK,CAC7B,CACJ,EAnBA,IAAK,IAAMH,KAAOL,EAAMG,IAoBxB,OAAO7M,KAAKsN,MAAMd,EAAOI,EAC7B,CAOO,SAAeW,GAAUC,GAAA,OAAAC,GAAAJ,MAAC,KAADrO,UAAA,CAIhC,SAAAyO,KAzmBA,IAAAzM,EAumBC,OAvmBDA,EAymBA+B,IAAAE,EAJO,SAAAyK,EAA0BC,GAAO,OAAA5K,IAAAC,EAAA,SAAA4K,GAAA,cAAAA,EAAA5M,EAAA,OAAA4M,EAAA3L,EAAA,EAC7B,IAAIuB,QAAQ,SAAAC,GAAO,OAAIoK,WAAWpK,EAASkK,EAAQ,GAAC,EAAAD,EAAA,GAG/DD,GAzmBA,eAAA5M,EAAA,KAAAD,EAAA5B,UAAA,WAAAwE,QAAA,SAAA1C,EAAAI,GAAA,IAAAe,EAAAjB,EAAAqM,MAAAxM,EAAAD,GAAA,SAAAkN,EAAA9M,GAAAuC,EAAAtB,EAAAnB,EAAAI,EAAA4M,EAAAC,EAAA,OAAA/M,EAAA,UAAA+M,EAAA/M,GAAAuC,EAAAtB,EAAAnB,EAAAI,EAAA4M,EAAAC,EAAA,QAAA/M,EAAA,CAAA8M,OAAA,MAumBCL,GAAAJ,MAAA,KAAArO,UAAA,CAqCM,SAASgP,GAAsBC,GAC9BrK,MAAMC,QAAQoK,KACdA,EAAQC,QAAQ,SAAAC,GACRA,EAAIC,YACJD,EAAIC,WAAWC,YAAYF,EAEnC,GACAF,EAAQhP,OAAS,EAEzB,C,+sBCppBA,IAMMqP,GAAQ,WA2BV,O,EArBA,SAAAA,EAAYC,I,4FAAQC,CAAA,KAAAF,GAChBG,KAAKF,OAASA,EAEdE,KAAKC,GAAKD,KAAKF,OAAOI,WAAW,QAAS,CACtCC,WAAW,EACXC,OAAO,EACPC,OAAO,EACPC,SAAS,EACTC,uBAAuB,EACvBC,gBAAiB,qBAGhBR,KAAKC,IAKVD,KAAKS,mBAAqBT,KAAKS,mBAAmB/M,KAAKsM,MACvDA,KAAKF,OAAOY,iBAAiB,mBAAoBV,KAAKS,qBALlDE,MAAM,qDAMd,G,EAEA,EAAArC,IAAA,qBAAAvK,MAKA,SAAmB6M,GACfA,EAAMC,iBAMNb,KAAKc,MACT,GAEA,CAAAxC,IAAA,OAAAvK,MAMA,WACI,MAAM,IAAIgN,MAAM,kBACpB,GAEA,CAAAzC,IAAA,OAAAvK,MAMA,WACI,MAAM,IAAIgN,MAAM,kBACpB,GAEA,CAAAzC,IAAA,QAAAvK,MAMA,WACI,MAAM,IAAIgN,MAAM,kBACpB,GAEA,CAAAzC,IAAA,UAAAvK,MAGA,WACIiM,KAAKC,GAAK,KACVD,KAAKF,OAAS,IAClB,M,2FAAC,CA9ES,G,uPCPd,IAAA3N,EAAAC,EAAAC,EAAA,mBAAAC,OAAAA,OAAA,GAAAC,EAAAF,EAAAG,UAAA,aAAAC,EAAAJ,EAAAK,aAAA,yBAAAC,EAAAN,EAAAE,EAAAE,EAAAE,GAAA,IAAAC,EAAAL,GAAAA,EAAAM,qBAAAC,EAAAP,EAAAO,EAAAC,EAAAC,OAAAC,OAAAL,EAAAC,WAAA,OAAAK,GAAAH,EAAA,mBAAAV,EAAAE,EAAAE,GAAA,IAAAE,EAAAC,EAAAG,EAAAI,EAAA,EAAAC,EAAAX,GAAA,GAAAY,GAAA,EAAAC,EAAA,CAAAF,EAAA,EAAAb,EAAA,EAAAgB,EAAApB,EAAAqB,EAAAC,EAAAN,EAAAM,EAAAC,KAAAvB,EAAA,GAAAsB,EAAA,SAAArB,EAAAC,GAAA,OAAAM,EAAAP,EAAAQ,EAAA,EAAAG,EAAAZ,EAAAmB,EAAAf,EAAAF,EAAAmB,CAAA,YAAAC,EAAApB,EAAAE,GAAA,IAAAK,EAAAP,EAAAU,EAAAR,EAAAH,EAAA,GAAAiB,GAAAF,IAAAV,GAAAL,EAAAgB,EAAA5C,OAAA4B,IAAA,KAAAK,EAAAE,EAAAS,EAAAhB,GAAAqB,EAAAH,EAAAF,EAAAO,EAAAhB,EAAA,GAAAN,EAAA,GAAAI,EAAAkB,IAAApB,KAAAQ,EAAAJ,GAAAC,EAAAD,EAAA,OAAAC,EAAA,MAAAD,EAAA,GAAAA,EAAA,GAAAR,GAAAQ,EAAA,IAAAc,KAAAhB,EAAAJ,EAAA,GAAAoB,EAAAd,EAAA,KAAAC,EAAA,EAAAU,EAAAC,EAAAhB,EAAAe,EAAAf,EAAAI,EAAA,IAAAc,EAAAE,IAAAlB,EAAAJ,EAAA,GAAAM,EAAA,GAAAJ,GAAAA,EAAAoB,KAAAhB,EAAA,GAAAN,EAAAM,EAAA,GAAAJ,EAAAe,EAAAf,EAAAoB,EAAAf,EAAA,OAAAH,GAAAJ,EAAA,SAAAmB,EAAA,MAAAH,GAAA,EAAAd,CAAA,iBAAAE,EAAAW,EAAAO,GAAA,GAAAR,EAAA,QAAAS,UAAA,oCAAAP,GAAA,IAAAD,GAAAK,EAAAL,EAAAO,GAAAf,EAAAQ,EAAAL,EAAAY,GAAAvB,EAAAQ,EAAA,EAAAT,EAAAY,KAAAM,GAAA,CAAAV,IAAAC,EAAAA,EAAA,GAAAA,EAAA,IAAAU,EAAAf,GAAA,GAAAkB,EAAAb,EAAAG,IAAAO,EAAAf,EAAAQ,EAAAO,EAAAC,EAAAR,GAAA,OAAAI,EAAA,EAAAR,EAAA,IAAAC,IAAAH,EAAA,QAAAL,EAAAO,EAAAF,GAAA,MAAAL,EAAAA,EAAAyB,KAAAlB,EAAAI,IAAA,MAAAa,UAAA,wCAAAxB,EAAA0B,KAAA,OAAA1B,EAAAW,EAAAX,EAAA2B,MAAAnB,EAAA,IAAAA,EAAA,YAAAA,IAAAR,EAAAO,EAAA,SAAAP,EAAAyB,KAAAlB,GAAAC,EAAA,IAAAG,EAAAa,UAAA,oCAAAnB,EAAA,YAAAG,EAAA,GAAAD,EAAAR,CAAA,UAAAC,GAAAiB,EAAAC,EAAAf,EAAA,GAAAQ,EAAAV,EAAAwB,KAAAtB,EAAAe,MAAAE,EAAA,YAAApB,GAAAO,EAAAR,EAAAS,EAAA,EAAAG,EAAAX,CAAA,SAAAe,EAAA,UAAAY,MAAA3B,EAAA0B,KAAAT,EAAA,GAAAhB,EAAAI,EAAAE,IAAA,GAAAI,CAAA,KAAAS,EAAA,YAAAV,IAAA,UAAAkB,IAAA,UAAAC,IAAA,CAAA7B,EAAAY,OAAAkB,eAAA,IAAAtB,EAAA,GAAAL,GAAAH,EAAAA,EAAA,GAAAG,QAAAW,GAAAd,EAAA,GAAAG,EAAA,yBAAAH,GAAAW,EAAAkB,EAAApB,UAAAC,EAAAD,UAAAG,OAAAC,OAAAL,GAAA,SAAAO,EAAAhB,GAAA,OAAAa,OAAAmB,eAAAnB,OAAAmB,eAAAhC,EAAA8B,IAAA9B,EAAAiC,UAAAH,EAAAf,GAAAf,EAAAM,EAAA,sBAAAN,EAAAU,UAAAG,OAAAC,OAAAF,GAAAZ,CAAA,QAAA6B,EAAAnB,UAAAoB,EAAAf,GAAAH,EAAA,cAAAkB,GAAAf,GAAAe,EAAA,cAAAD,GAAAA,EAAAK,YAAA,oBAAAnB,GAAAe,EAAAxB,EAAA,qBAAAS,GAAAH,GAAAG,GAAAH,EAAAN,EAAA,aAAAS,GAAAH,EAAAR,EAAA,yBAAAW,GAAAH,EAAA,oDAAAuB,GAAA,kBAAAC,EAAA5B,EAAA6B,EAAArB,EAAA,cAAAD,GAAAf,EAAAE,EAAAE,EAAAH,GAAA,IAAAO,EAAAK,OAAAyB,eAAA,IAAA9B,EAAA,gBAAAR,GAAAQ,EAAA,EAAAO,GAAA,SAAAf,EAAAE,EAAAE,EAAAH,GAAA,SAAAK,EAAAJ,EAAAE,GAAAW,GAAAf,EAAAE,EAAA,SAAAF,GAAA,YAAAuC,QAAArC,EAAAE,EAAAJ,EAAA,GAAAE,EAAAM,EAAAA,EAAAR,EAAAE,EAAA,CAAA0B,MAAAxB,EAAAoC,YAAAvC,EAAAwC,cAAAxC,EAAAyC,UAAAzC,IAAAD,EAAAE,GAAAE,GAAAE,EAAA,UAAAA,EAAA,WAAAA,EAAA,cAAAS,GAAAf,EAAAE,EAAAE,EAAAH,EAAA,UAAA0C,GAAAvC,EAAAH,EAAAD,EAAAE,EAAAI,EAAAe,EAAAZ,GAAA,QAAAD,EAAAJ,EAAAiB,GAAAZ,GAAAG,EAAAJ,EAAAoB,KAAA,OAAAxB,GAAA,YAAAJ,EAAAI,EAAA,CAAAI,EAAAmB,KAAA1B,EAAAW,GAAAgC,QAAAC,QAAAjC,GAAAkC,KAAA5C,EAAAI,EAAA,UAAAuO,GAAAzO,GAAA,sBAAAH,EAAA,KAAAD,EAAA5B,UAAA,WAAAwE,QAAA,SAAA1C,EAAAI,GAAA,IAAAe,EAAAjB,EAAAqM,MAAAxM,EAAAD,GAAA,SAAAkN,EAAA9M,GAAAuC,GAAAtB,EAAAnB,EAAAI,EAAA4M,EAAAC,EAAA,OAAA/M,EAAA,UAAA+M,EAAA/M,GAAAuC,GAAAtB,EAAAnB,EAAAI,EAAA4M,EAAAC,EAAA,QAAA/M,EAAA,CAAA8M,OAAA,eAAA1J,GAAAtD,EAAAF,GAAA,gBAAAE,GAAA,GAAA8C,MAAAC,QAAA/C,GAAA,OAAAA,CAAA,CAAAuD,CAAAvD,IAAA,SAAAA,EAAAsB,GAAA,IAAAvB,EAAA,MAAAC,EAAA,yBAAAC,QAAAD,EAAAC,OAAAE,WAAAH,EAAA,uBAAAD,EAAA,KAAAD,EAAAI,EAAAI,EAAAI,EAAAS,EAAA,GAAAL,GAAA,EAAAV,GAAA,SAAAE,GAAAP,EAAAA,EAAAyB,KAAAxB,IAAAwD,KAAA,IAAAlC,EAAA,IAAAX,OAAAZ,KAAAA,EAAA,OAAAe,GAAA,cAAAA,GAAAhB,EAAAQ,EAAAkB,KAAAzB,IAAA0B,QAAAN,EAAAsC,KAAA3D,EAAA4B,OAAAP,EAAAhD,SAAAmD,GAAAR,GAAA,UAAAd,GAAAI,GAAA,EAAAF,EAAAF,CAAA,iBAAAc,GAAA,MAAAf,EAAA,SAAAW,EAAAX,EAAA,SAAAY,OAAAD,KAAAA,GAAA,kBAAAN,EAAA,MAAAF,CAAA,SAAAiB,CAAA,EAAAuC,CAAA1D,EAAAF,IAAAsD,GAAApD,EAAAF,IAAA,qBAAAyB,UAAA,6IAAAoC,EAAA,UAAAd,GAAA7C,GAAA,gBAAAA,GAAA,GAAA8C,MAAAC,QAAA/C,GAAA,OAAAgD,GAAAhD,EAAA,CAAAiD,CAAAjD,IAAA,SAAAA,GAAA,uBAAAC,QAAA,MAAAD,EAAAC,OAAAE,WAAA,MAAAH,EAAA,qBAAA8C,MAAAI,KAAAlD,EAAA,CAAAmD,CAAAnD,IAAAoD,GAAApD,IAAA,qBAAAuB,UAAA,wIAAA8B,EAAA,UAAAD,GAAApD,EAAAmB,GAAA,GAAAnB,EAAA,qBAAAA,EAAA,OAAAgD,GAAAhD,EAAAmB,GAAA,IAAApB,EAAA,GAAA6D,SAAApC,KAAAxB,GAAA6D,MAAA,uBAAA9D,GAAAC,EAAA8D,cAAA/D,EAAAC,EAAA8D,YAAAC,MAAA,QAAAhE,GAAA,QAAAA,EAAA+C,MAAAI,KAAAlD,GAAA,cAAAD,GAAA,2CAAAiE,KAAAjE,GAAAiD,GAAAhD,EAAAmB,QAAA,YAAA6B,GAAAhD,EAAAmB,IAAA,MAAAA,GAAAA,EAAAnB,EAAA7B,UAAAgD,EAAAnB,EAAA7B,QAAA,QAAA2B,EAAA,EAAAI,EAAA4C,MAAA3B,GAAArB,EAAAqB,EAAArB,IAAAI,EAAAJ,GAAAE,EAAAF,GAAA,OAAAI,CAAA,UAAA0O,GAAA9O,EAAAE,GAAA,QAAAD,EAAA,EAAAA,EAAAC,EAAA7B,OAAA4B,IAAA,KAAAK,EAAAJ,EAAAD,GAAAK,EAAAkC,WAAAlC,EAAAkC,aAAA,EAAAlC,EAAAmC,cAAA,YAAAnC,IAAAA,EAAAoC,UAAA,GAAA7B,OAAAyB,eAAAtC,EAAA+O,GAAAzO,EAAA6L,KAAA7L,EAAA,WAAAyO,GAAA9O,GAAA,IAAAO,EAAA,SAAAP,EAAAC,GAAA,aAAA8O,GAAA/O,KAAAA,EAAA,OAAAA,EAAA,IAAAD,EAAAC,EAAAE,OAAA8O,aAAA,YAAAjP,EAAA,KAAAQ,EAAAR,EAAA0B,KAAAzB,EAAAC,GAAA,wBAAA8O,GAAAxO,GAAA,OAAAA,EAAA,UAAAiB,UAAA,kEAAAvB,EAAAuJ,OAAA3E,QAAA7E,EAAA,CAAAiP,CAAAjP,EAAA,0BAAA+O,GAAAxO,GAAAA,EAAAA,EAAA,YAAA2O,GAAAlP,EAAAK,EAAAN,GAAA,OAAAM,EAAA8O,GAAA9O,GAAA,SAAAL,EAAAD,GAAA,GAAAA,IAAA,UAAAgP,GAAAhP,IAAA,mBAAAA,GAAA,OAAAA,EAAA,YAAAA,EAAA,UAAAyB,UAAA,4EAAAzB,GAAA,YAAAA,EAAA,UAAAqP,eAAA,oEAAArP,CAAA,CAAAsP,CAAArP,EAAA,CAAAsP,CAAAtP,EAAAuP,KAAAC,QAAAC,UAAApP,EAAAN,GAAA,GAAAoP,GAAAnP,GAAA+D,aAAA1D,EAAAmM,MAAAxM,EAAAD,GAAA,UAAAwP,KAAA,QAAAvP,GAAA0P,QAAAjP,UAAAkP,QAAAlO,KAAA+N,QAAAC,UAAAC,QAAA,wBAAA1P,GAAA,QAAAuP,GAAA,mBAAAvP,CAAA,cAAA4P,KAAA,OAAAA,GAAA,oBAAAJ,SAAAA,QAAAnJ,IAAAmJ,QAAAnJ,IAAA/E,OAAA,SAAAvB,EAAAC,EAAAC,GAAA,IAAAe,EAAA,SAAAhB,EAAAK,GAAA,SAAA4L,eAAAxK,KAAAzB,EAAAK,IAAA,QAAAL,EAAAmP,GAAAnP,MAAA,OAAAA,CAAA,CAAA6P,CAAA9P,EAAAC,GAAA,GAAAgB,EAAA,KAAAb,EAAAS,OAAAkP,yBAAA9O,EAAAhB,GAAA,OAAAG,EAAAkG,IAAAlG,EAAAkG,IAAA5E,KAAAtD,UAAAC,OAAA,EAAA2B,EAAAE,GAAAE,EAAAwB,KAAA,GAAAiO,GAAApD,MAAA,KAAArO,UAAA,UAAAgR,GAAAnP,GAAA,OAAAmP,GAAAvO,OAAAmB,eAAAnB,OAAAkB,eAAAR,OAAA,SAAAtB,GAAA,OAAAA,EAAAgC,WAAApB,OAAAkB,eAAA9B,EAAA,EAAAmP,GAAAnP,EAAA,UAAA+P,GAAA/P,EAAAD,GAAA,OAAAgQ,GAAAnP,OAAAmB,eAAAnB,OAAAmB,eAAAT,OAAA,SAAAtB,EAAAD,GAAA,OAAAC,EAAAgC,UAAAjC,EAAAC,CAAA,EAAA+P,GAAA/P,EAAAD,EAAA,CA8BA,IASMiQ,GAAe,SAAAC,GAKjB,SAAAD,EAAYtC,GAAQ,IAAAwC,EAkFkC,OA9H1D,SAAA9O,EAAAjB,GAAA,KAAAiB,aAAAjB,GAAA,UAAAqB,UAAA,qCA4CwBmM,CAAA,KAAAqC,IAChBE,EAAAhB,GAAA,KAAAc,EAAA,CAAMtC,KAGDyC,SAAW,IAEhBD,EAAKE,iBAAmB,EACxBF,EAAKG,aAAe,EAEpBH,EAAKI,YAAc,CAAC,EAAG,GACvBJ,EAAKK,gBAAkB,CAAC,EAAK,EAAK,GAClCL,EAAKM,SAAW,MAChBN,EAAKO,SAAW,GAMhBP,EAAKQ,QAAU,GAGfR,EAAK3L,KAAO2L,EAAKG,aAGjBH,EAAKS,IAAG7N,GAAOoN,EAAKI,aAGpBJ,EAAKU,MAAQ,CACT7R,EAAGyJ,EAAO0H,EAAKS,IAAI,GAAI,GACvB1P,EAAGuH,EAAO0H,EAAKS,IAAI,GAAI,IAO3BT,EAAK1L,SAAW0L,EAAKE,iBAErBF,EAAKW,yBAA2B,KAChCX,EAAKY,0BAA4B,KACjCZ,EAAKa,8BAAgC,KACrCb,EAAKc,2BAA6B,KAElCd,EAAKe,uBAAyB,KAE9Bf,EAAKgB,YAAa,EAClBhB,EAAKiB,mBAAqB,EAE1BjB,EAAKkB,mBAAoB,EACzBlB,EAAKmB,iBAAmB,KAGxBnB,EAAKoB,WAAa,EAClBpB,EAAKqB,gBAAkB,EAGvBrB,EAAKsB,8BAAgC,EAGrCtB,EAAKuB,uBHjBsB,KGoB3BvB,EAAKwB,mBAAqBlT,EAG1B0R,EAAKyB,aAAY7O,GAAOoN,EAAKK,iBAG7BL,EAAK0B,cAAgB,CACjBC,MAAO,EACPC,MAAO,EACPC,KAAMtK,IACNuK,KAAMvK,IACNlD,KAAMkD,IACNjD,SAAUiD,IACV6J,WAAY7J,IACZwK,OAAQxK,IACRyK,OAAQzK,IACR0K,OAAQ1K,KAIZyI,EAAKkC,mB,8RAA6ClC,CACtD,CAEA,OAjIJ,SAAAlQ,EAAAD,GAAA,sBAAAA,GAAA,OAAAA,EAAA,UAAAyB,UAAA,sDAAAxB,EAAAS,UAAAG,OAAAC,OAAAd,GAAAA,EAAAU,UAAA,CAAAsD,YAAA,CAAApC,MAAA3B,EAAAyC,UAAA,EAAAD,cAAA,KAAA5B,OAAAyB,eAAArC,EAAA,aAAAyC,UAAA,IAAA1C,GAAAgQ,GAAA/P,EAAAD,EAAA,CAiIIsS,CAAArC,EAAAC,GAjIJlQ,EAiIIiQ,EAjIJ/P,EAiII,EAAAiM,IAAA,iBAAAvK,MAIA,WAAkB,GAElB,CAAAuK,IAAA,yBAAAvK,MAIA,WACIiM,KAAKgE,cAAcC,MAAQ,EAC3BjE,KAAKgE,cAAcE,MAAQ,EAC3BlE,KAAKgE,cAAcG,KAAOtK,IAC1BmG,KAAKgE,cAAcI,KAAOvK,IAC1BmG,KAAKgE,cAAcrN,KAAOkD,IAC1BmG,KAAKgE,cAAcpN,SAAWiD,IAC9BmG,KAAKgE,cAAcN,WAAa7J,IAChCmG,KAAKgE,cAAcK,OAASxK,IAC5BmG,KAAKgE,cAAcM,OAASzK,IAC5BmG,KAAKgE,cAAcO,OAAS1K,GAChC,GAIA,CAAAyE,IAAA,SAAAvK,MACA,WACI,MAAO,CAACiM,KAAK+C,IAAI,GAAI/C,KAAK+C,IAAI,GAClC,GAEA,CAAAzE,IAAA,SAAAvK,MAOA,SAAO5C,EAAGkC,GACNkI,EAAMyE,KAAKgD,MAAM7R,EAAGA,GACpBoK,EAAMyE,KAAKgD,MAAM3P,EAAGA,GACpB2M,KAAK+C,IAAI,GAAKvH,EAAQwE,KAAKgD,MAAM7R,GACjC6O,KAAK+C,IAAI,GAAKvH,EAAQwE,KAAKgD,MAAM3P,EACrC,GAEA,CAAAiL,IAAA,SAAAvK,MAOA,SAAO2Q,EAAIC,GACPtJ,EAAM2E,KAAKgD,MAAM7R,EAAGuT,GACpBrJ,EAAM2E,KAAKgD,MAAM3P,EAAGsR,GACpB3E,KAAK+C,IAAI,GAAKvH,EAAQwE,KAAKgD,MAAM7R,GACjC6O,KAAK+C,IAAI,GAAKvH,EAAQwE,KAAKgD,MAAM3P,EACrC,GAEA,CAAAiL,IAAA,mBAAAvK,MAIA,SAAiB6Q,EAAUC,EAAUC,EAAIC,GACrC,IAAMtO,EAAKmO,EAAWE,EAAK9E,KAAKrJ,KAC1BD,EAAKmO,EAAWE,EAAK/E,KAAKrJ,KAChCqJ,KAAKgF,OAAOvO,EAAIC,EACpB,GAEA,CAAA4H,IAAA,uBAAAvK,MAQA,SAAqBkR,EAAYC,EAASC,GACtC,IAA0DC,EAAAzP,GAAzCqK,KAAKqF,mBAAmBH,EAASC,GAAQ,GAAnDL,EAAEM,EAAA,GAAEL,EAAEK,EAAA,GACPE,EAAYtF,KAAKrJ,KAAOsO,EAE9BjF,KAAKuF,OAAOT,EAAKQ,EAAWP,EAAKO,GACjCtF,KAAKrJ,KAAOsO,CAChB,GAEA,CAAA3G,IAAA,kBAAAvK,MAMA,WAAgC,IAAAyR,EAAA,KAAhBC,EAAQlV,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,IACvByP,KAAKwD,mBAAoB,EACzBxD,KAAK0F,qBAAuBC,YAAYC,MAEpC5F,KAAKyD,mBACLoC,aAAa7F,KAAKyD,kBAClBzD,KAAKyD,iBAAmB,MAG5BzD,KAAKyD,iBAAmBrE,WAAW,WAC/BoG,EAAKhC,mBAAoB,EAGzBgC,EAAKM,iBAGLN,EAAKO,OACLC,IAAW,EACf,EAAGP,EACP,GAEA,CAAAnH,IAAA,UAAAvK,MACA,WAjPJ,IAAA3B,EAAAK,EAAAN,EAAAE,EAAAe,EAoPQ4M,KAAKiG,4BACLjG,KAAKkG,6BAGDlG,KAAKF,QACLE,KAAKF,OAAOqG,oBAAoB,mBAAoBnG,KAAKS,oBAIzDT,KAAKoG,UACLpG,KAAKC,GAAGoG,cAAcrG,KAAKoG,SAC3BpG,KAAKoG,QAAU,MAEfpG,KAAKsG,eACLtG,KAAKC,GAAGsG,aAAavG,KAAKsG,cAC1BtG,KAAKsG,aAAe,MAEpBtG,KAAKwG,iBACLxG,KAAKC,GAAGsG,aAAavG,KAAKwG,gBAC1BxG,KAAKwG,eAAiB,MAGtBxG,KAAKyD,mBACLoC,aAAa7F,KAAKyD,kBAClBzD,KAAKyD,iBAAmB,OA5QpCrR,EA+QQgQ,EA/QR3P,EA+QQ,UA/QRN,EA+QQ,KA/QRiB,EAAA4O,GAAAT,GAAA,GAAAlP,EA+QQ,GA/QRD,EAAAS,UAAAT,GAAAK,EAAAN,GAAA,EAAAE,GAAA,mBAAAe,EAAA,SAAAhB,GAAA,OAAAgB,EAAAwL,MAAAzM,EAAAC,EAAA,EAAAgB,GA+QQ,GAGJ,GAEA,CAAAkL,IAAA,oBAAAvK,MAEA,WACIiM,KAAK8C,QAAQrD,QAAQ,SAACgH,EAAQC,GAC1BD,EAAOC,MAAQA,CACnB,EACJ,GAAC,CAAApI,IAAA,OAAAvK,MAED,WACIiM,KAAK2G,oBACL3G,KAAK4G,gBACL5G,KAAK+F,MACT,GAAC,CAAAzH,IAAA,eAAAvK,MAED,WACI3D,EAAI,eAAgB4P,KAAK7J,YAAYC,MAErC4J,KAAKC,GAAG4G,WAAW7G,KAAKoG,SAGxB,IAAMU,EAAU9G,KAAKF,OAAOiH,wBACtBlQ,EAAKiQ,EAAQE,MAAQ,EACrBlQ,EAAKgQ,EAAQG,OAAS,EAE6BC,EAAAvR,GAA5BqK,KAAKmH,gBAAgBtQ,EAAIC,GAAG,GAAlDsQ,EAAQF,EAAA,GAAEG,EAAQH,EAAA,GAEnBI,EAAMzP,OAAO0P,kBAAoB,EACvCvH,KAAKF,OAAOkH,MAAQzV,KAAKiW,MAAMV,EAAQE,MAAQM,GAC/CtH,KAAKF,OAAOmH,OAAS1V,KAAKiW,MAAMV,EAAQG,OAASK,GAEjDtH,KAAKC,GAAGwH,SAAS,EAAG,EAAGzH,KAAKF,OAAOkH,MAAOhH,KAAKF,OAAOmH,QAClDjH,KAAK0H,eAAe1H,KAAKC,GAAG0H,UAAU3H,KAAK0H,cAAe1H,KAAKF,OAAOkH,MAAOhH,KAAKF,OAAOmH,QAE7F,IAAgDW,EAAAjS,GAA/BqK,KAAKqF,mBAAmBxO,EAAIC,GAAG,GAAzCgO,EAAE8C,EAAA,GAAE7C,EAAE6C,EAAA,GACb5H,KAAK6H,iBAAiBT,EAAUC,EAAUvC,EAAIC,GAG9C/E,KAAK8F,iBACL9F,KAAK+F,MACT,GAGA,CAAAzH,IAAA,6BAAAvK,MAMA,WACI,MAAM,IAAIgN,MAAM,uDACpB,GAEA,CAAAzC,IAAA,gBAAAvK,MAMA,SAAc+T,EAAQC,GAMlB,IAAMC,EAAShI,KAAKC,GAAGgI,aAAaF,GAIpC,OAHA/H,KAAKC,GAAGiI,aAAaF,EAAQF,GAC7B9H,KAAKC,GAAGkI,cAAcH,GAEjBhI,KAAKC,GAAGmI,mBAAmBJ,EAAQhI,KAAKC,GAAGoI,gBAQzCL,GANHhI,KAAKC,GAAGsG,aAAayB,GAEd,KAKf,GAEA,CAAA1J,IAAA,gBAAAvK,MAGA,WAGQiM,KAAKoG,SAASpG,KAAKC,GAAGoG,cAAcrG,KAAKoG,SACzCpG,KAAKwG,gBAAgBxG,KAAKC,GAAGsG,aAAavG,KAAKwG,gBAE9CxG,KAAKsG,eACNtG,KAAKsG,aAAetG,KAAKmI,cAAcnI,KAAKwE,mBAAoBxE,KAAKC,GAAGqI,gBAE5EtI,KAAKwG,eAAiBxG,KAAKmI,cAAcnI,KAAKuI,6BAA8BvI,KAAKC,GAAGuI,iBAEpFxI,KAAKoG,QAAUpG,KAAKC,GAAGwI,gBACvBzI,KAAKC,GAAGyI,aAAa1I,KAAKoG,QAASpG,KAAKsG,cACxCtG,KAAKC,GAAGyI,aAAa1I,KAAKoG,QAASpG,KAAKwG,gBACxCxG,KAAKC,GAAG0I,YAAY3I,KAAKoG,SAEpBpG,KAAKC,GAAG2I,oBAAoB5I,KAAKoG,QAASpG,KAAKC,GAAG4I,aAGvD7I,KAAKC,GAAG4G,WAAW7G,KAAKoG,SAGxB,IAAM0C,EAAiB9I,KAAKC,GAAG8I,eAC/B/I,KAAKC,GAAG+I,WAAWhJ,KAAKC,GAAGgJ,aAAcH,GACzC,IAAMI,EAAY,IAAIC,aAAa,EAAE,GAAI,EAAG,GAAI,GAAI,EAAG,EAAG,EAAG,IAC7DnJ,KAAKC,GAAGmJ,WAAWpJ,KAAKC,GAAGgJ,aAAcC,EAAWlJ,KAAKC,GAAGoJ,aAC5D,IAAMC,EAActJ,KAAKC,GAAGsJ,kBAAkBvJ,KAAKoG,QAAS,cAC5DpG,KAAKC,GAAGuJ,wBAAwBF,GAChCtJ,KAAKC,GAAGwJ,oBAAoBH,EAAa,EAAGtJ,KAAKC,GAAGyJ,OAAO,EAAO,EAAG,GAErE1J,KAAK2J,iBACL3J,KAAK4J,yBAEgC,mBAA1B5J,KAAK6J,kBACZ7J,KAAK6J,kBAIb,GAEA,CAAAvL,IAAA,mBAAAvK,MACA,WACI,MAAM,IAAIgN,MAAM,mEACpB,GAEA,CAAAzC,IAAA,cAAAvK,MAIA,WACI,MAAM,IAAIgN,MAAM,8DACpB,GAEA,CAAAzC,IAAA,iBAAAvK,MAGA,WACIiM,KAAKC,GAAG4G,WAAW7G,KAAKoG,SACxBpG,KAAK8J,OAAS9J,KAAKC,GAAG8J,mBAAmB/J,KAAKoG,QAAS,SACvDpG,KAAKgK,QAAUhK,KAAKC,GAAG8J,mBAAmB/J,KAAKoG,QAAS,UACxDpG,KAAKiK,QAAUjK,KAAKC,GAAG8J,mBAAmB/J,KAAKoG,QAAS,gBACxDpG,KAAKkK,SAAWlK,KAAKC,GAAG8J,mBAAmB/J,KAAKoG,QAAS,kBACzDpG,KAAKmK,YAAcnK,KAAKC,GAAG8J,mBAAmB/J,KAAKoG,QAAS,cAC5DpG,KAAK0H,cAAgB1H,KAAKC,GAAG8J,mBAAmB/J,KAAKoG,QAAS,eAClE,GAEA,CAAA9H,IAAA,OAAAvK,MAKA,WACIiM,KAAKC,GAAG4G,WAAW7G,KAAKoG,SAExB,IAAM7R,EAAIyL,KAAKF,OAAOkH,MAChB3K,EAAI2D,KAAKF,OAAOmH,OAChBmD,EAAKpK,KAAKgE,cAEhBhE,KAAKC,GAAGwH,SAAS,EAAG,EAAGlT,EAAG8H,IAGtB2D,KAAK0H,eAAkB0C,EAAGnG,OAAS1P,GAAK6V,EAAGlG,OAAS7H,IACpD2D,KAAKC,GAAG0H,UAAU3H,KAAK0H,cAAenT,EAAG8H,GACzC+N,EAAGnG,KAAO1P,EACV6V,EAAGlG,KAAO7H,IAGV2D,KAAK8J,QAAWM,EAAGjG,OAASnE,KAAK+C,IAAI,IAAMqH,EAAGhG,OAASpE,KAAK+C,IAAI,KAChE/C,KAAKC,GAAGoK,WAAWrK,KAAK8J,OAAQ9J,KAAK+C,KACrCqH,EAAGjG,KAAOnE,KAAK+C,IAAI,GACnBqH,EAAGhG,KAAOpE,KAAK+C,IAAI,IAGnB/C,KAAKgK,SAAWI,EAAGzT,OAASqJ,KAAKrJ,OACjCqJ,KAAKC,GAAGqK,UAAUtK,KAAKgK,QAAShK,KAAKrJ,MACrCyT,EAAGzT,KAAOqJ,KAAKrJ,MAGfqJ,KAAKmK,aAAeC,EAAGxT,WAAaoJ,KAAKpJ,WACzCoJ,KAAKC,GAAGqK,UAAUtK,KAAKmK,YAAanK,KAAKpJ,UACzCwT,EAAGxT,SAAWoJ,KAAKpJ,UAGnBoJ,KAAKiK,SAAWG,EAAG1G,aAAe1D,KAAK0D,aACvC1D,KAAKC,GAAGqK,UAAUtK,KAAKiK,QAASjK,KAAK0D,YACrC0G,EAAG1G,WAAa1D,KAAK0D,aAGrB1D,KAAKkK,UAAaE,EAAG/F,SAAWrE,KAAK+D,aAAa,IAClDqG,EAAG9F,SAAWtE,KAAK+D,aAAa,IAChCqG,EAAG7F,SAAWvE,KAAK+D,aAAa,KAChC/D,KAAKC,GAAGsK,WAAWvK,KAAKkK,SAAUlK,KAAK+D,cACvCqG,EAAG/F,OAASrE,KAAK+D,aAAa,GAC9BqG,EAAG9F,OAAStE,KAAK+D,aAAa,GAC9BqG,EAAG7F,OAASvE,KAAK+D,aAAa,IAGlC/D,KAAKC,GAAGuK,WAAW,EAAG,EAAG,EAAG,GAC5BxK,KAAKC,GAAGwK,MAAMzK,KAAKC,GAAGyK,kBACtBC,UAAAA,GAAYC,gBACZ5K,KAAKC,GAAG4K,WAAW7K,KAAKC,GAAG6K,eAAgB,EAAG,GAC9CH,UAAAA,GAAYI,cACZ/K,KAAKgL,uBACT,GAEA,CAAA1M,IAAA,wBAAAvK,MAIA,WACI,GAAKiM,KAAK6D,wBACL8G,UAAAA,GAAYM,KAAjB,CAEA,IAAMC,EAAQP,GAAWM,KAAKE,cAC9B,GAAKlU,OAAO8C,SAASmR,KAGjBlL,KAAKwD,kBAAT,CAGA,IAAMoC,EAAMD,YAAYC,MACxB,KAAIA,EAAM5F,KAAK4D,8BH5XkB,KG+XjC,GAAIsH,EHzZmC,GGyZM,CACzC,IAAME,EAAW7Z,KAAKmL,IAAIsD,KAAK8D,mBAAoB9D,KAAK2D,gBH7Y/B,IG8YrByH,IAAapL,KAAK2D,kBAClB3D,KAAK2D,gBAAkByH,EACvBpL,KAAK4D,8BAAgCgC,EAE7C,MAEK,GAAIsF,EAAQva,GAAkCqP,KAAK2D,gBAAkB,EAAG,CACzE,IAAMyH,EAAW7Z,KAAKoL,IAAI,EAAGqD,KAAK2D,gBHrZT,IGsZrByH,IAAapL,KAAK2D,kBAClB3D,KAAK2D,gBAAkByH,EACvBpL,KAAK4D,8BAAgCgC,EAE7C,CArBkC,CANL,CA4BjC,GAEA,CAAAtH,IAAA,wBAAAvK,MAIA,WACIiM,KAAK6D,wBAA0B7D,KAAK6D,uBAC/B7D,KAAK6D,yBACN7D,KAAK2D,gBAAkB,GAE3BvT,EAAI,qBAADM,OAAsBsP,KAAK6D,uBAAyB,KAAO,OAAS7D,KAAK7J,YAAYC,MACxF4J,KAAK+F,MACT,GAEA,CAAAzH,IAAA,2BAAAvK,MAIA,SAAyBsX,GACrB,IAAMC,EAAStL,KAAK8D,mBAEpB9D,KAAK8D,mBAAqBvS,KAAKmL,KAAK,IAAMnL,KAAKoL,KAAK,IAAKqD,KAAK8D,mBAAqBuH,IAE/ErL,KAAK2D,gBAAkB3D,KAAK8D,qBAC5B9D,KAAK2D,gBAAkB3D,KAAK8D,oBAEhC1T,EAAI,yBAADM,OAA0B4a,EAAM,OAAA5a,OAAMsP,KAAK8D,mBAAkB,aAAApT,OAAY2a,EAAQ,EAAI,IAAM,IAAE3a,OAAG2a,EAAK,KAAKrL,KAAK7J,YAAYC,MAC9H4J,KAAK+F,MACT,GAEA,CAAAzH,IAAA,wBAAAvK,MAKA,SAAsBsX,GAClB,IAAME,EAAWvL,KAAK2D,gBAEhB6H,EAAWja,KAAKmN,IAAIsB,KAAK8D,oBAC/B9D,KAAK2D,gBAAkBpS,KAAKmL,IAAIsD,KAAK8D,mBAAoBvS,KAAKoL,IAAI6O,EAAUxL,KAAK2D,gBAAkB0H,IAC/FE,IAAavL,KAAK2D,kBAClBvT,EAAI,oBAADM,OAAqB6a,EAAQ,OAAA7a,OAAMsP,KAAK2D,gBAAe,aAAAjT,OAAY2a,EAAQ,EAAI,IAAM,IAAE3a,OAAG2a,EAAK,KAAKrL,KAAK7J,YAAYC,MACxH4J,KAAK+F,OAEb,GAEA,CAAAzH,IAAA,QAAAvK,MAGA,WAGIiM,KAAKiG,4BACLjG,KAAKkG,6BAELlG,KAAK+D,aAAY7O,GAAO8K,KAAK2C,iBAC7B3C,KAAKgF,OAAOhF,KAAK0C,YAAY,GAAI1C,KAAK0C,YAAY,IAClD1C,KAAKrJ,KAAOqJ,KAAKyC,aACjBzC,KAAKpJ,SAAWoJ,KAAKwC,iBACrBxC,KAAK2D,gBAAkB,EACvB3D,KAAKuD,mBAAqB,EAE1BvD,KAAKyL,eAELzL,KAAK8F,iBACL9F,KAAK+F,OAGLC,IACJ,GAEA,CAAA1H,IAAA,kBAAAvK,MAMA,SAAgB2X,EAASC,GACrB,IAAMrE,EAAMzP,OAAO0P,kBAAoB,EACjCqE,EAAO5L,KAAKF,OAAOiH,wBACnBxS,EAAIqX,EAAK5E,MAAQM,EACjBjL,EAAIuP,EAAK3E,OAASK,EAQpBuE,EANYH,EAAUpE,EAGF/S,EAGN,GACduX,EAAO,EANKH,EAAUrE,EAGFjL,EAGA,GAGxBwP,GADetX,EAAI8H,EAGnB,IAAM0P,EAAOxa,KAAKya,IAAIhM,KAAKpJ,UACrBqV,EAAO1a,KAAK2a,IAAIlM,KAAKpJ,UAErBuV,EAAWF,EAAOJ,EAAME,EAAOD,EAErC,MAAO,EAHUC,EAAOF,EAAMI,EAAOH,GAGlB9L,KAAKrJ,KAAOqJ,KAAK+C,IAAI,GAAIoJ,EAAWnM,KAAKrJ,KAAOqJ,KAAK+C,IAAI,GAChF,GAEA,CAAAzE,IAAA,mBAAAvK,MASA,SAAiB2X,EAASC,GACtB,IAA0DS,EAAAzW,GAAzCqK,KAAKqF,mBAAmBqG,EAASC,GAAQ,GAAnD7G,EAAEsH,EAAA,GAAErH,EAAEqH,EAAA,GACb,MAAO,CAACtH,EAAK9E,KAAKrJ,KAAMoO,EAAK/E,KAAKrJ,KACtC,GAEA,CAAA2H,IAAA,qBAAAvK,MAQA,SAAmB2X,EAASC,GACxB,IAAMrE,EAAMzP,OAAO0P,kBAAoB,EACjCqE,EAAO5L,KAAKF,OAAOiH,wBACnBxS,EAAIqX,EAAK5E,MAAQM,EACjBjL,EAAIuP,EAAK3E,OAASK,EAQpBuE,EANYH,EAAUpE,EAGF/S,EAGN,GACduX,EAAO,EANKH,EAAUrE,EAGFjL,EAGA,GAGxBwP,GADetX,EAAI8H,EAGnB,IAAM0P,EAAOxa,KAAKya,IAAIhM,KAAKpJ,UACrBqV,EAAO1a,KAAK2a,IAAIlM,KAAKpJ,UAE3B,MAAO,CAACmV,EAAOF,EAAMI,EAAOH,EAAKG,EAAOJ,EAAME,EAAOD,EACzD,GAEA,CAAAxN,IAAA,qBAAAvK,MAIA,WACI,IAAM6X,EAAO5L,KAAKF,OAAOiH,wBACzB,MAAO,CAAC6E,EAAK5E,MAAQ,EAAG4E,EAAK3E,OAAS,EAC1C,GAKA,CAAA3I,IAAA,4BAAAvK,MACA,WAGIiM,KAAKqM,0BACLrM,KAAKsM,2BACLtM,KAAKuM,8BACT,GAEA,CAAAjO,IAAA,0BAAAvK,MACA,WAG0C,OAAlCiM,KAAKiD,2BACLuJ,qBAAqBxM,KAAKiD,0BAC1BjD,KAAKiD,yBAA2B,KAExC,GAEA,CAAA3E,IAAA,2BAAAvK,MACA,WAG2C,OAAnCiM,KAAKkD,4BACLsJ,qBAAqBxM,KAAKkD,2BAC1BlD,KAAKkD,0BAA4B,KAEzC,GAEA,CAAA5E,IAAA,+BAAAvK,MACA,WAG+C,OAAvCiM,KAAKmD,gCACLqJ,qBAAqBxM,KAAKmD,+BAC1BnD,KAAKmD,8BAAgC,KAE7C,GAEA,CAAA7E,IAAA,6BAAAvK,MACA,WAII,IAAM0Y,EAAqBzM,KAAK0M,uBAAyB1M,KAAK2M,0BAyB9D,GAtBI3M,KAAK0M,uBAAyB1M,KAAK2M,4BACnC3M,KAAK0M,sBAAuB,EACxB1M,KAAK4M,0BACL/G,aAAa7F,KAAK4M,yBAClB5M,KAAK4M,wBAA0B,OAIC,OAApC5M,KAAKoD,6BAELoJ,qBAAqBxM,KAAKoD,4BAC1ByC,aAAa7F,KAAKoD,4BAClBpD,KAAKoD,2BAA6B,MAIlCpD,KAAKqD,yBACLrD,KAAKqD,yBACLrD,KAAKqD,uBAAyB,MAI9BoJ,GAAwC,oBAAX5U,OAAwB,CACrD,IAAMgV,EAAWC,SAASC,eAAe,iBACrCF,GACAA,EAASG,UAAUC,OAAO,SAElC,CACJ,GAEA,CAAA3O,IAAA,WAAAvK,MACA,WAEIiM,KAAKsD,YAAa,EAElBtD,KAAKiG,2BACT,GAEA,CAAA3H,IAAA,sBAAAvK,MACA,WACIqL,WAAW,kBAAM4G,IAAY,EAAE,GACnC,GAEA,CAAA1H,IAAA,gCAAAvK,OAAAmZ,EAAAlM,GAAA1M,KAAAE,EASA,SAAAyK,EAAoCkO,GAAU,IAAAC,EAAAC,EAAAC,EAAAC,EAAA,KAAAC,EAAAjd,UAAA,OAAA+D,KAAAC,EAAA,SAAA4K,GAAA,cAAAA,EAAA5M,GAAA,OAER,GAFU6a,EAAQI,EAAAhd,OAAA,QAAAC,IAAA+c,EAAA,GAAAA,EAAA,GAAG,IAAKH,EAAgBG,EAAAhd,OAAA,QAAAC,IAAA+c,EAAA,GAAAA,EAAA,GAAG,KAE/ExN,KAAKkG,8BAEDjK,EAAgB+D,KAAK+D,aAAcoJ,GAAa,CAAFhO,EAAA5M,EAAA,QACK,OAAA4M,EAAA3L,EAAA,UAKb,OAApC8Z,EAAYpY,GAAO8K,KAAK+D,cAAY5E,EAAA5M,EAAA,EAEpC,IAAIwC,QAAQ,SAACC,GAEfuY,EAAKlK,uBAAyBrO,EAC9B,IAAIyY,EAAY,KAEVC,EAAO,SAACC,GACLF,IAAWA,EAAYE,GAC5B,IAAMC,EAAWrc,KAAKoL,KAAKgR,EAAYF,GAAaL,EAAU,GAE9DG,EAAKxJ,aAAe,CAChBxG,EAAK+P,EAAa,GAAIH,EAAW,GAAIS,GACrCrQ,EAAK+P,EAAa,GAAIH,EAAW,GAAIS,GACrCrQ,EAAK+P,EAAa,GAAIH,EAAW,GAAIS,IAEzCL,EAAKxH,OAEDsH,GAAkBA,IAElBO,EAAW,EACXL,EAAKnK,2BAA6ByK,sBAAsBH,IAExDH,EAAKlK,uBAAyB,KAC9BkK,EAAKrH,6BAELlR,IAER,EACAuY,EAAKnK,2BAA6ByK,sBAAsBH,EAC5D,GAAE,cAAAvO,EAAA3L,EAAA,KAAAyL,EAAA,SACL,SAzCkCF,GAAA,OAAAmO,EAAAtO,MAAC,KAADrO,UAAA,IA2CnC,CAAA+N,IAAA,6BAAAvK,OAAA+Z,EAAA9M,GAAA1M,KAAAE,EAQA,SAAAuZ,IAAA,IAAAX,EAAAC,EAAAW,EAAAC,EAAAC,EAAAC,EAAA,KAAAC,EAAA7d,UAAA,OAAA+D,KAAAC,EAAA,SAAA8Z,GAAA,cAAAA,EAAA9b,GAAA,OAUI,OAV6B6a,EAAQgB,EAAA5d,OAAA,QAAAC,IAAA2d,EAAA,GAAAA,EAAA,GAAG,KAAOf,EAAgBe,EAAA5d,OAAA,QAAAC,IAAA2d,EAAA,GAAAA,EAAA,GAAG,KAElEpO,KAAKkG,6BAEC8H,EAAahO,KAAK+D,aAClBkK,EAAMxR,EAASuR,EAAW,GAAIA,EAAW,GAAIA,EAAW,IACxDE,EAAWD,EAAI,GAIrBI,EAAA9b,EAAA,EACM,IAAIwC,QAAQ,WACd,IAAI0Y,EAAY,KAEVC,EAAO,SAACC,GACLF,IAAWA,EAAYE,GAC5B,IAAMC,EAAWrc,KAAKoL,KAAKgR,EAAYF,GAAaL,EAAU,GAExDkB,GAAUJ,EAAWN,GAAY,EAEvCO,EAAKpK,aAAe3H,EAASkS,EAbtB,EACA,IAaPH,EAAKpI,OAEDsH,GAAkBA,IAEtBc,EAAK/K,2BAA6ByK,sBAAsBH,EAC5D,EACAS,EAAK/K,2BAA6ByK,sBAAsBH,EAC5D,GAAE,cAAAW,EAAA7a,EAAA,KAAAua,EAAA,SACL,WA7B+B,OAAAD,EAAAlP,MAAC,KAADrO,UAAA,IA+BhC,CAAA+N,IAAA,sBAAAvK,OAAAwa,EAAAvN,GAAA1M,KAAAE,EAUA,SAAAga,IAAA,IAAAC,EAAAC,EAAArB,EAAAsB,EAAA9B,EAAA+B,EAAAC,EAAAC,EAAA,KAAAC,EAAAxe,UAAA,OAAA+D,KAAAC,EAAA,SAAAya,GAAA,cAAAA,EAAAzc,GAAA,OAEsC,GAFZkc,EAAkBM,EAAAve,OAAA,QAAAC,IAAAse,EAAA,GAAAA,EAAA,GAAG,IAAML,EAAYK,EAAAve,OAAA,QAAAC,IAAAse,EAAA,GAAAA,EAAA,GAAG,IAAM1B,EAAgB0B,EAAAve,OAAA,QAAAC,IAAAse,EAAA,GAAAA,EAAA,GAAG,KAAMJ,EAAiBI,EAAAve,OAAA,QAAAC,IAAAse,EAAA,GAAAA,EAAA,GAAG,KAEnH/O,KAAKkG,6BAEAlG,KAAKiP,UAAqC,IAAzBjP,KAAKiP,SAASze,OAAY,CAAAwe,EAAAzc,EAAA,QACM,OAAAyc,EAAAxb,EAAA,UA6CjB,OAxCrCwM,KAAK0M,sBAAuB,EAGN,oBAAX7U,SACDgV,EAAWC,SAASC,eAAe,oBACxBF,EAASG,UAAUkC,SAAS,WACzCrC,EAASG,UAAUmC,IAAI,UAK3BP,GAAa5O,KAAKoP,qBAAuB,EAAIpP,KAAKoP,oBAAsB,EAAI,GAAKpP,KAAKiP,SAASze,OAE7F6e,EAAS,eAAAC,EAAAtO,GAAA1M,KAAAE,EAAG,SAAA+a,IAAA,OAAAjb,KAAAC,EAAA,SAAAib,GAAA,cAAAA,EAAAjd,GAAA,UACTuc,EAAKpC,qBAAsB,CAAF8C,EAAAjd,EAAA,eAAAid,EAAAhc,EAAA,UAGQ,OAAtCsb,EAAKnC,2BAA4B,EAAK6C,EAAAjd,EAAA,EAChCuc,EAAKW,oBAAoBb,EAAWH,EAAoBpB,GAAiB,OAM9E,GALDyB,EAAKnC,2BAA4B,EAG7BmC,EAAKpC,sBAAwBiC,GAC7BA,IAGCG,EAAKpC,qBAAsB,CAAF8C,EAAAjd,EAAA,eAAAid,EAAAhc,EAAA,UAG9Bob,GAAaA,EAAY,GAAKE,EAAKG,SAASze,OAG5Cse,EAAKlC,wBAA0BxN,WAAW,WAClC0P,EAAKpC,sBACL2C,GAER,EAAGX,GAAc,cAAAc,EAAAhc,EAAA,KAAA+b,EAAA,IACpB,kBAxBc,OAAAD,EAAA1Q,MAAA,KAAArO,UAAA,KA2BfyP,KAAKoD,2BAA6B,EAAG4L,EAAAzc,EAAA,EAC/B8c,IAAW,cAAAL,EAAAxb,EAAA,KAAAgb,EAAA,SACpB,WApDwB,OAAAD,EAAA3P,MAAC,KAADrO,UAAA,IAsDzB,CAAA+N,IAAA,+BAAAvK,OAAA2b,EAAA1O,GAAA1M,KAAAE,EASA,SAAAmb,EAAmClJ,EAAQ2G,GAAQ,IAAAC,EAAAuC,EAAAC,EAAAtf,UAAA,OAAA+D,KAAAC,EAAA,SAAAub,GAAA,cAAAA,EAAAvd,GAAA,OAC0D,GADxD8a,EAAgBwC,EAAArf,OAAA,QAAAC,IAAAof,EAAA,GAAAA,EAAA,GAAG,MAEhEpJ,EAAO1P,UAAW,CAAF+Y,EAAAvd,EAAA,QAE4D,GAD5EnC,EAAI,qCAADM,OAAsC+V,EAAO1P,UAAS,SACnD6Y,EAAe5P,KAAKiP,SAASc,UAAU,SAAA3c,GAAC,OAAIA,EAAE4c,KAAOvJ,EAAO1P,SAAS,KACvD,GAAC,CAAA+Y,EAAAvd,EAAA,eAAAud,EAAAvd,EAAA,EACXyN,KAAKyP,oBAAoBG,EAAcxC,EAAUC,GAAiB,OAAAyC,EAAAvd,EAAA,eAEJ,OAAAud,EAAAvd,EAAA,eAGxEnC,EAAI,iEAAiE,OAEtD,cAAA0f,EAAAtc,EAAA,KAAAmc,EAAA,SACtB,SAdiCM,EAAAC,GAAA,OAAAR,EAAA9Q,MAAC,KAADrO,UAAA,IAgBlC,CAAA+N,IAAA,eAAAvK,OAAAoc,EAAAnP,GAAA1M,KAAAE,EAQA,SAAA4b,EAAmBC,GAAS,IAAAjD,EAAAkD,EAAAC,EAAAC,EAAA,KAAAC,EAAAlgB,UAAA,OAAA+D,KAAAC,EAAA,SAAAmc,GAAA,cAAAA,EAAAne,GAAA,OAIF,GAJI6a,EAAQqD,EAAAjgB,OAAA,QAAAC,IAAAggB,EAAA,GAAAA,EAAA,GAAG,IAAKH,EAAYG,EAAAjgB,OAAA,QAAAC,IAAAggB,EAAA,GAAAA,EAAA,GAAGxf,EAAUC,KAEnE8O,KAAKqM,0BAELrM,KAAK8F,kBAEDhK,EAAekE,KAAK+C,IAAKsN,EAAW,GAAI,CAAFK,EAAAne,EAAA,QAEnB,OAAAme,EAAAld,EAAA,UAKM,OAAvB+c,EAAQrb,GAAO8K,KAAK+C,KAAG2N,EAAAne,EAAA,EAEvB,IAAIwC,QAAQ,SAACC,GACf,IAAIyY,EAAY,KAEVC,EAAO,SAACC,GACLF,IAAWA,EAAYE,GAC5B,IAAMvb,EAAIb,KAAKoL,KAAKgR,EAAYF,GAAaL,EAAU,GAEjDuD,EAAIL,EAAale,GAEjBwe,EAAKrT,EAAKgT,EAAS,GAAIF,EAAU,GAAIM,GACrCE,EAAKtT,EAAKgT,EAAS,GAAIF,EAAU,GAAIM,GAC3CH,EAAKxL,OAAO4L,EAAIC,GAEhBL,EAAKzK,OACLC,IAAW,GAEP5T,EAAI,EACJoe,EAAKvN,yBAA2B4K,sBAAsBH,IAEtD8C,EAAK1K,iBACL0K,EAAKzK,OACLyK,EAAKnE,0BACLmE,EAAKM,sBAEL9b,IAER,EACAwb,EAAKvN,yBAA2B4K,sBAAsBH,EAC1D,GAAE,cAAAgD,EAAAld,EAAA,KAAA4c,EAAA,SACL,SA5CiBW,GAAA,OAAAZ,EAAAvR,MAAC,KAADrO,UAAA,IA8ClB,CAAA+N,IAAA,eAAAvK,OAAAid,EAAAhQ,GAAA1M,KAAAE,EAWA,SAAAyc,EAAmBC,GAAQ,IAAA9D,EAAAkD,EAAAa,EAAA,KAAAC,EAAA7gB,UAAA,OAAA+D,KAAAC,EAAA,SAAA8c,GAAA,cAAAA,EAAA9e,GAAA,OAID,GAJG6a,EAAQgE,EAAA5gB,OAAA,QAAAC,IAAA2gB,EAAA,GAAAA,EAAA,GAAG,IAAKd,EAAYc,EAAA5gB,OAAA,QAAAC,IAAA2gB,EAAA,GAAAA,EAAA,GAAGngB,EAAUC,KAElE8O,KAAKqM,0BAELrM,KAAK8F,mBAEDvU,KAAKmN,IAAIwS,EAAS,IAAM,OAAS3f,KAAKmN,IAAIwS,EAAS,IAAM,OAAK,CAAAG,EAAA9e,EAAA,QAE3C,OAAA8e,EAAA7d,EAAA,UAIgB,OAAA6d,EAAA9e,EAAA,EAEjC,IAAIwC,QAAQ,SAACC,GACf,IAAIyY,EAAY,KACZ6D,EAAQ,EAEN5D,EAAO,SAACC,GACLF,IAAWA,EAAYE,GAE5B,IAAMvb,EAAIb,KAAKoL,KAAKgR,EAAYF,GAAaL,EAAU,GACjDuD,EAAIL,EAAale,GAEjBmf,EAAKZ,EAAIW,EACfA,EAAQX,EAEG,IAAPY,GACAJ,EAAK5L,OAAO2L,EAAS,GAAKK,EAAIL,EAAS,GAAKK,GAGhDJ,EAAKpL,OACLC,IAAW,GAEP5T,EAAI,EACJ+e,EAAKlO,yBAA2B4K,sBAAsBH,IAEtDyD,EAAKrL,iBACLqL,EAAKpL,OACLoL,EAAK9E,0BACL8E,EAAKL,sBAEL9b,IAER,EAEAmc,EAAKlO,yBAA2B4K,sBAAsBH,EAC1D,GAAE,cAAA2D,EAAA7d,EAAA,KAAAyd,EAAA,SACL,SAhDiBO,GAAA,OAAAR,EAAApS,MAAC,KAADrO,UAAA,IAkDlB,CAAA+N,IAAA,gBAAAvK,OAAA0d,EAAAzQ,GAAA1M,KAAAE,EASA,SAAAkd,EAAoBzM,GAAU,IAAAmI,EAAAkD,EAAApL,EAAAC,EAAAwM,EAAAC,EAAA/a,EAAAC,EAAA+a,EAAAC,EAAAC,EAAAC,EAAAlN,EAAAC,EAAAH,EAAAC,EAAAoN,EAAA,KAAAC,EAAA3hB,UAAA,OAAA+D,KAAAC,EAAA,SAAA4d,GAAA,cAAAA,EAAA5f,GAAA,OAEM,GAFJ6a,EAAQ8E,EAAA1hB,OAAA,QAAAC,IAAAyhB,EAAA,GAAAA,EAAA,GAAG,IAAK5B,EAAY4B,EAAA1hB,OAAA,QAAAC,IAAAyhB,EAAA,GAAAA,EAAA,GAAGjhB,EAAUC,KAAMgU,EAAOgN,EAAA1hB,OAAA,QAAAC,IAAAyhB,EAAA,GAAAA,EAAA,GAAG,KAAM/M,EAAO+M,EAAA1hB,OAAA,QAAAC,IAAAyhB,EAAA,GAAAA,EAAA,GAAG,KAErGlS,KAAKsM,2BAEDtM,KAAKrJ,KAAKS,QAAQ,MAAQ6N,EAAW7N,QAAQ,IAAG,CAAA+a,EAAA5f,EAAA,QAE7B,OAAA4f,EAAA3e,EAAA,UAoBD,OAfN,OAAZ0R,GAAgC,OAAZC,IAAkBwM,EACrB3R,KAAKoS,qBAAoBR,EAAAjc,GAAAgc,EAAA,GAAnC9a,EAAE+a,EAAA,GAAE9a,EAAE8a,EAAA,GACb1M,EAAUrO,EACVsO,EAAUrO,GAGR+a,EAAY7R,KAAKrJ,KACjBmb,EAAQ7M,EAAa4M,EAE3BE,EACiB/R,KAAKqF,mBAAmBH,EAASC,GAAQ6M,EAAArc,GAAAoc,EAAA,GAAnDjN,EAAEkN,EAAA,GAAEjN,EAAEiN,EAAA,GACPpN,EAAWE,EAAK+M,EAAY7R,KAAK+C,IAAI,GACrC8B,EAAWE,EAAK8M,EAAY7R,KAAK+C,IAAI,GAG3C/C,KAAK8F,iBAAiBqM,EAAA5f,EAAA,EAEhB,IAAIwC,QAAQ,SAACC,GACf,IAAIyY,EAAY,KAEVC,EAAO,SAACC,GACLF,IAAWA,EAAYE,GAE5B,IAAMvb,EAAIb,KAAKoL,KAAKgR,EAAYF,GAAaL,EAAU,GAEvD,GAAIkD,IAAiBrf,EAAUC,KAAM,CACjC,IAAMyf,EAAIL,EAAale,GACvB6f,EAAKtb,KAAOkb,GAAa5M,EAAa4M,GAAalB,CACvD,MACIsB,EAAKtb,KAAOkb,EAAYtgB,KAAKC,IAAIsgB,EAAO1f,GAI5C6f,EAAKpK,iBAAiBjD,EAAUC,EAAUC,EAAIC,GAE9CkN,EAAKnM,iBACLmM,EAAKlM,OACLC,IAAW,GAEP5T,EAAI,EACJ6f,EAAK/O,0BAA4B2K,sBAAsBH,IAEvDuE,EAAKnM,iBACLmM,EAAKlM,OACLkM,EAAK3F,2BACL2F,EAAKnB,sBAEL9b,IAER,EAEAid,EAAK/O,0BAA4B2K,sBAAsBH,EAC3D,GAAE,cAAAyE,EAAA3e,EAAA,KAAAke,EAAA,SACL,SAhEkBW,GAAA,OAAAZ,EAAA7S,MAAC,KAADrO,UAAA,IAkEnB,CAAA+N,IAAA,qBAAAvK,OAAAue,EAAAtR,GAAA1M,KAAAE,EAUA,SAAA+d,EAAyBtN,GAAU,IAAAmI,EAAAkD,EAAAuB,EAAAW,EAAA,KAAAC,EAAAliB,UAAA,OAAA+D,KAAAC,EAAA,SAAAme,GAAA,cAAAA,EAAAngB,GAAA,OAKT,GALW6a,EAAQqF,EAAAjiB,OAAA,QAAAC,IAAAgiB,EAAA,GAAAA,EAAA,GAAG,IAAKnC,EAAYmC,EAAAjiB,OAAA,QAAAC,IAAAgiB,EAAA,GAAAA,EAAA,GAAGxhB,EAAUC,KAG1E8O,KAAKsM,2BAELtM,KAAK8F,iBAED9F,KAAKrJ,KAAKS,QAAQ,MAAQ6N,EAAW7N,QAAQ,IAAG,CAAAsb,EAAAngB,EAAA,QAE7B,OAAAmgB,EAAAlf,EAAA,UAII,OAArBqe,EAAY7R,KAAKrJ,KAAI+b,EAAAngB,EAAA,EAErB,IAAIwC,QAAQ,SAACC,GACf,IAAIyY,EAAY,KAEVC,EAAO,SAACC,GACLF,IAAWA,EAAYE,GAC5B,IAAMvb,EAAIb,KAAKoL,KAAKgR,EAAYF,GAAaL,EAAU,GAEvD,GAAIkD,IAAiBrf,EAAUC,KAAM,CACjC,IAAMyf,EAAIL,EAAale,GACvBogB,EAAK7b,KAAOkb,GAAa5M,EAAa4M,GAAalB,CACvD,MACI6B,EAAK7b,KAAOkb,EAAYtgB,KAAKC,IAAIyT,EAAa4M,EAAWzf,GAG7DogB,EAAKzM,OACLC,IAAW,GAEP5T,EAAI,EACJogB,EAAKtP,0BAA4B2K,sBAAsBH,IAEvD8E,EAAK1M,iBACL0M,EAAKzM,OACLyM,EAAKlG,2BACLkG,EAAK1B,sBAEL9b,IAER,EACAwd,EAAKtP,0BAA4B2K,sBAAsBH,EAC3D,GAAE,cAAAgF,EAAAlf,EAAA,KAAA+e,EAAA,SACL,SA7CuBI,GAAA,OAAAL,EAAA1T,MAAC,KAADrO,UAAA,KAAA+N,IAAA,oBAAAvK,OAAA6e,EAAA5R,GAAA1M,KAAAE,EA+CxB,SAAAqe,EAAwBC,GAAc,IAAA1F,EAAAkD,EAAAyC,EAAAC,EAAA,KAAAC,EAAA1iB,UAAA,OAAA+D,KAAAC,EAAA,SAAA2e,GAAA,cAAAA,EAAA3gB,GAAA,OAIlC,GAJoC6a,EAAQ6F,EAAAziB,OAAA,QAAAC,IAAAwiB,EAAA,GAAAA,EAAA,GAAG,IAAK3C,EAAY2C,EAAAziB,OAAA,QAAAC,IAAAwiB,EAAA,GAAAA,EAAA,GAAGhiB,EAAUC,KAE7E8O,KAAKuM,+BAGDvM,KAAKpJ,SAASQ,QAAQ,KAAO0b,EAAe1b,QAAQ,GAAE,CAAA8b,EAAA3gB,EAAA,QAEnC,OAAA2gB,EAAA1f,EAAA,UAKY,OAA7Buf,EAAgB/S,KAAKpJ,SAAQsc,EAAA3gB,EAAA,EAE7B,IAAIwC,QAAQ,SAACC,GACf,IAAIyY,EAAY,KAEVC,EAAO,SAACC,GACLF,IAAWA,EAAYE,GAC5B,IAAMvb,EAAIb,KAAKoL,KAAKgR,EAAYF,GAAaL,EAAU,GAEjDuD,EAAIL,EAAale,GAEvB4gB,EAAKpc,SAAW2G,EAAKwV,EAAeD,EAAgBnC,GACpDqC,EAAKjN,OACLC,IAAW,GAEP5T,EAAI,EACJ4gB,EAAK7P,8BAAgC0K,sBAAsBH,IAG3DsF,EAAKpc,SAAWgH,EAAkBoV,EAAKpc,UACvCoc,EAAKjN,OACLiN,EAAKzG,+BACLyG,EAAKlC,sBAEL9b,IAER,EACAge,EAAK7P,8BAAgC0K,sBAAsBH,EAC/D,GAAE,cAAAwF,EAAA1f,EAAA,KAAAqf,EAAA,SACL,SAzCsBM,GAAA,OAAAP,EAAAhU,MAAC,KAADrO,UAAA,IA2CvB,CAAA+N,IAAA,uBAAAvK,OAAAqf,EAAApS,GAAA1M,KAAAE,EAUA,SAAA6e,EAA2BhD,EAAWpL,EAAYqO,EAAaC,GAAY,IAAAjD,EAAAkD,EAAAjjB,UAAA,OAAA+D,KAAAC,EAAA,SAAAkf,GAAA,cAAAA,EAAAlhB,GAAA,OAC0B,OADxB+d,EAAYkD,EAAAhjB,OAAA,QAAAC,IAAA+iB,EAAA,GAAAA,EAAA,GAAGviB,EAAUC,KACDuiB,EAAAlhB,EAAA,EAE3FyN,KAAK0T,aAAarD,EAAWiD,EAAahD,GAAa,cAAAmD,EAAAlhB,EAAA,EACvDyN,KAAK2T,cAAc1O,EAAYsO,EAAcjD,GAAa,OAE7C,cAAAmD,EAAAjgB,EAAA,KAAA6f,EAAA,SACtB,SAPyBO,EAAAC,EAAAC,EAAAC,GAAA,OAAAX,EAAAxU,MAAC,KAADrO,UAAA,IAS1B,CAAA+N,IAAA,sBAAAvK,OAAAigB,EAAAhT,GAAA1M,KAAAE,EASA,SAAAyf,EAA0B5D,EAAWpL,GAAU,IAAAmI,EAAAkD,EAAA4D,EAAA3jB,UAAA,OAAA+D,KAAAC,EAAA,SAAA4f,GAAA,cAAAA,EAAA5hB,GAAA,OACqD,OADnD6a,EAAQ8G,EAAA1jB,OAAA,QAAAC,IAAAyjB,EAAA,GAAAA,EAAA,GAAG,IAAM5D,EAAY4D,EAAA1jB,OAAA,QAAAC,IAAAyjB,EAAA,GAAAA,EAAA,GAAGjjB,EAAUC,KACSijB,EAAA5hB,EAAA,EAE1FwC,QAAQqf,IAAI,CACdpU,KAAK0T,aAAarD,EAAWjD,EAAUkD,GACvCtQ,KAAKqU,mBAAmBpP,EAAYmI,EAAUkD,KAChD,OAEiB,cAAA6D,EAAA3gB,EAAA,KAAAygB,EAAA,SACtB,SATwBK,EAAAC,GAAA,OAAAP,EAAApV,MAAC,KAADrO,UAAA,IAWzB,CAAA+N,IAAA,wBAAAvK,OAAAygB,EAAAxT,GAAA1M,KAAAE,EAUA,SAAAigB,EAA4BvD,EAAUjM,GAAU,IAAAmI,EAAAkD,EAAAoE,EAAAnkB,UAAA,OAAA+D,KAAAC,EAAA,SAAAogB,GAAA,cAAAA,EAAApiB,GAAA,OACsD,OADpD6a,EAAQsH,EAAAlkB,OAAA,QAAAC,IAAAikB,EAAA,GAAAA,EAAA,GAAG,IAAMpE,EAAYoE,EAAAlkB,OAAA,QAAAC,IAAAikB,EAAA,GAAAA,EAAA,GAAGzjB,EAAUC,KACUyjB,EAAApiB,EAAA,EAE5FwC,QAAQqf,IAAI,CACdpU,KAAK4U,aAAa1D,EAAU9D,EAAUkD,GACtCtQ,KAAKqU,mBAAmBpP,EAAYmI,EAAUkD,KAChD,OAEiB,cAAAqE,EAAAnhB,EAAA,KAAAihB,EAAA,SACtB,SAT0BI,EAAAC,GAAA,OAAAN,EAAA5V,MAAC,KAADrO,UAAA,KAAA+N,IAAA,wBAAAvK,OAAAghB,EAAA/T,GAAA1M,KAAAE,EAW3B,SAAAwgB,EAA4B/P,EAAY6N,GAAc,IAAA1F,EAAAkD,EAAA2E,EAAA1kB,UAAA,OAAA+D,KAAAC,EAAA,SAAA2gB,GAAA,cAAAA,EAAA3iB,GAAA,OACgD,OAD9C6a,EAAQ6H,EAAAzkB,OAAA,QAAAC,IAAAwkB,EAAA,GAAAA,EAAA,GAAG,IAAK3E,EAAY2E,EAAAzkB,OAAA,QAAAC,IAAAwkB,EAAA,GAAAA,EAAA,GAAGhkB,EAAUC,KACKgkB,EAAA3iB,EAAA,EAE5FwC,QAAQqf,IAAI,CACdpU,KAAK2T,cAAc1O,EAAYmI,EAAUkD,GACzCtQ,KAAKmV,kBAAkBrC,EAAgB1F,EAAUnc,EAAUK,SAC7D,OAEiB,cAAA4jB,EAAA1hB,EAAA,KAAAwhB,EAAA,SACtB,SAT0BI,EAAAC,GAAA,OAAAN,EAAAnW,MAAC,KAADrO,UAAA,KAAA+N,IAAA,2BAAAvK,OAAAuhB,EAAAtU,GAAA1M,KAAAE,EAW3B,SAAA+gB,EAA+BlF,EAAWpL,EAAY6N,GAAc,IAAA1F,EAAAkD,EAAAkF,EAAAjlB,UAAA,OAAA+D,KAAAC,EAAA,SAAAkhB,GAAA,cAAAA,EAAAljB,GAAA,OACqC,OADnC6a,EAAQoI,EAAAhlB,OAAA,QAAAC,IAAA+kB,EAAA,GAAAA,EAAA,GAAG,IAAKlF,EAAYkF,EAAAhlB,OAAA,QAAAC,IAAA+kB,EAAA,GAAAA,EAAA,GAAGvkB,EAAUC,KACNukB,EAAAljB,EAAA,EAE/FwC,QAAQqf,IAAI,CACdpU,KAAK0T,aAAarD,EAAWjD,EAAUkD,GACvCtQ,KAAKqU,mBAAmBpP,EAAYmI,EAAUkD,GAC9CtQ,KAAKmV,kBAAkBrC,EAAgB1F,EAAUkD,KACnD,OAEiB,cAAAmF,EAAAjiB,EAAA,KAAA+hB,EAAA,SACtB,SAV6BG,EAAAC,EAAAC,GAAA,OAAAN,EAAA1W,MAAC,KAADrO,UAAA,KAAA+N,IAAA,0BAAAvK,OAAA8hB,EAAA7U,GAAA1M,KAAAE,EAY9B,SAAAshB,EAA8BC,GAAS,IAAArI,EAAAsI,EAAAC,EAAA,KAAAC,EAAA3lB,UAAA,OAAA+D,KAAAC,EAAA,SAAA4hB,GAAA,cAAAA,EAAA5jB,GAAA,OAIA,OAJEmb,EAAIwI,EAAA1lB,OAAA,QAAAC,IAAAylB,EAAA,GAAAA,EAAA,GAAG,KAE5ClW,KAAKuM,+BAECyJ,EAAMD,GAAa,EAAI,GAAK,EAACI,EAAA5jB,EAAA,EAE7B,IAAIwC,QAAQ,WACd,IAAMqhB,EAAe,WACjBH,EAAKrf,SAAWgH,EAAkBqY,EAAKrf,SAAWof,EAAMtI,EAAO,EAAIxb,GACnE+jB,EAAKlQ,OACLC,IAAW,GACXiQ,EAAK9S,8BAAgC0K,sBAAsBuI,EAC/D,EACAH,EAAK9S,8BAAgC0K,sBAAsBuI,EAC/D,GAAE,OACiB,cAAAD,EAAA3iB,EAAA,KAAAsiB,EAAA,SACtB,SAhB4BO,GAAA,OAAAR,EAAAjX,MAAC,KAADrO,UAAA,KA1yCjC8B,GAAA4O,GAAA9O,EAAAU,UAAAR,GAAAD,GAAA6O,GAAA9O,EAAAC,GAAAY,OAAAyB,eAAAtC,EAAA,aAAA0C,UAAA,IAAA1C,EAAA,IAAAA,EAAAE,EAAAD,EA8xCkCyjB,EAXHP,EAXAP,EAV3BP,EApBAR,EAnBAZ,EA1FwBR,EAVxBN,EA3EAb,EA7DAT,EAtDAb,EAzBAT,EAhEAnB,EAvCAT,EApDAZ,CA2jBA,CArxCiB,CDiDrB,ICuuCA,Y,m9LC/zCA,IAAA/a,EAAAC,EAAAC,EAAA,mBAAAC,OAAAA,OAAA,GAAAC,EAAAF,EAAAG,UAAA,aAAAC,EAAAJ,EAAAK,aAAA,yBAAAC,EAAAN,EAAAE,EAAAE,EAAAE,GAAA,IAAAC,EAAAL,GAAAA,EAAAM,qBAAAC,EAAAP,EAAAO,EAAAC,EAAAC,OAAAC,OAAAL,EAAAC,WAAA,OAAAK,GAAAH,EAAA,mBAAAV,EAAAE,EAAAE,GAAA,IAAAE,EAAAC,EAAAG,EAAAI,EAAA,EAAAC,EAAAX,GAAA,GAAAY,GAAA,EAAAC,EAAA,CAAAF,EAAA,EAAAb,EAAA,EAAAgB,EAAApB,EAAAqB,EAAAC,EAAAN,EAAAM,EAAAC,KAAAvB,EAAA,GAAAsB,EAAA,SAAArB,EAAAC,GAAA,OAAAM,EAAAP,EAAAQ,EAAA,EAAAG,EAAAZ,EAAAmB,EAAAf,EAAAF,EAAAmB,CAAA,YAAAC,EAAApB,EAAAE,GAAA,IAAAK,EAAAP,EAAAU,EAAAR,EAAAH,EAAA,GAAAiB,GAAAF,IAAAV,GAAAL,EAAAgB,EAAA5C,OAAA4B,IAAA,KAAAK,EAAAE,EAAAS,EAAAhB,GAAAqB,EAAAH,EAAAF,EAAAO,EAAAhB,EAAA,GAAAN,EAAA,GAAAI,EAAAkB,IAAApB,KAAAQ,EAAAJ,GAAAC,EAAAD,EAAA,OAAAC,EAAA,MAAAD,EAAA,GAAAA,EAAA,GAAAR,GAAAQ,EAAA,IAAAc,KAAAhB,EAAAJ,EAAA,GAAAoB,EAAAd,EAAA,KAAAC,EAAA,EAAAU,EAAAC,EAAAhB,EAAAe,EAAAf,EAAAI,EAAA,IAAAc,EAAAE,IAAAlB,EAAAJ,EAAA,GAAAM,EAAA,GAAAJ,GAAAA,EAAAoB,KAAAhB,EAAA,GAAAN,EAAAM,EAAA,GAAAJ,EAAAe,EAAAf,EAAAoB,EAAAf,EAAA,OAAAH,GAAAJ,EAAA,SAAAmB,EAAA,MAAAH,GAAA,EAAAd,CAAA,iBAAAE,EAAAW,EAAAO,GAAA,GAAAR,EAAA,QAAAS,UAAA,oCAAAP,GAAA,IAAAD,GAAAK,EAAAL,EAAAO,GAAAf,EAAAQ,EAAAL,EAAAY,GAAAvB,EAAAQ,EAAA,EAAAT,EAAAY,KAAAM,GAAA,CAAAV,IAAAC,EAAAA,EAAA,GAAAA,EAAA,IAAAU,EAAAf,GAAA,GAAAkB,EAAAb,EAAAG,IAAAO,EAAAf,EAAAQ,EAAAO,EAAAC,EAAAR,GAAA,OAAAI,EAAA,EAAAR,EAAA,IAAAC,IAAAH,EAAA,QAAAL,EAAAO,EAAAF,GAAA,MAAAL,EAAAA,EAAAyB,KAAAlB,EAAAI,IAAA,MAAAa,UAAA,wCAAAxB,EAAA0B,KAAA,OAAA1B,EAAAW,EAAAX,EAAA2B,MAAAnB,EAAA,IAAAA,EAAA,YAAAA,IAAAR,EAAAO,EAAA,SAAAP,EAAAyB,KAAAlB,GAAAC,EAAA,IAAAG,EAAAa,UAAA,oCAAAnB,EAAA,YAAAG,EAAA,GAAAD,EAAAR,CAAA,UAAAC,GAAAiB,EAAAC,EAAAf,EAAA,GAAAQ,EAAAV,EAAAwB,KAAAtB,EAAAe,MAAAE,EAAA,YAAApB,GAAAO,EAAAR,EAAAS,EAAA,EAAAG,EAAAX,CAAA,SAAAe,EAAA,UAAAY,MAAA3B,EAAA0B,KAAAT,EAAA,GAAAhB,EAAAI,EAAAE,IAAA,GAAAI,CAAA,KAAAS,EAAA,YAAAV,IAAA,UAAAkB,IAAA,UAAAC,IAAA,CAAA7B,EAAAY,OAAAkB,eAAA,IAAAtB,EAAA,GAAAL,GAAAH,EAAAA,EAAA,GAAAG,QAAAW,GAAAd,EAAA,GAAAG,EAAA,yBAAAH,GAAAW,EAAAkB,EAAApB,UAAAC,EAAAD,UAAAG,OAAAC,OAAAL,GAAA,SAAAO,EAAAhB,GAAA,OAAAa,OAAAmB,eAAAnB,OAAAmB,eAAAhC,EAAA8B,IAAA9B,EAAAiC,UAAAH,EAAAf,GAAAf,EAAAM,EAAA,sBAAAN,EAAAU,UAAAG,OAAAC,OAAAF,GAAAZ,CAAA,QAAA6B,EAAAnB,UAAAoB,EAAAf,GAAAH,EAAA,cAAAkB,GAAAf,GAAAe,EAAA,cAAAD,GAAAA,EAAAK,YAAA,oBAAAnB,GAAAe,EAAAxB,EAAA,qBAAAS,GAAAH,GAAAG,GAAAH,EAAAN,EAAA,aAAAS,GAAAH,EAAAR,EAAA,yBAAAW,GAAAH,EAAA,oDAAAuB,GAAA,kBAAAC,EAAA5B,EAAA6B,EAAArB,EAAA,cAAAD,GAAAf,EAAAE,EAAAE,EAAAH,GAAA,IAAAO,EAAAK,OAAAyB,eAAA,IAAA9B,EAAA,gBAAAR,GAAAQ,EAAA,EAAAO,GAAA,SAAAf,EAAAE,EAAAE,EAAAH,GAAA,SAAAK,EAAAJ,EAAAE,GAAAW,GAAAf,EAAAE,EAAA,SAAAF,GAAA,YAAAuC,QAAArC,EAAAE,EAAAJ,EAAA,GAAAE,EAAAM,EAAAA,EAAAR,EAAAE,EAAA,CAAA0B,MAAAxB,EAAAoC,YAAAvC,EAAAwC,cAAAxC,EAAAyC,UAAAzC,IAAAD,EAAAE,GAAAE,GAAAE,EAAA,UAAAA,EAAA,WAAAA,EAAA,cAAAS,GAAAf,EAAAE,EAAAE,EAAAH,EAAA,UAAA0C,GAAAvC,EAAAH,EAAAD,EAAAE,EAAAI,EAAAe,EAAAZ,GAAA,QAAAD,EAAAJ,EAAAiB,GAAAZ,GAAAG,EAAAJ,EAAAoB,KAAA,OAAAxB,GAAA,YAAAJ,EAAAI,EAAA,CAAAI,EAAAmB,KAAA1B,EAAAW,GAAAgC,QAAAC,QAAAjC,GAAAkC,KAAA5C,EAAAI,EAAA,UAAAyC,GAAA7C,GAAA,gBAAAA,GAAA,GAAA8C,MAAAC,QAAA/C,GAAA,OAAAgD,GAAAhD,EAAA,CAAAiD,CAAAjD,IAAA,SAAAA,GAAA,uBAAAC,QAAA,MAAAD,EAAAC,OAAAE,WAAA,MAAAH,EAAA,qBAAA8C,MAAAI,KAAAlD,EAAA,CAAAmD,CAAAnD,IAAA,SAAAA,EAAAmB,GAAA,GAAAnB,EAAA,qBAAAA,EAAA,OAAAgD,GAAAhD,EAAAmB,GAAA,IAAApB,EAAA,GAAA6D,SAAApC,KAAAxB,GAAA6D,MAAA,uBAAA9D,GAAAC,EAAA8D,cAAA/D,EAAAC,EAAA8D,YAAAC,MAAA,QAAAhE,GAAA,QAAAA,EAAA+C,MAAAI,KAAAlD,GAAA,cAAAD,GAAA,2CAAAiE,KAAAjE,GAAAiD,GAAAhD,EAAAmB,QAAA,GAAAiC,CAAApD,IAAA,qBAAAuB,UAAA,wIAAA8B,EAAA,UAAAL,GAAAhD,EAAAmB,IAAA,MAAAA,GAAAA,EAAAnB,EAAA7B,UAAAgD,EAAAnB,EAAA7B,QAAA,QAAA2B,EAAA,EAAAI,EAAA4C,MAAA3B,GAAArB,EAAAqB,EAAArB,IAAAI,EAAAJ,GAAAE,EAAAF,GAAA,OAAAI,CAAA,UAAA0O,GAAA9O,EAAAE,GAAA,QAAAD,EAAA,EAAAA,EAAAC,EAAA7B,OAAA4B,IAAA,KAAAK,EAAAJ,EAAAD,GAAAK,EAAAkC,WAAAlC,EAAAkC,aAAA,EAAAlC,EAAAmC,cAAA,YAAAnC,IAAAA,EAAAoC,UAAA,GAAA7B,OAAAyB,eAAAtC,EAAA+O,GAAAzO,EAAA6L,KAAA7L,EAAA,WAAAyO,GAAA9O,GAAA,IAAAO,EAAA,SAAAP,EAAAC,GAAA,aAAA8O,GAAA/O,KAAAA,EAAA,OAAAA,EAAA,IAAAD,EAAAC,EAAAE,OAAA8O,aAAA,YAAAjP,EAAA,KAAAQ,EAAAR,EAAA0B,KAAAzB,EAAAC,GAAA,wBAAA8O,GAAAxO,GAAA,OAAAA,EAAA,UAAAiB,UAAA,kEAAAvB,EAAAuJ,OAAA3E,QAAA7E,EAAA,CAAAiP,CAAAjP,EAAA,0BAAA+O,GAAAxO,GAAAA,EAAAA,EAAA,YAAA2O,GAAAlP,EAAAK,EAAAN,GAAA,OAAAM,EAAA8O,GAAA9O,GAAA,SAAAL,EAAAD,GAAA,GAAAA,IAAA,UAAAgP,GAAAhP,IAAA,mBAAAA,GAAA,OAAAA,EAAA,YAAAA,EAAA,UAAAyB,UAAA,4EAAAzB,GAAA,YAAAA,EAAA,UAAAqP,eAAA,oEAAArP,CAAA,CAAAsP,CAAArP,EAAA,CAAAsP,CAAAtP,EAAAuP,KAAAC,QAAAC,UAAApP,EAAAN,GAAA,GAAAoP,GAAAnP,GAAA+D,aAAA1D,EAAAmM,MAAAxM,EAAAD,GAAA,UAAAwP,KAAA,QAAAvP,GAAA0P,QAAAjP,UAAAkP,QAAAlO,KAAA+N,QAAAC,UAAAC,QAAA,wBAAA1P,GAAA,QAAAuP,GAAA,mBAAAvP,CAAA,cAAAkkB,GAAAlkB,EAAAK,EAAAN,EAAAE,GAAA,IAAAe,EAAA4O,GAAAT,GAAA,EAAAlP,EAAAD,EAAAS,UAAAT,GAAAK,EAAAN,GAAA,SAAAE,GAAA,mBAAAe,EAAA,SAAAhB,GAAA,OAAAgB,EAAAwL,MAAAzM,EAAAC,EAAA,EAAAgB,CAAA,UAAA4O,KAAA,OAAAA,GAAA,oBAAAJ,SAAAA,QAAAnJ,IAAAmJ,QAAAnJ,IAAA/E,OAAA,SAAAvB,EAAAC,EAAAC,GAAA,IAAAe,EAAA,SAAAhB,EAAAK,GAAA,SAAA4L,eAAAxK,KAAAzB,EAAAK,IAAA,QAAAL,EAAAmP,GAAAnP,MAAA,OAAAA,CAAA,CAAA6P,CAAA9P,EAAAC,GAAA,GAAAgB,EAAA,KAAAb,EAAAS,OAAAkP,yBAAA9O,EAAAhB,GAAA,OAAAG,EAAAkG,IAAAlG,EAAAkG,IAAA5E,KAAAtD,UAAAC,OAAA,EAAA2B,EAAAE,GAAAE,EAAAwB,KAAA,GAAAiO,GAAApD,MAAA,KAAArO,UAAA,UAAAgR,GAAAnP,GAAA,OAAAmP,GAAAvO,OAAAmB,eAAAnB,OAAAkB,eAAAR,OAAA,SAAAtB,GAAA,OAAAA,EAAAgC,WAAApB,OAAAkB,eAAA9B,EAAA,EAAAmP,GAAAnP,EAAA,UAAA+P,GAAA/P,EAAAD,GAAA,OAAAgQ,GAAAnP,OAAAmB,eAAAnB,OAAAmB,eAAAT,OAAA,SAAAtB,EAAAD,GAAA,OAAAC,EAAAgC,UAAAjC,EAAAC,CAAA,EAAA+P,GAAA/P,EAAAD,EAAA,CAaO,IAAMokB,GAAoB,SAAAC,GAE7B,SAAAD,EAAYzW,GAAQ,IAAAwC,EA+BJ,OA9CpB,SAAA9O,EAAAjB,GAAA,KAAAiB,aAAAjB,GAAA,UAAAqB,UAAA,qCAewBmM,CAAA,KAAAwW,IAChBjU,EAAAhB,GAAA,KAAAiV,EAAA,CAAMzW,KAEDyC,SAAW,IAChBD,EAAKqB,gBAAkB,EAEvBrB,EAAKG,aAAe,IAGpBH,EAAKmU,UAAY,EAAE,KAAO,QAE1BnU,EAAK3L,KAAO2L,EAAKG,aACjBH,EAAKS,IAAG7N,GAAOoN,EAAKI,aACpBJ,EAAK1L,SAAW0L,EAAKE,iBACrBF,EAAKK,gBAAkB+T,GAAAA,GAAAA,GAAAA,OAA0B7kB,EAAsB8kB,MACvErU,EAAKyB,aAAY7O,GAAOoN,EAAKK,iBAG7BL,EAAK1P,EAACsC,GAAOoN,EAAKmU,WAGlBnU,EAAKQ,QAAU,GAGfR,EAAKsU,MAAQ,GAEbtU,EAAKuU,WAAa,IAAI1N,aAAa7G,EAAKK,iBAExCL,EAAKwU,uBAAyB,KAC9BxU,EAAKyU,SAAW,EAEhBzU,EAAKxB,OAAOwB,CAChB,CAEA,OAjDJ,SAAAlQ,EAAAD,GAAA,sBAAAA,GAAA,OAAAA,EAAA,UAAAyB,UAAA,sDAAAxB,EAAAS,UAAAG,OAAAC,OAAAd,GAAAA,EAAAU,UAAA,CAAAsD,YAAA,CAAApC,MAAA3B,EAAAyC,UAAA,EAAAD,cAAA,KAAA5B,OAAAyB,eAAArC,EAAA,aAAAyC,UAAA,IAAA1C,GAAAgQ,GAAA/P,EAAAD,EAAA,CAiDIsS,CAAA8R,EAAAC,GAjDJrkB,EAiDIokB,EAjDJlkB,EAiDI,EAAAiM,IAAA,6BAAAvK,MAIA,WACI,M,g0GAAyBiJ,QAAQ,eAAgBgD,KAAKuC,UAAUtM,UACpE,GAEA,CAAAqI,IAAA,iBAAAvK,MAIA,WACIuiB,GAAAC,EAAA,wBAAAD,CAAA,IAEAtW,KAAKgX,KAAOhX,KAAKC,GAAG8J,mBAAmB/J,KAAKoG,QAAS,OACrDpG,KAAKiX,cAAgBjX,KAAKC,GAAG8J,mBAAmB/J,KAAKoG,QAAS,eAClE,GAEA,CAAA9H,IAAA,OAAAvK,MAIA,WACIiM,KAAKC,GAAG4G,WAAW7G,KAAKoG,SAExB,IAAM8Q,EAAY3lB,KAAKiW,MAAM,IAAOjW,KAAKC,IAAI,GAAID,KAAK4lB,KAAKnX,KAAKrJ,QAChEqJ,KAAK0D,WAAanS,KAAKoL,IAAI,IAAMua,EAAYlX,KAAK2D,iBAGlD3D,KAAKC,GAAGoK,WAAWrK,KAAKgX,KAAMhX,KAAKpN,GACnCoN,KAAKC,GAAGsK,WAAWvK,KAAKiX,cAAejX,KAAK6W,YAE5CP,GAAAC,EAAA,cAAAD,CAAA,GACJ,GAEA,CAAAhY,IAAA,QAAAvK,MAIA,WACIiM,KAAKpN,EAACsC,GAAO8K,KAAKyW,WAClBzW,KAAK+D,aAAY7O,GAAO8K,KAAK2C,iBAC7B3C,KAAK6W,WAAa,IAAI1N,aAAanJ,KAAK+D,cACxC/D,KAAK2D,gBAAkB,EAEvB3D,KAAK+F,MACT,GAIA,CAAAzH,IAAA,gCAAAvK,OApGJxB,EAoGI+B,KAAAE,EAOA,SAAAyK,EAAoCkO,GAAU,IAAAE,EAAAG,EAAAjd,UAAA,OAAA+D,KAAAC,EAAA,SAAA4K,GAAA,cAAAA,EAAA5M,GAAA,OAAyC,GAAvB8a,EAAgBG,EAAAhd,OAAA,QAAAC,IAAA+c,EAAA,GAAAA,EAAA,GAAG,KAC1EL,EAAY,CAAFhO,EAAA5M,EAAA,eAAA4M,EAAA3L,EAAA,EAASuB,QAAQC,WAAS,OAgBA,OAbzCgL,KAAK6W,WAAa,IAAI1N,aAAagE,GAInCnN,KAAK+D,aAAe,CACY,IAA5BoJ,EAAWiK,GACqB,IAAhCjK,EAAWiK,IACqB,IAAhCjK,EAAWiK,KAIfpX,KAAK+F,OAEDsH,GAAkBA,IAAmBlO,EAAA3L,EAAA,EAElCuB,QAAQC,WAAS,EAAAiK,EAAA,QA1B5BiO,EApGJ,eAAA9a,EAAA,KAAAD,EAAA5B,UAAA,WAAAwE,QAAA,SAAA1C,EAAAI,GAAA,IAAAe,EAAAjB,EAAAqM,MAAAxM,EAAAD,GAAA,SAAAkN,EAAA9M,GAAAuC,GAAAtB,EAAAnB,EAAAI,EAAA4M,EAAAC,EAAA,OAAA/M,EAAA,UAAA+M,EAAA/M,GAAAuC,GAAAtB,EAAAnB,EAAAI,EAAA4M,EAAAC,EAAA,QAAA/M,EAAA,CAAA8M,OAAA,MA+HK,SApBkCN,GAAA,OAAAmO,EAAAtO,MAAC,KAADrO,UAAA,KAAA+N,IAAA,cAAAvK,MAsBnC,WACI,OAAO,CACX,GAAC,CAAAuK,IAAA,mBAAAvK,MAED,WAEA,IAvIJ1B,GAAA4O,GAAA9O,EAAAU,UAAAR,GAAAD,GAAA6O,GAAA9O,EAAAC,GAAAY,OAAAyB,eAAAtC,EAAA,aAAA0C,UAAA,IAAA1C,EAAA,IAAAA,EAAAE,EAAAD,EAAAG,EAoGI2a,CAqCA,CA5H6B,CAAS9K,ICFtCiV,GAAiB,KAGjBC,GAAkB,KAGlBC,IAAgB,EAGhBC,GAAoB,KAGlBC,GAAgB,IAChBC,GAAiB,IAUhB,SAASC,MACZN,GAAiBvK,SAASC,eAAe,qBAOzCsK,GAAerQ,MAAQyQ,GAAgB5f,OAAO0P,iBAC9C8P,GAAepQ,OAASyQ,GAAiB7f,OAAO0P,iBAGhD8P,GAAeO,MAAM5Q,MAAQ,GAAHtW,OAAM+mB,GAAa,MAC7CJ,GAAeO,MAAM3Q,OAAS,GAAHvW,OAAMgnB,GAAc,MACnD,CAuEA,SAASG,GAAsBnM,EAASC,GACpC,GAAK0L,GAAL,CAEA,IAAMS,EAAgBjgB,OAAOkgB,WACvBC,EAAiBngB,OAAOogB,YAG1BC,EAAOxM,EAnGS,GAoGhByM,EAAMxM,EAnGU,GAsGhBuM,EAAOT,GAAgBK,IACvBI,EAAOxM,EAAU+L,GAxGD,IA4GhBU,EAAMT,GAAiBM,IACvBG,EAAMxM,EAAU+L,GA5GA,IAgHpBQ,EAAO3mB,KAAKmL,IAAI,EAAGnL,KAAKoL,IAAIub,EAAMJ,EAAgBL,KAClDU,EAAM5mB,KAAKmL,IAAI,EAAGnL,KAAKoL,IAAIwb,EAAKH,EAAiBN,KAEjDL,GAAeO,MAAMM,KAAO,GAAHxnB,OAAMwnB,EAAI,MACnCb,GAAeO,MAAMO,IAAM,GAAHznB,OAAMynB,EAAG,KAxBN,CAyB/B,CAKO,SAASC,KACPb,KAELA,IAAgB,EAEZF,KACAA,GAAeO,MAAMS,QAAU,QAIvC,CA+BO,SAASC,KACPhB,IAKLA,GAAgBiB,OACpB,C,ogCCzLA,IAiBIzY,GACA0Y,GAMAC,GACAC,GACAC,GACAC,GACAC,GA5BEC,GAAyB,IAGzBC,GAAY,IAMZC,GAAuB,IAYzBC,IAA0B,EAS1BC,GAAa,EAAGC,GAAa,EAC7BC,GAAQ,EAAGC,GAAQ,EACnBC,GAAe,KACfC,GAAoB,KACpBC,IAAa,EACbC,IAAa,EAGbC,GAAmB,KACnBC,IAAsB,EACtBC,GAAmB,KACnBC,GAAmB,EACnBC,GAAmB,EAGnBC,GAAwB,KACxBC,IAA2B,EAC3BC,GAAwB,KACxBC,GAAwB,EACxBC,GAAwB,EAGxBC,IAAkB,EAClBC,GAAS,EAGTC,IAAqB,EAGrBC,GAAe,EAQZ,SAASC,GAAcC,EAAYvJ,GACtC,IAAMwJ,EAAUD,EAAW,GAAKvJ,EAAS,GACnCyJ,EAAUF,EAAW,GAAKvJ,EAAS,GACnC0J,EAAWrpB,KAAKspB,KAAKH,EAAUA,EAAUC,EAAUA,GAGzD,GAAIC,GAnEwB,IAoExB,OAAO1J,EAIX,IAAM4J,EAxEsB,IAwEKF,EAE3BG,EAAcJ,EAAUG,EAQ9B,MAAO,CATaJ,EAAUI,EAIML,EAAW,GACzBM,EAAcN,EAAW,GAKnD,CACA,IAAIO,GAAc,EACdC,IAAc,EAGdC,GAAa,EACbC,GAAe,EACfC,GAAe,EACfC,GAAW,KAEXC,GAAgB,EAChBC,GAAe,EACfC,IAAe,EAMnB,SAASC,KACDjD,IAAmD,mBAA9BA,GAAW1S,gBAChC0S,GAAW1S,gBAInB,CAMO,SAAS4V,GAAkBC,GAC9BnD,GAAamD,GACb7b,GAAS6b,EAAI7b,QACNY,iBAAiB,cAAe,SAACvO,GAAC,OAAKA,EAAE0O,gBAAgB,GAChE8W,KACAiE,IACJ,CAGO,SAASA,KACR3C,KAKJR,GAAmB,SAAC7X,GAAK,OA2K7B,SAAqBA,GAIjB,GAHAA,EAAMC,kBAGD2a,GAAc,CACf,IAAM5P,EAAO4M,GAAW1Y,OAAOiH,wBAC/BuU,GAAgB1P,EAAKsM,KACrBqD,GAAe3P,EAAKuM,IACpBqD,IAAe,CACnB,CAGAN,IAActa,EAAMib,OACpBV,GAAeva,EAAMkb,QACrBV,GAAexa,EAAMmb,QAEhBV,KACDA,GAAWxN,sBAAsBmO,KAGjCzC,IAAmB1T,aAAa0T,IACpCA,GAAoBna,WAAW,WAC3Boc,IAAe,EACfS,IACJ,EAAG,KAEHzD,GAAW0D,gBAAgB,IAC/B,CAtMkCC,CAAYvb,EAAM,EAChD8X,GAAuB,SAAC9X,GAAK,OAuMjC,SAAyBA,GACrB,GAAqB,IAAjBA,EAAMwb,OAAc,CACpB5C,IAAa,EACbN,GAAatY,EAAMkb,QACnB3C,GAAavY,EAAMmb,QACnB3C,GAAQxY,EAAMkb,QACdzC,GAAQzY,EAAMmb,QAId,IAAMnQ,EAAO9L,GAAOiH,wBACpBwT,GAAe3O,EAAKsM,KACpB8C,GAAcpP,EAAKuM,IACnB8C,IAAc,EAGdpB,GAAmBjZ,EAAMkb,QAAUlQ,EAAKsM,KACxC4B,GAAmBlZ,EAAMmb,QAAUnQ,EAAKuM,IAGpCuB,IAAkB7T,aAAa6T,IACnCA,GAAmBta,WAAW,WAErBoa,IAxLjB,WACI,GAAIG,GAAqB,OAIzB,SAAS0C,IACL,GAAK1C,IAAwBnB,GAA7B,CAEA,IAAMvT,EA3KoB,KA2KPuT,GAAW7hB,KAE1BsO,EAAauT,GAAW5V,UAExB4V,GAAW8D,qBAAqBrX,EAAY4U,GAAkBC,IAC9D2B,KACAjD,GAAWzS,OACXC,IAAW,GAEX4T,GAAmB/L,sBAAsBwO,IAGzCE,IAd2C,CAgBnD,CApBA5C,IAAsB,EACtB7Z,GAAO8X,MAAM4E,OAAS,UAqBtB5C,GAAmB/L,sBAAsBwO,GACzC7D,GAAW0D,gBAAgB,IAC/B,CA+JgBO,EAER,EAAGzD,GACP,MAAO,GAAqB,IAAjBpY,EAAMwb,OAAc,CAC3B/B,GAASzZ,EAAMkb,QAGf,IAAMlQ,EAAO9L,GAAOiH,wBACpBmT,GAAwBtZ,EAAMkb,QAAUlQ,EAAKsM,KAC7CiC,GAAwBvZ,EAAMmb,QAAUnQ,EAAKuM,IAGzC4B,IAAuBlU,aAAakU,IACxCA,GAAwB3a,WAAW,WAE1Bgb,IArJjB,WACI,GAAIJ,GAA0B,OAI9B,SAASqC,IACL,GAAKrC,IAA6BxB,GAAlC,CAEA,IAAMvT,EA7NqB,MA6NRuT,GAAW7hB,KAE1BsO,EAAauT,GAAW3V,UAExB2V,GAAW8D,qBAAqBrX,EAAYiV,GAAuBC,IACnEsB,KACAjD,GAAWzS,OACXC,IAAW,GAEXiU,GAAwBpM,sBAAsBwO,IAG9CK,IAdgD,CAgBxD,CApBA1C,IAA2B,EAC3Bla,GAAO8X,MAAM4E,OAAS,WAqBtBvC,GAAwBpM,sBAAsBwO,GAC9C7D,GAAW0D,gBAAgB,IAC/B,CA4HgBS,EAER,EAAG3D,GACP,MAAO,GAAqB,IAAjBpY,EAAMwb,SACbxb,EAAMC,kBAGD+b,MAAe,CAChBtC,IAAqB,EAGrB,IAAM1O,EAAO9L,GAAOiH,wBACd8V,EAASjc,EAAMkb,QAAUlQ,EAAKsM,KAC9B4E,EAASlc,EAAMmb,QAAUnQ,EAAKuM,IACuB4E,EAAApnB,GAA1C6iB,GAAWrR,gBAAgB0V,EAAQC,GAAO,GAApDE,EAAED,EAAA,GAAEE,EAAEF,EAAA,GDxVQrR,EC2VJ9K,EAAMkb,QD3VOnQ,EC2VE/K,EAAMmb,QD3VCllB,EC2VQmmB,ED3VJlmB,EC2VQmmB,ED1VtD5F,IACDM,KAICL,MACDA,GAAkB,IAAIf,GAAqBc,KAE3B9U,SAAW,IAC3B+U,GAAgB3T,gBAAkB,EAI9B6T,KACAF,GAAgBT,WAAaW,GAC7BA,GAAoB,OAK5BF,GAAgB1kB,EAAI,CAACiE,EAAIC,GACzBwgB,GAAgBxR,iBAGhB+R,GAAsBnM,EAASC,GAG/B0L,GAAeO,MAAMS,QAAU,QAC/Bd,IAAgB,EAGhBD,GAAgBvR,MC4TZ,CD5VD,IAA0B2F,EAASC,EAAS9U,EAAIC,CC8VvD,CAnQsComB,CAAgBtc,EAAM,EACxD+X,GAAuB,SAAC/X,GAAK,OAoQjC,SAAyBA,GACrB,IAAM8D,EAAK9D,EAAMkb,QAAU5C,GACrBvU,EAAK/D,EAAMmb,QAAU5C,GAE3B,GAAsB,IAAlBvY,EAAMpB,QAAe,CAErB,GAAIma,GAAqB,CACrB,IAAM/N,EAAO9L,GAAOiH,wBAGpB,OAFA8S,GAAmBjZ,EAAMkb,QAAUlQ,EAAKsM,UACxC4B,GAAmBlZ,EAAMmb,QAAUnQ,EAAKuM,IAE5C,CAWA,IATKqB,KAAejoB,KAAKmN,IAAIgG,GAvZd,GAuZsCnT,KAAKmN,IAAIiG,GAvZ/C,KAwZX6U,IAAa,EAETE,KACA7T,aAAa6T,IACbA,GAAmB,OAIvBF,GAAY,CACZ1Z,GAAO8X,MAAM4E,OAAS,OAClBlD,KACAzT,aAAayT,IACbA,GAAe,MAInB,IAAIpB,EAAOqC,GACPpC,EAAM6C,GACV,IAAKC,GAAa,CACd,IAAMrP,EAAO9L,GAAOiH,wBACpBmR,EAAOtM,EAAKsM,KACZC,EAAMvM,EAAKuM,GACf,CAIA,IAAMgF,EAAW/D,GAAQlB,EACnBkF,EAAW/D,GAAQlB,EACnBkF,EAAUzc,EAAMkb,QAAU5D,EAC1BoF,EAAU1c,EAAMmb,QAAU5D,EAE0CoF,EAAA5nB,GAAjD6iB,GAAWnT,mBAAmB8X,EAAUC,GAAS,GAAnEI,EAAMD,EAAA,GAAEE,EAAMF,EAAA,GACmDG,EAAA/nB,GAA/C6iB,GAAWnT,mBAAmBgY,EAASC,GAAQ,GAAjEK,EAAKD,EAAA,GAAGE,EAAKF,EAAA,GAEpB,GAAIzmB,OAAO8C,SAASye,GAAW7hB,MAAO,CAClC,IAAMknB,GAAUL,EAASG,GAASnF,GAAW7hB,KACvCklB,GAAU4B,EAASG,GAASpF,GAAW7hB,KAE7C6hB,GAAWjT,OAAOsY,EAAQhC,GAE1BJ,KAEAjD,GAAW0D,gBAAgB,IAC/B,CAGA9C,GAAQxY,EAAMkb,QACdzC,GAAQzY,EAAMmb,QAEdvD,GAAWzS,OACXC,IAAW,EACf,CACJ,CAEA,GAAsB,IAAlBpF,EAAMpB,QAAe,CAErB,GAAIwa,GAA0B,CAC1B,IAAMpO,EAAO9L,GAAOiH,wBAGpB,OAFAmT,GAAwBtZ,EAAMkb,QAAUlQ,EAAKsM,UAC7CiC,GAAwBvZ,EAAMmb,QAAUnQ,EAAKuM,IAEjD,CAWA,IATKiC,KAAoB7oB,KAAKmN,IAAIgG,GAvdnB,GAud2CnT,KAAKmN,IAAIiG,GAvdpD,KAwdXyV,IAAkB,EAEdL,KACAlU,aAAakU,IACbA,GAAwB,OAI5BK,GAAiB,CACjBxZ,EAAMC,iBACN,IAAMgd,EAASjd,EAAMkb,QAAUzB,GAE/B7B,GAAW5hB,SAAWgH,EAAkB4a,GAAW5hB,SAlelC,IAke6CinB,GAC9DrF,GAAWzS,OAEXsU,GAASzZ,EAAMkb,QACfrC,IAAa,EACb3Z,GAAO8X,MAAM4E,OAAS,WACtBxW,IACJ,CACJ,CAGA,GAAsB,IAAlBpF,EAAMpB,SAAiB8a,KAAuBsC,KAAe,CAC7D,IAAMhR,EAAO9L,GAAOiH,wBACd8V,EAASjc,EAAMkb,QAAUlQ,EAAKsM,KAC9B4E,EAASlc,EAAMmb,QAAUnQ,EAAKuM,IACuB2F,EAAAnoB,GAA1C6iB,GAAWrR,gBAAgB0V,EAAQC,GAAO,GAApDE,EAAEc,EAAA,GAAEb,EAAEa,EAAA,GD/ZcpS,ECiaR9K,EAAMkb,QDjaWnQ,ECiaF/K,EAAMmb,QDjaKllB,ECiaImmB,EDjaAlmB,ECiaImmB,EDhapD1F,IAAkBD,KAGvBA,GAAgB1kB,EAAI,CAACiE,EAAIC,GACzBwgB,GAAgBxR,iBAGhB+R,GAAsBnM,EAASC,GAG/B2L,GAAgBvR,OCuZhB,CDlaG,IAA4B2F,EAASC,EAAS9U,EAAIC,CCmazD,CAjXsCinB,CAAgBnd,EAAM,EACxDgY,GAAqB,SAAChY,GAAK,OAkX/B,SAAuBA,GAEnB,IAAK,CAAC,EAAG,EAAG,GAAGod,SAASpd,EAAMwb,QAAS,OAMvC,GAJAxb,EAAMC,iBACND,EAAMqd,kBAGe,IAAjBrd,EAAMwb,OAAc,CACpB,GAAIzC,GAEA,YADA4C,KAIA7C,KACA7T,aAAa6T,IACbA,GAAmB,KAE3B,CAGA,GAAqB,IAAjB9Y,EAAMwb,OAAc,CACpB,GAAIpC,GAEA,YADA0C,KAIA3C,KACAlU,aAAakU,IACbA,GAAwB,KAEhC,CAEA,GAAqB,IAAjBnZ,EAAMwb,OAKN,YAJI9B,KACAA,IAAqB,EACrBlC,OAKR,GAAqB,IAAjBxX,EAAMwb,OAIN,GAFAnB,IAAc,EAETzB,GAuDDyC,KACAzC,IAAa,EAGbiC,KACAjD,GAAWzS,WA5DE,CACb,IAAM6F,EAAO9L,GAAOiH,wBACd8V,EAASjc,EAAMkb,QAAUlQ,EAAKsM,KAC9B4E,EAASlc,EAAMmb,QAAUnQ,EAAKuM,IAGpC,GAAqB,OAAjBmB,GAAuB,CACvBzT,aAAayT,IACbA,GAAe,KAEf,IAAMrU,EAAauT,GAAW7hB,KAAOoiB,GACrC,GAAI9T,EAAauT,GAAW5V,SAAU,CAElC,IAAIsO,EAAWsH,GAAW0F,iBAAiBrB,EAAQC,GAGnD5L,EAAWsJ,GAAchC,GAAWzV,IAAKmO,GAGzCsH,GAAW2F,sBAAsBjN,EAAUjM,EAAY,IAAMhU,EAAUQ,OAAOwD,KAAKgnB,GACvF,CAGJ,MAEI3C,GAAela,WAAW,WAEtB,IAAI8R,EAAWsH,GAAW0F,iBAAiBrB,EAAQC,GAGnD5L,EAAWsJ,GAAchC,GAAWzV,IAAKmO,GAKzCsH,GAAW5D,aAAa1D,EAAU,KAAKjc,KAAK,WACxCgnB,KAEA,IAAiEmC,EAAAzoB,GAA1C6iB,GAAWrR,gBAAgB0V,EAAQC,GAAO,GAA1DuB,EAAKD,EAAA,GAAEE,EAAKF,EAAA,GACfxB,KACArmB,EAAgB1F,EAAaE,MAAOstB,EAAOC,EAAO9F,GAAW7hB,KAAM6hB,GAAW5hB,SAAU4hB,GAAW5lB,EAAE,GAAI4lB,GAAW5lB,EAAE,GAAI2rB,MAE1HhoB,EAAgB1F,EAAaC,WAAYutB,EAAOC,EAAO9F,GAAW7hB,KAAM6hB,GAAW5hB,SAAU,KAAM,KAAM2nB,KAEjH,GAEArlB,UAAUslB,UAAUC,UAAU5mB,OAAOM,SAASC,MAAMnD,KAChD,WAAyF,EACzF,SAACkG,GAAoG,GAGzGme,GAAe,IACnB,EAAGR,GAEX,CAUJ,GAAqB,IAAjBlY,EAAMwb,OAAc,CACpB,GAAIhC,GAQA,OAPAA,IAAkB,EAIdX,IAAYwC,KAChBxC,IAAa,OACb3Z,GAAO8X,MAAM4E,OAAS,aAK1B,IAAM5Q,EAAO9L,GAAOiH,wBACd8V,EAASjc,EAAMkb,QAAUlQ,EAAKsM,KAC9B4E,EAASlc,EAAMmb,QAAUnQ,EAAKuM,IAEpC,GAAqB,OAAjBmB,GAAuB,CAEvBzT,aAAayT,IACbA,GAAe,KAEf,IAAMrU,EAAauT,GAAW7hB,KAAOoiB,GACrC,GAAI9T,EAAauT,GAAW3V,SAAU,CAElC,IAAIqO,EAAWsH,GAAW0F,iBAAiBrB,EAAQC,GAGnD5L,EAAWsJ,GAAchC,GAAWzV,IAAKmO,GAGzCsH,GAAW2F,sBAAsBjN,EAAUjM,EAAY,IAAMhU,EAAUQ,OAAOwD,KAAKgnB,GACvF,CAGJ,MACI3C,GAAela,WAAW,WAAQka,GAAe,IAAM,EAAGR,IAG9DsB,IAAkB,CACtB,CAEAta,GAAO8X,MAAM4E,OAAS,WAC1B,CA1gBoCkC,CAAc9d,EAAM,EACpDiY,GAAwB,WAAH,OA6gBrB0D,KACAG,UAGIpC,KACAA,IAAqB,EACrBlC,MAnhB4C,EAEhDtY,GAAOY,iBAAiB,QAAS+X,GAAkB,CAACkG,SAAS,IAC7D7e,GAAOY,iBAAiB,YAAagY,IACrC5Y,GAAOY,iBAAiB,YAAaiY,IACrC7Y,GAAOY,iBAAiB,UAAWkY,IACnC9Y,GAAOY,iBAAiB,aAAcmY,IAEtCI,IAA0B,EAE9B,CAGO,SAAS2F,KACP3F,KAKLnZ,GAAOqG,oBAAoB,QAASsS,GAAkB,CAACkG,SAAS,IAChE7e,GAAOqG,oBAAoB,YAAauS,IACxC5Y,GAAOqG,oBAAoB,YAAawS,IACxC7Y,GAAOqG,oBAAoB,UAAWyS,IACtC9Y,GAAOqG,oBAAoB,aAAc0S,IAEzCI,IAA0B,EAE9B,CAuCA,SAASsD,KACD7C,KACA7T,aAAa6T,IACbA,GAAmB,MAEnBE,KACApN,qBAAqBoN,IACrBA,GAAmB,MAEnBD,KACAA,IAAsB,EACtB7Z,GAAO8X,MAAM4E,OAAS,YACtBP,KAER,CAqCA,SAASS,KACD3C,KACAlU,aAAakU,IACbA,GAAwB,MAExBE,KACAzN,qBAAqByN,IACrBA,GAAwB,MAExBD,KACAA,IAA2B,EAC3Bla,GAAO8X,MAAM4E,OAAS,YACtBP,KAER,CAMA,SAASD,KAGL,GAFAX,GAAW,KAEN7C,IACAvhB,OAAO8C,SAASye,GAAW7hB,MAAhC,CAGA,IAAMkmB,EAAS1B,GAAeG,GACxBwB,EAAS1B,GAAeG,GAGxBsD,EAAattB,KAAKC,IAhRJ,IAgRyB0pB,GA/QxB,KAgRfjW,EAAauT,GAAW7hB,KAAOkoB,EAGrC3D,GAAa,EAETjW,EAAauT,GAAW5V,UAAYqC,EAAauT,GAAW3V,WAIhE2V,GAAW8D,qBAAqBrX,EAAY4X,EAAQC,GAGpDrB,KAEAzV,IAAW,GACXwS,GAAWzS,OAvBkC,CAwBjD,C,ogCC/SA,IAYIjG,GACA0Y,GAMAsG,GACAC,GACAC,GALAC,IAA0B,EAO1BC,GAAa,EAAGC,GAAa,EAC7BC,GAAa,EAAGC,GAAa,EAC7BC,GAAoB,KACpBC,IAAkB,EAGlBhF,GAAe,EACfS,GAAc,EACdC,IAAc,EAGduE,IAAa,EACbC,GAAqB,KACrBC,GAAkB,KAClBC,GAAmB,KACnBC,GAAmB,KAGnBlG,GAAmB,KACnBC,IAAsB,EACtBC,GAAmB,KACnBC,GAAmB,EACnBC,GAAmB,EAMvB,SAAS2B,KACDjD,IAAmD,mBAA9BA,GAAW1S,gBAChC0S,GAAW1S,gBAInB,CAMO,SAAS+Z,GAAkBlE,GACzBA,GAAQA,EAAI7b,SAKjB0Y,GAAamD,GACb7b,GAAS6b,EAAI7b,QACNY,iBAAiB,cAAe,SAACvO,GAAC,OAAKA,EAAE0O,gBAAgB,GAEhEif,KACJ,CAGO,SAASA,KACPhgB,KAKDmf,KAKJH,GAAwB,SAACle,GAAK,OA6ElC,SAA0BA,GACtB,IAAK4X,GAAY,OAEjB,GAA6B,IAAzB5X,EAAMmf,QAAQvvB,OAAc,CAC5BoQ,EAAMC,iBAEN0e,IAAkB,EAClBC,IAAa,EAEbC,GAAqB,KACrBC,GAAkB,KAElB,IAAMM,EAAQpf,EAAMmf,QAAQ,GAC5Bb,GAAac,EAAMlE,QACnBqD,GAAaa,EAAMjE,QACnBqD,GAAaY,EAAMlE,QACnBuD,GAAaW,EAAMjE,QAGnB,IAAMnQ,EAAO9L,GAAOiH,wBAkBpB,OAjBAwT,GAAe3O,EAAKsM,KACpB8C,GAAcpP,EAAKuM,IACnB8C,IAAc,EAGdpB,GAAmBmG,EAAMlE,QAAUlQ,EAAKsM,KACxC4B,GAAmBkG,EAAMjE,QAAUnQ,EAAKuM,IAGpCuB,IAAkB7T,aAAa6T,SACnCA,GAAmBta,WAAW,WAErBmgB,IAAoBC,IA7ErC,WACI,GAAI7F,GAAqB,OAGzB,SAAS0C,IACL,GAAK1C,IAAwBnB,GAA7B,CAEA,IAAMvT,EArHoB,KAqHPuT,GAAW7hB,KAE1BsO,EAAauT,GAAW5V,UAExB4V,GAAW8D,qBAAqBrX,EAAY4U,GAAkBC,IAC9D2B,KACAjD,GAAWzS,OACXC,IAAW,GAEX4T,GAAmB/L,sBAAsBwO,IAGzCE,IAd2C,CAgBnD,CAnBA5C,IAAsB,EAqBtBC,GAAmB/L,sBAAsBwO,GACzC7D,GAAW0D,gBAAgB,IAC/B,CAqDgBO,EAER,EA/LqB,KAkMzB,CAEA,GAA6B,IAAzB7b,EAAMmf,QAAQvvB,OAAc,CAC5BoQ,EAAMC,iBAGN0b,KAGAiD,IAAa,EACbD,IAAkB,EAGlBtE,IAAc,EAEd,IAAMgF,EAASrf,EAAMmf,QAAQ,GACvBG,EAAStf,EAAMmf,QAAQ,GAE7BN,GAAqBluB,KAAKoN,MACtBshB,EAAOnE,QAAUoE,EAAOpE,QACxBmE,EAAOlE,QAAUmE,EAAOnE,SAG5B2D,GAAkBnuB,KAAK4uB,MACnBD,EAAOnE,QAAUkE,EAAOlE,QACxBmE,EAAOpE,QAAUmE,EAAOnE,SAI5B,IAAMlQ,EAAO9L,GAAOiH,wBACdqZ,GAAiBH,EAAOnE,QAAUoE,EAAOpE,SAAW,EACpDuE,GAAiBJ,EAAOlE,QAAUmE,EAAOnE,SAAW,EAC1D4D,GAAmBS,EAAgBxU,EAAKsM,KACxC0H,GAAmBS,EAAgBzU,EAAKuM,IAGpCmH,KACAzZ,aAAayZ,IACbA,GAAoB,MAGxB9G,GAAW0D,gBAAgB,IAC/B,CACJ,CA9JuCoE,CAAiB1f,EAAM,EAC1Dme,GAAuB,SAACne,GAAK,OA+JjC,SAAyBA,GACrB,IAAK4X,GAAY,OAGjB,GAA6B,IAAzB5X,EAAMmf,QAAQvvB,SAAiBgvB,GAAY,CAC3C5e,EAAMC,iBAEN,IAAMmf,EAAQpf,EAAMmf,QAAQ,GAG5B,GAAIpG,GAAqB,CACrB,IAAM/N,EAAO9L,GAAOiH,wBAGpB,OAFA8S,GAAmBmG,EAAMlE,QAAUlQ,EAAKsM,UACxC4B,GAAmBkG,EAAMjE,QAAUnQ,EAAKuM,IAE5C,CAEA,IAAMzT,EAAKsb,EAAMlE,QAAUoD,GACrBva,EAAKqb,EAAMjE,QAAUoD,GAe3B,IAbKI,KAAoBhuB,KAAKmN,IAAIgG,GA1QnB,GA0Q2CnT,KAAKmN,IAAIiG,GA1QpD,KA2QX4a,IAAkB,EAEd7F,KACA7T,aAAa6T,IACbA,GAAmB,MAEnB4F,KACAzZ,aAAayZ,IACbA,GAAoB,OAIxBC,GAAiB,CAEjB,IAAIrH,EAAOqC,GACPpC,EAAM6C,GACV,IAAKC,GAAa,CACd,IAAMrP,EAAO9L,GAAOiH,wBACpBmR,EAAOtM,EAAKsM,KACZC,EAAMvM,EAAKuM,GACf,CAIA,IAAMgF,EAAWiC,GAAalH,EACxBkF,EAAWiC,GAAalH,EACxBkF,EAAU2C,EAAMlE,QAAU5D,EAC1BoF,EAAU0C,EAAMjE,QAAU5D,EAE0CoF,EAAA5nB,GAAjD6iB,GAAWnT,mBAAmB8X,EAAUC,GAAS,GAAnEI,EAAMD,EAAA,GAAEE,EAAMF,EAAA,GACmDG,EAAA/nB,GAA/C6iB,GAAWnT,mBAAmBgY,EAASC,GAAQ,GAAjEK,EAAKD,EAAA,GAAGE,EAAKF,EAAA,GAEpB,GAAIzmB,OAAO8C,SAASye,GAAW7hB,MAAO,CAClC,IAAMknB,GAAUL,EAASG,GAASnF,GAAW7hB,KACvCklB,GAAU4B,EAASG,GAASpF,GAAW7hB,KAE7C6hB,GAAWjT,OAAOsY,EAAQhC,GAC1BJ,KACAjD,GAAW0D,gBAAgB,IAC/B,CAEAkD,GAAaY,EAAMlE,QACnBuD,GAAaW,EAAMjE,QAEnBvD,GAAWzS,OACXC,IAAW,EACf,CAEA,MACJ,CAGA,GAA6B,IAAzBpF,EAAMmf,QAAQvvB,OAAc,CAC5BoQ,EAAMC,iBACN2e,IAAa,EAEb,IAAMS,EAASrf,EAAMmf,QAAQ,GACvBG,EAAStf,EAAMmf,QAAQ,GAEvBQ,EAAkBhvB,KAAKoN,MACzBshB,EAAOnE,QAAUoE,EAAOpE,QACxBmE,EAAOlE,QAAUmE,EAAOnE,SAGtByE,EAAejvB,KAAK4uB,MACtBD,EAAOnE,QAAUkE,EAAOlE,QACxBmE,EAAOpE,QAAUmE,EAAOnE,SAItBsE,GAAiBH,EAAOnE,QAAUoE,EAAOpE,SAAW,EACpDuE,GAAiBJ,EAAOlE,QAAUmE,EAAOnE,SAAW,EAEpDnQ,EAAO9L,GAAOiH,wBACd0Z,EAAUL,EAAgBxU,EAAKsM,KAC/BwI,EAAUL,EAAgBzU,EAAKuM,IAGrC,IAAKsH,KAAuBC,IAAwC,OAArBC,IAAkD,OAArBC,GAKxE,OAJAH,GAAqBc,EACrBb,GAAkBc,EAClBb,GAAmBc,OACnBb,GAAmBc,GAKvB,IAAMC,EAAeF,EAAUd,GACzBiB,EAAeF,EAAUd,GAE/B,GAAIruB,KAAKmN,IAAIiiB,GAAgB,IAAOpvB,KAAKmN,IAAIkiB,GAAgB,GAAK,CAE9D,IAA0FC,EAAAlrB,GAAjE6iB,GAAWnT,mBAAmBsa,GAAkBC,IAAiB,GAAnFpC,EAAMqD,EAAA,GAAEpD,EAAMoD,EAAA,GACiDC,EAAAnrB,GAA/C6iB,GAAWnT,mBAAmBob,EAASC,GAAQ,GAA/D/C,EAAKmD,EAAA,GAAElD,EAAKkD,EAAA,GAEnB,GAAI7pB,OAAO8C,SAASye,GAAW7hB,MAAO,CAClC,IAAMknB,GAAUL,EAASG,GAASnF,GAAW7hB,KACvCklB,GAAU4B,EAASG,GAASpF,GAAW7hB,KAC7C6hB,GAAWjT,OAAOsY,EAAQhC,EAC9B,CACJ,CAKA,IAAI5W,EAAauT,GAAW7hB,KAC5B,GAAI4pB,EAAkB,EAAG,CACrB,IAAM1B,EAAaY,GAAqBc,EACxCtb,EAAauT,GAAW7hB,KAAOkoB,CACnC,CAGI5Z,EAAauT,GAAW5V,WAAUqC,EAAauT,GAAW5V,UAC1DqC,EAAauT,GAAW3V,WAAUoC,EAAauT,GAAW3V,UAG9D2V,GAAW7hB,KAAOsO,EAGlB,IAAM8b,EAAkBP,EAAed,GACnCnuB,KAAKmN,IAAIqiB,GAhYM,MAiYfvI,GAAW5hB,SAAWgH,EAAkB4a,GAAW5hB,SAhYlC,EAgY6CmqB,IAIlEtB,GAAqBc,EACrBb,GAAkBc,EAClBb,GAAmBc,EACnBb,GAAmBc,EAEnBjF,KACAjD,GAAW0D,gBAAgB,KAE3B1D,GAAWzS,OACXC,IACJ,CACJ,CA5TsCgb,CAAgBpgB,EAAM,EACxDoe,GAAsB,SAACpe,GAAK,OA6ThC,SAAwBA,GACpB,IAAK4X,GAAY,OAGb5X,EAAMmf,QAAQvvB,OAAS,IACvBivB,GAAqB,KACrBC,GAAkB,KAClBC,GAAmB,KACnBC,GAAmB,MAIvB,GAA6B,IAAzBhf,EAAMmf,QAAQvvB,OAAc,CAE5B,GAAImpB,GAEA,YADA4C,KAUJ,GANI7C,KACA7T,aAAa6T,IACbA,GAAmB,MAInB8F,GAQA,OAPAA,IAAa,EACbvD,KAGAR,UACAjD,GAAWzS,OAQf,GAFAkV,IAAc,EAETsE,GAiDDtD,KACAsD,IAAkB,EAGlB9D,KACAjD,GAAWzS,WAtDO,CAClB,IAAMia,EAAQpf,EAAMqgB,eAAe,GAE7BrV,EAAO9L,GAAOiH,wBACdma,EAASlB,EAAMlE,QAAUlQ,EAAKsM,KAC9BiJ,EAASnB,EAAMjE,QAAUnQ,EAAKuM,IAEpC,GAA0B,OAAtBmH,GAA4B,CAC5BzZ,aAAayZ,IACbA,GAAoB,KAGpB,IAAIpO,EAAWsH,GAAW0F,iBAAiBgD,EAAQC,GAGnDjQ,EAAWsJ,GAAchC,GAAWzV,IAAKmO,GAIzC,IAAMjM,EA9cJ,IA8ciBuT,GAAW7hB,KAC1BsO,EAAauT,GAAW5V,UACxB4V,GAAW2F,sBAAsBjN,EAAUjM,GAAYhQ,KAAKgnB,GAEpE,MACIqD,GAAoBlgB,WAAW,WAE3B,IAAI8R,EAAWsH,GAAW0F,iBAAiBgD,EAAQC,GAGnDjQ,EAAWsJ,GAAchC,GAAWzV,IAAKmO,GAKzCsH,GAAW5D,aAAa1D,EAAU,KAAKjc,KAAK,WACxCgnB,KAEA,IAAiEc,EAAApnB,GAA1C6iB,GAAWrR,gBAAgB+Z,EAAQC,GAAO,GAA1D9C,EAAKtB,EAAA,GAAEuB,EAAKvB,EAAA,GACfH,KACArmB,EAAgB1F,EAAaE,MAAOstB,EAAOC,EAAO9F,GAAW7hB,KAAM6hB,GAAW5hB,SAAU4hB,GAAW5lB,EAAE,GAAI4lB,GAAW5lB,EAAE,GAAI2rB,MAE1HhoB,EAAgB1F,EAAaC,WAAYutB,EAAOC,EAAO9F,GAAW7hB,KAAM6hB,GAAW5hB,SAAU,KAAM,KAAM2nB,KAEjH,GAEAe,GAAoB,IACxB,EA5ea,IA8erB,CASAC,IAAkB,CACtB,CACJ,CA/ZqC6B,CAAexgB,EAAM,EAEtDd,GAAOY,iBAAiB,aAAcoe,GAAuB,CAACH,SAAS,IACvE7e,GAAOY,iBAAiB,YAAaqe,GAAsB,CAACJ,SAAS,IACrE7e,GAAOY,iBAAiB,WAAYse,GAAqB,CAACL,SAAS,IAEnEM,IAA0B,GAE9B,CAGO,SAASoC,KACPvhB,IAAWmf,KAIhBnf,GAAOqG,oBAAoB,aAAc2Y,GAAuB,CAACH,SAAS,IAC1E7e,GAAOqG,oBAAoB,YAAa4Y,GAAsB,CAACJ,SAAS,IACxE7e,GAAOqG,oBAAoB,WAAY6Y,GAAqB,CAACL,SAAS,IAEtEM,IAA0B,EAE9B,CAsCA,SAAS1C,KACD7C,KACA7T,aAAa6T,IACbA,GAAmB,MAEnBE,KACApN,qBAAqBoN,IACrBA,GAAmB,MAEnBD,KACAA,IAAsB,EACtBsC,KAER,CChHO,SAASqF,GAAexhB,EAAQ0Y,EAAY+I,GAI/C/I,EAAWzS,OAGX,IAAMyb,EAAkB1U,SAAS2U,cAAc,UAC/CD,EAAgBxa,MAAQlH,EAAOkH,MAC/Bwa,EAAgBva,OAASnH,EAAOmH,OAChC,IAAMya,EAAMF,EAAgBthB,WAAW,MAEvC,GAAKwhB,EAAL,CAMAA,EAAIC,UAAU7hB,EAAQ,EAAG,GAGzB,IAAA8hB,EA1DJ,SAA2BpJ,GACvB,IAAMqJ,EAAcjF,KAAgB,QAAU,aAI9C,MAAO,CAACkF,MR8FY,6BQ9FLC,MAFD,GAAArxB,OAAGmxB,EAAW,QAAAnxB,OAAO+I,EAAsB+e,EAAWzV,IAAI7M,QAAS,GAAE,WAAAxF,OAAU8nB,EAAW7hB,KAAKqrB,cAAc,IAAE,GAAAtxB,OACrH8nB,aAAsByJ,GAAa,OAAAvxB,OAAW+I,EAAsB+e,EAAW5lB,IAAE,IAE7F,CAoD2BsvB,CAAkB1J,GAAlCsJ,EAAKF,EAALE,MAAOC,EAAKH,EAALG,MAORI,EAAY,UAAHzxB,OANE,GAMmB,iCAC9B0xB,EAAY,GAAH1xB,OAPE,GAOY,yGAE7BgxB,EAAIW,UAAY,SAChBX,EAAIY,cAAgB,MACpBZ,EAAIa,aAAe,SAGnBb,EAAIc,KAAOL,EACX,IAAMM,EAAaf,EAAIgB,YAAYZ,GAAO9a,MAC1C0a,EAAIc,KAAOJ,EACX,IAAMO,EAAajB,EAAIgB,YAAYX,GAAO/a,MAIpC4b,EADerxB,KAAKmL,IAAI+lB,EAAYE,GACTE,GAAcC,EAIzC3xB,EAAIqwB,EAAgBxa,MAAQ4b,EAvBlB,EAwBVvvB,EAAImuB,EAAgBva,OAJP8b,GApBH,EA2BhBrB,EAAIsB,UAAY,qBAvEpB,SAAuBtB,EAAKvwB,EAAGkC,EAAG2T,EAAOC,EAAQgc,GAC7CvB,EAAIwB,YACJxB,EAAIyB,OAAOhyB,EAAI8xB,EAAQ5vB,GACvBquB,EAAI0B,OAAOjyB,EAAI6V,EAAQic,EAAQ5vB,GAC/BquB,EAAI2B,iBAAiBlyB,EAAI6V,EAAO3T,EAAGlC,EAAI6V,EAAO3T,EAAI4vB,GAClDvB,EAAI0B,OAAOjyB,EAAI6V,EAAO3T,EAAI4T,EAASgc,GACnCvB,EAAI2B,iBAAiBlyB,EAAI6V,EAAO3T,EAAI4T,EAAQ9V,EAAI6V,EAAQic,EAAQ5vB,EAAI4T,GACpEya,EAAI0B,OAAOjyB,EAAI8xB,EAAQ5vB,EAAI4T,GAC3Bya,EAAI2B,iBAAiBlyB,EAAGkC,EAAI4T,EAAQ9V,EAAGkC,EAAI4T,EAASgc,GACpDvB,EAAI0B,OAAOjyB,EAAGkC,EAAI4vB,GAClBvB,EAAI2B,iBAAiBlyB,EAAGkC,EAAGlC,EAAI8xB,EAAQ5vB,GACvCquB,EAAI4B,WACR,CA4DIC,CAAc7B,EAAKvwB,EAAGkC,EAAGuvB,EARNG,GAQ6B,GAChDrB,EAAI8B,OAGJ,IAAMC,EAAQtyB,EAAIyxB,EAAY,EACxBc,EAASrwB,EAjCC,EACI,EAgCuB0vB,EACrCY,EAASD,EApCE,GACG,EAsCpBhC,EAAIc,KAAOL,EACXT,EAAIsB,UAAYzB,EAChBG,EAAIkC,SAAS9B,EAAO2B,EAAOC,GAG3BhC,EAAIc,KAAOJ,EACXV,EAAIsB,UAAYzB,EAChBG,EAAIkC,SAAS7B,EAAO0B,EAAOE,GAG3B,IAtHM/d,EACAie,EAqHAC,EAAOhX,SAAS2U,cAAc,KAGpCqC,EAAKC,aAAa,YAzHZne,EAAM,IAAIoe,KACVH,EAAM,SAACtxB,GAAC,OAAKqJ,OAAOrJ,GAAG0xB,SAAS,EAAG,IAAI,EACtC,WAAPvzB,OAAkBkV,EAAIse,cAAa,KAAAxzB,OAAImzB,EAAIje,EAAIue,WAAa,GAAE,KAAAzzB,OAAImzB,EAAIje,EAAIwe,WAAU,KAAA1zB,OAAImzB,EAAIje,EAAIye,YAAW,KAAA3zB,OAAImzB,EAAIje,EAAI0e,cAAa,KAAA5zB,OAAImzB,EAAIje,EAAI2e,cAAa,UAwH7JT,EAAKC,aAAa,OAAQvC,EAAgBgD,UAAU,aRyFL,MQxF/CV,EAAKW,OA7DL,CAiEJ,C,cChJA,IAAAtyB,EAAAC,EAAAC,EAAA,mBAAAC,OAAAA,OAAA,GAAAC,EAAAF,EAAAG,UAAA,aAAAC,EAAAJ,EAAAK,aAAA,yBAAAC,EAAAN,EAAAE,EAAAE,EAAAE,GAAA,IAAAC,EAAAL,GAAAA,EAAAM,qBAAAC,EAAAP,EAAAO,EAAAC,EAAAC,OAAAC,OAAAL,EAAAC,WAAA,OAAAK,GAAAH,EAAA,mBAAAV,EAAAE,EAAAE,GAAA,IAAAE,EAAAC,EAAAG,EAAAI,EAAA,EAAAC,EAAAX,GAAA,GAAAY,GAAA,EAAAC,EAAA,CAAAF,EAAA,EAAAb,EAAA,EAAAgB,EAAApB,EAAAqB,EAAAC,EAAAN,EAAAM,EAAAC,KAAAvB,EAAA,GAAAsB,EAAA,SAAArB,EAAAC,GAAA,OAAAM,EAAAP,EAAAQ,EAAA,EAAAG,EAAAZ,EAAAmB,EAAAf,EAAAF,EAAAmB,CAAA,YAAAC,EAAApB,EAAAE,GAAA,IAAAK,EAAAP,EAAAU,EAAAR,EAAAH,EAAA,GAAAiB,GAAAF,IAAAV,GAAAL,EAAAgB,EAAA5C,OAAA4B,IAAA,KAAAK,EAAAE,EAAAS,EAAAhB,GAAAqB,EAAAH,EAAAF,EAAAO,EAAAhB,EAAA,GAAAN,EAAA,GAAAI,EAAAkB,IAAApB,KAAAQ,EAAAJ,GAAAC,EAAAD,EAAA,OAAAC,EAAA,MAAAD,EAAA,GAAAA,EAAA,GAAAR,GAAAQ,EAAA,IAAAc,KAAAhB,EAAAJ,EAAA,GAAAoB,EAAAd,EAAA,KAAAC,EAAA,EAAAU,EAAAC,EAAAhB,EAAAe,EAAAf,EAAAI,EAAA,IAAAc,EAAAE,IAAAlB,EAAAJ,EAAA,GAAAM,EAAA,GAAAJ,GAAAA,EAAAoB,KAAAhB,EAAA,GAAAN,EAAAM,EAAA,GAAAJ,EAAAe,EAAAf,EAAAoB,EAAAf,EAAA,OAAAH,GAAAJ,EAAA,SAAAmB,EAAA,MAAAH,GAAA,EAAAd,CAAA,iBAAAE,EAAAW,EAAAO,GAAA,GAAAR,EAAA,QAAAS,UAAA,oCAAAP,GAAA,IAAAD,GAAAK,EAAAL,EAAAO,GAAAf,EAAAQ,EAAAL,EAAAY,GAAAvB,EAAAQ,EAAA,EAAAT,EAAAY,KAAAM,GAAA,CAAAV,IAAAC,EAAAA,EAAA,GAAAA,EAAA,IAAAU,EAAAf,GAAA,GAAAkB,EAAAb,EAAAG,IAAAO,EAAAf,EAAAQ,EAAAO,EAAAC,EAAAR,GAAA,OAAAI,EAAA,EAAAR,EAAA,IAAAC,IAAAH,EAAA,QAAAL,EAAAO,EAAAF,GAAA,MAAAL,EAAAA,EAAAyB,KAAAlB,EAAAI,IAAA,MAAAa,UAAA,wCAAAxB,EAAA0B,KAAA,OAAA1B,EAAAW,EAAAX,EAAA2B,MAAAnB,EAAA,IAAAA,EAAA,YAAAA,IAAAR,EAAAO,EAAA,SAAAP,EAAAyB,KAAAlB,GAAAC,EAAA,IAAAG,EAAAa,UAAA,oCAAAnB,EAAA,YAAAG,EAAA,GAAAD,EAAAR,CAAA,UAAAC,GAAAiB,EAAAC,EAAAf,EAAA,GAAAQ,EAAAV,EAAAwB,KAAAtB,EAAAe,MAAAE,EAAA,YAAApB,GAAAO,EAAAR,EAAAS,EAAA,EAAAG,EAAAX,CAAA,SAAAe,EAAA,UAAAY,MAAA3B,EAAA0B,KAAAT,EAAA,GAAAhB,EAAAI,EAAAE,IAAA,GAAAI,CAAA,KAAAS,EAAA,YAAAV,IAAA,UAAAkB,IAAA,UAAAC,IAAA,CAAA7B,EAAAY,OAAAkB,eAAA,IAAAtB,EAAA,GAAAL,GAAAH,EAAAA,EAAA,GAAAG,QAAAW,GAAAd,EAAA,GAAAG,EAAA,yBAAAH,GAAAW,EAAAkB,EAAApB,UAAAC,EAAAD,UAAAG,OAAAC,OAAAL,GAAA,SAAAO,EAAAhB,GAAA,OAAAa,OAAAmB,eAAAnB,OAAAmB,eAAAhC,EAAA8B,IAAA9B,EAAAiC,UAAAH,EAAAf,GAAAf,EAAAM,EAAA,sBAAAN,EAAAU,UAAAG,OAAAC,OAAAF,GAAAZ,CAAA,QAAA6B,EAAAnB,UAAAoB,EAAAf,GAAAH,EAAA,cAAAkB,GAAAf,GAAAe,EAAA,cAAAD,GAAAA,EAAAK,YAAA,oBAAAnB,GAAAe,EAAAxB,EAAA,qBAAAS,GAAAH,GAAAG,GAAAH,EAAAN,EAAA,aAAAS,GAAAH,EAAAR,EAAA,yBAAAW,GAAAH,EAAA,oDAAAuB,GAAA,kBAAAC,EAAA5B,EAAA6B,EAAArB,EAAA,cAAAD,GAAAf,EAAAE,EAAAE,EAAAH,GAAA,IAAAO,EAAAK,OAAAyB,eAAA,IAAA9B,EAAA,gBAAAR,GAAAQ,EAAA,EAAAO,GAAA,SAAAf,EAAAE,EAAAE,EAAAH,GAAA,SAAAK,EAAAJ,EAAAE,GAAAW,GAAAf,EAAAE,EAAA,SAAAF,GAAA,YAAAuC,QAAArC,EAAAE,EAAAJ,EAAA,GAAAE,EAAAM,EAAAA,EAAAR,EAAAE,EAAA,CAAA0B,MAAAxB,EAAAoC,YAAAvC,EAAAwC,cAAAxC,EAAAyC,UAAAzC,IAAAD,EAAAE,GAAAE,GAAAE,EAAA,UAAAA,EAAA,WAAAA,EAAA,cAAAS,GAAAf,EAAAE,EAAAE,EAAAH,EAAA,UAAA0C,GAAAvC,EAAAH,EAAAD,EAAAE,EAAAI,EAAAe,EAAAZ,GAAA,QAAAD,EAAAJ,EAAAiB,GAAAZ,GAAAG,EAAAJ,EAAAoB,KAAA,OAAAxB,GAAA,YAAAJ,EAAAI,EAAA,CAAAI,EAAAmB,KAAA1B,EAAAW,GAAAgC,QAAAC,QAAAjC,GAAAkC,KAAA5C,EAAAI,EAAA,CA+CA,IAiEI+lB,GAjEEkM,GAA2B,CAAC,YAAa,aAAc,UAAW,YAAa,QAAS,OAAQ,QAYhGC,GAAW,GAMXC,GAAkB,IA8BlBC,GAAsB,KAMtBC,GAAmC,GASrCC,IAAiB,EACjBC,IAAc,EAGlB,SAKeC,GAASlmB,GAAA,OAAAmmB,GAAAtmB,MAAC,KAADrO,UAAA,CAgQxB,SAAA20B,KAvXA,IAAA3yB,EAqXC,OArXDA,EAuXA+B,KAAAE,EAhQA,SAAAyK,EAAyB2B,GAAK,IAAAukB,EAAAlnB,EAAAmnB,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAlY,EAAAmY,EAAAC,EAAAjH,EAAA5Z,EAAAzL,EAAAkN,EAAArU,EAAA0zB,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAA7xB,KAAAC,EAAA,SAAA4K,GAAA,cAAAA,EAAA5M,GAAA,OAYrB,GATC0L,EAA0C2C,EAAM3C,OAChDmnB,EAAMnnB,SAAe,QAATknB,EAANlnB,EAAQmoB,eAAO,IAAAjB,OAAA,EAAfA,EAAiBpoB,eAEvBkB,GAEU,UAARmnB,GACQ,aAARA,GACQ,WAARA,IACAnnB,EAAOooB,kBAGK,CAAFlnB,EAAA5M,EAAA,eAAA4M,EAAA3L,EAAA,UAeiC,GAX/C6xB,GAAU,EAERC,EAAgB1kB,EAAM0lB,SA9DO,IANP,GAqExBf,EAAoB7zB,EAEpB8zB,EAAY,EACZC,EAAY,EACZC,EAAU,EACVC,EAAU,EAGRC,EAAShlB,EAAMglB,QAAyB,QAAfhlB,EAAM2lB,MAEjCC,OAAuB9B,GAAyB1G,SAASpd,EAAM2lB,MAAK,CAAApnB,EAAA5M,EAAA,QAC7C,OAAvBqO,EAAMC,iBAAiB1B,EAAA3L,EAAA,UAAA2yB,EAGnBvlB,EAAM2lB,KAAIpnB,EAAA5M,EAET,SAFS4zB,EAEH,EAEN,SAFMA,EAEA,EAWN,SAXMA,EAWA,EAKN,SALMA,EAKA,EAKN,SALMA,EAKA,GAKN,SALMA,EAKA,GAKN,SALMA,EAKA,GAON,SAPMA,EAOA,GAuBN,SAvBMA,EAuBA,GAKN,SALMA,EAKA,GAWN,SAXMA,EAWA,GAQN,SARMA,EAQA,GAKN,SALMA,EAKA,GAKN,SALMA,EAKA,GASN,SATMA,EASA,GAKN,cALMA,GAMN,UADWA,EAAA,GASX,mBAROA,GASP,UADgBA,EAAA,GAShB,SAROA,EAQD,GAKN,cALMA,EAKK,GAMX,eANWA,EAMC,GAMZ,cANYA,EAMD,GAMX,YANWA,EAMF,GAMT,UANSA,EAMF,GAcP,UAdOA,EAcA,mBA3KRZ,EAAoB7zB,EAAuB,WAEvCqzB,GAAgB,CAAF5lB,EAAA5M,EAAA,QACdimB,GAAWjM,+BACXwY,IAAiB,EAAM5lB,EAAA5M,EAAA,eAED,OAAtBwyB,IAAiB,EAAK5lB,EAAA5M,EAAA,EAChBimB,GAAWiO,wBAAwBlB,EAAmBD,GAAc,OAE/D,OAAfD,GAAU,EAAKlmB,EAAA3L,EAAA,aAKA,OADfkzB,KACArB,GAAU,EAAKlmB,EAAA3L,EAAA,iBAIXoN,EAAM0lB,SAAU,CAAFnnB,EAAA5M,EAAA,eAAA4M,EAAA5M,EAAA,EAAQgmB,KAAO,OAClB,OAAf8M,GAAU,EAAKlmB,EAAA3L,EAAA,cAKA,OADfmzB,KACAtB,GAAU,EAAKlmB,EAAA3L,EAAA,cAKA,OADfozB,KACAvB,GAAU,EAAKlmB,EAAA3L,EAAA,cAIqB2L,EAAA5M,EAAA,wBAAA4M,EAAA5M,EAAA,GAE9Bs0B,GAAiCjK,KAAgB/rB,EAAaC,WAAaD,EAAaE,OAAM,QACrF,OAAfs0B,GAAU,EAAKlmB,EAAA3L,EAAA,kBAIXoyB,EAAQ,CAAFzmB,EAAA5M,EAAA,gBAAA4M,EAAA5M,EAAA,GAEAimB,GAAW/I,oBAAoB,EAAG,IAAKqX,IAAiB,QAC9DC,KACAC,KAAgC7nB,EAAA5M,EAAA,qBACzBqO,EAAM0lB,SAAU,CAAFnnB,EAAA5M,EAAA,SAEjBimB,GAAW9L,qBAEX8L,GAAWtS,6BAGXsS,GAAWyO,oBAAoB,IAAM,IAAMH,GAAkBC,IAEjEC,KAAgC7nB,EAAA5M,EAAA,wBAAA4M,EAAA5M,EAAA,GAG1B20B,KAAiB,QAEZ,OAAf7B,GAAU,EAAKlmB,EAAA3L,EAAA,cAKA,OADfglB,GAAW/M,eACX4Z,GAAU,EAAKlmB,EAAA3L,EAAA,cAWA,OAPXoyB,EAEAuB,KACOvmB,EAAM0lB,UAEbc,KAEJ/B,GAAU,EAAKlmB,EAAA3L,EAAA,kBAIXopB,MAAiB1sB,IAAeD,EAAgB,CAAAkP,EAAA5M,EAAA,SACgC,OAAhF0vB,GAAcoF,0BAA4BpF,GAAcoF,yBAAwBloB,EAAA5M,EAAA,GAC1E+0B,GAAkBz2B,EAAaE,OAAM,QAEhC,OAAfs0B,GAAU,EAAKlmB,EAAA3L,EAAA,qBAAA2L,EAAA5M,EAAA,GAITg1B,KAAY,QACH,OAAflC,GAAU,EAAKlmB,EAAA3L,EAAA,iBAIXtD,IAAeD,EAAgB,CAAAkP,EAAA5M,EAAA,gBAAA4M,EAAA5M,EAAA,GAAQ+0B,GAAkBz2B,EAAaG,SAAQ,QACnE,OAAfq0B,GAAU,EAAKlmB,EAAA3L,EAAA,cASA,OALXtD,IACAE,EAAI,+BACJooB,GAAWgP,sBAAwBhP,GAAWgP,qBAC9ChP,GAAWzS,QAEfsf,GAAU,EAAKlmB,EAAA3L,EAAA,cAKA,OADfglB,GAAWiP,wBACXpC,GAAU,EAAKlmB,EAAA3L,EAAA,cASA,OAJXglB,GAAW3U,yBACL6J,EAAO9M,EAAM0lB,SAAW,GAAK,IACnC9N,GAAWkP,sBAAsBha,IAErC2X,GAAU,EAAKlmB,EAAA3L,EAAA,cASA,OAJXglB,GAAW3U,yBACL6J,EAAO9M,EAAM0lB,UAAY,IAAM,IACrC9N,GAAWkP,sBAAsBha,IAErC2X,GAAU,EAAKlmB,EAAA3L,EAAA,cAKA,OADfm0B,KACAtC,GAAU,EAAKlmB,EAAA3L,EAAA,cAMA,OAFfgyB,EAAYI,EAAS,IAAMhlB,EAAM0lB,SAAW1B,GAAkBD,IAC9De,EAAUE,EAAUf,IAAuBjkB,EAAM0lB,SAAWxB,GAAmC,GAAM,EACrGO,GAAU,EAAKlmB,EAAA3L,EAAA,cAMA,OAFfgyB,EAAYI,EAAS,EAAKhlB,EAAM0lB,SAAW1B,GAAkBD,GAC7De,EAAUE,EAAUf,IAAuBjkB,EAAM0lB,UAAW,IAAqC,GAAM,EACvGjB,GAAU,EAAKlmB,EAAA3L,EAAA,cAMA,OAFfiyB,EAAYG,EAAS,IAAMhlB,EAAM0lB,SAAW1B,GAAkBD,IAC9DgB,EAAUC,EAAUf,IAAuBjkB,EAAM0lB,UAAW,IAAqC,GAAM,EACvGjB,GAAU,EAAKlmB,EAAA3L,EAAA,cAMA,OAFfiyB,EAAYG,EAAS,EAAKhlB,EAAM0lB,SAAW1B,GAAkBD,GAC7DgB,EAAUC,EAAUf,IAAuBjkB,EAAM0lB,SAAWxB,GAAmC,GAAM,EACrGO,GAAU,EAAKlmB,EAAA3L,EAAA,cAO8B,GAHvCsyB,EAAYllB,EAAM0lB,SAlOD,IANP,GAyOVzH,EAAcje,EAAMgnB,SAAWhC,EAAW,EAAIE,EAAc,EAAIA,KAElE7gB,EAAauT,GAAW7hB,KAAOkoB,IAEjBrG,GAAW5V,UAAYqC,GAAcuT,GAAW3V,UAAQ,CAAA1D,EAAA5M,EAAA,gBAAA4M,EAAA5M,EAAA,GAEhEimB,GAAWnE,mBAAmBpP,EAAY,IAAG,QACnDgX,KAAgB,QAEL,OAAfoJ,GAAU,EAAKlmB,EAAA3L,EAAA,cAKA,OADfq0B,KACAxC,GAAU,EAAKlmB,EAAA3L,EAAA,cAIuC,KAAhDgG,EAAQoH,EAAM2lB,KAAK/sB,MAAM,yBACpB,CAAF2F,EAAA5M,EAAA,SACgC,GAA/BmU,EAAQtJ,SAAS5D,EAAM,GAAI,IAC7BoH,EAAM0lB,WAAY1J,KAAa,CAAAzd,EAAA5M,EAAA,gBAAA4M,EAAA5M,EAAA,GACzBu1B,GAAetP,GAAW5B,MAAOlQ,GAAM,QAAAvH,EAAA5M,EAAA,wBAAA4M,EAAA5M,EAAA,GAEvCw1B,GAAevP,GAAW1V,QAAS4D,GAAM,QAEnD2e,GAAU,EAAK,eAAAlmB,EAAA3L,EAAA,kBAMvBgyB,IAAaC,EAAS,CAAAtmB,EAAA5M,EAAA,SAK2F,OAJ7GF,EAAImmB,GAAW5hB,SAGbmvB,EAAmBP,EAAYhN,GAAW7hB,KAAQpF,KAAKya,IAAI3Z,GAAMozB,EAAYjN,GAAW7hB,KAAQpF,KAAK2a,IAAI7Z,GACzG2zB,EAAmBR,EAAYhN,GAAW7hB,KAAQpF,KAAK2a,IAAI7Z,GAAMozB,EAAYjN,GAAW7hB,KAAQpF,KAAKya,IAAI3Z,GAAE8M,EAAA5M,EAAA,GAE3GimB,GAAW5D,aAAa,CAACmR,EAAiBC,GA9StC,IA8SkE,QAC5ExN,GAAW0D,gBAAgB,KAE3BD,KAAgB,YAIfyJ,IAAWC,IAAY/I,KAAa,CAAAzd,EAAA5M,EAAA,SAEa,OAD5C0zB,EAAmBP,EAAUlN,GAAW7hB,KACxCuvB,EAAmBP,EAAUnN,GAAW7hB,KAAIwI,EAAA5M,EAAA,GAE5CimB,GAAWwP,WAAW,CAACxP,GAAW5lB,EAAE,GAAKqzB,EAAkBzN,GAAW5lB,EAAE,GAAKszB,GAnQ9D,IAmQsG,QAC3HjK,KAAgB,QAGhBoJ,GACAzkB,EAAMC,iBACT,eAAA1B,EAAA3L,EAAA,KAAAyL,EAAA,GAGLimB,GAvXA,eAAA9yB,EAAA,KAAAD,EAAA5B,UAAA,WAAAwE,QAAA,SAAA1C,EAAAI,GAAA,IAAAe,EAAAjB,EAAAqM,MAAAxM,EAAAD,GAAA,SAAAkN,EAAA9M,GAAAuC,GAAAtB,EAAAnB,EAAAI,EAAA4M,EAAAC,EAAA,OAAA/M,EAAA,UAAA+M,EAAA/M,GAAAuC,GAAAtB,EAAAnB,EAAAI,EAAA4M,EAAAC,EAAA,QAAA/M,EAAA,CAAA8M,OAAA,MAqXC6lB,GAAAtmB,MAAA,KAAArO,UAAA,CAMM,SAAS03B,GAAYtM,GACpBqJ,KAKJxM,GAAamD,EACb7O,SAASpM,iBAAiB,UAAWukB,IACrCD,IAAc,EAEd50B,EAAI,eAAgB,eACxB,CAGO,SAAS83B,KACPlD,KAKLxM,GAAa,KACbwM,IAAc,EAEdlY,SAAS3G,oBAAoB,UAAW8e,IAG5C,C,q8MCrZA,IAAA9yB,EAAAC,EAAAC,EAAA,mBAAAC,OAAAA,OAAA,GAAAC,EAAAF,EAAAG,UAAA,aAAAC,EAAAJ,EAAAK,aAAA,yBAAAC,EAAAN,EAAAE,EAAAE,EAAAE,GAAA,IAAAC,EAAAL,GAAAA,EAAAM,qBAAAC,EAAAP,EAAAO,EAAAC,EAAAC,OAAAC,OAAAL,EAAAC,WAAA,OAAAK,GAAAH,EAAA,mBAAAV,EAAAE,EAAAE,GAAA,IAAAE,EAAAC,EAAAG,EAAAI,EAAA,EAAAC,EAAAX,GAAA,GAAAY,GAAA,EAAAC,EAAA,CAAAF,EAAA,EAAAb,EAAA,EAAAgB,EAAApB,EAAAqB,EAAAC,EAAAN,EAAAM,EAAAC,KAAAvB,EAAA,GAAAsB,EAAA,SAAArB,EAAAC,GAAA,OAAAM,EAAAP,EAAAQ,EAAA,EAAAG,EAAAZ,EAAAmB,EAAAf,EAAAF,EAAAmB,CAAA,YAAAC,EAAApB,EAAAE,GAAA,IAAAK,EAAAP,EAAAU,EAAAR,EAAAH,EAAA,GAAAiB,GAAAF,IAAAV,GAAAL,EAAAgB,EAAA5C,OAAA4B,IAAA,KAAAK,EAAAE,EAAAS,EAAAhB,GAAAqB,EAAAH,EAAAF,EAAAO,EAAAhB,EAAA,GAAAN,EAAA,GAAAI,EAAAkB,IAAApB,KAAAQ,EAAAJ,GAAAC,EAAAD,EAAA,OAAAC,EAAA,MAAAD,EAAA,GAAAA,EAAA,GAAAR,GAAAQ,EAAA,IAAAc,KAAAhB,EAAAJ,EAAA,GAAAoB,EAAAd,EAAA,KAAAC,EAAA,EAAAU,EAAAC,EAAAhB,EAAAe,EAAAf,EAAAI,EAAA,IAAAc,EAAAE,IAAAlB,EAAAJ,EAAA,GAAAM,EAAA,GAAAJ,GAAAA,EAAAoB,KAAAhB,EAAA,GAAAN,EAAAM,EAAA,GAAAJ,EAAAe,EAAAf,EAAAoB,EAAAf,EAAA,OAAAH,GAAAJ,EAAA,SAAAmB,EAAA,MAAAH,GAAA,EAAAd,CAAA,iBAAAE,EAAAW,EAAAO,GAAA,GAAAR,EAAA,QAAAS,UAAA,oCAAAP,GAAA,IAAAD,GAAAK,EAAAL,EAAAO,GAAAf,EAAAQ,EAAAL,EAAAY,GAAAvB,EAAAQ,EAAA,EAAAT,EAAAY,KAAAM,GAAA,CAAAV,IAAAC,EAAAA,EAAA,GAAAA,EAAA,IAAAU,EAAAf,GAAA,GAAAkB,EAAAb,EAAAG,IAAAO,EAAAf,EAAAQ,EAAAO,EAAAC,EAAAR,GAAA,OAAAI,EAAA,EAAAR,EAAA,IAAAC,IAAAH,EAAA,QAAAL,EAAAO,EAAAF,GAAA,MAAAL,EAAAA,EAAAyB,KAAAlB,EAAAI,IAAA,MAAAa,UAAA,wCAAAxB,EAAA0B,KAAA,OAAA1B,EAAAW,EAAAX,EAAA2B,MAAAnB,EAAA,IAAAA,EAAA,YAAAA,IAAAR,EAAAO,EAAA,SAAAP,EAAAyB,KAAAlB,GAAAC,EAAA,IAAAG,EAAAa,UAAA,oCAAAnB,EAAA,YAAAG,EAAA,GAAAD,EAAAR,CAAA,UAAAC,GAAAiB,EAAAC,EAAAf,EAAA,GAAAQ,EAAAV,EAAAwB,KAAAtB,EAAAe,MAAAE,EAAA,YAAApB,GAAAO,EAAAR,EAAAS,EAAA,EAAAG,EAAAX,CAAA,SAAAe,EAAA,UAAAY,MAAA3B,EAAA0B,KAAAT,EAAA,GAAAhB,EAAAI,EAAAE,IAAA,GAAAI,CAAA,KAAAS,EAAA,YAAAV,IAAA,UAAAkB,IAAA,UAAAC,IAAA,CAAA7B,EAAAY,OAAAkB,eAAA,IAAAtB,EAAA,GAAAL,GAAAH,EAAAA,EAAA,GAAAG,QAAAW,GAAAd,EAAA,GAAAG,EAAA,yBAAAH,GAAAW,EAAAkB,EAAApB,UAAAC,EAAAD,UAAAG,OAAAC,OAAAL,GAAA,SAAAO,EAAAhB,GAAA,OAAAa,OAAAmB,eAAAnB,OAAAmB,eAAAhC,EAAA8B,IAAA9B,EAAAiC,UAAAH,EAAAf,GAAAf,EAAAM,EAAA,sBAAAN,EAAAU,UAAAG,OAAAC,OAAAF,GAAAZ,CAAA,QAAA6B,EAAAnB,UAAAoB,EAAAf,GAAAH,EAAA,cAAAkB,GAAAf,GAAAe,EAAA,cAAAD,GAAAA,EAAAK,YAAA,oBAAAnB,GAAAe,EAAAxB,EAAA,qBAAAS,GAAAH,GAAAG,GAAAH,EAAAN,EAAA,aAAAS,GAAAH,EAAAR,EAAA,yBAAAW,GAAAH,EAAA,oDAAAuB,GAAA,kBAAAC,EAAA5B,EAAA6B,EAAArB,EAAA,cAAAD,GAAAf,EAAAE,EAAAE,EAAAH,GAAA,IAAAO,EAAAK,OAAAyB,eAAA,IAAA9B,EAAA,gBAAAR,GAAAQ,EAAA,EAAAO,GAAA,SAAAf,EAAAE,EAAAE,EAAAH,GAAA,SAAAK,EAAAJ,EAAAE,GAAAW,GAAAf,EAAAE,EAAA,SAAAF,GAAA,YAAAuC,QAAArC,EAAAE,EAAAJ,EAAA,GAAAE,EAAAM,EAAAA,EAAAR,EAAAE,EAAA,CAAA0B,MAAAxB,EAAAoC,YAAAvC,EAAAwC,cAAAxC,EAAAyC,UAAAzC,IAAAD,EAAAE,GAAAE,GAAAE,EAAA,UAAAA,EAAA,WAAAA,EAAA,cAAAS,GAAAf,EAAAE,EAAAE,EAAAH,EAAA,UAAA0C,GAAAvC,EAAAH,EAAAD,EAAAE,EAAAI,EAAAe,EAAAZ,GAAA,QAAAD,EAAAJ,EAAAiB,GAAAZ,GAAAG,EAAAJ,EAAAoB,KAAA,OAAAxB,GAAA,YAAAJ,EAAAI,EAAA,CAAAI,EAAAmB,KAAA1B,EAAAW,GAAAgC,QAAAC,QAAAjC,GAAAkC,KAAA5C,EAAAI,EAAA,UAAAuO,GAAAzO,GAAA,sBAAAH,EAAA,KAAAD,EAAA5B,UAAA,WAAAwE,QAAA,SAAA1C,EAAAI,GAAA,IAAAe,EAAAjB,EAAAqM,MAAAxM,EAAAD,GAAA,SAAAkN,EAAA9M,GAAAuC,GAAAtB,EAAAnB,EAAAI,EAAA4M,EAAAC,EAAA,OAAA/M,EAAA,UAAA+M,EAAA/M,GAAAuC,GAAAtB,EAAAnB,EAAAI,EAAA4M,EAAAC,EAAA,QAAA/M,EAAA,CAAA8M,OAAA,eAAAnK,GAAA7C,GAAA,gBAAAA,GAAA,GAAA8C,MAAAC,QAAA/C,GAAA,OAAAgD,GAAAhD,EAAA,CAAAiD,CAAAjD,IAAA,SAAAA,GAAA,uBAAAC,QAAA,MAAAD,EAAAC,OAAAE,WAAA,MAAAH,EAAA,qBAAA8C,MAAAI,KAAAlD,EAAA,CAAAmD,CAAAnD,IAAA,SAAAA,EAAAmB,GAAA,GAAAnB,EAAA,qBAAAA,EAAA,OAAAgD,GAAAhD,EAAAmB,GAAA,IAAApB,EAAA,GAAA6D,SAAApC,KAAAxB,GAAA6D,MAAA,uBAAA9D,GAAAC,EAAA8D,cAAA/D,EAAAC,EAAA8D,YAAAC,MAAA,QAAAhE,GAAA,QAAAA,EAAA+C,MAAAI,KAAAlD,GAAA,cAAAD,GAAA,2CAAAiE,KAAAjE,GAAAiD,GAAAhD,EAAAmB,QAAA,GAAAiC,CAAApD,IAAA,qBAAAuB,UAAA,wIAAA8B,EAAA,UAAAL,GAAAhD,EAAAmB,IAAA,MAAAA,GAAAA,EAAAnB,EAAA7B,UAAAgD,EAAAnB,EAAA7B,QAAA,QAAA2B,EAAA,EAAAI,EAAA4C,MAAA3B,GAAArB,EAAAqB,EAAArB,IAAAI,EAAAJ,GAAAE,EAAAF,GAAA,OAAAI,CAAA,UAAA0O,GAAA9O,EAAAE,GAAA,QAAAD,EAAA,EAAAA,EAAAC,EAAA7B,OAAA4B,IAAA,KAAAK,EAAAJ,EAAAD,GAAAK,EAAAkC,WAAAlC,EAAAkC,aAAA,EAAAlC,EAAAmC,cAAA,YAAAnC,IAAAA,EAAAoC,UAAA,GAAA7B,OAAAyB,eAAAtC,EAAA+O,GAAAzO,EAAA6L,KAAA7L,EAAA,WAAA6O,GAAAlP,EAAAK,EAAAN,GAAA,OAAAM,EAAA8O,GAAA9O,GAAA,SAAAL,EAAAD,GAAA,GAAAA,IAAA,UAAAgP,GAAAhP,IAAA,mBAAAA,GAAA,OAAAA,EAAA,YAAAA,EAAA,UAAAyB,UAAA,4EAAAzB,GAAA,YAAAA,EAAA,UAAAqP,eAAA,oEAAArP,CAAA,CAAAsP,CAAArP,EAAA,CAAAsP,CAAAtP,EAAAuP,KAAAC,QAAAC,UAAApP,EAAAN,GAAA,GAAAoP,GAAAnP,GAAA+D,aAAA1D,EAAAmM,MAAAxM,EAAAD,GAAA,UAAAwP,KAAA,QAAAvP,GAAA0P,QAAAjP,UAAAkP,QAAAlO,KAAA+N,QAAAC,UAAAC,QAAA,wBAAA1P,GAAA,QAAAuP,GAAA,mBAAAvP,CAAA,cAAAkkB,GAAAlkB,EAAAK,EAAAN,EAAAE,GAAA,IAAAe,EAAA4O,GAAAT,GAAA,EAAAlP,EAAAD,EAAAS,UAAAT,GAAAK,EAAAN,GAAA,SAAAE,GAAA,mBAAAe,EAAA,SAAAhB,GAAA,OAAAgB,EAAAwL,MAAAzM,EAAAC,EAAA,EAAAgB,CAAA,UAAA4O,KAAA,OAAAA,GAAA,oBAAAJ,SAAAA,QAAAnJ,IAAAmJ,QAAAnJ,IAAA/E,OAAA,SAAAvB,EAAAC,EAAAC,GAAA,IAAAe,EAAA,SAAAhB,EAAAK,GAAA,SAAA4L,eAAAxK,KAAAzB,EAAAK,IAAA,QAAAL,EAAAmP,GAAAnP,MAAA,OAAAA,CAAA,CAAA6P,CAAA9P,EAAAC,GAAA,GAAAgB,EAAA,KAAAb,EAAAS,OAAAkP,yBAAA9O,EAAAhB,GAAA,OAAAG,EAAAkG,IAAAlG,EAAAkG,IAAA5E,KAAAtD,UAAAC,OAAA,EAAA2B,EAAAE,GAAAE,EAAAwB,KAAA,GAAAiO,GAAApD,MAAA,KAAArO,UAAA,UAAAgR,GAAAnP,GAAA,OAAAmP,GAAAvO,OAAAmB,eAAAnB,OAAAkB,eAAAR,OAAA,SAAAtB,GAAA,OAAAA,EAAAgC,WAAApB,OAAAkB,eAAA9B,EAAA,EAAAmP,GAAAnP,EAAA,UAAA+P,GAAA/P,EAAAD,GAAA,OAAAgQ,GAAAnP,OAAAmB,eAAAnB,OAAAmB,eAAAT,OAAA,SAAAtB,EAAAD,GAAA,OAAAC,EAAAgC,UAAAjC,EAAAC,CAAA,EAAA+P,GAAA/P,EAAAD,EAAA,UAAA+O,GAAA9O,GAAA,IAAAO,EAAA,SAAAP,EAAAC,GAAA,aAAA8O,GAAA/O,KAAAA,EAAA,OAAAA,EAAA,IAAAD,EAAAC,EAAAE,OAAA8O,aAAA,YAAAjP,EAAA,KAAAQ,EAAAR,EAAA0B,KAAAzB,EAAAC,GAAA,wBAAA8O,GAAAxO,GAAA,OAAAA,EAAA,UAAAiB,UAAA,kEAAAvB,EAAAuJ,OAAA3E,QAAA7E,EAAA,CAAAiP,CAAAjP,EAAA,0BAAA+O,GAAAxO,GAAAA,EAAAA,EAAA,GAMA,IASMw1B,GAAkB,SAAA3R,GAEpB,SAAA2R,EAAYroB,GAAQ,IAAAwC,EAjBxBnQ,EAAAE,EAAAD,EA8DoB,OA9DpB,SAAAoB,EAAAjB,GAAA,KAAAiB,aAAAjB,GAAA,UAAAqB,UAAA,qCAiBwBmM,CAAA,KAAAooB,GAChB7lB,EAAAhB,GAAA,KAAA6mB,EAAA,CAAMroB,IAlBd3N,EAkBsBmQ,EAlBtBlQ,EAiEqB,kBAAMkQ,EAAK8lB,YAAa,CAAI,GAjEjD/1B,EAAA6O,GAAA7O,EAkBsB,qBAlBtBF,EAAAa,OAAAyB,eAAAtC,EAAAE,EAAA,CAAA0B,MAAA3B,EAAAuC,YAAA,EAAAC,cAAA,EAAAC,UAAA,IAAA1C,EAAAE,GAAAD,EAoBQkQ,EAAKI,YAAc,EAAE,GAAK,GAC1BJ,EAAK0C,OAAO1C,EAAKI,YAAY,GAAIJ,EAAKI,YAAY,IAGlDJ,EAAK+lB,OAAMnzB,GAAOoN,EAAKI,aACvBJ,EAAKgmB,SAAW,CACZn3B,EAAG,CAAE0J,GAAIyH,EAAKI,YAAY,GAAI5H,GAAI,GAClCzH,EAAG,CAAEwH,GAAIyH,EAAKI,YAAY,GAAI5H,GAAI,IAEtCwH,EAAK8lB,YAAa,EAGlB9lB,EAAKC,SAAW,IAGhBD,EAAKimB,gBAAkB,EACvBjmB,EAAKkmB,kBAAoB,GAGzBlmB,EAAKmmB,aAAc,EAGnBnmB,EAAKomB,SAAW,KAChBpmB,EAAKqmB,UAAY,KACjBrmB,EAAKsmB,YAAc,KAGnBtmB,EAAKQ,QAAU+lB,GAAAA,GAMfvmB,EAAK2M,SAAW4Z,GAAAA,IAAwB,GACxCvmB,EAAK8M,oBAAsB,EAG3B9M,EAAKwmB,kBAAoB,CAAC,OAAQ,MAAQ,MAC1CxmB,EAAKymB,cAAgB,CAAC,EAAG,EAAG,GAC5BzmB,EAAK0mB,UAAS9zB,GAAOoN,EAAKwmB,mBAC1BxmB,EAAK2mB,MAAK/zB,GAAOoN,EAAKymB,eAEtBzmB,EAAKxB,OAAOwB,CAChB,CAAC,OA/DL,SAAAlQ,EAAAD,GAAA,sBAAAA,GAAA,OAAAA,EAAA,UAAAyB,UAAA,sDAAAxB,EAAAS,UAAAG,OAAAC,OAAAd,GAAAA,EAAAU,UAAA,CAAAsD,YAAA,CAAApC,MAAA3B,EAAAyC,UAAA,EAAAD,cAAA,KAAA5B,OAAAyB,eAAArC,EAAA,aAAAyC,UAAA,IAAA1C,GAAAgQ,GAAA/P,EAAAD,EAAA,CA+DKsS,CAAA0jB,EAAA3R,GA/DLrkB,EA+DKg2B,EA/DL91B,EA+DK,EAAAiM,IAAA,mBAAAvK,MAQD,WACIiM,KAAK4oB,YAAc5oB,KAAKC,GAAGipB,aAAa,qBACnClpB,KAAK4oB,cAKV5oB,KAAK0oB,SAAW1oB,KAAKC,GAAGkpB,gBACxBnpB,KAAKC,GAAGmpB,cAAcppB,KAAKC,GAAGopB,UAC9BrpB,KAAKC,GAAGqpB,YAAYtpB,KAAKC,GAAGspB,WAAYvpB,KAAK0oB,UAE7C1oB,KAAKC,GAAGupB,cAAcxpB,KAAKC,GAAGspB,WAAYvpB,KAAKC,GAAGwpB,mBAAoBzpB,KAAKC,GAAGypB,SAC9E1pB,KAAKC,GAAGupB,cAAcxpB,KAAKC,GAAGspB,WAAYvpB,KAAKC,GAAG0pB,mBAAoB3pB,KAAKC,GAAGypB,SAC9E1pB,KAAKC,GAAGupB,cAAcxpB,KAAKC,GAAGspB,WAAYvpB,KAAKC,GAAG2pB,eAAgB5pB,KAAKC,GAAG4pB,eAC1E7pB,KAAKC,GAAGupB,cAAcxpB,KAAKC,GAAGspB,WAAYvpB,KAAKC,GAAG6pB,eAAgB9pB,KAAKC,GAAG4pB,eAE1E7pB,KAAK2oB,UAAY,IAAIxf,aAA6B,EAAhBnJ,KAAKuC,UAGnCvC,KAAK+pB,aAAa/pB,KAAKC,GAAG+pB,UAAUhqB,KAAK+pB,YAAa,GACtD/pB,KAAKiqB,WAAWjqB,KAAKC,GAAGqK,UAAUtK,KAAKiqB,UAAWjqB,KAAKuC,UAE3DvC,KAAKooB,YAAa,EACtB,GAAC,CAAA9pB,IAAA,6BAAAvK,MAED,WACI,M,ipLAAyBiJ,QAAQ,eAAgBgD,KAAKuC,UAAUtM,UACpE,GAAC,CAAAqI,IAAA,iBAAAvK,MAED,WACIuiB,GAAA6R,EAAA,wBAAA7R,CAAA,IAGAtW,KAAKkqB,aAAelqB,KAAKC,GAAG8J,mBAAmB/J,KAAKoG,QAAS,iBAC7DpG,KAAKmqB,aAAenqB,KAAKC,GAAG8J,mBAAmB/J,KAAKoG,QAAS,iBAG7DpG,KAAKoqB,SAAWpqB,KAAKC,GAAG8J,mBAAmB/J,KAAKoG,QAAS,YACzDpG,KAAKqqB,SAAWrqB,KAAKC,GAAG8J,mBAAmB/J,KAAKoG,QAAS,YAGzDpG,KAAK+pB,YAAc/pB,KAAKC,GAAG8J,mBAAmB/J,KAAKoG,QAAS,cAC5DpG,KAAKiqB,UAAYjqB,KAAKC,GAAG8J,mBAAmB/J,KAAKoG,QAAS,YAG1DpG,KAAKsqB,aAAetqB,KAAKC,GAAG8J,mBAAmB/J,KAAKoG,QAAS,eAC7DpG,KAAKuqB,SAAWvqB,KAAKC,GAAG8J,mBAAmB/J,KAAKoG,QAAS,UAC7D,GAEA,CAAA9H,IAAA,oBAAAvK,MACA,SAAkB8C,EAAIC,EAAI0zB,GAEtB,IADA,IAAIC,EAAK,EAAKC,EAAK,EACV/3B,EAAI,EAAGA,EAAI63B,EAAO73B,IAAK,CAC5B,IACMg4B,EAAM,EAAMF,EAAKC,EAAK5zB,EAG5B,IAFA2zB,EAFYA,EAAKA,EAAKC,EAAKA,EAAK7zB,GAIvB4zB,GADTC,EAAKC,GACcD,EAAK,EAAK,OAAO/3B,CACxC,CACA,OAAO63B,CACX,GAEA,CAAAlsB,IAAA,8BAAAvK,MAOA,WAGI,GAHqCxD,UAAAC,OAAA,QAAAC,IAAAF,UAAA,IAAAA,UAAA,GAUjC,OANAyP,KAAKqoB,OAAO,GAAKroB,KAAK+C,IAAI,GAC1B/C,KAAKqoB,OAAO,GAAKroB,KAAK+C,IAAI,GAC1B/C,KAAKsoB,SAASn3B,EAAE0J,GAAKmF,KAAKgD,MAAM7R,EAAE0J,GAClCmF,KAAKsoB,SAASn3B,EAAE2J,GAAKkF,KAAKgD,MAAM7R,EAAE2J,GAClCkF,KAAKsoB,SAASj1B,EAAEwH,GAAKmF,KAAKgD,MAAM3P,EAAEwH,QAClCmF,KAAKsoB,SAASj1B,EAAEyH,GAAKkF,KAAKgD,MAAM3P,EAAEyH,IAItC,IAAM8vB,EAAO5qB,KAAKuoB,gBACZsC,GAAQD,EAAO,GAAK,EACpBld,EAAQ,EAAM1N,KAAKwoB,mBAAsBoC,EAAO,GAEhDE,EAAO9qB,KAAKrJ,KAEZo0B,EAAax5B,KAAKoL,IAAIqD,KAAKuC,SAAUhR,KAAKmL,IAAI,IAAKnL,KAAKiW,MAAMxH,KAAK0D,cAGrEsnB,GAAmB,EACAz5B,KAAKoN,MAAMqB,KAAKqoB,OAAO,GAAKroB,KAAK+C,IAAI,GAAI/C,KAAKqoB,OAAO,GAAKroB,KAAK+C,IAAI,IACvE+nB,EAAO9qB,KAAKwoB,kBAAoB,MAG/CwC,EAAkBhrB,KAAKirB,kBAAkBjrB,KAAKqoB,OAAO,GAAIroB,KAAKqoB,OAAO,GAAI0C,IAQ7E,IAJA,IAAIG,EAASlrB,KAAK+C,IAAI,GAClBooB,EAASnrB,KAAK+C,IAAI,GAClBqoB,EAAYprB,KAAKirB,kBAAkBjrB,KAAK+C,IAAI,GAAI/C,KAAK+C,IAAI,GAAIgoB,GAExDM,EAAI,EAAGA,EAAIT,EAAMS,IACtB,IAAK,IAAI14B,EAAI,EAAGA,EAAIi4B,EAAMj4B,IAAK,CAC3B,IAAM24B,GAAM34B,EAAIk4B,GAAQnd,EAClB6d,GAAMF,EAAIR,GAAQnd,EAClB7W,EAAKmJ,KAAK+C,IAAI,GAAKuoB,EAAKR,EACxBh0B,EAAKkJ,KAAK+C,IAAI,GAAKwoB,EAAKT,EAExBU,EAAQxrB,KAAKirB,kBAAkBp0B,EAAIC,EAAIi0B,GACzCS,EAAQJ,IACRA,EAAYI,EACZN,EAASr0B,EACTs0B,EAASr0B,EAEjB,CAMJ,IAAM20B,EAAuBl6B,KAAKmL,IAAsB,GAAlBsuB,EAAwB,KACzCA,EAAkB,GAAMI,EAAYJ,EAAmBS,KAGxEzrB,KAAKqoB,OAAO,GAAK6C,EACjBlrB,KAAKqoB,OAAO,GAAK8C,EAEjBnrB,KAAKsoB,SAASn3B,EAAE0J,GAAKqwB,EACrBlrB,KAAKsoB,SAASn3B,EAAE2J,GAAK,EACrBkF,KAAKsoB,SAASj1B,EAAEwH,GAAKswB,EACrBnrB,KAAKsoB,SAASj1B,EAAEyH,GAAK,EAG7B,GAAC,CAAAwD,IAAA,wBAAAvK,MAED,WACI,GAAKiM,KAAK2oB,WAAc3oB,KAAK0oB,SAA7B,CAOA,IALA,IAAM7xB,EAAKmJ,KAAKqoB,OAAO,GACjBvxB,EAAKkJ,KAAKqoB,OAAO,GAEnBoC,EAAK,EAAKC,EAAK,EAEVn4B,EAAI,EAAGA,EAAIyN,KAAKuC,SAAUhQ,IAAK,CACpC,IAAMm5B,EAAKtxB,EAAWqwB,GAChBkB,EAAKvxB,EAAWswB,GAEhBkB,EAAU,EAAJr5B,EACZyN,KAAK2oB,UAAUiD,GAAOF,EAAGrxB,KACzB2F,KAAK2oB,UAAUiD,EAAM,GAAKF,EAAGnxB,IAC7ByF,KAAK2oB,UAAUiD,EAAM,GAAKD,EAAGtxB,KAC7B2F,KAAK2oB,UAAUiD,EAAM,GAAKD,EAAGpxB,IAE7B,IACMowB,EAAM,EAAMF,EAAKC,EAAK5zB,EAI5B,IAHA2zB,EAFYA,EAAKA,EAAKC,EAAKA,EAAK7zB,GAKvB4zB,GAFTC,EAAKC,GAEcD,EAAK,EAAK,CAIzB,IAFA,IAAM1N,EAAK5iB,EAAWqwB,GAChBxN,EAAK7iB,EAAWswB,GACb/Z,EAAIpe,EAAI,EAAGoe,EAAI3Q,KAAKuC,SAAUoO,IAAK,CACxC,IAAM0a,EAAQ,EAAJ1a,EACV3Q,KAAK2oB,UAAU0C,GAAKrO,EAAG3iB,KACvB2F,KAAK2oB,UAAU0C,EAAI,GAAKrO,EAAGziB,IAC3ByF,KAAK2oB,UAAU0C,EAAI,GAAKpO,EAAG5iB,KAC3B2F,KAAK2oB,UAAU0C,EAAI,GAAKpO,EAAG1iB,GAC/B,CACA,KACJ,CACJ,CAEAyF,KAAKC,GAAGmpB,cAAcppB,KAAKC,GAAGopB,UAC9BrpB,KAAKC,GAAGqpB,YAAYtpB,KAAKC,GAAGspB,WAAYvpB,KAAK0oB,UAG7C1oB,KAAKC,GAAG4rB,WACJ7rB,KAAKC,GAAGspB,WACR,EACAvpB,KAAKC,GAAG6rB,KACR9rB,KAAKuC,SACL,EACA,EACAvC,KAAKC,GAAG6rB,KACR9rB,KAAKC,GAAGyJ,MACR1J,KAAK2oB,WAGL3oB,KAAK+pB,aAAa/pB,KAAKC,GAAG+pB,UAAUhqB,KAAK+pB,YAAa,GACtD/pB,KAAKiqB,WAAWjqB,KAAKC,GAAGqK,UAAUtK,KAAKiqB,UAAWjqB,KAAKuC,SAtDd,CAuDjD,GAEA,CAAAjE,IAAA,OAAAvK,MAIA,WACIiM,KAAKC,GAAG4G,WAAW7G,KAAKoG,SAIxB,IAAM2lB,EAAOx6B,KAAKmL,IAAIsD,KAAKrJ,KAAM,QAC3Bq1B,EAAYz6B,KAAK4lB,KAAKnX,KAAKyC,aAAespB,GAC1C7U,EAAY3lB,KAAKiW,MAAM,IAAM,GAAKwkB,GACxChsB,KAAK0D,WAAanS,KAAKmL,IAAI,GAAInL,KAAKoL,IAAIqD,KAAKuC,SAAU2U,EAAYlX,KAAK2D,kBAExE,IAAMsoB,EAAgBjsB,KAAKksB,cACrBC,GAAgBnsB,KAAKwD,mBAAqByoB,EAE5CjsB,KAAKooB,YAAc+D,IACnBnsB,KAAKosB,8BACLpsB,KAAKqsB,wBACLrsB,KAAKooB,YAAa,GAKtB,IAAM5C,EAAY/pB,EAAQuE,KAAKgD,MAAM7R,EAAG6O,KAAKsoB,SAASn3B,GAChDs0B,EAAYhqB,EAAQuE,KAAKgD,MAAM3P,EAAG2M,KAAKsoB,SAASj1B,GAGlD2M,KAAKkqB,cAAclqB,KAAKC,GAAG0H,UAAU3H,KAAKkqB,aAAc1E,EAAU3qB,GAAI4qB,EAAU5qB,IAChFmF,KAAKmqB,cAAcnqB,KAAKC,GAAG0H,UAAU3H,KAAKmqB,aAAc3E,EAAU1qB,GAAI2qB,EAAU3qB,IAGpF,IAAMwxB,EAAIlyB,EAAW4F,KAAKrJ,MACtBqJ,KAAKoqB,UAAUpqB,KAAKC,GAAGqK,UAAUtK,KAAKoqB,SAAUkC,EAAEjyB,MAClD2F,KAAKqqB,UAAUrqB,KAAKC,GAAGqK,UAAUtK,KAAKqqB,SAAUiC,EAAE/xB,KAGlDyF,KAAKsqB,cAActqB,KAAKC,GAAGsK,WAAWvK,KAAKsqB,aAActqB,KAAKgpB,WAC9DhpB,KAAKuqB,UAAUvqB,KAAKC,GAAGsK,WAAWvK,KAAKuqB,SAAUvqB,KAAKipB,OAE1D3S,GAAA6R,EAAA,cAAA7R,CAAA,GACJ,GAAC,CAAAhY,IAAA,cAAAvK,MAED,WACI,IAAM2Q,EAAK1E,KAAK+C,IAAI,GAAK/C,KAAKqoB,OAAO,GAC/B1jB,EAAK3E,KAAK+C,IAAI,GAAK/C,KAAKqoB,OAAO,GAIrC,OAAO92B,KAAKoN,MAAM+F,EAAIC,GAAkB,IAAZ3E,KAAKrJ,IACrC,GAEA,CAAA2H,IAAA,QAAAvK,MAIA,WACIiM,KAAKgpB,UAAS9zB,GAAO8K,KAAK8oB,mBAC1B9oB,KAAKipB,MAAK/zB,GAAO8K,KAAK+oB,eACtB/oB,KAAKoP,oBAAsB,EAC3BpP,KAAKooB,YAAa,EAClB9R,GAAA6R,EAAA,eAAA7R,CAAA,GACJ,GAIA,CAAAhY,IAAA,sBAAAvK,OAAAw4B,EAAAvrB,GAAA1M,KAAAE,EAOA,SAAAyK,EAA0ByH,GAAK,IAAA0G,EAAAC,EAAAhW,EAAAm1B,EAAAhf,EAAAjd,UAAA,OAAA+D,KAAAC,EAAA,SAAA4K,GAAA,cAAAA,EAAA5M,GAAA,OACM,GADJ6a,EAAQI,EAAAhd,OAAA,QAAAC,IAAA+c,EAAA,GAAAA,EAAA,GAAG,IAAKH,EAAgBG,EAAAhd,OAAA,QAAAC,IAAA+c,EAAA,GAAAA,EAAA,GAAG,KAChExN,KAAKoP,oBAAsB1I,IAEvBA,GAAS,GAAKA,EAAQ1G,KAAKiP,SAASze,QAAM,CAAA2O,EAAA5M,EAAA,QAKpB,OAJhB8E,EAAU2I,KAAKiP,SAASvI,GAExB8lB,EAAkBnf,GAAoBhW,EAAQpF,SAC9C,kBAAMob,EAAiBrb,EAAcqF,EAAQpF,SAAU,KAAK,EAC5Dob,EAAgBlO,EAAA5M,EAAA,EAChByN,KAAKysB,8BAA8B,CACrC9V,MAAOtf,EAAQsf,MACfqS,UAAW3xB,EAAQ2xB,WAAahpB,KAAK8oB,kBACrCG,MAAO5xB,EAAQ4xB,OAASjpB,KAAK+oB,eAC9B3b,EAAUof,GAAgB,OAAArtB,EAAA5M,EAAA,sBAAA4M,EAAA5M,EAAA,EAGvByN,KAAKysB,8BAA8B,KAAMrf,EAAUC,GAAiB,cAAAlO,EAAA3L,EAAA,KAAAyL,EAAA,SAEjF,SAlBwBF,GAAA,OAAAwtB,EAAA3tB,MAAC,KAADrO,UAAA,IAoBzB,CAAA+N,IAAA,wBAAAvK,MAKA,WAEI,IACM24B,EADMn7B,KAAKo7B,SACGp7B,KAAKW,GAAK,EAGxBG,EAAId,KAAKmL,IAAI,EAAGnL,KAAKya,IAAI0gB,IACzBpwB,EAAI/K,KAAKmL,IAAI,EAAGnL,KAAKya,IAAI0gB,EAAkB,EAAVn7B,KAAKW,GAAS,IAC/C8I,EAAIzJ,KAAKmL,IAAI,EAAGnL,KAAKya,IAAI0gB,EAAkB,EAAVn7B,KAAKW,GAAS,IAG/C44B,EAAO,GAAsB,GAAhBv5B,KAAKo7B,SAClB7R,EAAQ,EAAsB,GAAhBvpB,KAAKo7B,SAwBzB,MAAO,CAAEhW,MAtBK,CACVmU,EAAOz4B,EAAIyoB,EACXgQ,EAAOxuB,EAAIwe,EACXgQ,EAAO9vB,EAAI8f,GAmBCkO,UAdE,CACd,EAAsB,EAAhBz3B,KAAKo7B,SACX,EAAsB,EAAhBp7B,KAAKo7B,SACX,EAAsB,EAAhBp7B,KAAKo7B,UAWY1D,MANb,CACV13B,KAAKo7B,SAAWp7B,KAAKW,GAAK,EAC1BX,KAAKo7B,SAAWp7B,KAAKW,GAAK,EAC1BX,KAAKo7B,SAAWp7B,KAAKW,GAAK,GAIlC,GAEA,CAAAoM,IAAA,gCAAAvK,OAAAmZ,EAAAlM,GAAA1M,KAAAE,EAUA,SAAAuZ,EAAoCZ,GAAU,IAAAC,EAAAC,EAAAuf,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAznB,EAAA,KAAA4I,EAAA7d,UAAA,OAAA+D,KAAAC,EAAA,SAAA8Z,GAAA,cAAAA,EAAA9b,GAAA,OAqBgB,OArBd6a,EAAQgB,EAAA5d,OAAA,QAAAC,IAAA2d,EAAA,GAAAA,EAAA,GAAG,IAAKf,EAAgBe,EAAA5d,OAAA,QAAAC,IAAA2d,EAAA,GAAAA,EAAA,GAAG,KAE1EjB,EAEMhY,MAAMC,QAAQ+X,KAErBA,EAAa,CACTwJ,MAAOxJ,EACP6b,UAAS9zB,GAAM8K,KAAKgpB,WACpBC,MAAK/zB,GAAM8K,KAAKipB,SANpB9b,EAAanN,KAAKktB,wBAUtBltB,KAAKkG,6BAEC0mB,EAAU13B,GAAO8K,KAAK+D,cACtB8oB,EAAc33B,GAAO8K,KAAKgpB,WAC1B8D,EAAU53B,GAAO8K,KAAKipB,OAEtB8D,EAAc5f,EAAWwJ,MACzBqW,EAAkB7f,EAAW6b,WAAahpB,KAAK8oB,kBAC/CmE,EAAc9f,EAAW8b,OAASjpB,KAAK+oB,cAAa1a,EAAA9b,EAAA,EAEpD,IAAIwC,QAAQ,SAACC,GAEfwQ,EAAKnC,uBAAyBrO,EAC9B,IAAIyY,EAAY,KAEVC,EAAO,SAACC,GACLF,IAAWA,EAAYE,GAC5B,IAAMC,EAAWrc,KAAKoL,KAAKgR,EAAYF,GAAaL,EAAU,GAG9D5H,EAAKzB,aAAe,CAChBxG,EAAKqvB,EAAW,GAAIG,EAAY,GAAInf,GACpCrQ,EAAKqvB,EAAW,GAAIG,EAAY,GAAInf,GACpCrQ,EAAKqvB,EAAW,GAAIG,EAAY,GAAInf,IAIxCpI,EAAKwjB,UAAY,CACbzrB,EAAKsvB,EAAe,GAAIG,EAAgB,GAAIpf,GAC5CrQ,EAAKsvB,EAAe,GAAIG,EAAgB,GAAIpf,GAC5CrQ,EAAKsvB,EAAe,GAAIG,EAAgB,GAAIpf,IAIhDpI,EAAKyjB,MAAQ,CACT1rB,EAAKuvB,EAAW,GAAIG,EAAY,GAAIrf,GACpCrQ,EAAKuvB,EAAW,GAAIG,EAAY,GAAIrf,GACpCrQ,EAAKuvB,EAAW,GAAIG,EAAY,GAAIrf,IAGxCpI,EAAKO,OAEDsH,GAAkBA,IAElBO,EAAW,EACXpI,EAAKpC,2BAA6ByK,sBAAsBH,IAExDlI,EAAKnC,uBAAyB,KAC9BmC,EAAKU,6BACLlR,IAER,EAEAwQ,EAAKpC,2BAA6ByK,sBAAsBH,EAC5D,GAAE,cAAAW,EAAA7a,EAAA,KAAAua,EAAA,SACL,SApEkCkC,GAAA,OAAA/C,EAAAtO,MAAC,KAADrO,UAAA,IAsEnC,CAAA+N,IAAA,wBAAAvK,OAAAo5B,EAAAnsB,GAAA1M,KAAAE,EAWA,SAAA+a,EAA4B9I,GAAM,IAAA2mB,EAAAC,EAAAC,EAAAha,EAAAia,EAAAlgB,EAAAmgB,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAnJ,EAAAoJ,EAAAC,EAAAC,EAAAC,EAAAv+B,UAAA,OAAA+D,KAAAC,EAAA,SAAAib,GAAA,cAAAA,EAAAjd,GAAA,OA8BuE,GA9BrE+6B,EAAewB,EAAAt+B,OAAA,QAAAC,IAAAq+B,EAAA,GAAAA,EAAA,GAAG,IAAMxb,EAAWwb,EAAAt+B,OAAA,QAAAC,IAAAq+B,EAAA,GAAAA,EAAA,GAAG,IAAMvB,EAAcuB,EAAAt+B,OAAA,QAAAC,IAAAq+B,EAAA,GAAAA,EAAA,GAAG,KAAMzhB,EAAgByhB,EAAAt+B,OAAA,QAAAC,IAAAq+B,EAAA,GAAAA,EAAA,GAAG,KAEtH1+B,EAAI,wBAADM,OAAyBgH,KAAKC,UAAU8O,KAErC+mB,EAAiB5vB,EAAiC,QAAhBwvB,EAAC3mB,EAAO7P,gBAAQ,IAAAw2B,EAAAA,EAAIptB,KAAKwC,kBAI3DirB,EAAYl8B,KAAKmN,IAAInN,KAAKnB,IAAI4P,KAAKrJ,KAAO8P,EAAO9P,OACjD+2B,EAAeD,EAAY,IAC3BE,EAAiBF,EAAY,IAG7BG,EAAUr8B,KAAKoN,MAAMqB,KAAK+C,IAAI,GAAK0D,EAAO1D,IAAI,GAAI/C,KAAK+C,IAAI,GAAK0D,EAAO1D,IAAI,IAC3E8qB,EAAiBpnB,EAAO9P,KAExBo3B,GADAD,EAAWF,EAAUC,GACI,GACzBG,EAAgBF,EAAW,EAG7BG,GAAsB,EACtBC,GAAkB,EAClBznB,EAAO1P,YACPk3B,EAAqBjuB,KAAKiP,SAASc,UAAU,SAAA3c,GAAC,OAAIA,EAAE4c,KAAOvJ,EAAO1P,SAAS,GAC3Em3B,EAAkBD,EAAqB,GAAKA,IAAuBjuB,KAAKoP,qBAGtE+e,EAA0BZ,GAA8B,QAAhBF,EAAI5mB,EAAOsoB,aAAK,IAAA1B,EAAAA,EAAI,GAG5De,EAAmB78B,KAAKmL,IAAI,IAAKnL,KAAKoL,IAAI2W,EAAa,IAAiB,IAAXwa,EAA6B,IAAZL,MAEhFC,GAAgBK,GAAeG,GAAe,CAAA1e,EAAAjd,EAAA,eAAAid,EAAAjd,EAAA,EAExCyN,KAAKmV,kBAAkBqY,EAAgBF,EAAiBr8B,EAAUQ,OAAM,OAAA+d,EAAAjd,EAAA,oBACvEm7B,IAAgBK,EAAW,CAAAve,EAAAjd,EAAA,QAOjC,OALK87B,EAAa,CACfruB,KAAKmV,kBAAkBqY,EAAgBF,EAAiBr8B,EAAUQ,QAEjEy8B,GACDG,EAAWv4B,KAAKkK,KAAKgvB,6BAA6BvoB,EAAQ6mB,EAAiBjgB,IAC9EmC,EAAAjd,EAAA,EACKwC,QAAQqf,IAAIia,GAAW,OAAA7e,EAAAjd,EAAA,oBACtBo7B,IAAkBK,EAAa,CAAAxe,EAAAjd,EAAA,QASrC,OAPDnC,EAAI,uCAADM,OAAwC+8B,EAAUr2B,QAAQ,GAAE,eAAA1G,OAAco9B,EAAS12B,QAAQ,GAAE,MAC1Fi3B,EAAa,CACfruB,KAAKivB,oBAAoBxoB,EAAO1D,IAAK0D,EAAO9P,KAAMy3B,EAAkBn9B,EAAUK,OAC9E0O,KAAKmV,kBAAkBqY,EAAgBY,EAAkBn9B,EAAUK,QAElE48B,GACDG,EAAWv4B,KAAKkK,KAAKgvB,6BAA6BvoB,EAAQ2nB,EAAkB/gB,IAC/EmC,EAAAjd,EAAA,EACKwC,QAAQqf,IAAIia,GAAW,OAAA7e,EAAAjd,EAAA,oBACtBm7B,EAAc,CAAFle,EAAAjd,EAAA,QAQlB,OANK87B,EAAa,CACfruB,KAAK0T,aAAajN,EAAO1D,IAAKuQ,EAAariB,EAAUK,OACrD0O,KAAKmV,kBAAkBqY,EAAgBla,EAAariB,EAAUK,QAE7D48B,GACDG,EAAWv4B,KAAKkK,KAAKgvB,6BAA6BvoB,EAAQ6M,EAAajG,IAC1EmC,EAAAjd,EAAA,EACKwC,QAAQqf,IAAIia,GAAW,OAAA7e,EAAAjd,EAAA,oBACtBw7B,EAAa,CAAFve,EAAAjd,EAAA,SAOjB,OALK87B,EAAa,CACfruB,KAAKkvB,sBAAsBzoB,EAAO9P,KAAM62B,EAAgBY,EAAkBn9B,EAAUQ,QAEnFy8B,GACDG,EAAWv4B,KAAKkK,KAAKgvB,6BAA6BvoB,EAAQ2nB,EAAkB/gB,IAC/EmC,EAAAjd,EAAA,EACKwC,QAAQqf,IAAIia,GAAW,OAAA7e,EAAAjd,EAAA,iBAK2B,KAAnCyN,KAAKrJ,KAA2B,GAApBqJ,KAAKyC,cACpB,CAAF+M,EAAAjd,EAAA,SACyD,OAA/Dk8B,EAAkBzuB,KAAKpJ,UAAYrF,KAAKo7B,SAAWz6B,EAAK,EAAIA,GAAGsd,EAAAjd,EAAA,GAC/DyN,KAAKkvB,sBAAsBlvB,KAAKyC,aAAcgsB,EAAiBnB,EAAiBr8B,EAAUQ,OAAM,eAAA+d,EAAAjd,EAAA,GAIpGyN,KAAK0T,aAAajN,EAAO1D,IAAKuQ,EAAariB,EAAUK,OAAM,QASjE,IALMo9B,EAAqBn9B,KAAKiW,MAAsB,EAAhBjW,KAAKo7B,UACrCpH,EAAoBh0B,KAAKo7B,SAAW,GAAM,GAAK,EAGjDgC,EAAanB,EAAiBxtB,KAAKpJ,SAChC+3B,EAAaz8B,GAAIy8B,GAAmB,EAALz8B,EACtC,KAAOy8B,GAAcz8B,GAAIy8B,GAAmB,EAALz8B,EAWtC,OAPK08B,EAA0B5uB,KAAKpJ,SAAW+3B,EAAcpJ,EAAoBmJ,EAAqBx8B,EAAK,EAEtG28B,EAAkB,CACpB7uB,KAAKkvB,sBAAsBzoB,EAAO9P,KAAMi4B,EAAyBT,EAAyBl9B,EAAUC,OAEnGg9B,GACDW,EAAgB/4B,KAAKkK,KAAKgvB,6BAA6BvoB,EAAQ0nB,EAAyB9gB,IAC3FmC,EAAAjd,EAAA,GACKwC,QAAQqf,IAAIya,GAAgB,QAItC7uB,KAAKpJ,SAAWgH,EAAkBoC,KAAKpJ,UAEvCoJ,KAAKuD,mBAAqBkD,EAAOC,OAAS,EAG1C1G,KAAK8F,iBACL9F,KAAK+F,OAGc,eAAAyJ,EAAAhc,EAAA,KAAA+b,EAAA,SACtB,SAzH0BW,GAAA,OAAAid,EAAAvuB,MAAC,KAADrO,UAAA,IA2H3B,CAAA+N,IAAA,cAAAvK,OAAAo7B,EAAAnuB,GAAA1M,KAAAE,EAQA,SAAAga,IAAA,IAAAme,EAAAtf,EAAA+hB,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA1gB,EAAAxe,UAAA,OAAA+D,KAAAC,EAAA,SAAAya,GAAA,cAAAA,EAAAzc,GAAA,OAKuD,GALrCo6B,IAAM5d,EAAAve,OAAA,QAAAC,IAAAse,EAAA,KAAAA,EAAA,GAAS1B,EAAgB0B,EAAAve,OAAA,QAAAC,IAAAse,EAAA,GAAAA,EAAA,GAAG,KAAMqgB,EAAgBrgB,EAAAve,OAAA,QAAAC,IAAAse,EAAA,GAAAA,EAAA,GAAG,KAAMsgB,EAAWtgB,EAAAve,OAAA,QAAAC,IAAAse,EAAA,GAAAA,EAAA,GAAG,GAE7F/O,KAAKiG,6BAGCqpB,EAAa,GAAH5+B,OAAAwE,GAAO8K,KAAK8C,SAAO5N,GAAKm6B,KAExB7+B,OAAQ,CAAFwe,EAAAzc,EAAA,QACsC,OAAAyc,EAAAxb,EAAA,UAK5DwM,KAAKsD,YAAa,EAGdisB,EAAY,EACVC,EAAqB,SAAC7C,GACxB,GAAI2C,EAAW9+B,QAAU,EACrB,OAAO,EAGX,GAAIm8B,EAAQ,CAER,IAAIjmB,EACJ,GACIA,EAAQnV,KAAKiW,MAAMjW,KAAKo7B,SAAW2C,EAAW9+B,cACzCkW,IAAU6oB,GAAaD,EAAW9+B,OAAS,GACpD,OAAOkW,CACX,CAEI,OAAQ6oB,EAAY,GAAKD,EAAW9+B,MAE5C,EAEA,WACOwP,KAAKsD,WAAY,CAAF0L,EAAAzc,EAAA,QAEyB,GAD3Cg9B,EAAYC,EAAmB7C,GACzB8C,EAAgBH,EAAWC,GAEb,CAAFvgB,EAAAzc,EAAA,QACiD,OAAAyc,EAAAxb,EAAA,YAIyB,OAAAwb,EAAAzc,EAAA,EAEtFyN,KAAK0vB,sBAAsBD,EAAe,IAAM,IAAM,IAAMpiB,GAAiB,OAKlF,OAFG+hB,GACAA,IACHpgB,EAAAzc,EAAA,EAEKuM,GAAW,MAAK,OAAAkQ,EAAAzc,EAAA,eAIP,cAAAyc,EAAAxb,EAAA,KAAAgb,EAAA,SACtB,WA3DgB,OAAA2gB,EAAAvwB,MAAC,KAADrO,UAAA,KAnnBrB8B,GAAA4O,GAAA9O,EAAAU,UAAAR,GAAAD,GAAA6O,GAAA9O,EAAAC,GAAAY,OAAAyB,eAAAtC,EAAA,aAAA0C,UAAA,IAAA1C,EAAA,IAAAA,EAAAE,EAAAD,EA2mBI+8B,EAtIAhC,EAhFAjgB,EAvEAqf,CAkWA,CAjqBoB,CAASnqB,IAoqBjC,Y,k7DClrBwD,IAElDutB,GAAe,SAAAnZ,GAEjB,SAAAmZ,EAAY7vB,GAAQ,IAAAwC,EASJ,O,4FATIvC,CAAA,KAAA4vB,IAChBrtB,EAAAhB,GAAA,KAAAquB,EAAA,CAAM7vB,KAED8vB,UAAY,IACjBttB,EAAKO,SAAW,IAChBP,EAAKG,aAAe,GAEpBH,EAAKklB,sBAAuB,EAE5BllB,EAAKxB,OAAOwB,CAChB,CAAC,O,sRAAAmC,CAAAkrB,EAAAnZ,G,EAAAmZ,G,EAAA,EAAArxB,IAAA,iBAAAvK,MAED,WACIiM,KAAK6vB,aAAe7vB,KAAKC,GAAG8J,mBAAmB/J,KAAKoG,QAAS,eAC7DpG,KAAK8vB,wBAA0B9vB,KAAKC,GAAG8J,mBAAmB/J,KAAKoG,QAAS,0BAExEkQ,GAAAqZ,EAAA,wBAAArZ,CAAA,GACJ,GAAC,CAAAhY,IAAA,OAAAvK,MAED,WACIiM,KAAKC,GAAG+pB,UAAUhqB,KAAK6vB,aAAc7vB,KAAK4vB,WAC1C5vB,KAAKC,GAAG+pB,UAAUhqB,KAAK8vB,wBAAyB9vB,KAAKwnB,qBAAuB,EAAI,GAEhFlR,GAAAqZ,EAAA,cAAArZ,CAAA,GACJ,GAAC,CAAAhY,IAAA,6BAAAvK,MAED,WACI,M,shHAEJ,GAAC,CAAAuK,IAAA,mBAAAvK,MAED,WAEA,GAAC,CAAAuK,IAAA,cAAAvK,MAED,WAEA,M,2FAAC,CAvCgB,CAASqO,IA0C9B,YC5BA,IAQI2tB,GACAC,GACAC,GACAC,GACAC,GAGA3X,GAFA4X,GAAmB,EAQhB,SAASC,GAAiB1U,GACvBA,aAAesG,KAKrBzJ,GAAamD,EAEbqU,GAAaljB,SAASC,eAAe,cACrCmjB,GAAkBpjB,SAASC,eAAe,mBAC1CkjB,GAAanjB,SAASC,eAAe,cACrCojB,GAAkBrjB,SAASC,eAAe,mBAE1CijB,GAAWtvB,iBAAiB,QAAS4vB,IACrCL,GAAWvvB,iBAAiB,QAAS6vB,KAErCR,GAAkBjjB,SAASC,eAAe,YAC1B6K,MAAMS,QAAU,OAGpC,CAEA,SAASmY,KACLhY,GAAWzS,OACXC,KACAlN,IACA23B,KACAjY,GAAWzB,SAAW,CAC1B,CAOA,SAAS2Z,GAAoBC,EAAQ58B,GACjC,IAAM68B,EAAar/B,KAAKmN,IAAI3K,GAtDJ,IAuDxB48B,EAAO3jB,UAAU6jB,OAAO,YAAaD,EACzC,CAOA,SAASE,GAAW/8B,GAChB,OAAOxC,KAAKmN,IAAI3K,GA7DQ,KA6DuB,EAAIA,CACvD,CAEA,IAAMu8B,GAAqB,WACvB,IAAIz5B,EAAKi6B,GAAWj4B,WAAWm3B,GAAWj8B,QAC1CykB,GAAW5lB,EAAE,GAAKiE,EAClBq5B,GAAgBa,YAAcl6B,EAAGO,QAAQ,GACzCs5B,GAAoBV,GAAYn5B,GAChC25B,IACJ,EAEMD,GAAqB,WACvB,IAAIz5B,EAAKg6B,GAAWj4B,WAAWo3B,GAAWl8B,QAC1CykB,GAAW5lB,EAAE,GAAKkE,EAClBq5B,GAAgBY,YAAc,GAAHrgC,OAAMoG,EAAGM,QAAQ,GAAE,KAC9Cs5B,GAAoBT,GAAYn5B,GAChC05B,IACJ,EAkBO,SAASQ,KACPpU,OAKLoT,GAAWj8B,MAAQ8E,WAAW2f,GAAW5lB,EAAE,GAAGwE,QAAQ,IACtD64B,GAAWl8B,MAAQ8E,WAAW2f,GAAW5lB,EAAE,GAAGwE,QAAQ,IACtD84B,GAAgBe,UAAYjB,GAAWj8B,MACvCo8B,GAAgBc,UAAYhB,GAAWl8B,MAAQ,IAC/CykB,GAAWzB,SAAW,EAC1B,CAGO,SAASma,KACZ,IAAMtrB,EAAMD,YAAYC,MACIA,EAAMwqB,GAtHD,KA6HjCA,GAAmBxqB,EACnBsqB,GAAgBe,UAAYzY,GAAW5lB,EAAE,GAAGwE,QAAQ,GACpD+4B,GAAgBc,UAAYzY,GAAW5lB,EAAE,GAAGwE,QAAQ,GAAK,IACzD44B,GAAWj8B,MAAQ8E,WAAW2f,GAAW5lB,EAAE,GAAGwE,QAAQ,IACtD64B,GAAWl8B,MAAQ8E,WAAW2f,GAAW5lB,EAAE,GAAGwE,QAAQ,IAGtDs5B,GAAoBV,GAAYxX,GAAW5lB,EAAE,IAC7C89B,GAAoBT,GAAYzX,GAAW5lB,EAAE,IACjD,C,80BCrIO,ICmCHkN,GACA0Y,GDpCS2Y,GAAU,WAuGlB,O,EAnGD,SAAAA,EAAYrxB,EAAQ0Y,GAAY,IAAA4Y,EAAAC,EAAAC,EAAAhvB,EAAA,KAM5B,G,4FAN4BvC,CAAA,KAAAoxB,GAAAI,GAAA,qBAFhB,aAAWA,GAAA,cA0MlB,SAACC,GAAO,IAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EACb,GAAKzvB,EAAK0vB,WAAc1vB,EAAKkW,WAA7B,CAEA,IAAMyZ,EAAKtsB,YAAYC,MAGvBtD,EAAK4vB,gBAGL,IAAMC,EAAKX,EAAKlvB,EAAK2I,KAAKmnB,UAC1B9vB,EAAK2I,KAAKmnB,UAAYZ,EACtBlvB,EAAK2I,KAAKonB,QAAUF,EACpB7vB,EAAK2I,KAAKqnB,gBAAkBhwB,EAAKiwB,OAAOjwB,EAAK2I,KAAKqnB,gBAAiBH,EAAI,IACvE7vB,EAAK2I,KAAKunB,IAAML,EAAK,EAAI,IAAOA,EAAK,EAGrC,IAAMvsB,EAAMD,YAAYC,MAClB6sB,EAAoB7sB,EAAMtD,EAAK2I,KAAKynB,mBACtCD,GAAqB,MAErBnwB,EAAK2I,KAAK0nB,UAAmC,IAAtBrwB,EAAK2I,KAAK2nB,UAAoBH,EACrDnwB,EAAK2I,KAAK2nB,UAAY,EACtBtwB,EAAK2I,KAAKynB,mBAAqB9sB,GAGnC,IAAM0B,EAAMzP,OAAO0P,kBAAoB,EAEjCtH,EAAKqC,EAAKrC,GAChB,GAAKA,GAA6C,mBAAhCA,EAAG4yB,yBAArB,CAEA,IAAMC,EAAK7yB,EAAG4yB,yBAAyB5yB,EAAGuI,gBAAiBvI,EAAG8yB,YAExDC,EAAS,CAACt5B,UAAWo5B,EAAGp5B,UAAWu5B,SAAUH,EAAGG,SAAUC,SAAUJ,EAAGI,UAEvEC,EAAW33B,EAAQ8G,EAAKkW,WAAWxV,MAAM7R,GACzCiiC,EAAW53B,EAAQ8G,EAAKkW,WAAWxV,MAAM3P,GACzCwD,EAAK+lB,KAAgBta,EAAKkW,WAAW5lB,EAAE,GAAK,EAC5CkE,EAAK8lB,KAAgBta,EAAKkW,WAAW5lB,EAAE,GAAK,EAE5CygC,EAAU/wB,EAAKkW,WAAWzV,IAAI,GAC9BuwB,EAAUhxB,EAAKkW,WAAWzV,IAAI,GAE9BpM,EAAO2L,EAAKkW,WAAW7hB,KACvB48B,EAAWhiC,KAAKmL,IAAI/F,EAAM,QAG1B68B,EAAYlxB,EAAKxC,OAAOkH,MAAQusB,EAIhCE,EADSliC,KAAKoN,MAAMw0B,EAAUC,GACPG,EACvBG,EAAqBniC,KAAK4lB,KAAK5lB,KAAKmL,IAAI+2B,EAAa,SAIrDE,EADWpiC,KAAKoN,MAAMw0B,EAAWE,EAASD,EAAWE,GACzBC,EAE5BK,EAActxB,EAAKkW,WAAW4P,WAAa,QAAU,SACrDyL,EAAatiC,KAAKiW,OAAOjW,KAAKuiC,MAAMP,IAGpCQ,EAAa,SAACC,GAChB,MAAc,QAAVA,EAAwB,UACd,SAAVA,EAAyB,WACtB,QACX,EAGIxI,EAAQ,IAERyI,EAAW,KACXP,EAAqB,IACrBO,EAAW,MACXzI,GAAS,IACFkI,EAAqB,IAC5BO,EAAW,OACXzI,GAAS,IACFkI,EAAqB,KAC5BO,EAAW,OACXzI,GAAS,IAGb,IAAI0I,EAAa,KACbP,EAAiB,GACjBO,EAAa,MACb1I,GAAS,IACFmI,EAAiB,IACxBO,EAAa,OACb1I,GAAS,IACFmI,EAAiB,MACxBO,EAAa,OACb1I,GAAS,GAGb,IAAI2I,EAAa,KACbX,EAAY,MACZW,EAAa,OACb3I,GAAS,IAETgI,EAAY,MACZW,EAAa,MACb3I,GAAS,IAKb,IAAI4I,EAAc,MAFlB5I,EAAQj6B,KAAKmL,IAAI,EAAGnL,KAAKoL,IAAI,IAAKpL,KAAKsN,MAAM2sB,MAGjC,KAAI4I,EAAc,QAC1B5I,EAAQ,KAAI4I,EAAc,OAE9B,IAAMC,EACc,QAAhBD,GAAyC,SAAhBA,EAAsB,SAAA1jC,OAChCujC,EAAQ,YAAAvjC,OAAWwjC,EAAU,YAAAxjC,OAAWyjC,EAAU,KAC3D,GAKJG,EAAYhyB,EAAK2I,KAAKE,cACtBopB,EACDt9B,OAAO8C,SAASu6B,GACXA,EAAY,GAAK,MACbA,EAAY,GAAK,OACb,KAHgB,KAK5BE,EACFlyB,EAAK2I,KAAK0nB,UAAY,GAAK,MACrBrwB,EAAK2I,KAAK0nB,UAAY,GAAK,OACvB,KAGR8B,EAAa9uB,YAAYC,MAAQqsB,EACvC3vB,EAAK2I,KAAKwpB,WAAaA,EACvBnyB,EAAK2I,KAAKypB,mBAAqBpyB,EAAKiwB,OAAOjwB,EAAK2I,KAAKypB,mBAAoBD,EAAY,IAGrF,IACME,EADShvB,YAAYC,MAAQtD,EAAK2I,KAAK2pB,gBACjB,IAEtBC,EACFvyB,EAAK2I,KAAK6pB,aACH79B,OAAO8C,SAASu6B,GACZK,EACG,SACCL,EA3BG,IAAO,GA2BkB,YAAc,KAC/C,uBACJ,eAKJS,EAAY,GACdzyB,EAAKkW,WAAWvV,0BAA0B8xB,EAAUj/B,KAAK,OACzDwM,EAAKkW,WAAWtV,2BAA2B6xB,EAAUj/B,KAAK,QAC1DwM,EAAKkW,WAAWrV,+BAA+B4xB,EAAUj/B,KAAK,YAC9DwM,EAAKkW,WAAWpV,4BAA4B2xB,EAAUj/B,KAAK,SAC3DwM,EAAKkW,WAAW1B,wBAAwBie,EAAUj/B,KAAK,KAC3D,IAAMk/B,EAAaD,EAAUvkC,OAAS,EAAIukC,EAAU53B,KAAK,MAAQ,OAC3D83B,EAASzO,KAGT0O,EAAc5yB,EAAKkW,WAAW5hB,UAAY,EAC1Cu+B,EAA6B,IAAdD,EAAoB3jC,KAAKW,GAAM,IAG9CkjC,EAAa9yB,EAAKkW,WAAWpJ,oBAC7BimB,EAAcD,GAAc,GAA6B,QAA5B3D,EAAInvB,EAAKkW,WAAWvJ,gBAAQ,IAAAwiB,GAAc,QAAdA,EAAxBA,EAA2B2D,UAAW,IAAA3D,GAAtCA,EAAwCzhB,GACzE1N,EAAKkW,WAAWvJ,SAASmmB,GAAYplB,IACpB,IAAhBolB,EAAoB,iBAAmB,MACxCrxB,EAAezB,EAAKkW,WAAWzU,cAAgB,CAAC,EAAG,EAAG,GAGtDuxB,GAAehzB,EAAKkW,WAAWwQ,WAAa1mB,EAAKkW,WAAWyQ,MAC5DsM,GAAUD,GAAY,IAAA5kC,OAClB4R,EAAKkW,WAAWwQ,UAAU/rB,IAAI,SAAA1J,GAAC,OAAIA,EAAE6D,QAAQ,EAAE,GAAE+F,KAAK,MAAK,KAC/D,MACAq4B,GAAWF,GAAY,IAAA5kC,OACnB4R,EAAKkW,WAAWyQ,MAAMhsB,IAAI,SAAA1J,GAAC,OAAIA,EAAE6D,QAAQ,EAAE,GAAE+F,KAAK,MAAK,KAC3D,MAGAs4B,GAA8B,QAAxB/D,EAAGpvB,EAAKkW,WAAWxV,aAAK,IAAA0uB,OAAA,EAArBA,EAAuBvgC,EAChCukC,GAA8B,QAAxB/D,EAAGrvB,EAAKkW,WAAWxV,aAAK,IAAA2uB,OAAA,EAArBA,EAAuBt+B,EAChCsiC,GAAkB,QAAb/D,EAAG6D,cAAM,EAANA,GAAQ56B,UAAE,IAAA+2B,EAAAA,EAAI,EACtBgE,GAAkB,QAAb/D,EAAG4D,cAAM,EAANA,GAAQ36B,UAAE,IAAA+2B,EAAAA,EAAI,EACtBgE,GAAkB,QAAb/D,EAAG4D,cAAM,EAANA,GAAQ76B,UAAE,IAAAi3B,EAAAA,EAAI,EACtBgE,GAAkB,QAAb/D,EAAG2D,cAAM,EAANA,GAAQ56B,UAAE,IAAAi3B,EAAAA,EAAI,EAGtBgE,GAAkBzzB,EAAKkW,WAAW9S,qBAClCswB,GAAuBD,KACrBpwB,YAAYC,MAAQmwB,IAAmB,KAAM3+B,QAAQ,GAAK,QAC5D,MAEA6+B,GAAY3zB,EAAK4zB,IAAIC,gBAAkB7zB,EAAK4zB,IAAIE,QAAU,UAC1DC,GAAc/zB,EAAK4zB,IAAII,kBAAoBh0B,EAAK4zB,IAAIK,UAAY,UAEtEj0B,EAAK0vB,UAAUwE,UAAY,kUAAH9lC,OAGmCiL,EAAIq3B,EAAOt5B,WAAU,YAAAhJ,OAAWiL,EAAIq3B,EAAOC,UAAS,MAAAviC,OAAKiL,EAAIq3B,EAAOE,UAAS,4DAAAxiC,OAC9FiL,EAAI06B,IAAY,4BAAA3lC,OAA2BiL,EAAIs6B,IAAU,oEAAAvlC,OACxDiL,EAAI86B,MAAiB,2EAAA/lC,OAA0EiL,EAAI2G,EAAKxC,OAAOkH,OAAM,KAAAtW,OAAIiL,EAAI2G,EAAKxC,OAAOmH,QAAO,gCAAAvW,OAA+BiL,EAAI2L,GAAI,2JAAA5W,OAGxLiL,EAAIw3B,EAAS/7B,QAAQ,KAAI,MAAA1G,OAAKiL,EAAIy3B,EAASh8B,QAAQ,KAAI,yDAAA1G,OAC1DiL,EAAIg6B,GAAM3T,cAAc,IAAG,QAAAtxB,OAAOiL,EAAIi6B,GAAM5T,cAAc,IAAG,+DAAAtxB,OAC7DiL,EAAIk6B,GAAM7T,cAAc,IAAG,QAAAtxB,OAAOiL,EAAIm6B,GAAM9T,cAAc,IAAG,kEAAAtxB,OAC1DiL,EAAIhF,EAAKqrB,cAAc,IAAG,+BAAAtxB,OAA8BiL,EAAIk4B,GAAW,uEAAAnjC,OACnEiL,EAAIw5B,EAAY/9B,QAAQ,IAAG,6BAAA1G,OAA4BiL,EAAIu5B,EAAY99B,QAAQ,IAAG,mCAAA1G,OAC1HksB,KAAgB,qCAAHlsB,OAAwCiL,EAAI9E,EAAGO,QAAQ,KAAI,MAAA1G,OAAKiL,EAAI7E,EAAGM,QAAQ,KAAI,UAAW,GAAE,8JAAA1G,QAGxC,IAAhB0kC,EAAoB,WAAa,SAAQ,MAAA1kC,OAAKiL,EAAI05B,GAAY,uCAAA3kC,OAAsCiL,EAAIy5B,GAAW,qEAAA1kC,OAClIqT,EAAa9G,IAAI,SAAA1J,GAAC,OAAIA,EAAE6D,QAAQ,EAAE,GAAE+F,KAAK,MAAK,wBAAAzM,OACpF4kC,GAAe,uCAAH5kC,OAA0CiL,EAAI45B,IAAQ,0CAAA7kC,OAAyCiL,EAAI65B,IAAS,SAAU,GAAE,8JAAA9kC,OAG5EqkC,EAAUvkC,OAAS,EAAI,WAAa,SAAQ,MAAAE,OAAKiL,EAAIq5B,GAAW,YAAAtkC,OAAWukC,EAAS,+CAAiD,GAAE,4DAAAvkC,OAC1JiL,EAAI2G,EAAKkW,WAAW9U,YAAW,gCAAAhT,OAA+BiL,EAAI2G,EAAKkW,WAAWjW,UAAS,iFAAA7R,OAC9E4R,EAAKkW,WAAW4P,WAAa,WAAa,SAAQ,MAAA13B,OAAKiL,EAAIi4B,GAAY,8FAAAljC,OACzDiL,EAAIq6B,IAAqB,mLAAAtlC,OAG5BqjC,EAAWK,GAAY,MAAA1jC,OAAK86B,EAAK,qCAAA96B,OAAoCiL,EAAI04B,GAAM,mDAAA3jC,OACvHqjC,EAAWI,GAAW,MAAAzjC,OAAKiL,EAAI63B,EAAUxR,cAAc,IAAG,oEAAAtxB,OAAmEqjC,EAAWE,GAAS,MAAAvjC,OAAKiL,EAAI+3B,EAAmBt8B,QAAQ,IAAG,qDAAA1G,OACtLqjC,EAAWG,GAAW,MAAAxjC,OAAKiL,EAAIg4B,EAAev8B,QAAQ,IAAG,sNAAA1G,OAG1BqjC,EAAWS,GAAS,MAAA9jC,OAAKiL,EAAI2G,EAAK2I,KAAK0nB,UAAUv7B,QAAQ,IAAG,uCAAA1G,OAAsCiL,EAAI2G,EAAK2I,KAAKunB,IAAIp7B,QAAQ,IAAG,+EAAA1G,OACrIqjC,EAAWQ,GAAS,MAAA7jC,OAAK4R,EAAKo0B,eAAepC,GAAU,kCAAA5jC,OAAiCiL,EAAIk5B,GAAQ,8BAAAnkC,OACpJ4R,EAAKq0B,yBAAwB,uBAGnC9oB,sBAAsBvL,EAAKs0B,OA9MyC,CA3BrB,CA0OnD,GAoEArF,GAAA,cACS,WACAjvB,EAAK0vB,YACV1vB,EAAK0vB,UAAUpa,MAAMS,QAA2C,UAAjC/V,EAAK0vB,UAAUpa,MAAMS,QAAsB,OAAS,QACvF,GA1fIrY,KAAKF,OAASA,EACdE,KAAKwY,WAAaA,EAClBxY,KAAKC,GAAKuY,aAAU,EAAVA,EAAYvY,GAEtBD,KAAKgyB,UAAYllB,SAASC,eAAe/M,KAAK62B,eACzC72B,KAAKgyB,UAAV,CAKA,GAAI/4B,IAAiB,CACjB,IAAI69B,EAAU,EACd92B,KAAKgyB,UAAUtxB,iBAAiB,cAAe,SAACvO,GAC5C,IAAMyT,EAAMoe,KAAKpe,MACbA,EAAMkxB,EAAU,KAChBx0B,EAAKuuB,SAETiG,EAAUlxB,EACVzT,EAAE0O,gBACN,EACJ,CAEAb,KAAKgyB,UAAUtxB,iBAAiB,WAAY,SAACE,GACzC,GAAqB,IAAjBA,EAAMwb,OAAc,CAEpBhsB,EAAIkS,EAAK0vB,UAAUf,UAAW3uB,EAAKnM,YAAYC,KAAMjG,GAGrD,IAAI4mC,EAAOz0B,EAAK0vB,UAAUf,UAAU5zB,UAAUiF,EAAK0vB,UAAUf,UAAU+F,QAAQ,SAE/E99B,UAAUslB,UAAUC,UAAUsY,GAAM9hC,KAAK,WACrC7E,EAAI,kCACR,EAAG,SAAU+K,GACT/K,EAAI,uCAAyC+K,EAAIlF,WAAY,GAAI9F,EACrE,EACJ,CACJ,GAGA6P,KAAKi3B,UACM,QAAP7F,EAAApxB,KAAKC,UAAE,IAAAmxB,OAAA,EAAPA,EAASlI,aAAa,+BACf,QAD0CmI,EACjDrxB,KAAKC,UAAE,IAAAoxB,OAAA,EAAPA,EAASnI,aAAa,qCACtB,KAGJlpB,KAAKk3B,iBACM,QAAP5F,EAAAtxB,KAAKC,UAAE,IAAAqxB,OAAA,EAAPA,EAASpI,aAAa,+BAAgC,KAE1DlpB,KAAKk2B,IAAM,CACPE,OAAQ,UACRG,SAAU,UACVJ,eAAgB,KAChBG,iBAAkB,KAClBa,aAAc,UACdC,uBAAwB,UACxBC,eAAgB,KAChBC,YAAa,KACbC,gBAAiB,KACjBC,gBAAiB,KACjBC,gBAAiB,MAGrBz3B,KAAK03B,eAGL13B,KAAKiL,KAAO,CAERmnB,UAAWzsB,YAAYC,MACvB4sB,IAAK,EACLH,QAAS,EACTC,gBAAiBz4B,IAGjB+4B,UAAW,EACXF,mBAAoB/sB,YAAYC,MAChC+sB,UAAW,EAGX8B,WAAY,EACZC,mBAAoB76B,IAGpBi7B,eAAgB90B,KAAKi3B,SACrB/rB,MAAOrR,IACPsR,cAAetR,IACf89B,aAAa,EACb/C,gBAAiB,EAGjBgD,cAAe,KACfC,eAAgB,IAIpB73B,KAAK6wB,SAGLhjB,sBAAsB7N,KAAK42B,OAzF3B,CA0FJ,E,EAAC,EAAAt4B,IAAA,cAAAvK,MAED,SAAYwiC,GACRv2B,KAAKwY,WAAa+d,GAAY,KAC9Bv2B,KAAKC,IAAKs2B,aAAQ,EAARA,EAAUt2B,KAAM,IAC9B,GAAC,CAAA3B,IAAA,eAAAvK,MAED,WACI,IAAMkM,EAAKD,KAAKC,GAChB,GAAKA,EAEL,IAaI,GAZAD,KAAKk2B,IAAIiB,aAAel3B,EAAG63B,aAAa73B,EAAG83B,UAAY,UACvD/3B,KAAKk2B,IAAIkB,uBACLn3B,EAAG63B,aAAa73B,EAAG+3B,2BAA6B,UACpDh4B,KAAKk2B,IAAIE,OAASn2B,EAAG63B,aAAa73B,EAAGg4B,SAAW,UAChDj4B,KAAKk2B,IAAIK,SAAWt2B,EAAG63B,aAAa73B,EAAGi4B,WAAa,UAEpDl4B,KAAKk2B,IAAImB,eAAiBp3B,EAAG63B,aAAa73B,EAAGk4B,kBAC7Cn4B,KAAKk2B,IAAIoB,YAAcr3B,EAAG63B,aAAa73B,EAAGm4B,qBAC1Cp4B,KAAKk2B,IAAIqB,gBAAkBt3B,EAAG63B,aAAa73B,EAAGo4B,8BAC9Cr4B,KAAKk2B,IAAIsB,gBAAkBv3B,EAAG63B,aAAa73B,EAAGq4B,4BAC9Ct4B,KAAKk2B,IAAIuB,gBAAkBx3B,EAAG63B,aAAa73B,EAAGs4B,mBAE1Cv4B,KAAKk3B,gBAAiB,CACtB,IAAM3jC,EAAI0M,EAAG63B,aACT93B,KAAKk3B,gBAAgBsB,uBAEnBnmC,EAAI4N,EAAG63B,aACT93B,KAAKk3B,gBAAgBuB,yBAEzBz4B,KAAKk2B,IAAIC,eAAiB5iC,GAAK,KAC/ByM,KAAKk2B,IAAII,iBAAmBjkC,GAAK,IACrC,CACJ,CAAE,MAAOF,GAGT,CACJ,GAEA,CAAAmM,IAAA,gBAAAvK,MACA,WACI,GAAKiM,KAAKi3B,UAAaj3B,KAAKC,KACxBD,KAAKiL,KAAK2sB,cAAd,CAGA53B,KAAKiL,KAAK2nB,YAGV,IAAMp2B,EAAIwD,KAAKi3B,SAASyB,iBACxB14B,KAAKi3B,SAAS0B,cAAc34B,KAAKi3B,SAAS2B,iBAAkBp8B,GAC5DwD,KAAKiL,KAAK2sB,cAAgBp7B,CARS,CASvC,GAAC,CAAA8B,IAAA,cAAAvK,MAED,WACSiM,KAAKi3B,UAAaj3B,KAAKC,IACvBD,KAAKiL,KAAK2sB,gBAEf53B,KAAKi3B,SAAS4B,YAAY74B,KAAKi3B,SAAS2B,kBACxC54B,KAAKiL,KAAK4sB,eAAe/hC,KAAKkK,KAAKiL,KAAK2sB,eACxC53B,KAAKiL,KAAK2sB,cAAgB,KAC9B,GAAC,CAAAt5B,IAAA,gBAAAvK,MAED,WACI,GAAKiM,KAAKi3B,UAAaj3B,KAAKC,GAA5B,CAGA,IAAM64B,EAAW94B,KAAKC,GAAG63B,aAAa93B,KAAKi3B,SAAS8B,kBAGpD,GAFA/4B,KAAKiL,KAAK0sB,cAAgBmB,EAEc,IAApC94B,KAAKiL,KAAK4sB,eAAernC,OAA7B,CAGA,IAAMgM,EAAIwD,KAAKiL,KAAK4sB,eAAe,GAKnC,GAJkB73B,KAAKi3B,SAAS+B,kBAC5Bx8B,EACAwD,KAAKi3B,SAASgC,4BAElB,CAEA,IAAMC,EAAKl5B,KAAKi3B,SAAS+B,kBAAkBx8B,EAAGwD,KAAKi3B,SAASkC,kBAI5D,GAHAn5B,KAAKi3B,SAASmC,eAAe58B,GAC7BwD,KAAKiL,KAAK4sB,eAAewB,QAEpBr5B,KAAKiL,KAAK0sB,YAMX33B,KAAKiL,KAAKC,MAAQrR,QANM,CACxB,IAAMy/B,EAAKJ,EAAK,IAChBl5B,KAAKiL,KAAKC,MAAQouB,EAClBt5B,KAAKiL,KAAKE,cAAgBnL,KAAKuyB,OAAOvyB,KAAKiL,KAAKE,cAAemuB,EAAI,KACnEt5B,KAAKiL,KAAK2pB,gBAAkBjvB,YAAYC,KAC5C,CAXsB,CAR2B,CANX,CA6B1C,GAAC,CAAAtH,IAAA,SAAAvK,MAED,SAAOwlC,EAAM1jC,EAAMuK,GACf,OAAKnJ,OAAO8C,SAASlE,GAChBoB,OAAO8C,SAASw/B,GACdA,GAAQ1jC,EAAO0jC,GAAQn5B,EADKvK,EADA0jC,CAGvC,GAAC,CAAAj7B,IAAA,yBAAAvK,MAmPD,WACI,IAAMylC,EAAUx5B,KAAKwY,WAAW3U,uBAG1B41B,EAASloC,KAAKsN,MAAM,IACpB66B,EAAYnoC,KAAKsN,MAAM,mBAE7B,IAAK26B,EACD,MAAO,qHAGX,IAAMG,EAAa35B,KAAKwY,WAAW7U,iBAAmB,EAChDi2B,EAAc55B,KAAKwY,WAAW1U,oBAAsBlT,EACpDsa,EAAQlL,KAAKiL,KAAKE,cAIpB0uB,EAAQ,SACRC,EAAa,SAJG95B,KAAKwY,WAAWhV,mBAOhCq2B,EAAQ,SACRC,EAAa,WACN7iC,OAAO8C,SAASmR,KACnBA,Eb1Y+B,Ia0YYyuB,EAAaC,GACxDC,EAAQ,WACRC,EAAa,YACN5uB,EAAQva,GAAkCgpC,EAAa,IAC9DE,EAAQ,YACRC,EAAa,WAKrB,IAAMC,EAAa,IAAMxoC,KAAKsN,MAAM,IAAM86B,EAAapoC,KAAKmN,IAAIk7B,IAC1DI,EAAeL,EAAa,EAAKI,EAAa,GAAK,UAAY,WAAeJ,EAAa,EAAI,SAAW,UAC1GnuB,EAAWja,KAAKmN,IAAIk7B,GAE1B,MAAO,uDAAPlpC,OAA8DspC,EAAY,MAAAtpC,OAAKipC,EAAa,EAAI,IAAM,IAAEjpC,OAAGipC,EAAU,mCAAAjpC,OAAkCkpC,EAAW,OAAAlpC,OAAM8a,EAAQ,oCAAA9a,OAAmCqpC,EAAU,2BAAArpC,OAA0BopC,EAAU,OAAAppC,OAAMmpC,EAAK,oCAAAnpC,OAAmC+oC,EAAM,UAAA/oC,OAASgpC,EAAS,eAC3U,GAEA,CAAAp7B,IAAA,iBAAAvK,MAKA,SAAeugC,GACX,OAAKr9B,OAAO8C,SAASu6B,GAIT3uB,YAAYC,MACH5F,KAAKiL,KAAK2pB,gBACN,IAGd,yBAAPlkC,OAAgC4jC,EAAUl9B,QAAQ,GAAE,qBAGjD,GAAP1G,OAAU4jC,EAAUl9B,QAAQ,GAAE,MAXnB,KAYf,I,8FAAC,CAzfkB,G,ogCEyFhB,SAAS6iC,GAAiCpjC,EAAIC,EAAIojC,GAA0C,IAAxBC,EAAgB5pC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,IACpF6pC,EA5FH,SAAgCvjC,EAAIC,GAevC,IAf2D,IAAhBujC,EAAO9pC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,IACjDk6B,EAAK,EAAGC,EAAK,EAEb4P,EAAM,EAAGC,EAAM,EAGbC,EAAe,GAIjBC,GAAU,EACVC,EAAaL,EACbM,EAAW,EACXC,EAAgB,EAEXjoC,EAAI,EAAGA,EAAI0nC,EAAS1nC,IAAK,CAE9B,IACMkoC,EAAS,GAAKpQ,EAAK8P,EAAM7P,EAAK4P,GACpCA,EAFe,GAAK7P,EAAK6P,EAAM5P,EAAK6P,GAAO,EAG3CA,EAAMM,EAGN,IACMC,EAAQ,EAAIrQ,EAAKC,EAAK5zB,EAItBikC,GAHNtQ,EAFcA,EAAKA,EAAKC,EAAKA,EAAK7zB,GAKhB4zB,GAFlBC,EAAKoQ,GAEuBpQ,EAG5B,GAAI/3B,GAxBmB,IAwBQA,EAAI,IAAO,EAAG,CACzC,IAAK,IAAI04B,EAAI,EAAGA,EAAImP,EAAahqC,OAAQ66B,IAAK,CAC1C,IAAA2P,EAAArlC,GAAqB6kC,EAAanP,GAAE,GAA7B4P,EAAED,EAAA,GAAEE,EAAEF,EAAA,GAAEngC,EAAEmgC,EAAA,GACXt2B,EAAK+lB,EAAKwQ,EAAIt2B,EAAK+lB,EAAKwQ,EAC9B,GAAIx2B,EAAKA,EAAKC,EAAKA,EA3BN,MA2B6B,CAEtC,IAAMw2B,EAASxoC,EAAIkI,EAMnB,MAAO,CAAE4/B,SAAS,EAAO/2B,WAAY22B,EAASzf,SAAU,EAAGugB,OAAAA,EAAQC,gBAD3C7pC,KAAKmL,IAAI,IAAMnL,KAAKoL,IAAI,IAAK,IAAMpL,KAAKC,IAAI2pC,EAAQ,MAEhF,CACJ,CACAX,EAAa1kC,KAAK,CAAC20B,EAAIC,EAAI/3B,IACvB6nC,EAAahqC,OAAS,KAAKgqC,EAAanB,OAChD,CAEA,GAAI0B,EAAO,IAAK,CACZN,GAAU,EACVC,EAAa/nC,EACbgoC,EAAWppC,KAAKspB,KAAKkgB,GACrBH,EAAgBrpC,KAAKspB,KAAKyf,EAAMA,EAAMC,EAAMA,GAC5C,KACJ,CACJ,CAEA,GAAIE,GAAWG,EAAgB,EAAG,CAE9B,IAAMhgB,EAAY+f,EAAWppC,KAAKnB,IAAIuqC,GAAaC,EAK7CS,EAAW9pC,KAAKC,IAAI,IAAKkpC,EAAa,KAGtCY,EAAW/pC,KAAKC,IAAIopB,EAAU,IAKpC,MAAO,CAAE6f,SAAS,EAAM/2B,WAAYg3B,EAAY9f,SAAAA,EAAUugB,OAAQ,EAAGC,gBAF7C7pC,KAAKmL,IAAI,KAAMnL,KAAKoL,IAAI,EAAKpL,KAAKoL,IAAI0+B,EAAUC,KAG5E,CAGA,MAAO,CAAEb,SAAS,EAAO/2B,WAAY22B,EAASzf,SAAU,EAAGugB,OAAQ,EAAGC,gBAAiB,GAC3F,CAaqBG,CAAuB1kC,EAAIC,EAAI,KAI1C0kC,EAAkBrB,EAAmB5oC,KAAKmL,IAAIw9B,EAAkB,MAIlEuB,EAAYrB,EAASgB,gBAQzB,OAPII,EAAkB,IAGlBC,EAAYrB,EAASgB,gBAAkB7pC,KAAKspB,KAAK2gB,IAI9CjqC,KAAKmL,IAAI,KAAMnL,KAAKoL,IAAI,EAAK8+B,GACxC,C,6pBD7HA,IAAAtpC,EAAAC,EAAAC,EAAA,mBAAAC,OAAAA,OAAA,GAAAC,EAAAF,EAAAG,UAAA,aAAAC,EAAAJ,EAAAK,aAAA,yBAAAC,EAAAN,EAAAE,EAAAE,EAAAE,GAAA,IAAAC,EAAAL,GAAAA,EAAAM,qBAAAC,EAAAP,EAAAO,EAAAC,EAAAC,OAAAC,OAAAL,EAAAC,WAAA,OAAAK,GAAAH,EAAA,mBAAAV,EAAAE,EAAAE,GAAA,IAAAE,EAAAC,EAAAG,EAAAI,EAAA,EAAAC,EAAAX,GAAA,GAAAY,GAAA,EAAAC,EAAA,CAAAF,EAAA,EAAAb,EAAA,EAAAgB,EAAApB,EAAAqB,EAAAC,EAAAN,EAAAM,EAAAC,KAAAvB,EAAA,GAAAsB,EAAA,SAAArB,EAAAC,GAAA,OAAAM,EAAAP,EAAAQ,EAAA,EAAAG,EAAAZ,EAAAmB,EAAAf,EAAAF,EAAAmB,CAAA,YAAAC,EAAApB,EAAAE,GAAA,IAAAK,EAAAP,EAAAU,EAAAR,EAAAH,EAAA,GAAAiB,GAAAF,IAAAV,GAAAL,EAAAgB,EAAA5C,OAAA4B,IAAA,KAAAK,EAAAE,EAAAS,EAAAhB,GAAAqB,EAAAH,EAAAF,EAAAO,EAAAhB,EAAA,GAAAN,EAAA,GAAAI,EAAAkB,IAAApB,KAAAQ,EAAAJ,GAAAC,EAAAD,EAAA,OAAAC,EAAA,MAAAD,EAAA,GAAAA,EAAA,GAAAR,GAAAQ,EAAA,IAAAc,KAAAhB,EAAAJ,EAAA,GAAAoB,EAAAd,EAAA,KAAAC,EAAA,EAAAU,EAAAC,EAAAhB,EAAAe,EAAAf,EAAAI,EAAA,IAAAc,EAAAE,IAAAlB,EAAAJ,EAAA,GAAAM,EAAA,GAAAJ,GAAAA,EAAAoB,KAAAhB,EAAA,GAAAN,EAAAM,EAAA,GAAAJ,EAAAe,EAAAf,EAAAoB,EAAAf,EAAA,OAAAH,GAAAJ,EAAA,SAAAmB,EAAA,MAAAH,GAAA,EAAAd,CAAA,iBAAAE,EAAAW,EAAAO,GAAA,GAAAR,EAAA,QAAAS,UAAA,oCAAAP,GAAA,IAAAD,GAAAK,EAAAL,EAAAO,GAAAf,EAAAQ,EAAAL,EAAAY,GAAAvB,EAAAQ,EAAA,EAAAT,EAAAY,KAAAM,GAAA,CAAAV,IAAAC,EAAAA,EAAA,GAAAA,EAAA,IAAAU,EAAAf,GAAA,GAAAkB,EAAAb,EAAAG,IAAAO,EAAAf,EAAAQ,EAAAO,EAAAC,EAAAR,GAAA,OAAAI,EAAA,EAAAR,EAAA,IAAAC,IAAAH,EAAA,QAAAL,EAAAO,EAAAF,GAAA,MAAAL,EAAAA,EAAAyB,KAAAlB,EAAAI,IAAA,MAAAa,UAAA,wCAAAxB,EAAA0B,KAAA,OAAA1B,EAAAW,EAAAX,EAAA2B,MAAAnB,EAAA,IAAAA,EAAA,YAAAA,IAAAR,EAAAO,EAAA,SAAAP,EAAAyB,KAAAlB,GAAAC,EAAA,IAAAG,EAAAa,UAAA,oCAAAnB,EAAA,YAAAG,EAAA,GAAAD,EAAAR,CAAA,UAAAC,GAAAiB,EAAAC,EAAAf,EAAA,GAAAQ,EAAAV,EAAAwB,KAAAtB,EAAAe,MAAAE,EAAA,YAAApB,GAAAO,EAAAR,EAAAS,EAAA,EAAAG,EAAAX,CAAA,SAAAe,EAAA,UAAAY,MAAA3B,EAAA0B,KAAAT,EAAA,GAAAhB,EAAAI,EAAAE,IAAA,GAAAI,CAAA,KAAAS,EAAA,YAAAV,IAAA,UAAAkB,IAAA,UAAAC,IAAA,CAAA7B,EAAAY,OAAAkB,eAAA,IAAAtB,EAAA,GAAAL,GAAAH,EAAAA,EAAA,GAAAG,QAAAW,GAAAd,EAAA,GAAAG,EAAA,yBAAAH,GAAAW,EAAAkB,EAAApB,UAAAC,EAAAD,UAAAG,OAAAC,OAAAL,GAAA,SAAAO,EAAAhB,GAAA,OAAAa,OAAAmB,eAAAnB,OAAAmB,eAAAhC,EAAA8B,IAAA9B,EAAAiC,UAAAH,EAAAf,GAAAf,EAAAM,EAAA,sBAAAN,EAAAU,UAAAG,OAAAC,OAAAF,GAAAZ,CAAA,QAAA6B,EAAAnB,UAAAoB,EAAAf,GAAAH,EAAA,cAAAkB,GAAAf,GAAAe,EAAA,cAAAD,GAAAA,EAAAK,YAAA,oBAAAnB,GAAAe,EAAAxB,EAAA,qBAAAS,GAAAH,GAAAG,GAAAH,EAAAN,EAAA,aAAAS,GAAAH,EAAAR,EAAA,yBAAAW,GAAAH,EAAA,oDAAAuB,GAAA,kBAAAC,EAAA5B,EAAA6B,EAAArB,EAAA,cAAAD,GAAAf,EAAAE,EAAAE,EAAAH,GAAA,IAAAO,EAAAK,OAAAyB,eAAA,IAAA9B,EAAA,gBAAAR,GAAAQ,EAAA,EAAAO,GAAA,SAAAf,EAAAE,EAAAE,EAAAH,GAAA,SAAAK,EAAAJ,EAAAE,GAAAW,GAAAf,EAAAE,EAAA,SAAAF,GAAA,YAAAuC,QAAArC,EAAAE,EAAAJ,EAAA,GAAAE,EAAAM,EAAAA,EAAAR,EAAAE,EAAA,CAAA0B,MAAAxB,EAAAoC,YAAAvC,EAAAwC,cAAAxC,EAAAyC,UAAAzC,IAAAD,EAAAE,GAAAE,GAAAE,EAAA,UAAAA,EAAA,WAAAA,EAAA,cAAAS,GAAAf,EAAAE,EAAAE,EAAAH,EAAA,UAAA8C,GAAA7C,GAAA,gBAAAA,GAAA,GAAA8C,MAAAC,QAAA/C,GAAA,OAAAgD,GAAAhD,EAAA,CAAAiD,CAAAjD,IAAA,SAAAA,GAAA,uBAAAC,QAAA,MAAAD,EAAAC,OAAAE,WAAA,MAAAH,EAAA,qBAAA8C,MAAAI,KAAAlD,EAAA,CAAAmD,CAAAnD,IAAAoD,GAAApD,IAAA,qBAAAuB,UAAA,wIAAA8B,EAAA,UAAAD,GAAApD,EAAAmB,GAAA,GAAAnB,EAAA,qBAAAA,EAAA,OAAAgD,GAAAhD,EAAAmB,GAAA,IAAApB,EAAA,GAAA6D,SAAApC,KAAAxB,GAAA6D,MAAA,uBAAA9D,GAAAC,EAAA8D,cAAA/D,EAAAC,EAAA8D,YAAAC,MAAA,QAAAhE,GAAA,QAAAA,EAAA+C,MAAAI,KAAAlD,GAAA,cAAAD,GAAA,2CAAAiE,KAAAjE,GAAAiD,GAAAhD,EAAAmB,QAAA,YAAA6B,GAAAhD,EAAAmB,IAAA,MAAAA,GAAAA,EAAAnB,EAAA7B,UAAAgD,EAAAnB,EAAA7B,QAAA,QAAA2B,EAAA,EAAAI,EAAA4C,MAAA3B,GAAArB,EAAAqB,EAAArB,IAAAI,EAAAJ,GAAAE,EAAAF,GAAA,OAAAI,CAAA,UAAAuC,GAAAvC,EAAAH,EAAAD,EAAAE,EAAAI,EAAAe,EAAAZ,GAAA,QAAAD,EAAAJ,EAAAiB,GAAAZ,GAAAG,EAAAJ,EAAAoB,KAAA,OAAAxB,GAAA,YAAAJ,EAAAI,EAAA,CAAAI,EAAAmB,KAAA1B,EAAAW,GAAAgC,QAAAC,QAAAjC,GAAAkC,KAAA5C,EAAAI,EAAA,UAAAuO,GAAAzO,GAAA,sBAAAH,EAAA,KAAAD,EAAA5B,UAAA,WAAAwE,QAAA,SAAA1C,EAAAI,GAAA,IAAAe,EAAAjB,EAAAqM,MAAAxM,EAAAD,GAAA,SAAAkN,EAAA9M,GAAAuC,GAAAtB,EAAAnB,EAAAI,EAAA4M,EAAAC,EAAA,OAAA/M,EAAA,UAAA+M,EAAA/M,GAAAuC,GAAAtB,EAAAnB,EAAAI,EAAA4M,EAAAC,EAAA,QAAA/M,EAAA,CAAA8M,OAAA,MAwDA,IAqBIq8B,GAGAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GAEAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GAMAC,GACAC,GACOjzB,GAhEPkzB,GAAchtC,EAAaC,WAS3BywB,GAAc5vB,EACdmsC,GAAWlsC,EACXmsC,GAAUnsC,EAEVosC,GAAwB,KACxBC,IAAgB,EAEhBC,IAAgB,EAEhBC,IAAkB,EAClBC,IAAwB,EACxBC,GAAoB,EAsCpBC,GAAgB,GAChBC,GAAc,GACdC,GAAiB,GACjBC,GAAa,GAKbC,GAAiB,EACfC,GAA0B,IAE5BC,GAAmB,KAGVnI,GAAiB,WAAH,Ob2hBI1uB,Ea3hBoB81B,Gb4hBxC7qC,OAAO6rC,KAAKhuC,GAAciuC,KAAK,SAAAxgC,GAAG,OAAIzN,EAAayN,KAASyJ,CAAI,IAAK,UADzE,IAAwBA,Ca3hBgC,EAOxD,SAAeuf,GAAiBvoB,GAAA,OAAAggC,GAAAngC,MAAC,KAADrO,UAAA,CA2EvC,SAAAwuC,KAFC,OAEDA,GAAA/9B,GAAA1M,KAAAE,EA3EO,SAAAyf,EAAiCzd,GAAI,IAAAwoC,EAAAC,EAAAC,EAAAC,EAAA14B,EAAA0f,EAAAjS,EAAA3jB,UAAA,OAAA+D,KAAAC,EAAA,SAAA4f,GAAA,cAAAA,EAAA5hB,GAAA,OAC4B,GAD1BkU,EAAMyN,EAAA1jB,OAAA,QAAAC,IAAAyjB,EAAA,GAAAA,EAAA,GAAG,KAG/C1d,IAASqnC,GAAW,CAAA1pB,EAAA5hB,EAAA,QAED,GACfrC,IAAeD,EAAgB,CAAAkkB,EAAA5hB,EAAA,eAAA4hB,EAAA3gB,EAAA,UAGvC4rC,KAEA5mB,GAAW6mB,UAAUlZ,EAEb3vB,EAAI2d,EAAA5hB,EAAA4zB,IACHt1B,EAAaC,WAAU,EAAAq1B,IAIvBt1B,EAAaE,MAAK,EAAAo1B,IAIlBt1B,EAAaG,QAAO,iBAPE,OAAvBsuC,KAAuBnrB,EAAA3gB,EAAA,YAIL,OAAlB+rC,KAAkBprB,EAAA3gB,EAAA,YAIE,OAApBgsC,KAAoBrrB,EAAA3gB,EAAA,YAKD,OAAA2gB,EAAA3gB,EAAA,UAsBR,GAjBT,QAAVwrC,EAAAr0B,UAAU,IAAAq0B,GAAa,QAAbC,EAAVD,EAAYS,mBAAW,IAAAR,GAAvBA,EAAAprC,KAAAmrC,EAA0B,MAGhB,QAAVE,EAAAv0B,UAAU,IAAAu0B,GAAa,QAAbC,EAAVD,EAAYO,mBAAW,IAAAN,GAAvBA,EAAAtrC,KAAAqrC,EAA0B1mB,IAGtBvf,KACAooB,KACAxB,GAAkBrH,MAElB0P,KACAD,GAAYzP,IAEZoG,KACAlD,GAAkBlD,KAGtBA,GAAWD,SAEP9R,EAAQ,CAAF0N,EAAA5hB,EAAA,SAIyD,GAH/Dk+B,KACAiP,MAGI9iB,KAAe,CAAFzI,EAAA5hB,EAAA,eAAA4hB,EAAA5hB,EAAA,EACPimB,GAAWkX,sBAAsB,CACnC3sB,IAAK,CAAC,EAAG,GAAInQ,EAAG6T,EAAO7T,EAAG+D,KAAM8P,EAAO9P,KAAMC,SAAU,GACxD,KAAI,OAAAud,EAAA5hB,EAAA,sBAAA4hB,EAAA5hB,EAAA,EAEDimB,GAAWkX,sBAAsB,CACnC3sB,IAAK0D,EAAO1D,IAAKpM,KAAM8P,EAAO9P,KAAMC,SAAU,GAC/C,IAAK,IAAK,KAAI,OAGrBwoC,KACA7oC,EAAgBsnC,GAAarlB,GAAWzV,IAAI,GAAIyV,GAAWzV,IAAI,GAAIyV,GAAW7hB,KAAM6hB,GAAW5hB,SAAU4hB,GAAW5lB,EAAI4lB,GAAW5lB,EAAE,GAAK,KAAM4lB,GAAW5lB,EAAI4lB,GAAW5lB,EAAE,GAAK,KAAM2rB,MAAuB,QAI/L,eAAApK,EAAA3gB,EAAA,KAAAygB,EAAA,IACtB8qB,GAAAngC,MAAA,KAAArO,UAAA,CAOM,SAAes2B,GAAgC5W,GAAA,OAAA0vB,GAAA/gC,MAAC,KAADrO,UAAA,CAkCrD,SAAAovC,KAAA,OAAAA,GAAA3+B,GAAA1M,KAAAE,EAlCM,SAAAigB,EAAgDmrB,GAAU,IAAAC,EAAAhpC,EAAAC,EAAA2kC,EAAA,OAAAnnC,KAAAC,EAAA,SAAAogB,GAAA,cAAAA,EAAApiB,GAAA,OACsB,GAE/EqtC,IAAe/B,GAAW,CAAAlpB,EAAApiB,EAAA,QAEP,OAAAoiB,EAAAnhB,EAAA,aAInBosC,IAAe/uC,EAAaC,WAAU,CAAA6jB,EAAApiB,EAAA,QAOkE,OALxGstC,EAAAlqC,GACiB6iB,GAAW5lB,EAAC,GAAtBiE,EAAEgpC,EAAA,GAAE/oC,EAAE+oC,EAAA,GAEPpE,EAAYxB,GAAiCpjC,EAAIC,EAAI0hB,GAAW7hB,KAD7C,KAG+Ege,EAAApiB,EAAA,EAElG+0B,GAAkBz2B,EAAaC,WAAY,CAC7CiS,IAAKyV,GAAW5lB,EAAEsD,QAClBS,KAAM8kC,EACN7kC,SAAU,IACZ,OAAA+d,EAAApiB,EAAA,eAK0B,OAAAoiB,EAAApiB,EAAA,EAEtB+0B,GAAkBz2B,EAAaE,MAAO,CACxCgS,IAAK,CAAC,EAAG,GAAInQ,EAAG4lB,GAAWzV,IAAI7M,QAASS,KAHnB,IAG2CC,SAAU,IAC5E,OAEa,cAAA+d,EAAAnhB,EAAA,KAAAihB,EAAA,KACtB7V,MAAA,KAAArO,UAAA,CAEM,IAAMqsB,GAAc,WAAH,OAASihB,KAAgBhtC,EAAaE,KAAK,EAM5D,SAASuuC,KACZxD,GAAY9uB,UAAUC,OAAO,UAC7B4uB,GAAiB7uB,UAAUmC,IAAI,UAE/B5P,GAAsBg/B,IACtBf,GAAc5lB,MAAMS,QAAU,OF5J1B2X,IAAcC,IAAcF,KAC5BC,GAAW7pB,oBAAoB,QAASmqB,IACxCL,GAAW9pB,oBAAoB,QAASoqB,IAExCR,GAAgBnY,MAAMS,QAAU,QP+FpCD,KAEId,KACAA,GAAgB+nB,UAChB/nB,GAAkB,MS0DtBkB,GAAW6mB,UACX7mB,GAAa,IAAI2P,GAAmBroB,IACpC+9B,GAAchtC,EAAaC,WAG3ByO,GAAsB++B,IACI,IAAtBD,IAAyByB,KAC7BC,KAGAC,KAEAlZ,GAAiBh1B,GAEjBi1B,KAEAlvB,OAAOM,SAASF,KAAO,EAC3B,CAEO,SAASsnC,KACZ/mB,GAAW6mB,UACX7mB,GAAa,IAAIyJ,GAAcniB,IAC/B+9B,GAAchtC,EAAaE,MAE3B+qC,GAAY9uB,UAAUmC,IAAI,UAC1B0sB,GAAiB7uB,UAAUC,OAAO,UAGlC1N,GAAsB++B,IACtByB,KAEA1P,GAAiB7X,IACjB0Y,KAEA3xB,GAAsBg/B,IACtB0B,KAGAD,KAE0B,IAAtB3B,IAAyByB,KAE7BhZ,GAAiB/0B,GAEjB4pC,GAAO/jB,MAAMsoB,WAAa,wBAC1BvC,GAAU/lB,MAAMsoB,WAAa,wBAE7BnZ,KAEAlvB,OAAOM,SAASF,KAAO,QAC3B,CAEO,SAASunC,MACZhnB,GAAa,IAAImX,GAAgB7vB,KACtB0nB,sBAAuB,EAClCqW,GAAchtC,EAAaG,QAE3BuO,GAAsB++B,IAEtBzmC,OAAOM,SAASF,KAAO,OAC3B,CAEO,SAAS8uB,KACZ,GAAK0W,GAAL,CAEA,IAAM0C,EAAW3nB,GAAWvJ,UAAY,GAClCmxB,EAAe5nB,GAAWpJ,oBAC1BixB,EAAY7nB,GAAW9L,qBAG7B,GAAIyzB,EAAS3vC,OAAS,GAAK4vC,GAAgB,EAAG,CAC1C,IAAME,EAAiBH,EAASC,GAChC3C,GAAc8C,MAAQ,aAAH7vC,OAAgB4vC,EAAetwB,GAAE,iBACxD,MACIytB,GAAc8C,MAAQ,2BAI1B/B,GAAe/+B,QAAQ,SAACC,EAAK8gC,GACzB,GAAiB,IAAbA,EAEA9gC,EAAIsN,UAAU6jB,OAAO,SAAUwP,QAC5B,GAAIG,GAAY,EAAG,CAEtB,IAAM5wB,EAAe4wB,EAAW,EAChC9gC,EAAIsN,UAAU6jB,OAAO,SAAUuP,IAAiBxwB,EACpD,CACJ,EAxB0B,CAyB9B,CAMO,SAAS2O,KAAsB,IAAAkiB,EAAAC,EAC5BP,GAAqB,QAAVM,EAAAjoB,UAAU,IAAAioB,OAAA,EAAVA,EAAYxxB,WAAY,GACnCmxB,EAAyB,QAAbM,EAAGloB,UAAU,IAAAkoB,OAAA,EAAVA,EAAYtxB,oBACjC,OAAI+wB,EAAS3vC,OAAS,GAAK4vC,GAAgB,GAAKA,EAAeD,EAAS3vC,OAC7D2vC,EAASC,GAAcpwB,GAE3B,IACX,CAMO,SAAS8W,GAAiBzvB,GAC7BA,IAAAA,EAAOnC,GAASsjB,GAAWzU,eAE3B,IAAM48B,EAAgB,SAAC5sC,GAAK,IAAE6sC,EAAgBrwC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,IAAG,OAAKgB,KAAKoL,IAAI,IAAKpL,KAAKiW,MAAc,IAARzT,EAAc6sC,GAAkB,EAElHrf,GAAc,QAAH7wB,OAAWiwC,EAActpC,EAAQ,IAAG,MAAA3G,OAAKiwC,EAActpC,EAAQ,IAAG,MAAA3G,OAAKiwC,EAActpC,EAAQ,IAAG,QAC3GymC,GAAW,QAAHptC,OAAWiwC,EAActpC,EAAQ,GAAI,IAAG,MAAA3G,OAAKiwC,EAActpC,EAAQ,GAAI,IAAG,MAAA3G,OAAKiwC,EAActpC,EAAQ,GAAI,IAAG,UACpH0mC,GAAU,QAAHrtC,OAAWa,KAAKiW,MAAmB,IAAbnQ,EAAQ,IAAS,MAAA3G,OAAKa,KAAKiW,MAAmB,IAAbnQ,EAAQ,IAAS,MAAA3G,OAAKa,KAAKiW,MAAmB,IAAbnQ,EAAQ,IAAS,UAEhH,IAAIwpC,EAAO/zB,SAASg0B,cAAc,SAClCD,EAAKjpB,MAAMmpB,YAAY,aAAchD,IACrC8C,EAAKjpB,MAAMmpB,YAAY,cAAejD,IACtC+C,EAAKjpB,MAAMmpB,YAAY,iBAAkBxf,IT5NtC,SAA6BlqB,GAChC,GAAKA,KAAWA,EAAQ7G,OAAS,GAAjC,CAIA,IAAMqmB,EAAa,IAAI1N,aAAa,CAChC,EAAG,EAAG,EACN9R,EAAQ,GAAIA,EAAQ,GAAIA,EAAQ,GAChC,EAAG,EAAG,EACO,IAAbA,EAAQ,GAAuB,IAAbA,EAAQ,GAAuB,IAAbA,EAAQ,GAC5C,GAAK,GAAK,KAGVigB,GAEAA,GAAgBmV,8BAA8B5V,GAAY5hB,OAG1DuiB,GAAoBX,CAjBkB,CAmB9C,CS0MImqB,CAAoB3pC,EACxB,CAGO,SAAS4kB,KACZwU,KACAqP,KACAhnC,GACJ,CAOO,SAASkN,KAA0B,IAAAi7B,EAAAC,EAAAC,EAAfC,EAAK7wC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,IAAAA,UAAA,GACtBqV,EAAMD,YAAYC,MAClBy7B,EAAsBz7B,EAAM84B,GAGlC,GAAI2C,EAAsB1C,IAEtB,GAAIyC,IAAUxC,GAAkB,CAC5B,IAAM0C,EAAQ/vC,KAAKmL,IAAIiiC,GAA0B0C,EAAqB,GAEtEzC,GAAmBx/B,WAAW,WAC1Bw/B,GAAmB,KACnB54B,IAAW,EACf,EAAGs7B,EACP,OAMJ,GAFA5C,GAAiB94B,EAEZ9F,IAAW0Y,GAAhB,CAIA,IAAI+oB,EAAQpD,GAAkB,mCAAH,GAErBqD,EAAkC,QAA9BP,EAAGzlC,EAAQgd,GAAWxV,MAAM7R,UAAE,IAAA8vC,EAAAA,EAAI,EACtCQ,EAAkC,QAA9BP,EAAG1lC,EAAQgd,GAAWxV,MAAM3P,UAAE,IAAA6tC,EAAAA,EAAI,EAE5CK,GAAQ,YAAJ7wC,OAAgB8wC,EAAKpqC,QAAQ,GAAE,MAAA1G,OAAK+wC,EAAKrqC,QAAQ,GAAE,4CAEvD,IAcOsqC,EAdDC,EAA6B,QAAlBR,EAAG3oB,GAAW7hB,YAAI,IAAAwqC,EAAAA,EAAI,EACjCS,EAAyC,IAAtBppB,GAAW5hB,SAAiB1E,EAAM,IAI3D,GAFAqvC,GAAQ,WAAJ7wC,QADuBkxC,EAAkB,EAAIA,EAAkB,IAAMA,GACnCxqC,QAAQ,GAAE,sDAAA1G,OAAqDixC,EAAY3f,cAAc,IAE3H6b,KAAgBhtC,EAAaE,MAAO,KAAA8wC,EAAAC,EAC9BjrC,EAAoB,QAAlBgrC,EAAGrpB,GAAW5lB,EAAE,UAAE,IAAAivC,EAAAA,EAAI,EACxB/qC,EAAoB,QAAlBgrC,EAAGtpB,GAAW5lB,EAAE,UAAE,IAAAkvC,EAAAA,EAAI,EAE9BP,GAAQ,iBAAJ7wC,OAAqBmG,EAAGO,QAAQ,GAAE,MAAA1G,OAAKoG,EAAGM,QAAQ,GAAE,KAC5D,CAEA,GAAI+mC,GACIP,KAAaA,GAAS5wB,UAAUkC,SAAS,oBAAoB0uB,GAAS5wB,UAAUmC,IAAI,wBAE5E,QAAZuyB,EAAI9D,UAAQ,IAAA8D,GAARA,EAAU10B,UAAUkC,SAAS,oBAAoB0uB,GAAS5wB,UAAUC,OAAO,mBAG/E2wB,GAASpH,YAAc+K,IAAM3D,GAASpH,UAAY+K,EA3BtD,CA4BJ,CAGO,IAAM/a,GAAoB,WAAH,OAAS2X,EAAe,EAK/C,SAASnX,KAAgC,IAAA+a,EACtCl1B,EAAWC,SAASC,eAAe,iBACzC,GAAKF,EAAL,CAEA,IAAMm1B,GAA2B,QAAVD,EAAAvpB,UAAU,IAAAupB,OAAA,EAAVA,EAAYr1B,wBAAwB,EACrDu1B,EAAWp1B,EAASG,UAAUkC,SAAS,UAEzC8yB,IAAmBC,EACnBp1B,EAASG,UAAUmC,IAAI,WACf6yB,GAAkBC,GAC1Bp1B,EAASG,UAAUC,OAAO,SART,CAUzB,CAGA,SAASmyB,KAAoB,IAAA8C,EAAAC,EAGpBhE,KAKLA,IAAkB,EACV,QAAR+D,EAAAtE,UAAQ,IAAAsE,GAARA,EAAUl1B,UAAUC,OAAO,aAEjB,QAAVk1B,EAAA3pB,UAAU,IAAA2pB,GAAVA,EAAYl8B,4BAGRk2B,KACAA,GAAWlL,UA7ac,OA8azBkL,GAAWnvB,UAAUC,OAAO,WAG5BmwB,KAAeA,GAAcgF,UAAW,GACxC9E,KAAaA,GAAY8E,UAAW,GAEpCnpC,IACA6mB,KAEAlE,KAGAgB,OFtVJqT,GAAWmS,SAAWpS,GAAWoS,UAAW,EAC5CpS,GAAWhjB,UAAUC,OAAO,iBAC5BgjB,GAAWjjB,UAAUC,OAAO,kBEwV5B7N,WAAW,WACP4G,IACJ,EAAG,KAGP,CAGA,SAAS05B,KAAoB,IAAA2C,EAGrBlE,KAKJA,IAAkB,EACV,QAARkE,EAAAzE,UAAQ,IAAAyE,GAARA,EAAUr1B,UAAUmC,IAAI,aAGpBgtB,KACAA,GAAWlL,UAldW,OAmdtBkL,GAAWnvB,UAAUmC,IAAI,WAG7BmzB,KACIlF,KAAeA,GAAcgF,UAAW,GAC5CG,KACIjF,KAAaA,GAAY8E,UAAW,GAGpCnpC,IACAooB,KAEAzC,KAGAhC,OFtYJqT,GAAWmS,SAAWpS,GAAWoS,UAAW,EAC5CpS,GAAWhjB,UAAUmC,IAAI,iBACzB8gB,GAAWjjB,UAAUmC,IAAI,kBEwYzBrW,IAGJ,CAMO,SAAeyuB,KAAU,OAAAib,GAAA5jC,MAAC,KAADrO,UAAA,CAqChC,SAAAiyC,KAFC,OAEDA,GAAAxhC,GAAA1M,KAAAE,EArCO,SAAAwgB,IAAA,IAAAytB,EAAA,OAAAnuC,KAAAC,EAAA,SAAA2gB,GAAA,cAAAA,EAAA3iB,GAAA,OAC0D,IAEzD4rC,GAAiB,CAAFjpB,EAAA3iB,EAAA,QAKI,OAJnBk+B,KACA2N,IAAwB,EACxB5lB,GAAWkqB,WACXtD,KACmBlqB,EAAA1hB,EAAA,UAIvBi9B,KACAiP,KAGIlnB,GAAW9L,uBACX8L,GAAWtS,6BACX8gB,MACHyb,EAEO5E,GAAW3oB,EAAA3iB,EAAAkwC,IAEV5xC,EAAaC,WAAU,EAAA2xC,IAEvB5xC,EAAaE,MAAK,wBAAAmkB,EAAA3iB,EAAA,EAFaowC,KAAqB,OAEV,cAAAztB,EAAA1hB,EAAA,KAFU,cAAA0hB,EAAA3iB,EAAA,EAE1BqwC,KAAgB,OAIvB,OAApBxD,KAAoBlqB,EAAA1hB,EAAA,YAKT,cAAA0hB,EAAA1hB,EAAA,KAAAwhB,EAAA,KACtBpW,MAAA,KAAArO,UAAA,UAGcoyC,KAAmB,OAAAE,GAAAjkC,MAAC,KAADrO,UAAA,CASlC,SAAAsyC,KAFC,OAEDA,GAAA7hC,GAAA1M,KAAAE,EATA,SAAA+gB,IAAA,OAAAjhB,KAAAC,EAAA,SAAAkhB,GAAA,cAAAA,EAAAljB,GAAA,OAC0E,OAAAkjB,EAAAljB,EAAA,EAEhEimB,GAAWsqB,aAAY,EAAMhc,GAAkBC,GAA4Bgc,MAAiB,OAG/E,cAAAttB,EAAAjiB,EAAA,KAAA+hB,EAAA,KACtB3W,MAAA,KAAArO,UAAA,CAQM,SAAeu3B,GAAc5X,EAAAa,GAAA,OAAAiyB,GAAApkC,MAAC,KAADrO,UAAA,CAoEpC,SAAAyyC,KAFC,OAEDA,GAAAhiC,GAAA1M,KAAAE,EApEO,SAAAshB,EAA8BmtB,EAAOv8B,GAAK,IAAAw8B,EAAAC,EAAA,OAAA7uC,KAAAC,EAAA,SAAA4hB,GAAA,cAAAA,EAAA5jB,GAAA,WACzC4rC,IAAmBz3B,IAAU03B,GAAoB,CAAAjoB,EAAA5jB,EAAA,QAC6E,OAAA4jB,EAAA3iB,EAAA,UAoBlI,GAhBI2qC,IACAiB,KAGJ3O,KACA2N,GAAuB13B,EACL,QAAlBw8B,EAAA3E,GAAY73B,UAAM,IAAAw8B,GAAlBA,EAAoBl2B,UAAUmC,IAAI,WAE5Bg0B,EAAOF,EAAMv8B,IAGV3P,YACLyhB,GAAWtS,6BACX8gB,QAIAmc,EAAKC,YAAc,GAAKD,EAAKE,KAAK,IAAMF,EAAKG,OAAO,IAAE,CAAAntB,EAAA5jB,EAAA,QAC2B,OAAA4jB,EAAA3iB,EAAA,eAE1E2vC,EAAKC,YAAc,GAAKD,EAAKE,KAAK,IAAMF,EAAKG,OAAO,IAAE,CAAAntB,EAAA5jB,EAAA,QACqB,OAAA4jB,EAAA3iB,EAAA,eAGlF2vC,EAAKI,YAAc,GAAKJ,EAAKE,KAAK,IAAMF,EAAKG,OAAO,IAAE,CAAAntB,EAAA5jB,EAAA,QAC2B,OAAA4jB,EAAA3iB,EAAA,eAE1E2vC,EAAKI,YAAc,GAAKJ,EAAKE,KAAK,IAAMF,EAAKG,OAAO,IAAE,CAAAntB,EAAA5jB,EAAA,QACqB,OAAA4jB,EAAA3iB,EAAA,UAkBtF,OAdAksC,KAKiB5hC,EAAqB,IAAK0a,GAAY,CAAC5lB,EAAGuwC,EAAKG,OAAQvgC,IAAKogC,EAAKpgC,IAAKpM,KAAMwsC,EAAKxsC,MAC9F,CAACoM,IAAK,GAAKpM,KAAM,EAAG/D,EAAG,IAQ3BujB,EAAA5jB,EAAA,EACMwC,QAAQqf,IAAI,CACdoE,GAAWgrB,kBAAkBhrB,GAAW/V,aAAc0gC,EAAKG,OAAQ,MACnE9qB,GAAWwW,6BAA6BmU,EAAM,KAAMrc,MACtD,OAKF,OAFAC,KAEA5Q,EAAA5jB,EAAA,EACMwC,QAAQqf,IAAI,CACdoE,GAAWirB,YAAYN,GACvB3qB,GAAWkrB,yBAAyBP,EAAKpgC,IAAKogC,EAAKxsC,KAAMwsC,EAAKvsC,SAAU,QAC1E,cAAAuf,EAAA3iB,EAAA,KAAAsiB,EAAA,KACLlX,MAAA,KAAArO,UAAA,UAGcqyC,KAAc,OAAAe,GAAA/kC,MAAC,KAADrO,UAAA,CAU7B,SAAAozC,KAFC,OAEDA,GAAA3iC,GAAA1M,KAAAE,EAVA,SAAAovC,IAAA,OAAAtvC,KAAAC,EAAA,SAAAsvC,GAAA,cAAAA,EAAAtxC,GAAA,OACqE,OAAAsxC,EAAAtxC,EAAA,EAE3DimB,GAAWsqB,aAAY,EAAOhc,GAAkBC,GAA4Bgc,MAAiB,OAIhF,cAAAc,EAAArwC,EAAA,KAAAowC,EAAA,KACtBhlC,MAAA,KAAArO,UAAA,CAQM,SAAew3B,GAAcvW,EAAAa,GAAA,OAAAyxB,GAAAllC,MAAC,KAADrO,UAAA,CAsCpC,SAAAuzC,KAFC,OAEDA,GAAA9iC,GAAA1M,KAAAE,EAtCO,SAAAuvC,EAA8BC,EAASt9B,GAAK,IAAAu9B,EAAA,OAAA3vC,KAAAC,EAAA,SAAA2vC,GAAA,cAAAA,EAAA3xC,GAAA,OAI9C,GAHG4rC,IAEAiB,KAGA14B,IAAU23B,GAAiB,CAAA6F,EAAA3xC,EAAA,QAC4F,OAAA2xC,EAAA1wC,EAAA,UAS7E,GAH9Ci9B,KACAiP,KAEoB,QAApBuE,EAAA3F,GAAc53B,UAAM,IAAAu9B,GAApBA,EAAsBj3B,UAAUmC,IAAI,WAEhCyN,KAAe,CAAFsnB,EAAA3xC,EAAA,QACW,OAAxBimB,GAAWzB,SAAW,EAAEmtB,EAAA3xC,EAAA,EAClBimB,GAAWkX,sBAAsBsU,EAAQt9B,GAAQ,KAAMogB,IAAiB,OAAAod,EAAA3xC,EAAA,sBAAA2xC,EAAA3xC,EAAA,EAGxEimB,GAAWkX,sBAAsBsU,EAAQt9B,GAAQ,IAAM,IAAK,KAAMogB,IAAiB,OAI7FE,KAEAqX,GAAoB33B,EAGpBqgB,KAEAqY,KACA7oC,EAAgBsnC,GAAarlB,GAAWzV,IAAI,GAAIyV,GAAWzV,IAAI,GAAIyV,GAAW7hB,KAAM6hB,GAAW5hB,SAAU4hB,GAAW5lB,EAAI4lB,GAAW5lB,EAAE,GAAK,KAAM4lB,GAAW5lB,EAAI4lB,GAAW5lB,EAAE,GAAK,KAAM2rB,MAAuB,cAAA2lB,EAAA1wC,EAAA,KAAAuwC,EAAA,KACjNnlC,MAAA,KAAArO,UAAA,CAGM,SAASq2B,KACRjc,GACAA,GAAWkmB,UAEXlmB,GAAa,IAAIwmB,GAAWrxB,GAAQ0Y,GAAY+I,IAChDmF,KAER,CAGO,SAASA,KACZ,IAAMyd,EAAer3B,SAASC,eAAe,gBACvCq3B,EAAiBt3B,SAASC,eAAe,kBAEZ,UAA/Bo3B,EAAavsB,MAAMS,SAAwD,UAAjC+rB,EAAexsB,MAAMS,SAC/D8rB,EAAavsB,MAAMS,QAAU,OAC7B+rB,EAAexsB,MAAMS,QAAU,SAE/B8rB,EAAavsB,MAAMS,QAAU,QAC7B+rB,EAAexsB,MAAMS,QAAU,QAEvC,CAEO,SAASoY,KAEZ6N,GAAc5tC,OAAO6tC,IAAa9+B,QAAQ,SAAAzE,GAAC,OAAIA,aAAC,EAADA,EAAGgS,UAAUC,OAAO,SAAS,EAChF,CAKO,SAAS6yB,KACZzB,IAAqB,CACzB,CAEO,SAAenX,KAAe,OAAAmd,GAAAzlC,MAAC,KAADrO,UAAA,CAiBpC,SAAA8zC,KAAA,OAAAA,GAAArjC,GAAA1M,KAAAE,EAjBM,SAAA8vC,IAAA,IAAAnE,EAAAoE,EAAA,OAAAjwC,KAAAC,EAAA,SAAAiwC,GAAA,cAAAA,EAAAjyC,GAAA,OACuC,GAClB,KADlB4tC,EAAW3nB,GAAWvJ,UAAY,IAC3Bze,OAAY,CAAAg0C,EAAAjyC,EAAA,eAAAiyC,EAAAhxC,EAAA,UAIzB,GAAwB,IAApB2sC,EAAS3vC,OACT+zC,EAAc,OAEd,GACIA,EAAchzC,KAAKiW,MAAMjW,KAAKo7B,SAAWwT,EAAS3vC,cAC7C+zC,IAAgB/rB,GAAWpJ,qBACvC,OAAAo1B,EAAAjyC,EAAA,EAEKimB,GAAW/I,oBAAoB80B,EAAa,IAAKzd,IAAiB,OACxEC,KACAC,KAAgC,cAAAwd,EAAAhxC,EAAA,KAAA8wC,EAAA,KACnC1lC,MAAA,KAAArO,UAAA,CAEM,SAAS62B,KACZ9F,GAAexhB,GAAQ0Y,GAAY+I,GACvC,CAMO,SAASsG,KAA0B,IAAb4c,EAAIl0C,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,KAC5BorC,EAAS7uB,SAASC,eAAe,mBAExB,OAAT03B,IAAeA,GAAQvG,IAEvBuG,EACA9I,EAAO3uB,UAAUC,OAAO,aAExB0uB,EAAO3uB,UAAUmC,IAAI,aAGzB+uB,GAAgBuG,CACpB,CAEO,SAAelsB,KAAK,OAAAmsB,GAAA9lC,MAAC,KAADrO,UAAA,CAwB3B,SAAAm0C,KAJC,OAIDA,GAAA1jC,GAAA1M,KAAAE,EAxBO,SAAAmwC,IAAA,OAAArwC,KAAAC,EAAA,SAAAqwC,GAAA,cAAAA,EAAAryC,GAAA,OAGHu0B,GAAiBlK,KAAgB7qB,EAA4BD,GAE7DstC,KAEA5mB,GAAWD,QAEPqE,KACAoU,KAEA1Y,KAEJ2D,KACA8K,KACAC,KACAsX,GAAc,GAAGtxB,UAAUmC,IAAI,UAEZ,cAAAy1B,EAAApxC,EAAA,KAAAmxC,EAAA,KACtB/lC,MAAA,KAAArO,UAAA,CAQD,SAASs0C,KACL,OAAOjoB,KA5wBoB,kBADK,sBA8wBpC,CAMO,SAASmmB,KACZ,IACI,IAAM+B,EAASC,aAAaC,QAAQH,MACpC,OAAOC,EAASptC,KAAKiB,MAAMmsC,GAAU,EACzC,CAAE,MAAO3yC,GAEL,MAAO,EACX,CACJ,CAMA,SAAS8yC,GAAgBjB,GACrB,IACIe,aAAaG,QAAQL,KAAqBntC,KAAKC,UAAUqsC,GAC7D,CAAE,MAAO7xC,GAET,CACJ,CAMA,SAASgzC,GAAwB/uC,GAC7B,IAAMi5B,EAAc0T,KAGdt8B,EAAS,CAEXuJ,GAAI5Z,EACJ2M,IAAK,CAACvH,EAAQgd,GAAWxV,MAAM7R,GAAIqK,EAAQgd,GAAWxV,MAAM3P,IAC5DsD,KAAM6hB,GAAW7hB,KACjBC,SAAU4hB,GAAW5hB,SACrBm4B,MAAO,IAIPnS,MAAiBpE,GAAW5lB,IAC5B6T,EAAO7T,EAACsC,GAAOsjB,GAAW5lB,IAI1B4lB,GAAWvJ,UAAYuJ,GAAWpJ,qBAAuB,GACzDoJ,GAAWpJ,oBAAsBoJ,GAAWvJ,SAASze,SACrDiW,EAAO1P,UAAYyhB,GAAWvJ,SAASuJ,GAAWpJ,qBAAqBY,IAG3Eqf,EAAYv5B,KAAK2Q,GACjBw+B,GAAgB5V,GAGhB9vB,GAAsB++B,IACtByB,KAEA3vC,EAAI,sBAADM,OAAuB0F,GAAQ,0BACtC,CAMA,SAASgvC,GAAiBC,GACtB,IAAIhW,EAAc0T,KAElBkC,GADA5V,EAAcA,EAAYiW,OAAO,SAAAlyC,GAAC,OAAIA,EAAE4c,KAAOq1B,CAAQ,IAIvD9lC,GAAsB++B,IACtByB,KAEA3vC,EAAI,wBAADM,OAAyB20C,GAAY,mBAC5C,CAKO,SAASle,KACPiV,KAELC,GAAkBtoC,MAAQ,GAC1BuoC,GAAmB8F,UAAW,EAC9BhG,GAAepvB,UAAUmC,IAAI,QAC7BktB,GAAkBkJ,QACtB,CAKA,SAASC,KACApJ,IACLA,GAAepvB,UAAUC,OAAO,OACpC,CAKA,SAASw4B,KACArJ,KAGLC,GAAkB37B,iBAAiB,QAAS,WACxC47B,GAAmB8F,UAAY/F,GAAkBtoC,MAAM2xC,MAC3D,GAEApJ,GAAmB57B,iBAAiB,QAAS,WACzC,IAAMtK,EAAOimC,GAAkBtoC,MAAM2xC,OACjCtvC,IACA+uC,GAAwB/uC,GACxBovC,KAER,GAEAjJ,GAAkB77B,iBAAiB,QAAS,WACxC8kC,IACJ,GAGApJ,GAAe17B,iBAAiB,QAAS,SAACvO,GAClCA,EAAE8L,SAAWm+B,IACboJ,IAER,GAGAnJ,GAAkB37B,iBAAiB,UAAW,SAACvO,GAE3C,GADAA,EAAE8rB,kBACY,UAAV9rB,EAAEmM,IAAiB,CACnB,IAAMlI,EAAOimC,GAAkBtoC,MAAM2xC,OACjCtvC,IACA+uC,GAAwB/uC,GACxBovC,KAER,KAAqB,WAAVrzC,EAAEmM,KACTknC,IAER,GAEAp1C,EAAI,eAAgB,sBACxB,CAKO,SAASu3B,KACZ,GAAK6U,GAAL,CAGIW,KACAA,GAAavlB,MAAMS,QAAUuE,KAAgB,WAAa,QAI9D,IAAMuW,EAAW33B,EAAQgd,GAAWxV,MAAM7R,GACpCiiC,EAAW53B,EAAQgd,GAAWxV,MAAM3P,GAE1CopC,GAAc1oC,MAAQo/B,EAAS/7B,QAAQ,GACvCslC,GAAc3oC,MAAQq/B,EAASh8B,QAAQ,GACvCulC,GAAc5oC,MAAQykB,GAAW7hB,KAAKqrB,cAAc,GACpD4a,GAAkB7oC,OAA+B,IAAtBykB,GAAW5hB,SAAiBrF,KAAKW,IAAIkF,QAAQ,GAEpEwlB,OACAigB,GAAY9oC,MAAQykB,GAAW5lB,EAAE,GAAGwE,QAAQ,GAC5C0lC,GAAY/oC,MAAQykB,GAAW5lB,EAAE,GAAGwE,QAAQ,IAIhD2lC,GAAchpC,MAAQ,GACtBipC,GAAgBjM,YAAc,GAG9B,CAAC0L,GAAeC,GAAeC,GAAeC,GAAmBC,GAAaC,GAAaC,IAAet9B,QAAQ,SAAAkmC,GAC1GA,GAAOA,EAAM34B,UAAUC,OAAO,UACtC,GAEAuvB,GAAiBxvB,UAAUmC,IAAI,QAC/BstB,GAAc8I,OA/Be,CAgCjC,CAKA,SAASK,KACApJ,IACLA,GAAiBxvB,UAAUC,OAAO,OACtC,CAOA,SAAS44B,KACL,IAAMC,EAAW/I,GAAchpC,MAAM2xC,OAGrC,GAAII,EACA,IACI,IAAMC,EAASruC,KAAKiB,MAAMmtC,GAG1B,IAAKC,EAAOhjC,MAAQ5N,MAAMC,QAAQ2wC,EAAOhjC,MAA8B,IAAtBgjC,EAAOhjC,IAAIvS,OACxD,MAAO,CAACw1C,MAAO,2CAEnB,GAA6B,iBAAlBD,EAAOhjC,IAAI,IAAmBkjC,MAAMF,EAAOhjC,IAAI,IACtD,MAAO,CAACijC,MAAO,wCAEnB,GAA6B,iBAAlBD,EAAOhjC,IAAI,IAAmBkjC,MAAMF,EAAOhjC,IAAI,IACtD,MAAO,CAACijC,MAAO,wCAEnB,GAA2B,iBAAhBD,EAAOpvC,MAAqBsvC,MAAMF,EAAOpvC,MAChD,MAAO,CAACqvC,MAAO,sCAEnB,GAAID,EAAOpvC,MAAQ,EACf,MAAO,CAACqvC,MAAO,gCAEnB,GAA+B,iBAApBD,EAAOnvC,UAAyBqvC,MAAMF,EAAOnvC,UACpD,MAAO,CAACovC,MAAO,uDAInB,GAAIppB,KAAe,CACf,IAAKmpB,EAAOnzC,IAAMuC,MAAMC,QAAQ2wC,EAAOnzC,IAA0B,IAApBmzC,EAAOnzC,EAAEpC,OAClD,MAAO,CAACw1C,MAAO,6DAEnB,GAA2B,iBAAhBD,EAAOnzC,EAAE,IAAmBqzC,MAAMF,EAAOnzC,EAAE,IAClD,MAAO,CAACozC,MAAO,sCAEnB,GAA2B,iBAAhBD,EAAOnzC,EAAE,IAAmBqzC,MAAMF,EAAOnzC,EAAE,IAClD,MAAO,CAACozC,MAAO,qCAEvB,CAGA,IAAME,EAAS,CACXnjC,IAAK,CAACgjC,EAAOhjC,IAAI,GAAIgjC,EAAOhjC,IAAI,IAChCpM,KAAMovC,EAAOpvC,KACbC,SAAUmvC,EAAOnvC,UAWrB,OAPImvC,EAAOnzC,GAAKuC,MAAMC,QAAQ2wC,EAAOnzC,IAA0B,IAApBmzC,EAAOnzC,EAAEpC,SAChD01C,EAAOtzC,EAAI,CAACmzC,EAAOnzC,EAAE,GAAImzC,EAAOnzC,EAAE,KAElCmzC,EAAOhvC,WAAagvC,EAAOhvC,UAAU2uC,SACrCQ,EAAOnvC,UAAYgvC,EAAOhvC,WAGvBmvC,CAEX,CAAE,MAAO/zC,GACL,MAAO,CAAC6zC,MAAO,iBAAFt1C,OAAmByB,EAAE9B,SACtC,CAIJ,IAAM81C,EAAU1J,GAAc1oC,MAAM2xC,OAC9BU,EAAU1J,GAAc3oC,MAAM2xC,OAC9BW,EAAU1J,GAAc5oC,MAAM2xC,OAC9BY,EAAc1J,GAAkB7oC,MAAM2xC,OAG5C,IAAKS,EAAS,MAAO,CAACH,MAAO,qBAC7B,IAAKI,EAAS,MAAO,CAACJ,MAAO,qBAC7B,IAAKK,EAAS,MAAO,CAACL,MAAO,oBAC7B,IAAKM,EAAa,MAAO,CAACN,MAAO,wBAEjC,IAAMxE,EAAO3oC,WAAWstC,GAClB1E,EAAO5oC,WAAWutC,GAClBzvC,EAAOkC,WAAWwtC,GAClBlR,EAAct8B,WAAWytC,GAG/B,GAAIL,MAAMzE,GAAO,MAAO,CAACwE,MAAO,UAAFt1C,OAAYy1C,EAAO,4BACjD,GAAIF,MAAMxE,GAAO,MAAO,CAACuE,MAAO,UAAFt1C,OAAY01C,EAAO,4BACjD,GAAIH,MAAMtvC,GAAO,MAAO,CAACqvC,MAAO,SAAFt1C,OAAW21C,EAAO,4BAChD,GAAI1vC,GAAQ,EAAG,MAAO,CAACqvC,MAAO,kCAC9B,GAAIC,MAAM9Q,GAAc,MAAO,CAAC6Q,MAAO,aAAFt1C,OAAe41C,EAAW,4BAE/D,IAAMJ,EAAS,CACXnjC,IAAK,CAACy+B,EAAMC,GACZ9qC,KAAMA,EACNC,SAAUgH,EAAkBu3B,EAAc5jC,KAAKW,GAAK,MAIxD,GAAI0qB,KAAe,CACf,IAAM2pB,EAAQ1J,GAAY9oC,MAAM2xC,OAC1Bc,EAAQ1J,GAAY/oC,MAAM2xC,OAEhC,IAAKa,EAAO,MAAO,CAACP,MAAO,oCAC3B,IAAKQ,EAAO,MAAO,CAACR,MAAO,oCAE3B,IAAMnvC,EAAKgC,WAAW0tC,GAChBzvC,EAAK+B,WAAW2tC,GAEtB,GAAIP,MAAMpvC,GAAK,MAAO,CAACmvC,MAAO,WAAFt1C,OAAa61C,EAAK,4BAC9C,GAAIN,MAAMnvC,GAAK,MAAO,CAACkvC,MAAO,WAAFt1C,OAAa81C,EAAK,4BAE9CN,EAAOtzC,EAAI,CAACiE,EAAIC,EACpB,CAEA,OAAOovC,CACX,CAMA,SAASO,KACL,IAAMP,EAASL,KAOf,MAJA,CAACpJ,GAAeC,GAAeC,GAAeC,GAAmBC,GAAaC,GAAaC,IAAet9B,QAAQ,SAAAkmC,GAC1GA,GAAOA,EAAM34B,UAAUC,OAAO,UACtC,GAEIi5B,EAAOF,OACPhJ,GAAgBjM,YAAcmV,EAAOF,MACrC/I,GAAmBmF,UAAW,EAG1BrF,GAAchpC,MAAM2xC,OACpB3I,GAAc/vB,UAAUmC,IAAI,WAGxB+2B,EAAOF,MAAMhoB,SAAS,SAAUye,GAAczvB,UAAUmC,IAAI,WACvD+2B,EAAOF,MAAMhoB,SAAS,SAAU0e,GAAc1vB,UAAUmC,IAAI,WAC5D+2B,EAAOF,MAAMhoB,SAAS,QAAS2e,GAAc3vB,UAAUmC,IAAI,WAC3D+2B,EAAOF,MAAMhoB,SAAS,YAAa4e,GAAkB5vB,UAAUmC,IAAI,WACnE+2B,EAAOF,MAAMhoB,SAAS,UAAW6e,GAAY7vB,UAAUmC,IAAI,WAC3D+2B,EAAOF,MAAMhoB,SAAS,WAAW8e,GAAY9vB,UAAUmC,IAAI,YAGjE,IAIX6tB,GAAgBjM,YAAc,GAC9BkM,GAAmBmF,UAAW,GAEvB,EACX,CAEA,SAGesE,KAAiB,OAAAC,GAAA/nC,MAAC,KAADrO,UAAA,CAyBhC,SAAAo2C,KAFC,OAEDA,GAAA3lC,GAAA1M,KAAAE,EAzBA,SAAAoyC,IAAA,IAAAV,EAAA,OAAA5xC,KAAAC,EAAA,SAAAsyC,GAAA,cAAAA,EAAAt0C,GAAA,OACyC,KAA/B2zC,EAASL,MAEJG,MAAO,CAAFa,EAAAt0C,EAAA,QAC+B,OAA3CyqC,GAAgBjM,YAAcmV,EAAOF,MAAMa,EAAArzC,EAAA,UAS/C,GALAoyC,KAGAlG,MAGI9iB,KAAe,CAAFiqB,EAAAt0C,EAAA,eAAAs0C,EAAAt0C,EAAA,EAEPimB,GAAWkX,sBAAsBwW,EAAQ,KAAMpf,IAAiB,OAAA+f,EAAAt0C,EAAA,sBAAAs0C,EAAAt0C,EAAA,EAGhEimB,GAAWkX,sBAAsBwW,EAAQ,IAAM,IAAK,IAAMpf,IAAiB,OAGrFsY,KAAoB,cAAAyH,EAAArzC,EAAA,KAAAozC,EAAA,KACvBhoC,MAAA,KAAArO,UAAA,CAKD,SAASu2C,KACL,GAAKtK,GAAL,CAGsB,CAACC,GAAeC,GAAeC,GAAeC,GAAmBC,GAAaC,IACtFr9B,QAAQ,SAAAkmC,GACbA,GAELA,EAAMjlC,iBAAiB,QAAS,SAACvO,GAC7B,IAAI4B,EAAQ5B,EAAE8L,OAAOlK,MAGjBgzC,EAAWhzC,EAAMiJ,QAAQ,eAAgB,IAGvCgqC,EAAWD,EAASzuC,MAAM,KAC5B0uC,EAASx2C,OAAS,IAClBu2C,EAAWC,EAAS,GAAK,IAAMA,EAAS9wC,MAAM,GAAGiH,KAAK,KAY1D,IAAM8pC,GARNF,EAAWA,EAAS/pC,QAAQ,KAAM,SAACxD,EAAO0tC,GACtC,GAAe,IAAXA,EAAc,OAAO1tC,EACzB,IAAM2tC,EAAWJ,EAASG,EAAS,GACnC,MAAiB,MAAbC,GAAiC,MAAbA,EAAyB3tC,EAC1C,EACX,IAGwBlB,MAAM,QAC1B2uC,EAAOz2C,OAAS,IAChBu2C,EAAWE,EAAO,GAAK,IAAMA,EAAO,IAIpClzC,IAAUgzC,IACV50C,EAAE8L,OAAOlK,MAAQgzC,EAEzB,EACJ,GAGA,IAAMK,EAAY,CAAC3K,GAAeC,GAAeC,GAAeC,GAAmBC,GAAaC,GAAaC,IAC7GqK,EAAU3nC,QAAQ,SAAAkmC,GACTA,GACLA,EAAMjlC,iBAAiB,QAAS+lC,GACpC,GAGAxJ,GAAmBv8B,iBAAiB,QAAOM,GAAA1M,KAAAE,EAAE,SAAAyK,IAAA,OAAA3K,KAAAC,EAAA,SAAA4K,GAAA,cAAAA,EAAA5M,GAAA,cAAA4M,EAAA5M,EAAA,EACnCm0C,KAAmB,cAAAvnC,EAAA3L,EAAA,KAAAyL,EAAA,KAI7Bi+B,GAAoBx8B,iBAAiB,QAAS,WAC1CklC,IACJ,GAGApJ,GAAiB97B,iBAAiB,QAAS,SAACvO,GACpCA,EAAE8L,SAAWu+B,IACboJ,IAER,GAGAwB,EAAU3nC,QAAQ,SAAAkmC,GACTA,GACLA,EAAMjlC,iBAAiB,UAAW,SAACvO,GAC/BA,EAAE8rB,kBAEY,UAAV9rB,EAAEmM,IACEmoC,MACAC,KAEa,WAAVv0C,EAAEmM,KACTsnC,IAER,EACJ,GAEAx1C,EAAI,eAAgB,uBAhFS,CAiFjC,CAMA,SAASi3C,KAEL,IAAIC,EAAkB,QAEtB1L,GAAKl7B,iBAAiB,cAAe,SAACvO,GAClCm1C,EAAkBn1C,EAAEo1C,WACxB,GAEA3L,GAAKl7B,iBAAiB,eAAgB,SAACvO,GAEb,UAAlBA,EAAEo1C,cAEFvJ,KACAn4B,aAAam4B,IACbA,GAAwB,MAE5BnW,IAAa,GACjB,GAGA+T,GAAKl7B,iBAAiB,QAAS,YACH,UAApB4mC,GAA+Bp3C,EAAaD,IAC5C43B,IAER,GAEA8T,GAAOj7B,iBAAiB,eAAgB,SAACvO,GAEf,UAAlBA,EAAEo1C,aAGFrJ,KAAkBhuC,IAClB8tC,GAAwB5+B,WAAW,WAC/ByoB,IAAa,GACbmW,GAAwB,IAC5B,EAAG,KAEX,GAGAl+B,GAAOY,iBAAiB,cAAe,WAC/BxQ,GACJ23B,IAAa,EACjB,GAEAz3B,EAAI,eAAgB,mBACxB,CAEA,SAASo3C,KACLxL,GAAYt7B,iBAAiB,QAAOM,GAAA1M,KAAAE,EAAE,SAAAuZ,IAAA,OAAAzZ,KAAAC,EAAA,SAAA8Z,GAAA,cAAAA,EAAA9b,GAAA,cAAA8b,EAAA9b,EAAA,EAC5BgmB,KAAO,cAAAlK,EAAA7a,EAAA,KAAAua,EAAA,KAGjBkuB,GAAev7B,iBAAiB,QAASymB,IAEzCgV,GAAWz7B,iBAAiB,QAAS6mB,IAErC2U,GAAiBx7B,iBAAiB,QAAS0mB,IAE3Ch3B,EAAI,eAAgB,0BACxB,CAEA,SAAS2vC,KACL,IAAM0H,EAAc36B,SAASC,eAAe,WAC5CuxB,GAAgB,GAGhB,IAAM0F,EAAO9uC,GAAOsjB,GAAW1V,SAC/BkhC,EAAQvkC,QAAQ,SAACgH,GACb,IAAM/G,EAAMoN,SAAS2U,cAAc,UASnC,GARA/hB,EAAIsQ,GAAK,UAAavJ,EAAOC,MAC7BhH,EAAIgoC,UAAY,SAChBhoC,EAAI6gC,MAAQ,GAAA7vC,OAAI+V,EAAOuJ,IAAO,UAAYvJ,EAAOC,MAAM,QAAAhW,OAChD+V,EAAOC,MAAQ,GAAK,QAAU,KAAGhW,OAAG+V,EAAOC,MAAK,KAEvDhH,EAAIqxB,aAAetqB,EAAOuJ,IAAMvJ,EAAOC,OAAOzQ,WAG1CwQ,EAAO1P,WAAayhB,GAAWvJ,SAAU,CACzC,IAAM5X,EAAUmhB,GAAWvJ,SAAS6vB,KAAK,SAAA1rC,GAAC,OAAIA,EAAE4c,KAAOvJ,EAAO1P,SAAS,GACnEM,GAAWA,EAAQpF,WACnByN,EAAIkY,MAAM+vB,YAActwC,EAAQpF,SAChCyN,EAAIkY,MAAMmpB,YAAY,kBAAmB1pC,EAAQpF,UACjDyN,EAAIsN,UAAUmC,IAAI,eAE1B,CAEAzP,EAAIgB,iBAAiB,QAAOM,GAAA1M,KAAAE,EAAE,SAAA+a,IAAA,OAAAjb,KAAAC,EAAA,SAAAib,GAAA,cAAAA,EAAAjd,GAAA,OACH,OAAvB+vC,KAAuB9yB,EAAAjd,EAAA,EACjBw1B,GAAeic,EAASv9B,EAAOC,OAAM,cAAA8I,EAAAhc,EAAA,KAAA+b,EAAA,KAG/Ck4B,EAAYG,YAAYloC,GACxB4+B,GAAcxoC,KAAK4J,EACvB,GAGoBqjC,KACRtjC,QAAQ,SAACgH,GACjB,IAAM/G,EAAMoN,SAAS2U,cAAc,UAOnC,GANA/hB,EAAIsQ,GAAK,UAAYvJ,EAAOuJ,GAC5BtQ,EAAIgoC,UAAY,qBAChBhoC,EAAI6gC,MAAQ,GAAH7vC,OAAM+V,EAAOuJ,GAAE,mCACxBtQ,EAAIqxB,YAActqB,EAAOuJ,GAGrBvJ,EAAO1P,WAAayhB,GAAWvJ,SAAU,CACzC,IAAM5X,EAAUmhB,GAAWvJ,SAAS6vB,KAAK,SAAA1rC,GAAC,OAAIA,EAAE4c,KAAOvJ,EAAO1P,SAAS,GACnEM,GAAWA,EAAQpF,WACnByN,EAAIkY,MAAM+vB,YAActwC,EAAQpF,SAChCyN,EAAIkY,MAAMmpB,YAAY,kBAAmB1pC,EAAQpF,UACjDyN,EAAIsN,UAAUmC,IAAI,eAE1B,CAGAzP,EAAIgB,iBAAiB,QAAOM,GAAA1M,KAAAE,EAAE,SAAAga,IAAA,OAAAla,KAAAC,EAAA,SAAAya,GAAA,cAAAA,EAAAzc,GAAA,OAIE,GAH5B+vC,KACA7R,KACAiP,KACAhgC,EAAIsN,UAAUmC,IAAI,WAEdyN,KAAe,CAAF5N,EAAAzc,EAAA,eAAAyc,EAAAzc,EAAA,EACPimB,GAAWkX,sBAAsBjpB,EAAQ,KAAMqgB,IAAiB,OAAA9X,EAAAzc,EAAA,sBAAAyc,EAAAzc,EAAA,EAEhEimB,GAAWkX,sBAAsBjpB,EAAQ,IAAM,IAAK,KAAMqgB,IAAiB,OAGrFsY,KACA7oC,EAAgBsnC,GAAarlB,GAAWzV,IAAI,GAAIyV,GAAWzV,IAAI,GAAIyV,GAAW7hB,KAAM6hB,GAAW5hB,SAAU4hB,GAAW5lB,EAAI4lB,GAAW5lB,EAAE,GAAK,KAAM4lB,GAAW5lB,EAAI4lB,GAAW5lB,EAAE,GAAK,KAAM2rB,MAAuB,cAAAvP,EAAAxb,EAAA,KAAAgb,EAAA,KAIlN9O,EAAIgB,iBAAiB,cAAe,SAACvO,GACjCA,EAAE0O,iBACEgnC,QAAQ,gBAADn3C,OAAiB+V,EAAOuJ,GAAE,QACjCo1B,GAAiB3+B,EAAOuJ,GAEhC,GAGA,IAAI83B,EAAiB,KACjBC,GAAa,EACjBroC,EAAIgB,iBAAiB,aAAc,SAACvO,GAChC41C,GAAa,EACbD,EAAiB1oC,WAAW,WACnB2oC,IACD51C,EAAE0O,iBACEgnC,QAAQ,gBAADn3C,OAAiB+V,EAAOuJ,GAAE,QACjCo1B,GAAiB3+B,EAAOuJ,IAGpC,EAAG,IACP,EAAG,CAAC2O,SAAS,IACbjf,EAAIgB,iBAAiB,YAAa,WAC9BqnC,GAAa,EACTD,IACAjiC,aAAaiiC,GACbA,EAAiB,KAEzB,GACApoC,EAAIgB,iBAAiB,WAAY,WACzBonC,IACAjiC,aAAaiiC,GACbA,EAAiB,KAEzB,GAEAL,EAAYG,YAAYloC,GACxB4+B,GAAcxoC,KAAK4J,EACvB,GAEI4+B,GAAc9tC,OAAS,GACvB8tC,GAAc,GAAGtxB,UAAUmC,IAAI,UAGnC/e,EAAI,eAAgB,yBACxB,CAUA,SAASkyC,KAAuB,IAAA0F,EACjB,QAAXA,EAAA3K,UAAW,IAAA2K,GAAXA,EAAah7B,UAAUC,OAAO,QAC1BmwB,KAAeA,GAAcrM,YAAc,SACnD,CAEA,SAASkX,KACL7K,GAAc18B,iBAAiB,QAAS,SAACvO,GACrCA,EAAE8rB,kBACFskB,KACA2F,KAhBR,WACI7K,GAAYrwB,UAAU6jB,OAAO,QAC7B,IAAMsX,EAAS9K,GAAYrwB,UAAUkC,SAAS,QAC9CkuB,GAAcrM,YAAcoX,EAAS,SAAW,QACpD,CAaQC,EACJ,GAGAt7B,SAASpM,iBAAiB,QAAS,SAACvO,GAC3BkrC,GAAYnuB,SAAS/c,EAAE8L,SAAW9L,EAAE8L,SAAWm/B,IAChDkF,IAER,GAEAlyC,EAAI,eAAgB,sBACxB,CAUA,SAASmyC,KAAqB,IAAA8F,EACjB,QAATA,EAAA9K,UAAS,IAAA8K,GAATA,EAAWr7B,UAAUC,OAAO,QACxBqwB,KAAaA,GAAYvM,YAAc,SAC/C,CAEA,SAASuX,KACLhL,GAAY58B,iBAAiB,QAAS,SAACvO,GACnCA,EAAE8rB,kBACFqkB,KACA4F,KAhBR,WACI3K,GAAUvwB,UAAU6jB,OAAO,QAC3B,IAAMsX,EAAS5K,GAAUvwB,UAAUkC,SAAS,QAC5CouB,GAAYvM,YAAcoX,EAAS,SAAW,QAClD,CAaQI,EACJ,GAGAz7B,SAASpM,iBAAiB,QAAS,SAACvO,GAC3BorC,GAAUruB,SAAS/c,EAAE8L,SAAW9L,EAAE8L,SAAWq/B,IAC9CiF,IAER,GAEAnyC,EAAI,eAAgB,oBACxB,CAUA,SAAS83C,KACLxK,GAAY1wB,UAAUC,OAAO,QAC7BwwB,GAAc1M,YAAc,WAChC,CAEA,SAASiP,KACLxB,GAAiB,GACjBd,GAAYlH,UAAY,GAExB,IAAM2J,EAAW3nB,GAAWvJ,UAAY,GAGlCu5B,EAAY17B,SAAS2U,cAAc,UACzC+mB,EAAUx4B,GAAK,iBACfw4B,EAAUd,UAAY,UACtBc,EAAUjI,MAAQ,4BAClBiI,EAAUhS,UAAY,4HACtBgS,EAAU9nC,iBAAiB,QAAOM,GAAA1M,KAAAE,EAAE,SAAAmb,IAAA,OAAArb,KAAAC,EAAA,SAAAub,GAAA,cAAAA,EAAAvd,GAAA,OACT,OAAvB21C,KAAuBp4B,EAAAvd,EAAA,EACjB20B,KAAiB,cAAApX,EAAAtc,EAAA,KAAAmc,EAAA,KAE3B+tB,GAAYkK,YAAYY,GACxBhK,GAAe1oC,KAAK0yC,GAGpB,IAAM37B,EAAWC,SAAS2U,cAAc,UACxC5U,EAASmD,GAAK,gBACdnD,EAAS66B,UAAY,UACrB76B,EAAS0zB,MAAQ,gDACjB1zB,EAAS2pB,UAAY,qEACrB3pB,EAASnM,iBAAiB,QAAOM,GAAA1M,KAAAE,EAAE,SAAA4b,IAAA,OAAA9b,KAAAC,EAAA,SAAAmc,GAAA,cAAAA,EAAAne,GAAA,WAC3BimB,GAAW9L,qBAAsB,CAAFgE,EAAAne,EAAA,QAC/BimB,GAAWtS,6BAA6BwK,EAAAne,EAAA,eAEjB,OAAvB21C,KAAuBx3B,EAAAne,EAAA,EACjBimB,GAAWyO,oBAAoB,IAAM,IAAMH,GAAkBC,IAA2B,OAGlGC,KAAgC,cAAAtW,EAAAld,EAAA,KAAA4c,EAAA,KAEpCstB,GAAYkK,YAAY/6B,GACxB2xB,GAAe1oC,KAAK+W,GAGpBszB,EAAS1gC,QAAQ,SAACpI,EAASqP,GACvB,IAAMhH,EAAMoN,SAAS2U,cAAc,UACnC/hB,EAAIsQ,GAAK,WAAatJ,EACtBhH,EAAIgoC,UAAY,UAChBhoC,EAAI6gC,MAAQlpC,EAAQ2Y,GAGpB,IAAMy4B,EAAepxC,EAAQpF,UAAY,OACrCy2C,EAAiBD,EAErB,GAAIpxC,EAAQsf,MACR,GAA6B,KAAzBtf,EAAQsf,MAAMnmB,OAAe,CAE7B,IAAM6B,EAAId,KAAKoL,IAAI,IAAKpL,KAAKsN,MAAyB,IAAnBxH,EAAQsf,MAAM,KAC3Cra,EAAI/K,KAAKoL,IAAI,IAAKpL,KAAKsN,MAA0B,IAApBxH,EAAQsf,MAAM,MAC3C3b,EAAIzJ,KAAKoL,IAAI,IAAKpL,KAAKsN,MAA0B,IAApBxH,EAAQsf,MAAM,MACjD+xB,EAAiB,OAAHh4C,OAAU2B,EAAC,MAAA3B,OAAK4L,EAAC,MAAA5L,OAAKsK,EAAC,IACzC,MAAO,GAA6B,IAAzB3D,EAAQsf,MAAMnmB,OAAc,CAEnC,IAAMqM,EAAM4rC,EAAazrC,QAAQ,IAAK,IAChC2rC,EAAKvrC,SAASP,EAAIQ,UAAU,EAAG,GAAI,IACnCurC,EAAKxrC,SAASP,EAAIQ,UAAU,EAAG,GAAI,IACnCwrC,EAAKzrC,SAASP,EAAIQ,UAAU,EAAG,GAAI,IACnChL,EAAId,KAAKoL,IAAI,IAAKpL,KAAKsN,MAAM8pC,EAAKtxC,EAAQsf,MAAM,GAAK,KACrDra,EAAI/K,KAAKoL,IAAI,IAAKpL,KAAKsN,MAAM+pC,EAAKvxC,EAAQsf,MAAM,GAAK,KACrD3b,EAAIzJ,KAAKoL,IAAI,IAAKpL,KAAKsN,MAAMgqC,EAAKxxC,EAAQsf,MAAM,GAAK,KAC3D+xB,EAAiB,OAAHh4C,OAAU2B,EAAC,MAAA3B,OAAK4L,EAAC,MAAA5L,OAAKsK,EAAC,IACzC,CAGJ0E,EAAI82B,UAAY,yEAAH9lC,OAA4E+3C,EAAY,UAAA/3C,OAASg4C,EAAc,mBAAAh4C,OAAkB2G,EAAQ2Y,IAEtJtQ,EAAIgB,iBAAiB,QAAOM,GAAA1M,KAAAE,EAAE,SAAAyc,IAAA,OAAA3c,KAAAC,EAAA,SAAA8c,GAAA,cAAAA,EAAA9e,GAAA,OACH,OAAvB21C,KAAuB72B,EAAA9e,EAAA,EACjBimB,GAAW/I,oBAAoB/I,EAAO,IAAKogB,IAAiB,OAClEC,KACAC,KAAgC,cAAA3V,EAAA7d,EAAA,KAAAyd,EAAA,KAGpCysB,GAAYkK,YAAYloC,GACxB8+B,GAAe1oC,KAAK4J,EACxB,GAGAqnB,KAEA32B,EAAI,eAAgB,0BACxB,CAEA,SAAS04C,KACLrL,GAAc/8B,iBAAiB,QAAS,SAACvO,GACrCA,EAAE8rB,kBACFqkB,KACAC,KAxGR,WACI7E,GAAY1wB,UAAU6jB,OAAO,QAC7B,IAAMsX,EAASzK,GAAY1wB,UAAUkC,SAAS,QAC9CuuB,GAAc1M,YAAcoX,EAAS,YAAc,WACvD,CAqGQY,EACJ,GAGAj8B,SAASpM,iBAAiB,QAAS,SAACvO,GAC3BurC,GAAYxuB,SAAS/c,EAAE8L,SAAW9L,EAAE8L,SAAWw/B,IAChDyK,IAER,GAEA93C,EAAI,eAAgB,sBACxB,CAKA,SAAS44C,MACLvK,GAAaF,GAAY7tC,OAAO4tC,IAAe5tC,OAAO8tC,KAC3C1oC,KAAKkmC,GAAaC,GAAgBC,GAAkBC,IAE/DsC,GAAWh/B,QAAQ,SAACC,GAChBA,EAAIgB,iBAAiB,aAAc,WAC/BhB,EAAIupC,MACR,GAEAvpC,EAAIgB,iBAAiB,UAAW,WAC5BhB,EAAIupC,MACR,EACJ,GAEA74C,EAAI,eAAgB,yBACxB,CAEA,SAAS6vC,KACL,GAAIrjB,KAAe,CACf,IAAMssB,EAAYp8B,SAASC,eAAe,SAC1CwxB,GAAc,GAEd,IAAM0E,EAAK/tC,GAAOsjB,GAAW5B,OAC7BqsB,EAAMxjC,QAAQ,SAAC0jC,EAAMz8B,GACjB,IAAMhH,EAAMoN,SAAS2U,cAAc,UAOnC,GANA/hB,EAAIsQ,GAAK,OAAUtJ,EACnBhH,EAAIgoC,UAAY,OAChBhoC,EAAI6gC,OAAS4C,EAAKnzB,IAAO,UAAYtJ,GAAU,WAAJhW,OAAegW,EAAK,KAC/DhH,EAAIqxB,YAAcoS,EAAKnzB,IAAOtJ,EAAOzQ,WAGjCktC,EAAKpsC,WAAayhB,GAAWvJ,SAAU,CACvC,IAAM5X,EAAUmhB,GAAWvJ,SAAS6vB,KAAK,SAAA1rC,GAAC,OAAIA,EAAE4c,KAAOmzB,EAAKpsC,SAAS,GACjEM,GAAWA,EAAQpF,WACnByN,EAAIkY,MAAM+vB,YAActwC,EAAQpF,SAChCyN,EAAIkY,MAAMmpB,YAAY,kBAAmB1pC,EAAQpF,UACjDyN,EAAIsN,UAAUmC,IAAI,eAE1B,CAEAzP,EAAIgB,iBAAiB,QAAOM,GAAA1M,KAAAE,EAAE,SAAAkd,IAAA,OAAApd,KAAAC,EAAA,SAAA4d,GAAA,cAAAA,EAAA5f,GAAA,OACL,OAArBgwC,KAAqBpwB,EAAA5f,EAAA,EACfu1B,GAAemb,EAAOv8B,GAAM,cAAAyL,EAAA3e,EAAA,KAAAke,EAAA,KAGtCw3B,EAAUtB,YAAYloC,GACtB6+B,GAAYzoC,KAAK4J,EACrB,GAEA89B,GAAc5lB,MAAMS,QAAU,cAClC,CAEAjoB,EAAI,eAAgB,kBACxB,CAEA,SAAS+4C,KACLtN,GAAiBn7B,iBAAiB,QAAO,eAAA0oC,EAAApoC,GAAA1M,KAAAE,EAAE,SAAA+d,EAAOpgB,GAAC,OAAAmC,KAAAC,EAAA,SAAAme,GAAA,cAAAA,EAAAngB,GAAA,WAC3CJ,EAAEy1B,QAAS,CAAFlV,EAAAngB,EAAA,QACmD,OAAAmgB,EAAAngB,EAAA,EACtDs0B,GAAiCh2B,EAAaC,YAAW,OAAA4hB,EAAAngB,EAAA,eAEtB,OAAAmgB,EAAAngB,EAAA,EACnC+0B,GAAkBz2B,EAAaC,YAAW,cAAA4hB,EAAAlf,EAAA,KAAA+e,EAAA,IAEvD,gBAAAI,GAAA,OAAAy2B,EAAAxqC,MAAA,KAAArO,UAAA,EARwC,IAUzCurC,GAAYp7B,iBAAiB,QAAO,eAAA2oC,EAAAroC,GAAA1M,KAAAE,EAAE,SAAAqe,EAAO1gB,GAAC,OAAAmC,KAAAC,EAAA,SAAA2e,GAAA,cAAAA,EAAA3gB,GAAA,WACtCJ,EAAEy1B,QAAS,CAAF1U,EAAA3gB,EAAA,QAC8C,OAAA2gB,EAAA3gB,EAAA,EACjDs0B,GAAiCh2B,EAAaE,OAAM,OAAAmiB,EAAA3gB,EAAA,sBAAA2gB,EAAA3gB,EAAA,EAEpD+0B,GAAkBz2B,EAAaE,OAAM,cAAAmiB,EAAA1f,EAAA,KAAAqf,EAAA,IAElD,gBAAAM,GAAA,OAAAk2B,EAAAzqC,MAAA,KAAArO,UAAA,EAPmC,IAUhCwrC,GAAcr7B,iBAAiB,QAAOM,GAAA1M,KAAAE,EAAE,SAAA6e,IAAA,OAAA/e,KAAAC,EAAA,SAAAkf,GAAA,cAAAA,EAAAlhB,GAAA,OAEd,GAAtBwpC,GAAckN,QACVrsB,KAAe,CAAFnJ,EAAAlhB,EAAA,eAAAkhB,EAAAlhB,EAAA,EACPs0B,GAAiCh2B,EAAaC,YAAW,OAAA2iB,EAAAlhB,EAAA,sBAAAkhB,EAAAlhB,EAAA,EAEzDs0B,GAAiCh2B,EAAaE,OAAM,cAAA0iB,EAAAjgB,EAAA,KAAA6f,EAAA,KAIlE0oB,GAAcnkB,MAAMS,QAAU,cAGlCjoB,EAAI,eAAgB,2BACxB,CAEA,SAASk5C,KAELzxC,OAAO6I,iBAAiB,SAAU,WAC9BmF,aAAa61B,IACbA,GAAgBt8B,WAAW,WACvBoZ,GAAW/M,cACf,EAAG,IACP,GAGA,IAAM89B,EAAez8B,SAAS08B,iBAAiB,cAS/CD,EAAa9pC,QAAQ,SAACgqC,GAClBA,EAAQ/oC,iBAAiB,YAAa,WAClC,IAAMgpC,EAAS,SAAC9oC,GAAK,OAThB,SAACA,EAAO6oC,GACjB,IAAIE,EAAYvsC,SAASvF,OAAO+xC,iBAAiBH,GAASvxB,MACtD2xB,EAAWzsC,SAASvF,OAAO+xC,iBAAiBH,GAAStxB,KACzDsxB,EAAQ7xB,MAAMM,KAAO,GAAHxnB,OAAMi5C,EAAY/oC,EAAMkpC,UAAS,MACnDL,EAAQ7xB,MAAMO,IAAM,GAAHznB,OAAMm5C,EAAWjpC,EAAMmpC,UAAS,KACrD,CAIkCC,CAAKppC,EAAO6oC,EAAQ,EAE9C38B,SAASpM,iBAAiB,YAAagpC,GACvC58B,SAASpM,iBAAiB,UAAW,WACjCoM,SAAS3G,oBAAoB,YAAaujC,EAC9C,EAAG,CAACO,MAAM,GACd,EACJ,GAEA75C,EAAI,eAAgB,mBACxB,CAEA,SAAS85C,KACLtM,GAASl9B,iBAAiB,aAAc,WAChCy9B,KACJP,GAASpH,UAAY,2CACzB,GAEAoH,GAASl9B,iBAAiB,aAAc,WAChCy9B,IACJn4B,IACJ,GAEA43B,GAASl9B,iBAAiB,QAAS,WAC3By9B,IAEJxX,IACJ,GAGAiX,GAASl9B,iBAAiB,cAAe,SAACvO,GACtCA,EAAE0O,iBACEs9B,IAEJxW,IACJ,GAGA,IAAIwiB,EAAiB,KAGrBvM,GAASl9B,iBAAiB,aAAc,SAACvO,GACjCgsC,KAEJgM,EAAiB/qC,WAAW,WACxBjN,EAAE0O,iBACF8mB,KACAwiB,EAAiB,IACrB,EATwB,KAU5B,EAAG,CAAExrB,SAAS,IAEdif,GAASl9B,iBAAiB,WAAY,WAC9BypC,IACAtkC,aAAaskC,GACbA,EAAiB,KAEzB,GAEAvM,GAASl9B,iBAAiB,YAAa,WAC/BypC,IACAtkC,aAAaskC,GACbA,EAAiB,KAEzB,EACJ,CAEO,SAASxjB,KACZ,IAAMwM,EAAW33B,EAAQgd,GAAWxV,MAAM7R,GACpCiiC,EAAW53B,EAAQgd,GAAWxV,MAAM3P,GACpC+2C,EAAc74C,KAAKo7B,SAAS12B,SAAS,IAAIC,MAAM,GAAGmH,UAAU,EAAG,GAC/DtG,EAAYwnB,MAAyB,GAEvCgjB,EACA,WAAA7wC,OAAW05C,EAAW,QACrBxtB,KAAgB,SAAHlsB,OAAY8nB,GAAW5lB,EAAC,WAAW,WAAAlC,OACtCiL,EAAIw3B,EAAS/7B,QAAQ,KAAI,MAAA1G,OAAKiL,EAAIy3B,EAASh8B,QAAQ,KAAI,OAAK,eAAA1G,OACxDkN,EAAkB4a,GAAW5hB,UAAS,cAAAlG,OAAa8nB,GAAW7hB,KAAI,oBAAAjG,OAAmBqG,EAAS,MAEjHmC,UAAUslB,UAAUC,UAAU8iB,GAAMtsC,KAAK,WACrC2oC,GAASpH,UAAY,sBACzB,EAAG,SAAUr7B,GAEb,EACJ,CAEA,SAASkvC,KAELxO,GAAmB/uB,SAASC,eAAe,oBAC3C+uB,GAAchvB,SAASC,eAAe,eACtCgvB,GAAgBjvB,SAASC,eAAe,iBACxC4uB,GAAS7uB,SAASC,eAAe,mBACjC6uB,GAAO9uB,SAASC,eAAe,QAC/B4wB,GAAY7wB,SAASC,eAAe,aACpC6wB,GAAW9wB,SAASC,eAAe,YACnCivB,GAAclvB,SAASC,eAAe,SACtCkvB,GAAiBnvB,SAASC,eAAe,YACzCmvB,GAAmBpvB,SAASC,eAAe,cAC3CovB,GAAarvB,SAASC,eAAe,QACrCqwB,GAAgBtwB,SAASC,eAAe,kBACxCswB,GAAcvwB,SAASC,eAAe,WACtCuwB,GAAcxwB,SAASC,eAAe,gBACtCwwB,GAAYzwB,SAASC,eAAe,SACpCywB,GAAgB1wB,SAASC,eAAe,kBACxC0wB,GAAgB3wB,SAASC,eAAe,kBACxC2wB,GAAc5wB,SAASC,eAAe,YACpBD,SAASC,eAAe,oBAE1CqvB,GAAiBtvB,SAASC,eAAe,kBACzCsvB,GAAoBvvB,SAASC,eAAe,gBAC5CuvB,GAAqBxvB,SAASC,eAAe,mBAC7CwvB,GAAoBzvB,SAASC,eAAe,kBAE5CyvB,GAAmB1vB,SAASC,eAAe,oBAC3C0vB,GAAgB3vB,SAASC,eAAe,YACxC2vB,GAAgB5vB,SAASC,eAAe,YACxC4vB,GAAgB7vB,SAASC,eAAe,YACxC6vB,GAAoB9vB,SAASC,eAAe,gBAC5C8vB,GAAc/vB,SAASC,eAAe,UACtC+vB,GAAchwB,SAASC,eAAe,UACtCgwB,GAAgBjwB,SAASC,eAAe,iBACxCiwB,GAAkBlwB,SAASC,eAAe,mBAC1CkwB,GAAqBnwB,SAASC,eAAe,mBAC7CmwB,GAAsBpwB,SAASC,eAAe,oBAC9CowB,GAAerwB,SAASC,eAAe,eAC3C,CAMO,SAAeu9B,GAAM12B,GAAA,OAAA22B,GAAA3rC,MAAC,KAADrO,UAAA,CAiF5B,SAAAg6C,KAFC,OAEDA,GAAAvpC,GAAA1M,KAAAE,EAjFO,SAAAg2C,EAAsBC,GAAe,IAAAC,EAAA,OAAAp2C,KAAAC,EAAA,SAAAo2C,GAAA,cAAAA,EAAAp4C,GAAA,WACpC0rC,GAAe,CAAF0M,EAAAp4C,EAAA,QAC2B,OAAAo4C,EAAAn3C,EAAA,UAK5CsM,IADA0Y,GAAaiyB,GACO3qC,OAEpBuqC,KAEII,aAA2BxoB,IAC3B4b,GAAchtC,EAAaE,MAC3B+qC,GAAY9uB,UAAUmC,IAAI,UAC1B0sB,GAAiB7uB,UAAUC,OAAO,UAElCojB,GAAiB7X,IACjB0Y,KACA+O,KAEAnZ,GAAiB/0B,GAEjB4pC,GAAO/jB,MAAMsoB,WAAa,wBAC1BvC,GAAU/lB,MAAMsoB,WAAa,wBAE7BroC,OAAOM,SAASF,KAAO,UAEvB0f,KAGJooB,KACAkI,KACAK,KACAtI,KACA8I,KACAQ,KACAjC,KACAG,KACA/B,KACAqB,KACAoD,KACAf,KACAH,KAGI/vC,IACA4mB,GAAkBrH,KAElByP,GAAYzP,IACZkD,GAAkBlD,KAGtBuO,KAEI72B,IAAeD,GAAqBoJ,KACpCutB,KAGJ9Z,SAASC,eAAe,eAAeypB,UAAY,IAAH9lC,Od36D7B,Qc86Dbg6C,EAAe59B,SAASC,eAAe,mBAEzC29B,EAAahqC,iBAAiB,QAAS,SAACvO,GAChC0F,OAAO+yC,WAAW,qBAAqBC,UACvC14C,EAAE0O,iBACF1O,EAAE8rB,kBACFysB,EAAa19B,UAAU6jB,OAAO,UAEtC,GAEA/jB,SAASpM,iBAAiB,QAAS,SAACvO,GAC3Bu4C,EAAax7B,SAAS/c,EAAE8L,SACzBysC,EAAa19B,UAAUC,OAAO,SAEtC,IAGJgxB,IAAgB,EAAK,cAAA0M,EAAAn3C,EAAA,KAAAg3C,EAAA,IACxBD,GAAA3rC,MAAA,KAAArO,UAAA,C,uPE78DD,IAAA4B,EAAAC,EAAAC,EAAA,mBAAAC,OAAAA,OAAA,GAAAC,EAAAF,EAAAG,UAAA,aAAAC,EAAAJ,EAAAK,aAAA,yBAAAC,EAAAN,EAAAE,EAAAE,EAAAE,GAAA,IAAAC,EAAAL,GAAAA,EAAAM,qBAAAC,EAAAP,EAAAO,EAAAC,EAAAC,OAAAC,OAAAL,EAAAC,WAAA,OAAAK,GAAAH,EAAA,mBAAAV,EAAAE,EAAAE,GAAA,IAAAE,EAAAC,EAAAG,EAAAI,EAAA,EAAAC,EAAAX,GAAA,GAAAY,GAAA,EAAAC,EAAA,CAAAF,EAAA,EAAAb,EAAA,EAAAgB,EAAApB,EAAAqB,EAAAC,EAAAN,EAAAM,EAAAC,KAAAvB,EAAA,GAAAsB,EAAA,SAAArB,EAAAC,GAAA,OAAAM,EAAAP,EAAAQ,EAAA,EAAAG,EAAAZ,EAAAmB,EAAAf,EAAAF,EAAAmB,CAAA,YAAAC,EAAApB,EAAAE,GAAA,IAAAK,EAAAP,EAAAU,EAAAR,EAAAH,EAAA,GAAAiB,GAAAF,IAAAV,GAAAL,EAAAgB,EAAA5C,OAAA4B,IAAA,KAAAK,EAAAE,EAAAS,EAAAhB,GAAAqB,EAAAH,EAAAF,EAAAO,EAAAhB,EAAA,GAAAN,EAAA,GAAAI,EAAAkB,IAAApB,KAAAQ,EAAAJ,GAAAC,EAAAD,EAAA,OAAAC,EAAA,MAAAD,EAAA,GAAAA,EAAA,GAAAR,GAAAQ,EAAA,IAAAc,KAAAhB,EAAAJ,EAAA,GAAAoB,EAAAd,EAAA,KAAAC,EAAA,EAAAU,EAAAC,EAAAhB,EAAAe,EAAAf,EAAAI,EAAA,IAAAc,EAAAE,IAAAlB,EAAAJ,EAAA,GAAAM,EAAA,GAAAJ,GAAAA,EAAAoB,KAAAhB,EAAA,GAAAN,EAAAM,EAAA,GAAAJ,EAAAe,EAAAf,EAAAoB,EAAAf,EAAA,OAAAH,GAAAJ,EAAA,SAAAmB,EAAA,MAAAH,GAAA,EAAAd,CAAA,iBAAAE,EAAAW,EAAAO,GAAA,GAAAR,EAAA,QAAAS,UAAA,oCAAAP,GAAA,IAAAD,GAAAK,EAAAL,EAAAO,GAAAf,EAAAQ,EAAAL,EAAAY,GAAAvB,EAAAQ,EAAA,EAAAT,EAAAY,KAAAM,GAAA,CAAAV,IAAAC,EAAAA,EAAA,GAAAA,EAAA,IAAAU,EAAAf,GAAA,GAAAkB,EAAAb,EAAAG,IAAAO,EAAAf,EAAAQ,EAAAO,EAAAC,EAAAR,GAAA,OAAAI,EAAA,EAAAR,EAAA,IAAAC,IAAAH,EAAA,QAAAL,EAAAO,EAAAF,GAAA,MAAAL,EAAAA,EAAAyB,KAAAlB,EAAAI,IAAA,MAAAa,UAAA,wCAAAxB,EAAA0B,KAAA,OAAA1B,EAAAW,EAAAX,EAAA2B,MAAAnB,EAAA,IAAAA,EAAA,YAAAA,IAAAR,EAAAO,EAAA,SAAAP,EAAAyB,KAAAlB,GAAAC,EAAA,IAAAG,EAAAa,UAAA,oCAAAnB,EAAA,YAAAG,EAAA,GAAAD,EAAAR,CAAA,UAAAC,GAAAiB,EAAAC,EAAAf,EAAA,GAAAQ,EAAAV,EAAAwB,KAAAtB,EAAAe,MAAAE,EAAA,YAAApB,GAAAO,EAAAR,EAAAS,EAAA,EAAAG,EAAAX,CAAA,SAAAe,EAAA,UAAAY,MAAA3B,EAAA0B,KAAAT,EAAA,GAAAhB,EAAAI,EAAAE,IAAA,GAAAI,CAAA,KAAAS,EAAA,YAAAV,IAAA,UAAAkB,IAAA,UAAAC,IAAA,CAAA7B,EAAAY,OAAAkB,eAAA,IAAAtB,EAAA,GAAAL,GAAAH,EAAAA,EAAA,GAAAG,QAAAW,GAAAd,EAAA,GAAAG,EAAA,yBAAAH,GAAAW,EAAAkB,EAAApB,UAAAC,EAAAD,UAAAG,OAAAC,OAAAL,GAAA,SAAAO,EAAAhB,GAAA,OAAAa,OAAAmB,eAAAnB,OAAAmB,eAAAhC,EAAA8B,IAAA9B,EAAAiC,UAAAH,EAAAf,GAAAf,EAAAM,EAAA,sBAAAN,EAAAU,UAAAG,OAAAC,OAAAF,GAAAZ,CAAA,QAAA6B,EAAAnB,UAAAoB,EAAAf,GAAAH,EAAA,cAAAkB,GAAAf,GAAAe,EAAA,cAAAD,GAAAA,EAAAK,YAAA,oBAAAnB,GAAAe,EAAAxB,EAAA,qBAAAS,GAAAH,GAAAG,GAAAH,EAAAN,EAAA,aAAAS,GAAAH,EAAAR,EAAA,yBAAAW,GAAAH,EAAA,oDAAAuB,GAAA,kBAAAC,EAAA5B,EAAA6B,EAAArB,EAAA,cAAAD,GAAAf,EAAAE,EAAAE,EAAAH,GAAA,IAAAO,EAAAK,OAAAyB,eAAA,IAAA9B,EAAA,gBAAAR,GAAAQ,EAAA,EAAAO,GAAA,SAAAf,EAAAE,EAAAE,EAAAH,GAAA,SAAAK,EAAAJ,EAAAE,GAAAW,GAAAf,EAAAE,EAAA,SAAAF,GAAA,YAAAuC,QAAArC,EAAAE,EAAAJ,EAAA,GAAAE,EAAAM,EAAAA,EAAAR,EAAAE,EAAA,CAAA0B,MAAAxB,EAAAoC,YAAAvC,EAAAwC,cAAAxC,EAAAyC,UAAAzC,IAAAD,EAAAE,GAAAE,GAAAE,EAAA,UAAAA,EAAA,WAAAA,EAAA,cAAAS,GAAAf,EAAAE,EAAAE,EAAAH,EAAA,UAAA0C,GAAAvC,EAAAH,EAAAD,EAAAE,EAAAI,EAAAe,EAAAZ,GAAA,QAAAD,EAAAJ,EAAAiB,GAAAZ,GAAAG,EAAAJ,EAAAoB,KAAA,OAAAxB,GAAA,YAAAJ,EAAAI,EAAA,CAAAI,EAAAmB,KAAA1B,EAAAW,GAAAgC,QAAAC,QAAAjC,GAAAkC,KAAA5C,EAAAI,EAAA,UAAAuO,GAAAzO,GAAA,sBAAAH,EAAA,KAAAD,EAAA5B,UAAA,WAAAwE,QAAA,SAAA1C,EAAAI,GAAA,IAAAe,EAAAjB,EAAAqM,MAAAxM,EAAAD,GAAA,SAAAkN,EAAA9M,GAAAuC,GAAAtB,EAAAnB,EAAAI,EAAA4M,EAAAC,EAAA,OAAA/M,EAAA,UAAA+M,EAAA/M,GAAAuC,GAAAtB,EAAAnB,EAAAI,EAAA4M,EAAAC,EAAA,QAAA/M,EAAA,CAAA8M,OAAA,eAAAyrC,GAAA34C,EAAAE,GAAA,IAAAD,EAAAY,OAAA6rC,KAAA1sC,GAAA,GAAAa,OAAA+3C,sBAAA,KAAAt4C,EAAAO,OAAA+3C,sBAAA54C,GAAAE,IAAAI,EAAAA,EAAA6yC,OAAA,SAAAjzC,GAAA,OAAAW,OAAAkP,yBAAA/P,EAAAE,GAAAsC,UAAA,IAAAvC,EAAA0D,KAAA8I,MAAAxM,EAAAK,EAAA,QAAAL,CAAA,UAAA44C,GAAA74C,GAAA,QAAAE,EAAA,EAAAA,EAAA9B,UAAAC,OAAA6B,IAAA,KAAAD,EAAA,MAAA7B,UAAA8B,GAAA9B,UAAA8B,GAAA,GAAAA,EAAA,EAAAy4C,GAAA93C,OAAAZ,IAAA,GAAAqN,QAAA,SAAApN,GAAAk/B,GAAAp/B,EAAAE,EAAAD,EAAAC,GAAA,GAAAW,OAAAi4C,0BAAAj4C,OAAAk4C,iBAAA/4C,EAAAa,OAAAi4C,0BAAA74C,IAAA04C,GAAA93C,OAAAZ,IAAAqN,QAAA,SAAApN,GAAAW,OAAAyB,eAAAtC,EAAAE,EAAAW,OAAAkP,yBAAA9P,EAAAC,GAAA,UAAAF,CAAA,UAAA+C,GAAA7C,GAAA,gBAAAA,GAAA,GAAA8C,MAAAC,QAAA/C,GAAA,OAAAgD,GAAAhD,EAAA,CAAAiD,CAAAjD,IAAA,SAAAA,GAAA,uBAAAC,QAAA,MAAAD,EAAAC,OAAAE,WAAA,MAAAH,EAAA,qBAAA8C,MAAAI,KAAAlD,EAAA,CAAAmD,CAAAnD,IAAA,SAAAA,EAAAmB,GAAA,GAAAnB,EAAA,qBAAAA,EAAA,OAAAgD,GAAAhD,EAAAmB,GAAA,IAAApB,EAAA,GAAA6D,SAAApC,KAAAxB,GAAA6D,MAAA,uBAAA9D,GAAAC,EAAA8D,cAAA/D,EAAAC,EAAA8D,YAAAC,MAAA,QAAAhE,GAAA,QAAAA,EAAA+C,MAAAI,KAAAlD,GAAA,cAAAD,GAAA,2CAAAiE,KAAAjE,GAAAiD,GAAAhD,EAAAmB,QAAA,GAAAiC,CAAApD,IAAA,qBAAAuB,UAAA,wIAAA8B,EAAA,UAAAL,GAAAhD,EAAAmB,IAAA,MAAAA,GAAAA,EAAAnB,EAAA7B,UAAAgD,EAAAnB,EAAA7B,QAAA,QAAA2B,EAAA,EAAAI,EAAA4C,MAAA3B,GAAArB,EAAAqB,EAAArB,IAAAI,EAAAJ,GAAAE,EAAAF,GAAA,OAAAI,CAAA,UAAA0O,GAAA9O,EAAAE,GAAA,QAAAD,EAAA,EAAAA,EAAAC,EAAA7B,OAAA4B,IAAA,KAAAK,EAAAJ,EAAAD,GAAAK,EAAAkC,WAAAlC,EAAAkC,aAAA,EAAAlC,EAAAmC,cAAA,YAAAnC,IAAAA,EAAAoC,UAAA,GAAA7B,OAAAyB,eAAAtC,EAAA+O,GAAAzO,EAAA6L,KAAA7L,EAAA,WAAA6O,GAAAlP,EAAAK,EAAAN,GAAA,OAAAM,EAAA8O,GAAA9O,GAAA,SAAAL,EAAAD,GAAA,GAAAA,IAAA,UAAAgP,GAAAhP,IAAA,mBAAAA,GAAA,OAAAA,EAAA,YAAAA,EAAA,UAAAyB,UAAA,4EAAAzB,GAAA,YAAAA,EAAA,UAAAqP,eAAA,oEAAArP,CAAA,CAAAsP,CAAArP,EAAA,CAAAsP,CAAAtP,EAAAuP,KAAAC,QAAAC,UAAApP,EAAAN,GAAA,GAAAoP,GAAAnP,GAAA+D,aAAA1D,EAAAmM,MAAAxM,EAAAD,GAAA,UAAAwP,KAAA,QAAAvP,GAAA0P,QAAAjP,UAAAkP,QAAAlO,KAAA+N,QAAAC,UAAAC,QAAA,wBAAA1P,GAAA,QAAAuP,GAAA,mBAAAvP,CAAA,cAAAkkB,GAAAlkB,EAAAK,EAAAN,EAAAE,GAAA,IAAAe,EAAA4O,GAAAT,GAAA,EAAAlP,EAAAD,EAAAS,UAAAT,GAAAK,EAAAN,GAAA,SAAAE,GAAA,mBAAAe,EAAA,SAAAhB,GAAA,OAAAgB,EAAAwL,MAAAzM,EAAAC,EAAA,EAAAgB,CAAA,UAAA4O,KAAA,OAAAA,GAAA,oBAAAJ,SAAAA,QAAAnJ,IAAAmJ,QAAAnJ,IAAA/E,OAAA,SAAAvB,EAAAC,EAAAC,GAAA,IAAAe,EAAA,SAAAhB,EAAAK,GAAA,SAAA4L,eAAAxK,KAAAzB,EAAAK,IAAA,QAAAL,EAAAmP,GAAAnP,MAAA,OAAAA,CAAA,CAAA6P,CAAA9P,EAAAC,GAAA,GAAAgB,EAAA,KAAAb,EAAAS,OAAAkP,yBAAA9O,EAAAhB,GAAA,OAAAG,EAAAkG,IAAAlG,EAAAkG,IAAA5E,KAAAtD,UAAAC,OAAA,EAAA2B,EAAAE,GAAAE,EAAAwB,KAAA,GAAAiO,GAAApD,MAAA,KAAArO,UAAA,UAAAgR,GAAAnP,GAAA,OAAAmP,GAAAvO,OAAAmB,eAAAnB,OAAAkB,eAAAR,OAAA,SAAAtB,GAAA,OAAAA,EAAAgC,WAAApB,OAAAkB,eAAA9B,EAAA,EAAAmP,GAAAnP,EAAA,UAAA+P,GAAA/P,EAAAD,GAAA,OAAAgQ,GAAAnP,OAAAmB,eAAAnB,OAAAmB,eAAAT,OAAA,SAAAtB,EAAAD,GAAA,OAAAC,EAAAgC,UAAAjC,EAAAC,CAAA,EAAA+P,GAAA/P,EAAAD,EAAA,UAAAo/B,GAAAp/B,EAAAE,EAAAD,GAAA,OAAAC,EAAA6O,GAAA7O,MAAAF,EAAAa,OAAAyB,eAAAtC,EAAAE,EAAA,CAAA0B,MAAA3B,EAAAuC,YAAA,EAAAC,cAAA,EAAAC,UAAA,IAAA1C,EAAAE,GAAAD,EAAAD,CAAA,UAAA+O,GAAA9O,GAAA,IAAAO,EAAA,SAAAP,EAAAC,GAAA,aAAA8O,GAAA/O,KAAAA,EAAA,OAAAA,EAAA,IAAAD,EAAAC,EAAAE,OAAA8O,aAAA,YAAAjP,EAAA,KAAAQ,EAAAR,EAAA0B,KAAAzB,EAAAC,GAAA,wBAAA8O,GAAAxO,GAAA,OAAAA,EAAA,UAAAiB,UAAA,kEAAAvB,EAAAuJ,OAAA3E,QAAA7E,EAAA,CAAAiP,CAAAjP,EAAA,0BAAA+O,GAAAxO,GAAAA,EAAAA,EAAA,GAkCO,IAAMsvB,GAAa,SAAAzL,GAQtB,SAAAyL,EAAYniB,GAAQ,IAAAqrC,EAAA7oC,GA1CxB,SAAA9O,EAAAjB,GAAA,KAAAiB,aAAAjB,GAAA,UAAAqB,UAAA,qCA0CwBmM,CAAA,KAAAkiB,GACFsP,GAAdjvB,EAAAhB,GAAA,KAAA2gB,EAAA,CAAMniB,IAAQ,iBAwFD,kBAAMwC,EAAK8lB,YAAa,CAAI,GAtFzC9lB,EAAKG,aAAeiU,GAAAA,GAAAA,GAAAA,KACpBpU,EAAKM,SAAWqf,EAAcoF,yBAA2B,KAAO,MAChE/kB,EAAK3L,KAAO2L,EAAKG,aAEjBH,EAAKE,iBAAmB9E,EAASgZ,GAAAA,GAAAA,GAAAA,UAA0B,GAC3DpU,EAAK1L,SAAW0L,EAAKE,iBAIrBF,EAAKmU,UAAY,CAACC,GAAAA,GAAAA,GAAAA,EAAAA,GAAoBA,GAAAA,GAAAA,GAAAA,EAAAA,IAEtCpU,EAAK1P,EAACsC,GAAOoN,EAAKmU,WAGlBnU,EAAK0C,OAAO1C,EAAKI,YAAY,GAAIJ,EAAKI,YAAY,IAGlDJ,EAAK8oC,MAAQ,CAAC,EAAG,GACjB9oC,EAAK+oC,QAAU,CACXl6C,EAAG,CAAE0J,GAAI,EAAGC,GAAI,GAChBzH,EAAG,CAAEwH,GAAI,EAAGC,GAAI,IAEpBwH,EAAK+lB,OAAMnzB,GAAOoN,EAAKI,aACvBJ,EAAKgmB,SAAW,CACZn3B,EAAG,CAAE0J,GAAIyH,EAAKI,YAAY,GAAI5H,GAAI,GAClCzH,EAAG,CAAEwH,GAAIyH,EAAKI,YAAY,GAAI5H,GAAI,IAEtCwH,EAAK8lB,YAAa,EAElB9lB,EAAKgpC,UAAYzxC,IACjByI,EAAKipC,UAAY1xC,IACjByI,EAAKkpC,UAAY3xC,IACjByI,EAAKmpC,QAAU5xC,IACfyI,EAAKopC,QAAU7xC,IAEfyI,EAAKC,SAAW,IAChBD,EAAKimB,gBAAkB,EACvBjmB,EAAKkmB,kBAAoB,GAEzBlmB,EAAKomB,SAAW,KAChBpmB,EAAKqmB,UAAY,KACjBrmB,EAAKsmB,YAAc,KAEnBtmB,EAAKmmB,aAAc,EAGnBnmB,EAAKQ,QAAU4T,GAAAA,GAAWzZ,IAAI,SAAA7J,GAAC,OAAA43C,GAAAA,GAAA,GACxB53C,GAAC,IACJwD,SAAU8G,EAAStK,EAAEwD,UAAY,IAAE,GAIvC0L,EAAKsU,MAAQF,GAAAA,GAAWzZ,IAAI,SAAAxJ,GAAC,OAAAu3C,GAAAA,GAAA,GACtBv3C,GAAC,IACJmD,SAAU8G,EAASjK,EAAEmD,UAAY,IAAE,GAIvC0L,EAAK2M,SAAWyH,GAAAA,IAAiB,GAGjC,IAAMi1B,EAAoC,QAAhBR,EAAGz0B,GAAAA,GAAAA,UAAa,IAAAy0B,OAAA,EAAbA,EAAep0C,UAC5CuL,EAAKspC,sBAAwBD,EACvBrpC,EAAK2M,SAASc,UAAU,SAAA3c,GAAC,OAAIA,EAAE4c,KAAO27B,CAAoB,GAC1D,EACFrpC,EAAKspC,sBAAwB,IAAGtpC,EAAKspC,sBAAwB,GAEjEtpC,EAAK8M,oBAAsB9M,EAAKspC,sBAChCtpC,EAAKuU,WAAavU,EAAK2M,SAASze,OAAS,EACnC,IAAI2Y,aAAa7G,EAAK2M,SAAS3M,EAAK8M,qBAAqBuH,OACzD,IAAIxN,aAAatX,EAAsB8kB,OAG7C,IAAMk1B,EAAiBvpC,EAAK2M,SAAS3M,EAAK8M,sBAAwBvd,EAC5DI,EAAW45C,EAAe55C,SAAW2K,EAASivC,EAAe55C,UAAY,KASnE,OARZqQ,EAAKyB,aAAe9R,EACd,CAACA,EAASI,EAAGJ,EAASqK,EAAGrK,EAAS+I,GAClC,CAAC6wC,EAAel1B,MAAM,GAAIk1B,EAAel1B,MAAM,IAAKk1B,EAAel1B,MAAM,KAE/ErU,EAAKwU,uBAAyB,KAC9BxU,EAAKwpC,kBAAmB,EACxBxpC,EAAKyU,SAAW,EAEhBzU,EAAKxB,OAAOwB,CAChB,CAAC,OAjIL,SAAAlQ,EAAAD,GAAA,sBAAAA,GAAA,OAAAA,EAAA,UAAAyB,UAAA,sDAAAxB,EAAAS,UAAAG,OAAAC,OAAAd,GAAAA,EAAAU,UAAA,CAAAsD,YAAA,CAAApC,MAAA3B,EAAAyC,UAAA,EAAAD,cAAA,KAAA5B,OAAAyB,eAAArC,EAAA,aAAAyC,UAAA,IAAA1C,GAAAgQ,GAAA/P,EAAAD,EAAA,CAiIKsS,CAAAwd,EAAAzL,GAjILrkB,EAiIK8vB,EAjIL5vB,EAiIK,EAAAiM,IAAA,mBAAAvK,MAID,WACIiM,KAAK4oB,YAAc5oB,KAAKC,GAAGipB,aAAa,qBACnClpB,KAAK4oB,cAKV5oB,KAAK0oB,SAAW1oB,KAAKC,GAAGkpB,gBACxBnpB,KAAKC,GAAGmpB,cAAcppB,KAAKC,GAAGopB,UAC9BrpB,KAAKC,GAAGqpB,YAAYtpB,KAAKC,GAAGspB,WAAYvpB,KAAK0oB,UAE7C1oB,KAAKC,GAAGupB,cAAcxpB,KAAKC,GAAGspB,WAAYvpB,KAAKC,GAAGwpB,mBAAoBzpB,KAAKC,GAAGypB,SAC9E1pB,KAAKC,GAAGupB,cAAcxpB,KAAKC,GAAGspB,WAAYvpB,KAAKC,GAAG0pB,mBAAoB3pB,KAAKC,GAAGypB,SAC9E1pB,KAAKC,GAAGupB,cAAcxpB,KAAKC,GAAGspB,WAAYvpB,KAAKC,GAAG2pB,eAAgB5pB,KAAKC,GAAG4pB,eAC1E7pB,KAAKC,GAAGupB,cAAcxpB,KAAKC,GAAGspB,WAAYvpB,KAAKC,GAAG6pB,eAAgB9pB,KAAKC,GAAG4pB,eAE1E7pB,KAAK2oB,UAAY,IAAIxf,aAA6B,EAAhBnJ,KAAKuC,UAEnCvC,KAAK+pB,aAAa/pB,KAAKC,GAAG+pB,UAAUhqB,KAAK+pB,YAAa,GACtD/pB,KAAKiqB,WAAWjqB,KAAKC,GAAGqK,UAAUtK,KAAKiqB,UAAWjqB,KAAKuC,UAE3DvC,KAAKooB,YAAa,EACtB,GAAC,CAAA9pB,IAAA,6BAAAvK,MAED,WACI,OAAQkuB,EAAcoF,yB,05RAEGrqB,QAAQ,eAAgBgD,KAAKuC,UAAUtM,UACpE,GAEA,CAAAqI,IAAA,iBAAAvK,MAIA,WACIuiB,GAAA2L,EAAA,wBAAA3L,CAAA,IAEAtW,KAAKgX,KAAOhX,KAAKC,GAAG8J,mBAAmB/J,KAAKoG,QAAS,OACrDpG,KAAKiX,cAAgBjX,KAAKC,GAAG8J,mBAAmB/J,KAAKoG,QAAS,gBAG9DpG,KAAK+rC,YAAc/rC,KAAKC,GAAG8J,mBAAmB/J,KAAKoG,QAAS,gBAC5DpG,KAAKgsC,YAAchsC,KAAKC,GAAG8J,mBAAmB/J,KAAKoG,QAAS,gBAC5DpG,KAAKoqB,SAAWpqB,KAAKC,GAAG8J,mBAAmB/J,KAAKoG,QAAS,YACzDpG,KAAKqqB,SAAWrqB,KAAKC,GAAG8J,mBAAmB/J,KAAKoG,QAAS,YAEzDpG,KAAK+pB,YAAc/pB,KAAKC,GAAG8J,mBAAmB/J,KAAKoG,QAAS,cAC5DpG,KAAKiqB,UAAYjqB,KAAKC,GAAG8J,mBAAmB/J,KAAKoG,QAAS,WAC9D,GAEA,CAAA9H,IAAA,mBAAAvK,MAEA,SAAiBk4C,EAAKC,EAAK1hB,GAGvB,IAFA,IAAIC,EAAKwhB,EAAKvhB,EAAKwhB,EACbr1C,EAAKmJ,KAAKpN,EAAE,GAAIkE,EAAKkJ,KAAKpN,EAAE,GACzBD,EAAI,EAAGA,EAAI63B,EAAO73B,IAAK,CAC5B,IACMg4B,EAAM,EAAMF,EAAKC,EAAK5zB,EAE5B,IADA2zB,EAFYA,EAAKA,EAAKC,EAAKA,EAAK7zB,GAGvB4zB,GADCC,EAAKC,GACID,EAAK,EAAK,OAAO/3B,CACxC,CACA,OAAO63B,CACX,GAEA,CAAAlsB,IAAA,8BAAAvK,MAOA,WAGI,GAHqCxD,UAAAC,OAAA,QAAAC,IAAAF,UAAA,IAAAA,UAAA,GAiBjC,OAbAyP,KAAKorC,MAAM,GAAKprC,KAAK+C,IAAI,GACzB/C,KAAKorC,MAAM,GAAKprC,KAAK+C,IAAI,GACzB/C,KAAKqrC,QAAQl6C,EAAE0J,GAAKmF,KAAKgD,MAAM7R,EAAE0J,GACjCmF,KAAKqrC,QAAQl6C,EAAE2J,GAAKkF,KAAKgD,MAAM7R,EAAE2J,GACjCkF,KAAKqrC,QAAQh4C,EAAEwH,GAAKmF,KAAKgD,MAAM3P,EAAEwH,GACjCmF,KAAKqrC,QAAQh4C,EAAEyH,GAAKkF,KAAKgD,MAAM3P,EAAEyH,GAEjCkF,KAAKqoB,OAAO,GAAKroB,KAAK+C,IAAI,GAC1B/C,KAAKqoB,OAAO,GAAKroB,KAAK+C,IAAI,GAC1B/C,KAAKsoB,SAASn3B,EAAE0J,GAAKmF,KAAKgD,MAAM7R,EAAE0J,GAClCmF,KAAKsoB,SAASn3B,EAAE2J,GAAKkF,KAAKgD,MAAM7R,EAAE2J,GAClCkF,KAAKsoB,SAASj1B,EAAEwH,GAAKmF,KAAKgD,MAAM3P,EAAEwH,QAClCmF,KAAKsoB,SAASj1B,EAAEyH,GAAKkF,KAAKgD,MAAM3P,EAAEyH,IAItC,IAAM8vB,EAAO5qB,KAAKuoB,gBACZsC,GAAQD,EAAO,GAAK,EACpBld,EAAQ,EAAM1N,KAAKwoB,mBAAsBoC,EAAO,GAEhDE,EAAO9qB,KAAKrJ,KACZo0B,EAAax5B,KAAKoL,IAAIqD,KAAKuC,SAAUhR,KAAKmL,IAAI,IAAKnL,KAAKiW,MAAMxH,KAAK0D,cAGrEsnB,GAAmB,EACAz5B,KAAKoN,MAAMqB,KAAKorC,MAAM,GAAKprC,KAAK+C,IAAI,GAAI/C,KAAKorC,MAAM,GAAKprC,KAAK+C,IAAI,IACrE+nB,EAAO9qB,KAAKwoB,kBAAoB,MAG/CwC,EAAkBhrB,KAAKmsC,iBAAiBnsC,KAAKorC,MAAM,GAAIprC,KAAKorC,MAAM,GAAIrgB,IAQ1E,IAJA,IAAIqhB,EAAQpsC,KAAK+C,IAAI,GACjBspC,EAAQrsC,KAAK+C,IAAI,GACjBqoB,EAAYprB,KAAKmsC,iBAAiBnsC,KAAK+C,IAAI,GAAI/C,KAAK+C,IAAI,GAAIgoB,GAEvDM,EAAI,EAAGA,EAAIT,EAAMS,IACtB,IAAK,IAAI14B,EAAI,EAAGA,EAAIi4B,EAAMj4B,IAAK,CAC3B,IAAM24B,GAAM34B,EAAIk4B,GAAQnd,EAClB6d,GAAMF,EAAIR,GAAQnd,EAElBu+B,EAAMjsC,KAAK+C,IAAI,GAAKuoB,EAAKR,EACzBohB,EAAMlsC,KAAK+C,IAAI,GAAKwoB,EAAKT,EAEzBU,EAAQxrB,KAAKmsC,iBAAiBF,EAAKC,EAAKnhB,GAC1CS,EAAQJ,IACRA,EAAYI,EACZ4gB,EAAQH,EACRI,EAAQH,EAEhB,CAMJ,IAAMzgB,EAAuBl6B,KAAKmL,IAAsB,GAAlBsuB,EAAwB,KACzCA,EAAkB,GAAMI,EAAYJ,EAAmBS,KAGxEzrB,KAAKorC,MAAM,GAAKgB,EAChBpsC,KAAKorC,MAAM,GAAKiB,EAEhBrsC,KAAKqrC,QAAQl6C,EAAE0J,GAAKuxC,EACpBpsC,KAAKqrC,QAAQl6C,EAAE2J,GAAK,EACpBkF,KAAKqrC,QAAQh4C,EAAEwH,GAAKwxC,EACpBrsC,KAAKqrC,QAAQh4C,EAAEyH,GAAK,EAEpBkF,KAAKqoB,OAAO,GAAK+jB,EACjBpsC,KAAKqoB,OAAO,GAAKgkB,EACjBrsC,KAAKsoB,SAASn3B,EAAE0J,GAAKuxC,EACrBpsC,KAAKsoB,SAASn3B,EAAE2J,GAAK,EACrBkF,KAAKsoB,SAASj1B,EAAEwH,GAAKwxC,EACrBrsC,KAAKsoB,SAASj1B,EAAEyH,GAAK,EAG7B,GAAC,CAAAwD,IAAA,wBAAAvK,MAED,WACI,GAAKiM,KAAK2oB,WAAc3oB,KAAK0oB,SAA7B,CAQA,IANA,IAAM7xB,EAAKmJ,KAAKpN,EAAE,GACZkE,EAAKkJ,KAAKpN,EAAE,GAEd63B,EAAKzqB,KAAKorC,MAAM,GAChB1gB,EAAK1qB,KAAKorC,MAAM,GAEX74C,EAAI,EAAGA,EAAIyN,KAAKuC,SAAUhQ,IAAK,CACpC,IAAMm5B,EAAKtxB,EAAWqwB,GAChBkB,EAAKvxB,EAAWswB,GAEhBkB,EAAU,EAAJr5B,EACZyN,KAAK2oB,UAAUiD,GAAOF,EAAGrxB,KACzB2F,KAAK2oB,UAAUiD,EAAM,GAAKF,EAAGnxB,IAC7ByF,KAAK2oB,UAAUiD,EAAM,GAAKD,EAAGtxB,KAC7B2F,KAAK2oB,UAAUiD,EAAM,GAAKD,EAAGpxB,IAE7B,IACMowB,EAAM,EAAMF,EAAKC,EAAK5zB,EAG5B,IAFA2zB,EAFYA,EAAKA,EAAKC,EAAKA,EAAK7zB,GAIvB4zB,GAFCC,EAAKC,GAEID,EAAK,EAAK,CAGzB,IAFA,IAAM1N,EAAK5iB,EAAWqwB,GAChBxN,EAAK7iB,EAAWswB,GACb/Z,EAAIpe,EAAI,EAAGoe,EAAI3Q,KAAKuC,SAAUoO,IAAK,CACxC,IAAM0a,EAAQ,EAAJ1a,EACV3Q,KAAK2oB,UAAU0C,GAAKrO,EAAG3iB,KACvB2F,KAAK2oB,UAAU0C,EAAI,GAAKrO,EAAGziB,IAC3ByF,KAAK2oB,UAAU0C,EAAI,GAAKpO,EAAG5iB,KAC3B2F,KAAK2oB,UAAU0C,EAAI,GAAKpO,EAAG1iB,GAC/B,CACA,KACJ,CACJ,CAEAyF,KAAKC,GAAGmpB,cAAcppB,KAAKC,GAAGopB,UAC9BrpB,KAAKC,GAAGqpB,YAAYtpB,KAAKC,GAAGspB,WAAYvpB,KAAK0oB,UAE7C1oB,KAAKC,GAAG4rB,WACJ7rB,KAAKC,GAAGspB,WACR,EACAvpB,KAAKC,GAAG6rB,KACR9rB,KAAKuC,SACL,EACA,EACAvC,KAAKC,GAAG6rB,KACR9rB,KAAKC,GAAGyJ,MACR1J,KAAK2oB,WAGL3oB,KAAK+pB,aAAa/pB,KAAKC,GAAG+pB,UAAUhqB,KAAK+pB,YAAa,GACtD/pB,KAAKiqB,WAAWjqB,KAAKC,GAAGqK,UAAUtK,KAAKiqB,UAAWjqB,KAAKuC,SApDd,CAqDjD,GAEA,CAAAjE,IAAA,cAAAvK,MAIA,WAMI,QAFyBtD,IAArBuP,KAAKyoB,cAA2BzoB,KAAKyoB,aAAc,IAElDzoB,KAAKqoB,OAAQ,OAAO,EACzB,IAAKpxB,OAAO8C,SAASiG,KAAKrJ,MAAO,OAAO,EAExC,IAAM21B,EAAI/6B,KAAKmL,IAAIsD,KAAKrJ,KAAM,QAExB+N,EAAK1E,KAAK+C,IAAI,GAAK/C,KAAKqoB,OAAO,GAC/B1jB,EAAK3E,KAAK+C,IAAI,GAAK/C,KAAKqoB,OAAO,GAC/BikB,EAAY/6C,KAAKoN,MAAM+F,EAAIC,GAAM2nB,EAEvC,OAAKtsB,KAAKyoB,aAAe6jB,EAbN,IAcftsC,KAAKyoB,aAAc,GACZ,MAGPzoB,KAAKyoB,aAAe6jB,EAnBN,QAoBdtsC,KAAKyoB,aAAc,GACZ,EAIf,GAAC,CAAAnqB,IAAA,OAAAvK,MAED,WACIiM,KAAKC,GAAG4G,WAAW7G,KAAKoG,SASxB,IAAM8Q,EAAY3lB,KAAKiW,MAAM,IAAOjW,KAAKC,IAAI,GAAID,KAAK4lB,KAAKnX,KAAKrJ,QAChEqJ,KAAK0D,WAAanS,KAAKoL,IAAI,IAAMua,EAAYlX,KAAK2D,iBAGlD,IAAM4oC,GACFt1C,OAAO8C,SAASiG,KAAKsrC,aAAcr0C,OAAO8C,SAASiG,KAAKurC,YACjDh6C,KAAKmN,IAAIsB,KAAK+C,IAAI,GAAK/C,KAAKsrC,WAAa/5C,KAAKmN,IAAIsB,KAAK+C,IAAI,GAAK/C,KAAKurC,WAA2B,KAAZvrC,KAAKrJ,KAG9F61C,GACFv1C,OAAO8C,SAASiG,KAAKwrC,YACfj6C,KAAKmN,IAAIsB,KAAKrJ,KAAOqJ,KAAKwrC,WAA0B,KAAZxrC,KAAKrJ,KAGjD81C,GACFx1C,OAAO8C,SAASiG,KAAKyrC,WAAYx0C,OAAO8C,SAASiG,KAAK0rC,UAC/Cn6C,KAAKmN,IAAIsB,KAAKpN,EAAE,GAAKoN,KAAKyrC,SAAWl6C,KAAKmN,IAAIsB,KAAKpN,EAAE,GAAKoN,KAAK0rC,SAAY,GAGlFa,GAAYC,GAAeC,KAC3BzsC,KAAKooB,YAAa,EAClBpoB,KAAKsrC,UAAYtrC,KAAK+C,IAAI,GAC1B/C,KAAKurC,UAAYvrC,KAAK+C,IAAI,GAC1B/C,KAAKwrC,UAAYxrC,KAAKrJ,KACtBqJ,KAAKyrC,QAAUzrC,KAAKpN,EAAE,GACtBoN,KAAK0rC,QAAU1rC,KAAKpN,EAAE,IAO1B,IAAMq5B,EAAgBwgB,GAAYzsC,KAAKksB,cACjCwgB,EAA0B1sC,KAAK8rC,kBAAoB9rC,KAAKwD,kBACxD2oB,GAAgBugB,GAA2BzgB,EAE7CjsB,KAAKooB,YAAc+D,IAEnBnsB,KAAKosB,4BAA4BsgB,GACjC1sC,KAAKqsB,wBACLrsB,KAAKooB,YAAa,GAKtB,IAAMukB,EAAWlxC,EAAQuE,KAAKgD,MAAM7R,EAAG6O,KAAKqrC,QAAQl6C,GAC9Cy7C,EAAWnxC,EAAQuE,KAAKgD,MAAM3P,EAAG2M,KAAKqrC,QAAQh4C,GAGhD2M,KAAK+rC,aAAa/rC,KAAKC,GAAG0H,UAAU3H,KAAK+rC,YAAaY,EAAS9xC,GAAI+xC,EAAS/xC,IAC5EmF,KAAKgsC,aAAahsC,KAAKC,GAAG0H,UAAU3H,KAAKgsC,YAAaW,EAAS7xC,GAAI8xC,EAAS9xC,IAGhF,IAAMwxB,EAAIlyB,EAAW4F,KAAKrJ,MACtBqJ,KAAKoqB,UAAUpqB,KAAKC,GAAGqK,UAAUtK,KAAKoqB,SAAUkC,EAAEjyB,MAClD2F,KAAKqqB,UAAUrqB,KAAKC,GAAGqK,UAAUtK,KAAKqqB,SAAUiC,EAAE/xB,KAElDyF,KAAKgX,MAAMhX,KAAKC,GAAGoK,WAAWrK,KAAKgX,KAAMhX,KAAKpN,GAC9CoN,KAAKiX,eAAejX,KAAKC,GAAGsK,WAAWvK,KAAKiX,cAAejX,KAAK6W,YAEpEP,GAAA2L,EAAA,cAAA3L,CAAA,GACJ,GAEA,CAAAhY,IAAA,QAAAvK,MAIA,WACIiM,KAAKpN,EAACsC,GAAO8K,KAAKyW,WAGlBzW,KAAKoP,oBAAsBpP,KAAK4rC,sBAChC,IAAMiB,EAAe7sC,KAAKiP,SAASjP,KAAKoP,sBAAwBvd,EAChEmO,KAAK6W,WAAa,IAAI1N,aAAa0jC,EAAal2B,OAGhD,IAAM1kB,EAAW46C,EAAa56C,SAAW2K,EAASiwC,EAAa56C,UAAY,KAC3E+N,KAAK+D,aAAe9R,EACd,CAACA,EAASI,EAAGJ,EAASqK,EAAGrK,EAAS+I,GAClC,CAAC6xC,EAAal2B,MAAM,GAAIk2B,EAAal2B,MAAM,IAAKk2B,EAAal2B,MAAM,KAEzE3W,KAAKooB,YAAa,EAClBpoB,KAAKsrC,UAAYzxC,IACjBmG,KAAKurC,UAAY1xC,IACjBmG,KAAKwrC,UAAY3xC,IACjBmG,KAAKyrC,QAAU5xC,IACfmG,KAAK0rC,QAAU7xC,IAEfyc,GAAA2L,EAAA,eAAA3L,CAAA,GACJ,GAIA,CAAAhY,IAAA,wBAAAvK,MACA,WAGwC,OAAhCiM,KAAK8W,yBACLtK,qBAAqBxM,KAAK8W,wBAC1B9W,KAAK8W,uBAAyB,MAI9B9W,KAAK8rC,mBACL9rC,KAAK8rC,kBAAmB,EACxB9rC,KAAK8F,iBAEb,GAEA,CAAAxH,IAAA,4BAAAvK,MAIA,WACIiM,KAAK8sC,wBAELx2B,GAAA2L,EAAA,mCAAA3L,CAAA,GACJ,GAEA,CAAAhY,IAAA,8BAAAvK,OAAAg5C,EAAA/rC,GAAA1M,KAAAE,EAUA,SAAAyK,EAAkC+tC,GAAS,IAAA5/B,EAAA6/B,EAAAC,EAAA1nC,EAAA,KAAAgI,EAAAjd,UAAA,OAAA+D,KAAAC,EAAA,SAAA4K,GAAA,cAAAA,EAAA5M,GAAA,OAKO,OALL6a,EAAQI,EAAAhd,OAAA,QAAAC,IAAA+c,EAAA,GAAAA,EAAA,GAAG,IAAKy/B,EAAQz/B,EAAAhd,OAAA,QAAAC,IAAA+c,EAAA,GAAAA,EAAA,GAAG,KAEpExN,KAAKkG,6BAGCgnC,EAAa/3C,MAAMI,KAAKyK,KAAK6W,YAAW1X,EAAA5M,EAAA,EAExC,IAAIwC,QAAQ,SAACC,GAEfwQ,EAAKnC,uBAAyBrO,EAC9B,IAAIyY,EAAY,KAEVC,EAAO,SAACC,GACLF,IAAWA,EAAYE,GAC5B,IAMI1b,EANE2b,EAAWrc,KAAKoL,KAAKgR,EAAYF,GAAaL,EAAU,GAGxD+/B,EAAeD,EAAWjwC,IAAI,SAAC1J,EAAGZ,GAAC,OAAK4K,EAAKhK,EAAGy5C,EAAUr2B,MAAMhkB,GAAIib,EAAS,GACnFpI,EAAKqR,WAAa,IAAI1N,aAAagkC,GAI/BH,EAAU/6C,WACVA,EAAW2K,EAASowC,EAAU/6C,aAChBuT,EAAKzB,aAAe,CAAC9R,EAASI,EAAGJ,EAASqK,EAAGrK,EAAS+I,IAGnE/I,IAEDuT,EAAKzB,aAAe,CACiB,IAAjCipC,EAAUr2B,MAAMS,GACqB,IAArC41B,EAAUr2B,MAAMS,IACqB,IAArC41B,EAAUr2B,MAAMS,MAIxB5R,EAAKO,OAEDknC,GAAUA,IAEVr/B,EAAW,EACXpI,EAAKpC,2BAA6ByK,sBAAsBH,IAExDlI,EAAKnC,uBAAyB,KAC9BmC,EAAKU,6BAELlR,IAER,EAEAwQ,EAAKpC,2BAA6ByK,sBAAsBH,EAC5D,GAAE,cAAAvO,EAAA3L,EAAA,KAAAyL,EAAA,SACL,SApDgCF,GAAA,OAAAguC,EAAAnuC,MAAC,KAADrO,UAAA,IAsDjC,CAAA+N,IAAA,gCAAAvK,OAAAmZ,EAAAlM,GAAA1M,KAAAE,EACA,SAAAuZ,IAAA,IAAAX,EAAAC,EAAAe,EAAA7d,UAAA,OAAA+D,KAAAC,EAAA,SAAA8Z,GAAA,cAAAA,EAAA9b,GAAA,OAA2E,GAAvC6a,EAAQgB,EAAA5d,OAAA,QAAAC,IAAA2d,EAAA,GAAAA,EAAA,GAAG,IAAKf,EAAgBe,EAAA5d,OAAA,QAAAC,IAAA2d,EAAA,GAAAA,EAAA,GAAG,KACtC,IAAzBpO,KAAKiP,SAASze,OAAY,CAAA6d,EAAA9b,EAAA,eAAA8b,EAAA7a,EAAA,EAAA8iB,GAAA2L,EAAA,uCAAA3L,CAAA,CAEiBlJ,EAAUC,KAAgB,OAEQ,OAAjFrN,KAAKoP,qBAAuBpP,KAAKoP,oBAAsB,GAAKpP,KAAKiP,SAASze,OAAO6d,EAAA9b,EAAA,EAC3EyN,KAAKotC,4BAA4BptC,KAAKiP,SAASjP,KAAKoP,qBAAsBhC,EAAUC,GAAiB,cAAAgB,EAAA7a,EAAA,KAAAua,EAAA,SAC9G,WAPkC,OAAAb,EAAAtO,MAAC,KAADrO,UAAA,IASnC,CAAA+N,IAAA,sBAAAvK,OAAAw4B,EAAAvrB,GAAA1M,KAAAE,EAOA,SAAA+a,EAA0B7I,GAAK,IAAA0G,EAAAC,EAAAyhB,EAAAv+B,UAAA,OAAA+D,KAAAC,EAAA,SAAAib,GAAA,cAAAA,EAAAjd,GAAA,OAAyC,GAAvC6a,EAAQ0hB,EAAAt+B,OAAA,QAAAC,IAAAq+B,EAAA,GAAAA,EAAA,GAAG,IAAKzhB,EAAgByhB,EAAAt+B,OAAA,QAAAC,IAAAq+B,EAAA,GAAAA,EAAA,GAAG,OACnC,IAAzB9uB,KAAKiP,SAASze,QAAgBkW,EAAQ,GAAKA,GAAS1G,KAAKiP,SAASze,QAAM,CAAAgf,EAAAjd,EAAA,eAAAid,EAAAhc,EAAA,UAG3C,OAAjCwM,KAAKoP,oBAAsB1I,EAAM8I,EAAAjd,EAAA,EAC3ByN,KAAKotC,4BAA4BptC,KAAKiP,SAASvI,GAAQ0G,EAAUC,GAAiB,cAAAmC,EAAAhc,EAAA,KAAA+b,EAAA,SAC3F,SANwBU,GAAA,OAAAsc,EAAA3tB,MAAC,KAADrO,UAAA,IAQzB,CAAA+N,IAAA,6BAAAvK,OAAA+Z,EAAA9M,GAAA1M,KAAAE,EACA,SAAAga,IAAA,IAAApB,EAAAC,EAAAE,EAAA,KAAAwB,EAAAxe,UAAA,OAAA+D,KAAAC,EAAA,SAAAya,GAAA,cAAAA,EAAAzc,GAAA,OAA0E,OAAzC6a,EAAQ2B,EAAAve,OAAA,QAAAC,IAAAse,EAAA,GAAAA,EAAA,GAAG,KAAO1B,EAAgB0B,EAAAve,OAAA,QAAAC,IAAAse,EAAA,GAAAA,EAAA,GAAG,KAAIC,EAAAzc,EAAA,EAChE,IAAIwC,QAAQ,WACdwY,EAAKkf,8BAA8Brf,EAAUC,EACjD,GAAE,cAAA2B,EAAAxb,EAAA,KAAAgb,EAAA,IACL,WAJ+B,OAAAV,EAAAlP,MAAC,KAADrO,UAAA,IAMhC,CAAA+N,IAAA,aAAAvK,OAAAs5C,EAAArsC,GAAA1M,KAAAE,EAQA,SAAAmb,IAAA,IAAA29B,EAAAlgC,EAAAkD,EAAAgzB,EAAAn1B,EAAA,KAAA0B,EAAAtf,UAAA,OAAA+D,KAAAC,EAAA,SAAAub,GAAA,cAAAA,EAAAvd,GAAA,OAEiC,GAFhB+6C,EAAOz9B,EAAArf,OAAA,QAAAC,IAAAof,EAAA,GAAAA,EAAA,GAAA3a,GAAO8K,KAAKyW,WAAYrJ,EAAQyC,EAAArf,OAAA,QAAAC,IAAAof,EAAA,GAAAA,EAAA,GAAG,IAAKS,EAAYT,EAAArf,OAAA,QAAAC,IAAAof,EAAA,GAAAA,EAAA,GAAG5e,EAAUQ,MAErFuO,KAAK8sC,yBAEDhxC,EAAekE,KAAKpN,EAAG06C,GAAU,CAAFx9B,EAAAvd,EAAA,QAEZ,OAAAud,EAAAtc,EAAA,UAOO,OADxB8vC,EAAMpuC,GAAO8K,KAAKpN,GACxBoN,KAAK8rC,kBAAmB,EAAMh8B,EAAAvd,EAAA,EAExB,IAAIwC,QAAQ,SAACC,GACf,IAAIyY,EAAY,KAEVC,EAAO,SAACC,GACLF,IAAWA,EAAYE,GAC5B,IAAMC,EAAWrc,KAAKoL,KAAKgR,EAAYF,GAAaL,EAAU,GAGxDmgC,EAAgBj9B,EAAa1C,GACnCO,EAAKvb,EAAE,GAAK2K,EAAK+lC,EAAO,GAAIgK,EAAQ,GAAIC,GACxCp/B,EAAKvb,EAAE,GAAK2K,EAAK+lC,EAAO,GAAIgK,EAAQ,GAAIC,GAExCp/B,EAAKpI,OAELC,IAAW,GACXkrB,KAEItjB,EAAW,EACXO,EAAK2I,uBAAyBjJ,sBAAsBH,IAEpDS,EAAK29B,kBAAmB,EAExB39B,EAAKrI,iBACLqI,EAAKpI,OAELoI,EAAK2+B,wBACL3+B,EAAK2C,sBAEL9b,IAER,EACAmZ,EAAK2I,uBAAyBjJ,sBAAsBH,EACxD,GAAE,cAAAoC,EAAAtc,EAAA,KAAAmc,EAAA,SACL,WAhDe,OAAA09B,EAAAzuC,MAAC,KAADrO,UAAA,IAkDhB,CAAA+N,IAAA,oBAAAvK,OAAAy5C,EAAAxsC,GAAA1M,KAAAE,EASA,SAAA4b,EAAwBnL,GAAU,IAAAqoC,EAAAlgC,EAAAkD,EAAAG,EAAAlgB,UAAA,OAAA+D,KAAAC,EAAA,SAAAmc,GAAA,cAAAA,EAAAne,GAAA,OAED,OAFG+6C,EAAO78B,EAAAjgB,OAAA,QAAAC,IAAAggB,EAAA,GAAAA,EAAA,GAAAvb,GAAO8K,KAAKyW,WAAYrJ,EAAQqD,EAAAjgB,OAAA,QAAAC,IAAAggB,EAAA,GAAAA,EAAA,GAAG,IAAKH,EAAYG,EAAAjgB,OAAA,QAAAC,IAAAggB,EAAA,GAAAA,EAAA,GAAGxf,EAAUQ,MAExGuO,KAAK8sC,wBAAwBp8B,EAAAne,EAAA,EAEvBwC,QAAQqf,IAAI,CACdpU,KAAK2T,cAAc1O,EAAYmI,EAAUkD,GACzCtQ,KAAKgoB,WAAWslB,EAASlgC,EAAUkD,KACrC,OACiB,cAAAI,EAAAld,EAAA,KAAA4c,EAAA,SACtB,SATsBF,GAAA,OAAAs9B,EAAA5uC,MAAC,KAADrO,UAAA,IAWvB,CAAA+N,IAAA,wBAAAvK,OAAAo5B,EAAAnsB,GAAA1M,KAAAE,EAQA,SAAAyc,EAA4BxK,GAAM,IAAA4mB,EAAAD,EAAAhgB,EAAAC,EAAAogC,EAAAnK,EAAA/yB,EAAAsB,EAAAkB,EAAAm6B,EAAAI,EAAAj9B,EAAApL,EAAA6N,EAAA46B,EAAA99B,EAAA+9B,EAAAC,EAAA9+B,EAAA,KAAAsC,EAAA7gB,UAAA,OAAA+D,KAAAC,EAAA,SAAA8c,GAAA,cAAAA,EAAA9e,GAAA,OAO9B,OAPgC6a,EAAQgE,EAAA5gB,OAAA,QAAAC,IAAA2gB,EAAA,GAAAA,EAAA,GAAG,IAAK/D,EAAgB+D,EAAA5gB,OAAA,QAAAC,IAAA2gB,EAAA,GAAAA,EAAA,GAAG,KAEnEpR,KAAKiG,4BACLjG,KAAKkG,6BAECunC,EAAoBrgC,GAAwB,QAAhBigB,EAAI5mB,EAAOsoB,aAAK,IAAA1B,EAAAA,EAAI,GAEtDhc,EAAA9e,EAAA,EACMyN,KAAKivB,oBAAoBjvB,KAAK0C,YAAa1C,KAAKyC,aAAc,KAAK,OA+BnD,OA3BhB6gC,EAAMpuC,GAAO8K,KAAKpN,GAClB2d,EAAQrb,GAAO8K,KAAK+C,KACpB8O,EAAY7R,KAAKrJ,KACjBoc,EAAgB/S,KAAKpJ,SACrBs2C,EAAa/3C,MAAMI,KAAKyK,KAAK6W,YAG7By2B,EAAU7mC,EAAO7T,GAAKoN,KAAKyW,UAC3BpG,EAAY5J,EAAO1D,KAAO/C,KAAK0C,YAC/BuC,EAAawB,EAAO9P,MAAQqJ,KAAKyC,aACjCqQ,EAAgC,QAAlBsa,EAAG3mB,EAAO7P,gBAAQ,IAAAw2B,EAAAA,EAAI,EAGtCsgB,EAAgB,KAChBjnC,EAAO1P,YACD6Y,EAAe5P,KAAKiP,SAASc,UAAU,SAAA3c,GAAC,OAAIA,EAAE4c,KAAOvJ,EAAO1P,SAAS,KACvD,IAChB22C,EAAgB1tC,KAAKiP,SAASW,GAC9B5P,KAAKoP,oBAAsBQ,GAK7B+9B,EAAep8C,KAAKmL,IAAI0Q,EAAUqgC,GAClCG,EAAW38C,EAAUQ,MAE3BuO,KAAK8rC,kBAAmB,EACxB9rC,KAAK8F,iBAAiBuL,EAAA9e,EAAA,EAEhB,IAAIwC,QAAQ,SAACC,GACf,IAAIyY,EAAY,KAEVC,EAAO,SAACC,GACLF,IAAWA,EAAYE,GAC5B,IAAMvb,EAAIb,KAAKoL,KAAKgR,EAAYF,GAAakgC,EAAc,GACrDh9B,EAAIi9B,EAASx7C,GAmBnB,GAhBA0c,EAAKlc,EAAE,GAAK2K,EAAK+lC,EAAO,GAAIgK,EAAQ,GAAI38B,GACxC7B,EAAKlc,EAAE,GAAK2K,EAAK+lC,EAAO,GAAIgK,EAAQ,GAAI38B,GAGxC7B,EAAK9J,OACDzH,EAAKgT,EAAS,GAAIF,EAAU,GAAIM,GAChCpT,EAAKgT,EAAS,GAAIF,EAAU,GAAIM,IAIpC7B,EAAKnY,KAAOkb,EAAYtgB,KAAKC,IAAIyT,EAAa4M,EAAWlB,GAGzD7B,EAAKlY,SAAW2G,EAAKwV,EAAeD,EAAgBnC,GAGhD+8B,EAAe,CACf,IAAMG,EAAoBX,EAAWjwC,IAAI,SAAC1J,EAAGZ,GAAC,OAC1C4K,EAAKhK,EAAGm6C,EAAc/2B,MAAMhkB,GAAIge,EAAE,GAKtC,GAHA7B,EAAK+H,WAAa,IAAI1N,aAAa0kC,GAG/BH,EAAcz7C,SAAU,CACxB,IAAMA,EAAW2K,EAAS8wC,EAAcz7C,UACpCA,IACA6c,EAAK/K,aAAe,CAAC9R,EAASI,EAAGJ,EAASqK,EAAGrK,EAAS+I,GAE9D,CACJ,CAGA8T,EAAK/I,OACLC,IAAW,GACXkrB,KAEI7jB,GACAA,IAGAjb,EAAI,EACJ0c,EAAKgI,uBAAyBjJ,sBAAsBH,IAGpDoB,EAAKg9B,kBAAmB,EACxBh9B,EAAKhJ,iBACLgJ,EAAK/I,OACL+I,EAAKvL,mBAAqBkD,EAAOC,MAEjC1R,IAER,EAEA8Z,EAAKgI,uBAAyBjJ,sBAAsBH,EACxD,GAAE,cAAA2D,EAAA7d,EAAA,KAAAyd,EAAA,SACL,SAzG0BF,GAAA,OAAAoc,EAAAvuB,MAAC,KAADrO,UAAA,IA2G3B,CAAA+N,IAAA,cAAAvK,OAAA+5C,EAAA9sC,GAAA1M,KAAAE,EAKA,SAAAkd,EAAkByxB,GAAI,IAAA3yB,EAAA,YAAAlc,KAAAC,EAAA,SAAA4d,GAAA,cAAAA,EAAA5f,GAAA,OASlB,OAPAyN,KAAK8sC,wBAOL36B,EAAA5f,EAAA,EACM,IAAIwC,QAAQ,WAEdouC,EAAK4K,SAAL5K,EAAK4K,OAAW,CAAC,EAAG,EAAG,EAAG,IAC1B,IAAI9kB,EAAQka,EAAK4K,OAAO,GAElBC,EAAW,WACb,IAAMtgC,EAAOy1B,EAAKz1B,KAEJ,IAAVub,GACAzY,EAAK5d,EAAE,IAAMuwC,EAAKC,YAAc11B,GAC3By1B,EAAKC,YAAc,GAAK5yB,EAAK5d,EAAE,IAAMuwC,EAAKE,KAAK,IAAQF,EAAKC,YAAc,GAAK5yB,EAAK5d,EAAE,IAAMuwC,EAAKE,KAAK,MACvG7yB,EAAK5d,EAAE,GAAKuwC,EAAKE,KAAK,GACtBpa,EAAQ,IAIG,IAAVA,GACLzY,EAAK5d,EAAE,IAAMuwC,EAAKI,YAAc71B,GAC3By1B,EAAKI,YAAc,GAAK/yB,EAAK5d,EAAE,IAAMuwC,EAAKE,KAAK,IAAQF,EAAKI,YAAc,GAAK/yB,EAAK5d,EAAE,IAAMuwC,EAAKE,KAAK,MACvG7yB,EAAK5d,EAAE,GAAKuwC,EAAKE,KAAK,GACtBpa,EAAQ,IAIG,IAAVA,GACLzY,EAAK5d,EAAE,IAAMuwC,EAAKC,YAAc11B,GAC3By1B,EAAKC,YAAc,GAAK5yB,EAAK5d,EAAE,IAAMuwC,EAAKG,OAAO,IAAQH,EAAKC,YAAc,GAAK5yB,EAAK5d,EAAE,IAAMuwC,EAAKG,OAAO,MAC3G9yB,EAAK5d,EAAE,GAAKuwC,EAAKG,OAAO,GACxBra,EAAQ,IAIG,IAAVA,IACLzY,EAAK5d,EAAE,IAAMuwC,EAAKI,YAAc71B,GAC3By1B,EAAKI,YAAc,GAAK/yB,EAAK5d,EAAE,IAAMuwC,EAAKG,OAAO,IAAQH,EAAKI,YAAc,GAAK/yB,EAAK5d,EAAE,IAAMuwC,EAAKG,OAAO,MAC3G9yB,EAAK5d,EAAE,GAAKuwC,EAAKG,OAAO,GACxBra,EAAQ,IAIhBzY,EAAKzK,OACLC,IAAW,GACXkrB,KAEA1gB,EAAKsG,uBAAyBjJ,sBAAsBmgC,EACxD,EACAx9B,EAAKsG,uBAAyBjJ,sBAAsBmgC,EACxD,GAAE,cAAA77B,EAAA3e,EAAA,KAAAke,EAAA,SACL,SA1DgBF,GAAA,OAAAs8B,EAAAlvC,MAAC,KAADrO,UAAA,IA4DjB,CAAA+N,IAAA,oBAAAvK,OAAAk6C,EAAAjtC,GAAA1M,KAAAE,EAIA,SAAA+d,IAAA,IAAApB,EAAA,YAAA7c,KAAAC,EAAA,SAAAme,GAAA,cAAAA,EAAAngB,GAAA,OAOI,OALAyN,KAAKiG,4BAELjG,KAAKsD,YAAa,EAGlBoP,EAAAngB,EAAA,EACM,IAAIwC,QAAQ,WACd,IAAM2Y,EAAO,WACTyD,EAAKve,EAAI,EACHrB,KAAK2a,IAAIiF,EAAK4F,UAAY,GAAK,EAAK,IAAM,GAC1CxlB,KAAKya,IAAImF,EAAK4F,UAAY,GAAK,EAAK,IAAM,IAEhD5F,EAAKva,SAAWgH,EAAkBuT,EAAKva,SAAW,MAClDua,EAAK4F,UAAY,KAEjB5F,EAAKpL,OACLC,IAAW,GACXkrB,KAEA/f,EAAK2F,uBAAyBjJ,sBAAsBH,EACxD,EACAyD,EAAK2F,uBAAyBjJ,sBAAsBH,EACxD,GAAE,cAAAgF,EAAAlf,EAAA,KAAA+e,EAAA,SACL,WAzBsB,OAAA07B,EAAArvC,MAAC,KAADrO,UAAA,IA4BvB,CAAA+N,IAAA,cAAAvK,OAAAo7B,EAAAnuB,GAAA1M,KAAAE,EAQA,SAAAqe,IAAA,IAAA8Z,EAAAtf,EAAA+hB,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAxc,EAAA1iB,UAAA,OAAA+D,KAAAC,EAAA,SAAA2e,GAAA,cAAAA,EAAA3gB,GAAA,OAKuD,GALrCo6B,IAAM1Z,EAAAziB,OAAA,QAAAC,IAAAwiB,EAAA,KAAAA,EAAA,GAAS5F,EAAgB4F,EAAAziB,OAAA,QAAAC,IAAAwiB,EAAA,GAAAA,EAAA,GAAG,KAAMmc,EAAgBnc,EAAAziB,OAAA,QAAAC,IAAAwiB,EAAA,GAAAA,EAAA,GAAG,KAAMoc,EAAWpc,EAAAziB,OAAA,QAAAC,IAAAwiB,EAAA,GAAAA,EAAA,GAAG,GAE7FjT,KAAKiG,6BAGCqpB,EAAa,GAAH5+B,OAAAwE,GAAO8K,KAAK8C,SAAO5N,GAAKm6B,KAExB7+B,OAAQ,CAAF0iB,EAAA3gB,EAAA,QAEC,OAAA2gB,EAAA1f,EAAA,UAKvBwM,KAAKsD,YAAa,EAGdisB,EAAY,EACVC,EAAqB,SAAC7C,GACxB,GAAI2C,EAAW9+B,QAAU,EACrB,OAAO,EAGX,GAAIm8B,EAAQ,CAER,IAAIjmB,EACJ,GACIA,EAAQnV,KAAKiW,MAAMjW,KAAKo7B,SAAW2C,EAAW9+B,cACzCkW,IAAU6oB,GAAaD,EAAW9+B,OAAS,GACpD,OAAOkW,CACX,CAEI,OAAQ6oB,EAAY,GAAKD,EAAW9+B,MAE5C,EAEA,WACOwP,KAAKsD,WAAY,CAAF4P,EAAA3gB,EAAA,QAEyB,GAD3Cg9B,EAAYC,EAAmB7C,GACzB8C,EAAgBH,EAAWC,GAEb,CAAFrc,EAAA3gB,EAAA,QACiD,OAAA2gB,EAAA1f,EAAA,YAIyB,OAAA0f,EAAA3gB,EAAA,EAEtFyN,KAAK0vB,sBAAsBD,EAAe,IAAMpiB,GAAiB,OAKtE,OAFG+hB,GACAA,IACHlc,EAAA3gB,EAAA,EAEKuM,GAAW,KAAI,OAAAoU,EAAA3gB,EAAA,eAIN,cAAA2gB,EAAA1f,EAAA,KAAAqf,EAAA,SACtB,WA5DgB,OAAAsc,EAAAvwB,MAAC,KAADrO,UAAA,KAl4BrB8B,GAAA4O,GAAA9O,EAAAU,UAAAR,GAAAD,GAAA6O,GAAA9O,EAAAC,GAAAY,OAAAyB,eAAAtC,EAAA,aAAA0C,UAAA,IAAA1C,EAAA,IAAAA,EAAAE,EAAAD,EA03BI+8B,EAhCA8e,EAjEAH,EAnHA3gB,EApBAqgB,EA1DAH,EAPAv/B,EAfAye,EAVArf,EAhEA6/B,CAwcA,CA95BsB,CAAS3qC,I,cClCnC,IAAAjQ,EAAAC,EAAAC,EAAA,mBAAAC,OAAAA,OAAA,GAAAC,EAAAF,EAAAG,UAAA,aAAAC,EAAAJ,EAAAK,aAAA,yBAAAC,EAAAN,EAAAE,EAAAE,EAAAE,GAAA,IAAAC,EAAAL,GAAAA,EAAAM,qBAAAC,EAAAP,EAAAO,EAAAC,EAAAC,OAAAC,OAAAL,EAAAC,WAAA,OAAAK,GAAAH,EAAA,mBAAAV,EAAAE,EAAAE,GAAA,IAAAE,EAAAC,EAAAG,EAAAI,EAAA,EAAAC,EAAAX,GAAA,GAAAY,GAAA,EAAAC,EAAA,CAAAF,EAAA,EAAAb,EAAA,EAAAgB,EAAApB,EAAAqB,EAAAC,EAAAN,EAAAM,EAAAC,KAAAvB,EAAA,GAAAsB,EAAA,SAAArB,EAAAC,GAAA,OAAAM,EAAAP,EAAAQ,EAAA,EAAAG,EAAAZ,EAAAmB,EAAAf,EAAAF,EAAAmB,CAAA,YAAAC,EAAApB,EAAAE,GAAA,IAAAK,EAAAP,EAAAU,EAAAR,EAAAH,EAAA,GAAAiB,GAAAF,IAAAV,GAAAL,EAAAgB,EAAA5C,OAAA4B,IAAA,KAAAK,EAAAE,EAAAS,EAAAhB,GAAAqB,EAAAH,EAAAF,EAAAO,EAAAhB,EAAA,GAAAN,EAAA,GAAAI,EAAAkB,IAAApB,KAAAQ,EAAAJ,GAAAC,EAAAD,EAAA,OAAAC,EAAA,MAAAD,EAAA,GAAAA,EAAA,GAAAR,GAAAQ,EAAA,IAAAc,KAAAhB,EAAAJ,EAAA,GAAAoB,EAAAd,EAAA,KAAAC,EAAA,EAAAU,EAAAC,EAAAhB,EAAAe,EAAAf,EAAAI,EAAA,IAAAc,EAAAE,IAAAlB,EAAAJ,EAAA,GAAAM,EAAA,GAAAJ,GAAAA,EAAAoB,KAAAhB,EAAA,GAAAN,EAAAM,EAAA,GAAAJ,EAAAe,EAAAf,EAAAoB,EAAAf,EAAA,OAAAH,GAAAJ,EAAA,SAAAmB,EAAA,MAAAH,GAAA,EAAAd,CAAA,iBAAAE,EAAAW,EAAAO,GAAA,GAAAR,EAAA,QAAAS,UAAA,oCAAAP,GAAA,IAAAD,GAAAK,EAAAL,EAAAO,GAAAf,EAAAQ,EAAAL,EAAAY,GAAAvB,EAAAQ,EAAA,EAAAT,EAAAY,KAAAM,GAAA,CAAAV,IAAAC,EAAAA,EAAA,GAAAA,EAAA,IAAAU,EAAAf,GAAA,GAAAkB,EAAAb,EAAAG,IAAAO,EAAAf,EAAAQ,EAAAO,EAAAC,EAAAR,GAAA,OAAAI,EAAA,EAAAR,EAAA,IAAAC,IAAAH,EAAA,QAAAL,EAAAO,EAAAF,GAAA,MAAAL,EAAAA,EAAAyB,KAAAlB,EAAAI,IAAA,MAAAa,UAAA,wCAAAxB,EAAA0B,KAAA,OAAA1B,EAAAW,EAAAX,EAAA2B,MAAAnB,EAAA,IAAAA,EAAA,YAAAA,IAAAR,EAAAO,EAAA,SAAAP,EAAAyB,KAAAlB,GAAAC,EAAA,IAAAG,EAAAa,UAAA,oCAAAnB,EAAA,YAAAG,EAAA,GAAAD,EAAAR,CAAA,UAAAC,GAAAiB,EAAAC,EAAAf,EAAA,GAAAQ,EAAAV,EAAAwB,KAAAtB,EAAAe,MAAAE,EAAA,YAAApB,GAAAO,EAAAR,EAAAS,EAAA,EAAAG,EAAAX,CAAA,SAAAe,EAAA,UAAAY,MAAA3B,EAAA0B,KAAAT,EAAA,GAAAhB,EAAAI,EAAAE,IAAA,GAAAI,CAAA,KAAAS,EAAA,YAAAV,IAAA,UAAAkB,IAAA,UAAAC,IAAA,CAAA7B,EAAAY,OAAAkB,eAAA,IAAAtB,EAAA,GAAAL,GAAAH,EAAAA,EAAA,GAAAG,QAAAW,GAAAd,EAAA,GAAAG,EAAA,yBAAAH,GAAAW,EAAAkB,EAAApB,UAAAC,EAAAD,UAAAG,OAAAC,OAAAL,GAAA,SAAAO,EAAAhB,GAAA,OAAAa,OAAAmB,eAAAnB,OAAAmB,eAAAhC,EAAA8B,IAAA9B,EAAAiC,UAAAH,EAAAf,GAAAf,EAAAM,EAAA,sBAAAN,EAAAU,UAAAG,OAAAC,OAAAF,GAAAZ,CAAA,QAAA6B,EAAAnB,UAAAoB,EAAAf,GAAAH,EAAA,cAAAkB,GAAAf,GAAAe,EAAA,cAAAD,GAAAA,EAAAK,YAAA,oBAAAnB,GAAAe,EAAAxB,EAAA,qBAAAS,GAAAH,GAAAG,GAAAH,EAAAN,EAAA,aAAAS,GAAAH,EAAAR,EAAA,yBAAAW,GAAAH,EAAA,oDAAAuB,GAAA,kBAAAC,EAAA5B,EAAA6B,EAAArB,EAAA,cAAAD,GAAAf,EAAAE,EAAAE,EAAAH,GAAA,IAAAO,EAAAK,OAAAyB,eAAA,IAAA9B,EAAA,gBAAAR,GAAAQ,EAAA,EAAAO,GAAA,SAAAf,EAAAE,EAAAE,EAAAH,GAAA,SAAAK,EAAAJ,EAAAE,GAAAW,GAAAf,EAAAE,EAAA,SAAAF,GAAA,YAAAuC,QAAArC,EAAAE,EAAAJ,EAAA,GAAAE,EAAAM,EAAAA,EAAAR,EAAAE,EAAA,CAAA0B,MAAAxB,EAAAoC,YAAAvC,EAAAwC,cAAAxC,EAAAyC,UAAAzC,IAAAD,EAAAE,GAAAE,GAAAE,EAAA,UAAAA,EAAA,WAAAA,EAAA,cAAAS,GAAAf,EAAAE,EAAAE,EAAAH,EAAA,UAAA0C,GAAAvC,EAAAH,EAAAD,EAAAE,EAAAI,EAAAe,EAAAZ,GAAA,QAAAD,EAAAJ,EAAAiB,GAAAZ,GAAAG,EAAAJ,EAAAoB,KAAA,OAAAxB,GAAA,YAAAJ,EAAAI,EAAA,CAAAI,EAAAmB,KAAA1B,EAAAW,GAAAgC,QAAAC,QAAAjC,GAAAkC,KAAA5C,EAAAI,EAAA,UAAAuO,GAAAzO,GAAA,sBAAAH,EAAA,KAAAD,EAAA5B,UAAA,WAAAwE,QAAA,SAAA1C,EAAAI,GAAA,IAAAe,EAAAjB,EAAAqM,MAAAxM,EAAAD,GAAA,SAAAkN,EAAA9M,GAAAuC,GAAAtB,EAAAnB,EAAAI,EAAA4M,EAAAC,EAAA,OAAA/M,EAAA,UAAA+M,EAAA/M,GAAAuC,GAAAtB,EAAAnB,EAAAI,EAAA4M,EAAAC,EAAA,QAAA/M,EAAA,CAAA8M,OAAA,MAgBA,SAGe6uC,KAAc,OAAAC,GAAAvvC,MAAC,KAADrO,UAAA,UAAA49C,KAwF5B,OAxF4BA,GAAAntC,GAAA1M,KAAAE,EAA7B,SAAAuZ,IAAA,IAAAjO,EAAA3I,EAAAi3C,EAAAC,EAAA5nC,EAAA6nC,EAAA91B,EAAA2N,EAAA,OAAA7xB,KAAAC,EAAA,SAAA8Z,GAAA,cAAAA,EAAA9b,GAAA,QAIUuN,EAASgN,SAASC,eAAe,kBAChC/F,MAAQnP,OAAOkgB,WACtBjY,EAAOmH,OAASpP,OAAOogB,YAEjB9gB,EAASa,IAITo2C,EAA2C,MAAbj3C,EAAOV,IAA2B,MAAbU,EAAOT,IAA6B,MAAfS,EAAOR,MAA4B,MAAZQ,EAAO9E,EACtGg8C,EAAyBD,GAA4C,MAAbj3C,EAAON,IAA2B,MAAbM,EAAOL,GACpF2P,EAAS,CACX1D,IAAK,CAAC5L,EAAOV,GAAIU,EAAOT,IACxBC,KAAMQ,EAAOR,KACb/D,EAAG,CAACuE,EAAON,GAAIM,EAAOL,IACtBF,SAAUO,EAAO9E,EACjB0E,UAAWI,EAAOJ,WAGhBu3C,EAAY,WAEd91B,EAAW/M,eACX3S,GACJ,EAACqtB,EAIOhvB,EAAOX,KAAI6X,EAAA9b,EAAA4zB,IAIVt1B,EAAaE,MAAK,EAAAo1B,IAQlBt1B,EAAaC,WAAU,EAAAq1B,IAQvBt1B,EAAaG,QAAO,iBAdkB,OAAvCwnB,EAAa,IAAIyJ,GAAcniB,GAAQuO,EAAA7a,EAAA,YAQK,OAA5CglB,EAAa,IAAI2P,GAAmBroB,GAAQuO,EAAA7a,EAAA,YAQH,OAAzCglB,EAAa,IAAImX,GAAgB7vB,GAAQuO,EAAA7a,EAAA,YAIa,OAAA6a,EAAA7a,EAAA,mBAAA6a,EAAA9b,EAAA,EAIxDuM,GAAW,KAAI,cAAAuP,EAAA9b,EAAA,EACf+3C,GAAO9xB,GAAW,WAEpB61B,EAAwB,CAAFhgC,EAAA9b,EAAA,QACkB,OAAA8b,EAAA9b,EAAA,EAClCimB,EAAWkX,sBAAsBjpB,EAAQ,KAAK,OAAA4H,EAAA9b,EAAA,oBAC7C67C,EAA6B,CAAF//B,EAAA9b,EAAA,SACM,OAAA8b,EAAA9b,EAAA,GAClCimB,EAAWkX,sBAAsBjpB,EAAQ,IAAK,IAAK,KAAK,QAAA4H,EAAA9b,EAAA,iBAE9D+7C,IAAY,eAAAjgC,EAAA9b,EAAA,GAGVuM,GAAW,KAAI,eAAAuP,EAAA9b,EAAA,GAEf,IAAIwC,QAAQ,SAAAC,GACd8X,SAASC,eAAe,mBAAmBC,UAAUmC,IAAI,SACzDrC,SAASC,eAAe,aAAaC,UAAUmC,IAAI,SACnDna,GACJ,GAAE,SAGEo5C,GAA+BC,KAC/B5d,KACAqP,MAGe,eAAAzxB,EAAA7a,EAAA,KAAAua,EAAA,IACtBogC,GAAAvvC,MAAA,KAAArO,UAAA,CDvEGghC,GAFStP,GAAa,4BAMY,GCqEtCnV,SAASpM,iBAAiB,mBAAkBM,GAAA1M,KAAAE,EAAE,SAAAyK,IAAA,OAAA3K,KAAAC,EAAA,SAAA4K,GAAA,cAAAA,EAAA5M,GAAA,OACmF,OAAA4M,EAAA5M,EAAA,EAEnH27C,KAAgB,OACoF,OAAA/uC,EAAA5M,EAAA,EAEpGuM,GAAW,KAAK,OACtBkH,KAAa,cAAA7G,EAAA3L,EAAA,KAAAyL,EAAA,IACd,CACCgrC,MAAM,G","sources":["webpack://fractal-traveler/./src/global/constants.js","webpack://fractal-traveler/./src/global/utils.js","webpack://fractal-traveler/./src/renderers/renderer.js","webpack://fractal-traveler/./src/renderers/fractalRenderer.js","webpack://fractal-traveler/./src/renderers/juliaPreviewRenderer.js","webpack://fractal-traveler/./src/ui/juliaPreview.js","webpack://fractal-traveler/./src/ui/mouseEventHandlers.js","webpack://fractal-traveler/./src/ui/touchEventHandlers.js","webpack://fractal-traveler/./src/ui/screenshotController.js","webpack://fractal-traveler/./src/ui/hotkeyController.js","webpack://fractal-traveler/./src/renderers/mandelbrotRenderer.js","webpack://fractal-traveler/./src/renderers/riemannRenderer.js","webpack://fractal-traveler/./src/ui/juliaSlidersController.js","webpack://fractal-traveler/./src/ui/debugPanel.js","webpack://fractal-traveler/./src/ui/ui.js","webpack://fractal-traveler/./src/global/utils.fractal.js","webpack://fractal-traveler/./src/renderers/juliaRenderer.js","webpack://fractal-traveler/./src/main.js"],"sourcesContent":["/**\r\n * @module Constants\r\n * @author Radim Brnka\r\n * @description Global constants used across the app.\r\n * @copyright Synaptory Fractal Traveler, 2025-2026\r\n * @license MIT\r\n */\r\n\r\nimport {easeInOut, easeInOutCubic, easeInOutQuint, hexToRGBArray} from \"./utils\";\r\n\r\n/**\r\n * App version shown in the UI. Should match the package.json version.\r\n * @type {string}\r\n */\r\nexport const VERSION = \"2.1\";\r\n\r\n// region > DEBUG CONSTANTS ////////////////////////////////////////////////////////////////////////////////////////////\r\n/**\r\n * DEBUG_LEVEL\r\n * @enum {number}\r\n */\r\nexport const DEBUG_LEVEL = {\r\n    NONE: 0,\r\n    VERBOSE: 1, /** Logs only */\r\n    FULL: 2\r\n}\r\n\r\n/**\r\n * DEBUG MODE - Injected by webpack DefinePlugin at build time.\r\n * Development builds: DEBUG_LEVEL.FULL\r\n * Production builds: DEBUG_LEVEL.NONE (debug code tree-shaken away)\r\n * @type {number}\r\n */\r\nexport const DEBUG_MODE = DEBUG_LEVEL[process.env.DEBUG_MODE] || DEBUG_LEVEL.NONE;\r\n\r\n/**\r\n *\r\n * @type {{LOG: string, INFO: string, WARN: string, ERROR: string}}\r\n */\r\nexport const LOG_LEVEL = {\r\n    LOG: 'log',\r\n    DEBUG: 'debug',\r\n    WARN: 'warn',\r\n    ERROR: 'error'\r\n}\r\n\r\n/**\r\n * Logs a message with an optional scope and severity level.\r\n * @param {string} message - The message to log.\r\n * @param {string} [scope=''] - The scope/context of the message.\r\n * @param {string} [severity=LOG_LEVEL.LOG] - The severity level from LOG_LEVEL.\r\n */\r\nexport const log = (message, scope = '', severity = LOG_LEVEL.LOG) => {\r\n    const formattedScope = scope ? `[${scope}]` : '';\r\n\r\n    console[severity](\r\n        `%c${formattedScope}%c ${message}`,\r\n        CONSOLE_GROUP_STYLE,\r\n        CONSOLE_MESSAGE_STYLE\r\n    );\r\n}\r\n// endregion\r\n// region > FEATURE FLAGS\r\n/** Allows switching between fractal while keeping the params to allow Mandelbrot and Julia to match each other */\r\nexport const FF_PERSISTENT_FRACTAL_SWITCHING = true;\r\n\r\n/**\r\n * Feature flag controlling the display of the persistent fractal switching button in the UI.\r\n * When enabled, users can see a button to toggle between fractal types while maintaining\r\n * the current parameters for seamless transitions between Mandelbrot and Julia sets.\r\n *\r\n * @type {boolean}\r\n * @since 1.9\r\n */\r\nexport const FF_PERSISTENT_FRACTAL_SWITCHING_BUTTON_DISPLAYED = true;\r\n\r\n/**\r\n * When set to true, demo animation will always start from the beginning rather than continue where it's been interrupted.\r\n * @type {boolean}\r\n */\r\nexport const FF_DEMO_ALWAYS_RESETS = false;\r\n\r\n/**\r\n * Feature flag for adaptive quality control.\r\n * When enabled, automatically adjusts iteration count based on GPU performance.\r\n * @type {boolean}\r\n */\r\nexport const FF_ADAPTIVE_QUALITY = true;\r\n\r\n/**\r\n * GPU time threshold in ms above which quality will be reduced.\r\n * @default 40 ms (~25 FPS).\r\n * @type {number}\r\n */\r\nexport const ADAPTIVE_QUALITY_THRESHOLD_HIGH = 1000 / 25;\r\n\r\n/**\r\n * GPU time threshold in ms below which quality will be restored\r\n * @default 16 ms (~60 FPS).\r\n * @type {number}\r\n */\r\nexport const ADAPTIVE_QUALITY_THRESHOLD_LOW = 1000 / 60;\r\n\r\n/**\r\n * Iteration adjustment step per quality change.\r\n * @type {number}\r\n */\r\nexport const ADAPTIVE_QUALITY_STEP = 50;\r\n\r\n/**\r\n * Minimum extraIterations offset (most aggressive quality reduction).\r\n * @default -1500 for optimal visual quality.\r\n * @type {number}\r\n */\r\nexport const ADAPTIVE_QUALITY_MIN = DEBUG_MODE === DEBUG_LEVEL.NONE ? -1500 : -3000;\r\n\r\n/**\r\n * Cooldown between quality adjustments in milliseconds.\r\n * @type {number}\r\n */\r\nexport const ADAPTIVE_QUALITY_COOLDOWN = 500;\r\n\r\n// endregion ///////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n/**\r\n * Application name\r\n * @type {string}\r\n */\r\nexport const APP_NAME = 'Synaptory Fractal Traveler';\r\n// ---------------------------------------------------------------------------------------------------------------------\r\n/**\r\n * Enum of fractal types\r\n * @enum {number}\r\n */\r\nexport const FRACTAL_TYPE = {\r\n    MANDELBROT: 0,\r\n    JULIA: 1,\r\n    RIEMANN: 2\r\n}\r\n// ---------------------------------------------------------------------------------------------------------------------\r\n/**\r\n * Ease in-out transition types matching functions in the Utils module\r\n * @enum {Function}\r\n */\r\nexport const EASE_TYPE = {\r\n    /** No easing (identity function) */\r\n    NONE: (x) => x,\r\n    /** Slow at the end */\r\n    QUAD: easeInOut,\r\n    /** Slower at the end */\r\n    CUBIC: easeInOutCubic,\r\n    /** Slowest at the end */\r\n    QUINT: easeInOutQuint\r\n}\r\n// ---------------------------------------------------------------------------------------------------------------------\r\n/**\r\n * Rotation directions\r\n * @enum {number}\r\n */\r\nexport const ROTATION_DIRECTION = {\r\n    /** Counter-clockwise */\r\n    CCW: -1,\r\n    /** Clockwise */\r\n    CW: 1\r\n}\r\n// ---------------------------------------------------------------------------------------------------------------------\r\n/**\r\n * Default main GUI color (Mandelbrot mode)\r\n * @type {string}\r\n */\r\nexport const DEFAULT_ACCENT_COLOR = '#B4FF6A';\r\n// ---------------------------------------------------------------------------------------------------------------------\r\n/**\r\n * Default secondary (background) GUI color\r\n * @type {string}\r\n */\r\nexport const DEFAULT_BG_COLOR = 'rgba(24, 48, 13, 0.2)';\r\n// ---------------------------------------------------------------------------------------------------------------------\r\n/***\r\n * Default color for console group labels\r\n * @type {string}\r\n */\r\nconst DEFAULT_CONSOLE_GROUP_COLOR = DEFAULT_ACCENT_COLOR;\r\n\r\nconst DEFAULT_CONSOLE_MESSAGE_COLOR = '#fff';\r\n\r\nexport const CONSOLE_GROUP_STYLE = `color: ${DEFAULT_CONSOLE_GROUP_COLOR}`;\r\n\r\nexport const CONSOLE_MESSAGE_STYLE = `color: ${DEFAULT_CONSOLE_MESSAGE_COLOR}`;\r\n// ---------------------------------------------------------------------------------------------------------------------\r\n/**\r\n * Default Julia-specific palette.\r\n * @type {JULIA_PALETTE}\r\n */\r\nexport const DEFAULT_JULIA_PALETTE =\r\n    {\r\n        \"id\": \"Event Horizon\",\r\n        \"keyColor\": \"#c74a00\",\r\n        \"theme\": [0.859, 0.565, 0.306, 0.18, 0.129, 0.216, 0.067, 0.067, 0.082, 0.467, 0, 0, 0.78, 0.29, 0]\r\n    };\r\n// ---------------------------------------------------------------------------------------------------------------------\r\n/** Default color used based on the initial Mandelbrot coloring. It's an accent color / 1.9 brightness factor that\r\n * is hardcoded in the updateColorTheme method.\r\n * @type {PALETTE}\r\n */\r\nexport const DEFAULT_MANDELBROT_THEME_COLOR = [95 / 255, 134 / 255, 56 / 255];\r\n// ---------------------------------------------------------------------------------------------------------------------\r\n/** Default color used based on the initial Julia coloring. It's accent color / 1.9 brightness factor that\r\n * is hardcoded in the updateColorTheme method.\r\n * @type {PALETTE}\r\n */\r\nexport const DEFAULT_JULIA_THEME_COLOR = hexToRGBArray(DEFAULT_JULIA_PALETTE.keyColor);\r\n// ---------------------------------------------------------------------------------------------------------------------\r\n/**\r\n * This is to allow switching between two precisions as the embedded PI constant is too accurate, which is not needed\r\n * in many cases (rotations etc.)\r\n * @type {boolean}\r\n * @default true\r\n */\r\nconst USE_PRECISE_PI = true;\r\n/**\r\n * PI\r\n * @type {number|number}\r\n */\r\nexport const PI = USE_PRECISE_PI ? Math.PI : 3.1415926535;\r\n// ---------------------------------------------------------------------------------------------------------------------\r\n/**\r\n * Defines the compression quality for JPEG screenshots (0-1) in %\r\n * @type {number}\r\n */\r\nexport const SCREENSHOT_JPEG_COMPRESSION_QUALITY = 0.95;\r\n// ---------------------------------------------------------------------------------------------------------------------","/**\r\n * @module Utils\r\n * @author Radim Brnka\r\n * @description Contains helper functions for working with URL parameters, colors, etc.\r\n * @copyright Synaptory Fractal Traveler, 2025-2026\r\n * @license MIT\r\n */\r\n\r\nimport {CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE, DEBUG_MODE, FRACTAL_TYPE, PI} from \"./constants\";\r\n\r\nlet urlParamsSet = false;\r\n\r\n/**\r\n * Updates browser URL with params of the selected point and zoom in the fractal\r\n * @param {FRACTAL_TYPE} mode\r\n * @param {number} px panX\r\n * @param {number} py panY\r\n * @param {number|null} cx Julia only\r\n * @param {number|null} cy Julia only\r\n * @param {number} zoom\r\n * @param {number} rotation\r\n * @param {string|null} paletteId optional palette ID\r\n */\r\nexport function updateURLParams(mode, px, py, zoom, rotation, cx = null, cy = null, paletteId = null) {\r\n    const formatNumber = (value) => {\r\n        if (value == null) return null;\r\n        // 1517 digits is where JS double precision is meaningfully preserved.\r\n        // toPrecision also uses scientific notation for very small values (deep zoom).\r\n        return Number(value).toPrecision(17);\r\n    };\r\n\r\n    const params = {\r\n        mode: mode != null ? mode.toFixed(0) : FRACTAL_TYPE.MANDELBROT,\r\n        px: formatNumber(px),\r\n        py: formatNumber(py),\r\n        zoom: formatNumber(zoom),\r\n        r: rotation != null ? Number(rotation).toPrecision(17) : 0,\r\n        cx: formatNumber(cx),\r\n        cy: formatNumber(cy),\r\n        palette: paletteId,\r\n    };\r\n\r\n    if (DEBUG_MODE) console.log(`%c updateURLParams: %c Setting URL: ${JSON.stringify(params)}`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n\r\n    if ([px, py, zoom, rotation].some(el => el == null)) {\r\n        console.error(`%c updateURLParams: %c Fractal params incomplete, can't generate URL! ${JSON.stringify(params)}`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n        return;\r\n    }\r\n\r\n    if (mode === FRACTAL_TYPE.JULIA && [cx, cy].some(el => el == null)) {\r\n        console.error(`%c updateURLParams: %c Julia params incomplete, can't generate URL! ${JSON.stringify(params)}`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n        return;\r\n    }\r\n\r\n    // Convert to Base64 for compact representation\r\n    const encodedParams = btoa(JSON.stringify(params));\r\n\r\n    // Update the URL with a single \"params\" field\r\n    const hashPath = mode === FRACTAL_TYPE.JULIA ? '#julia' : '#';\r\n    window.history.pushState({}, '', `${hashPath}?view=${encodedParams}`);\r\n\r\n    urlParamsSet = true;\r\n}\r\n\r\n/**\r\n * Fetches and recalculates coords and zoom from URL and sets them to the fractalApp instance\r\n * @return {URL_PRESET}\r\n */\r\nexport function loadFractalParamsFromURL() {\r\n    if (DEBUG_MODE) console.groupCollapsed(`%c loadFractalParamsFromURL`, CONSOLE_GROUP_STYLE);\r\n\r\n    const url = new URL(window.location.href);\r\n    const hash = url.hash; // Get the hash part of the URL (e.g., #julia?view=...)\r\n\r\n    if (!hash) {\r\n        if (DEBUG_MODE) console.log(`No hash found in the URL, return default mode.`);\r\n        if (DEBUG_MODE) console.groupEnd();\r\n        return {mode: FRACTAL_TYPE.MANDELBROT}; // Return default if no hash is present\r\n    }\r\n\r\n    // Split the hash to separate the mode and parameters\r\n    const [mode, queryString] = hash.slice(1).split('?'); // Remove the '#' and split by '?'\r\n\r\n    if (!queryString) {\r\n        if (DEBUG_MODE) console.log(`No query string is found in the URL, returning mode only.`);\r\n        if (DEBUG_MODE) console.groupEnd();\r\n        return {mode: mode === 'julia' ? FRACTAL_TYPE.JULIA : FRACTAL_TYPE.MANDELBROT};\r\n    }\r\n\r\n    // Parse the query parameters\r\n    const hashParams = new URLSearchParams(queryString);\r\n    const encodedParams = hashParams.get('view');\r\n\r\n    try {\r\n        // Decode the Base64 string and parse the JSON object\r\n        const decodedParams = JSON.parse(atob(encodedParams));\r\n        if (DEBUG_MODE) console.log(`Decoded params: ${JSON.stringify(decodedParams)}`);\r\n        urlParamsSet = true;\r\n        if (DEBUG_MODE) console.groupEnd();\r\n        // Return the parsed parameters\r\n        return {\r\n            mode: mode === 'julia' ? FRACTAL_TYPE.JULIA : FRACTAL_TYPE.MANDELBROT,\r\n            px: decodedParams.px != null ? parseFloat(decodedParams.px) : null,\r\n            py: decodedParams.py != null ? parseFloat(decodedParams.py) : null,\r\n            zoom: decodedParams.zoom != null ? parseFloat(decodedParams.zoom) : null,\r\n            r: decodedParams.r != null ? parseFloat(decodedParams.r) : 0, // Rotation is not necessary to be defined\r\n            cx: decodedParams.cx != null ? parseFloat(decodedParams.cx) : null,\r\n            cy: decodedParams.cy != null ? parseFloat(decodedParams.cy) : null,\r\n            paletteId: decodedParams.palette || null,\r\n        };\r\n    } catch (e) {\r\n        console.error(`%c loadFractalParamsFromURL: %c Error decoding URL parameters: ${e}`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n        urlParamsSet = true;\r\n        if (DEBUG_MODE) console.groupEnd();\r\n        return {mode: mode === 'julia' ? FRACTAL_TYPE.JULIA : FRACTAL_TYPE.MANDELBROT}; // Return only the mode if no query string is found\r\n    }\r\n}\r\n\r\n/** Clears browser URL, usually when it stops correspond with the position/zoom in the fractal */\r\nexport function clearURLParams() {\r\n    if (!urlParamsSet) return;\r\n\r\n    if (DEBUG_MODE) console.log(`%c clearURLParams: %c Clearing URL params.`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n\r\n    const hash = window.location.hash.split('?')[0]; // Keep only the hash part, discard any query parameters\r\n    const newUrl = `${window.location.origin}/${hash}`;\r\n    window.history.pushState({}, '', newUrl);\r\n    urlParamsSet = false;\r\n}\r\n\r\n/**\r\n * Detects touch device\r\n * @returns {boolean}\r\n */\r\nexport const isTouchDevice = () => 'ontouchstart' in window || navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0;\r\n\r\n/**\r\n * Detects mobile device\r\n * @returns {boolean} if the user device is mobile\r\n */\r\nexport function isMobileDevice() {\r\n    const toMatch = [/Android/i, /webOS/i, /iPhone/i, /iPad/i, /iPod/i, /BlackBerry/i, /Windows Phone/i];\r\n\r\n    return toMatch.some((toMatchItem) => {\r\n        return navigator.userAgent.match(toMatchItem);\r\n    });\r\n}\r\n\r\n/**\r\n * Generates string in [x, yi] format from the given complex number. Trailing zeroes are trimmed.\r\n * @param {COMPLEX} c\r\n * @param {number} precision Decimal point precision\r\n * @param {boolean} [withI] Append \"i\" to the imaginary member? Ignored if zero.\r\n * @return {string} [x, yi]|[x, 0]|[?, ?]\r\n */\r\nexport function expandComplexToString(c, precision = 6, withI = true) {\r\n    if (DEBUG_MODE) console.groupCollapsed(`%c expandComplexToString`, CONSOLE_GROUP_STYLE);\r\n\r\n    const invalidValues = [NaN, undefined, null, ''];\r\n    const isNumber = (value) => typeof value === 'number' && isFinite(value);\r\n\r\n    let expanded = `[`;\r\n\r\n    if (invalidValues.some(value => value === c[0]) || invalidValues.some(value => value === c[1]) || !isNumber(c[0]) || !isNumber(c[1])) {\r\n        expanded += `?, ?]`;\r\n        console.warn(`%c expandComplexToString: %c Invalid complex number: ${c}`, CONSOLE_GROUP_STYLE);\r\n        console.groupEnd();\r\n        return expanded;\r\n    } else {\r\n        const trimmedReal = parseFloat(c[0].toFixed(precision)).toString();\r\n        const trimmedImag = parseFloat(c[1].toFixed(precision)).toString();\r\n        expanded += `${trimmedReal}, ${trimmedImag}`;\r\n    }\r\n\r\n    if (DEBUG_MODE) console.groupEnd();\r\n    return expanded + ((withI && c[1] !== 0) ? 'i]' : ']');\r\n}\r\n\r\n// region > Double helpers ---------------------------------------------------------------------------------------------\r\n\r\n/**\r\n * @enum\r\n * @type {{VELTKAMP_DEKKER: string, GPU_EMULATED_DOUBLE: string}}\r\n */\r\nexport const SPLIT_FLOAT_METHOD = {\r\n    VELTKAMP_DEKKER: 'vd', // Default\r\n    GPU_EMULATED_DOUBLE: 'ed',\r\n}\r\n\r\n/**\r\n * Splits a 64-bit floating point number into two 32-bit parts\r\n * @param {number} value A standard JavaScript 64-bit number.\r\n * @param value\r\n * @param method\r\n * @returns {{high: number, low: number}}\r\n */\r\nexport const splitFloat = (value, method = SPLIT_FLOAT_METHOD.VELTKAMP_DEKKER) =>\r\n    (method === SPLIT_FLOAT_METHOD.GPU_EMULATED_DOUBLE) ? splitFloatED(value) : splitFloatVD(value);\r\n\r\n/**\r\n * Veltkamp-Dekker splitting constant: 2^27 + 1 = 134217729\r\n * Pre-computed to avoid Math.pow() on every splitFloat call (called 4000+ times per orbit rebuild).\r\n * This is a common splitting point for 53-bit mantissa (JS number).\r\n */\r\nconst VELTKAMP_DEKKER_K = 134217729;\r\n\r\n/**\r\n * The Veltkamp-Dekker Split: This implementation is the classic Veltkamp-Dekker algorithm. It is designed to split\r\n * a 64-bit double into two \"half-precision\" doubles so that their product can be calculated without losing precision.\r\n * @param {number} value A standard JavaScript 64-bit number.\r\n * @returns {{high: number, low: number}}\r\n */\r\nfunction splitFloatVD(value) {\r\n    const temp = value * VELTKAMP_DEKKER_K;\r\n    const high = temp - (temp - value);\r\n    const low = value - high;\r\n\r\n    return {high, low};\r\n}\r\n\r\n/**\r\n * GPU Emulated Double. This is the standard approach for rendering high-precision or astronomical visualizations).\r\n * @param value\r\n * @returns {{high: number, low: number}}\r\n */\r\nfunction splitFloatED(value) {\r\n    // Force the high part to be *exactly* what will be stored in GPU float32.\r\n    const high = Math.fround(value);\r\n    // Residual in double, then quantize to float32 as well (matches GPU storage).\r\n    const low = Math.fround(value - high);\r\n\r\n    return {high, low};\r\n}\r\n\r\n/**\r\n * Creates a double-double precision number object with high and low parts.\r\n * Used for extended precision arithmetic beyond standard 64-bit floating point.\r\n *\r\n * @param {number} [hi=0] - The high-order (primary) part of the number.\r\n * @param {number} [lo=0] - The low-order (error correction) part of the number.\r\n * @returns {{hi: number, lo: number}} A double-double precision number object.\r\n */\r\nexport function ddMake(hi = 0, lo = 0) {\r\n    return {hi, lo};\r\n}\r\n\r\n/**\r\n * Computes the error-free sum of two floating-point numbers using Knuth's two-sum algorithm.\r\n * Returns both the sum and the rounding error, enabling extended precision arithmetic.\r\n *\r\n * @param {number} a - The first number to sum.\r\n * @param {number} b - The second number to sum.\r\n * @returns {{s: number, err: number}} An object containing the sum (s) and the rounding error (err).\r\n */\r\nexport function twoSum(a, b) {\r\n    const s = a + b;\r\n    const bb = s - a;\r\n    const err = (a - (s - bb)) + (b - bb);\r\n    return {s, err};\r\n}\r\n\r\n/**\r\n * Computes the error-free sum of two floating-point numbers where |a| >= |b|.\r\n * This is a faster variant of twoSum that assumes the first argument has greater magnitude.\r\n *\r\n * @param {number} a - The larger magnitude number (must satisfy |a| >= |b|).\r\n * @param {number} b - The smaller magnitude number to add.\r\n * @returns {{s: number, err: number}} An object containing the sum (s) and the rounding error (err).\r\n */\r\nexport function quickTwoSum(a, b) {\r\n    const s = a + b;\r\n    const err = b - (s - a);\r\n    return {s, err};\r\n}\r\n\r\n/**\r\n * Adds a standard floating-point number to a double-double precision number.\r\n * This function mutates the input double-double object and maintains extended precision.\r\n *\r\n * @param {{hi: number, lo: number}} dd - The double-double number to modify (mutated in place).\r\n * @param {number} n - The standard floating-point number to add.\r\n * @returns {{hi: number, lo: number}} The mutated double-double object with the sum.\r\n */\r\nexport function ddAdd(dd, n) {\r\n    const t = twoSum(dd.hi, n);\r\n    const lo = dd.lo + t.err;\r\n    const r = quickTwoSum(t.s, lo);\r\n    dd.hi = r.s;\r\n    dd.lo = r.err;\r\n    return dd;\r\n}\r\n\r\n/**\r\n * Sets the value of a double-double precision object from a standard number.\r\n * This effectively resets the high-precision value to a single 64-bit float,\r\n * clearing any existing low-precision error bits.\r\n *\r\n * @param {{hi: number, lo: number}} dd - The double-double object to modify.\r\n * @param {number} n - The number to assign to the high part.\r\n * @returns {{hi: number, lo: number}} The mutated double-double object.\r\n */\r\nexport function ddSet(dd, n) {\r\n    dd.hi = n;\r\n    dd.lo = 0;\r\n    return dd;\r\n}\r\n\r\n/**\r\n * Returns the standard 64-bit floating-point approximation of a double-double number.\r\n * This combines the high and low parts to reconstruct the full precision value.\r\n *\r\n * @param {{hi: number, lo: number}} dd The double-double number object with high and low precision parts.\r\n * @returns {number} The combined floating-point value.\r\n */\r\nexport function ddValue(dd) {\r\n    return dd.hi + dd.lo;\r\n}\r\n\r\n/**\r\n * Adds two double-double precision numbers and returns a new DD result.\r\n * Uses the Knuth two-sum algorithm for error-free addition.\r\n *\r\n * @param {{hi: number, lo: number}} a - First double-double number.\r\n * @param {{hi: number, lo: number}} b - Second double-double number.\r\n * @returns {{hi: number, lo: number}} The sum as a new double-double number.\r\n */\r\nexport function ddAddDD(a, b) {\r\n    const t = twoSum(a.hi, b.hi);\r\n    const lo = a.lo + b.lo + t.err;\r\n    const r = quickTwoSum(t.s, lo);\r\n    return {hi: r.s, lo: r.err};\r\n}\r\n\r\n/**\r\n * Subtracts two double-double precision numbers (a - b) and returns a new DD result.\r\n *\r\n * @param {{hi: number, lo: number}} a - The minuend (number to subtract from).\r\n * @param {{hi: number, lo: number}} b - The subtrahend (number to subtract).\r\n * @returns {{hi: number, lo: number}} The difference (a - b) as a new double-double number.\r\n */\r\nexport function ddSubDD(a, b) {\r\n    return ddAddDD(a, {hi: -b.hi, lo: -b.lo});\r\n}\r\n\r\n// endregion---------------------------------------------------------------------------------------\r\n\r\n/**\r\n * Escapes HTML special characters in a string to prevent XSS attacks and rendering issues.\r\n * Converts &, <, and > to their HTML entity equivalents.\r\n *\r\n * @param {*} s - The input value to escape (will be converted to string)\r\n * @returns {string} The escaped string with HTML entities\r\n */\r\nexport const esc = (s) =>\r\n    String(s)\r\n        .replaceAll(\"&\", \"&amp;\")\r\n        .replaceAll(\"<\", \"&lt;\")\r\n        .replaceAll(\">\", \"&gt;\");\r\n\r\n/**\r\n * Compares two complex numbers / arrays of two numbers with given precision\r\n * @param {COMPLEX} c1\r\n * @param {COMPLEX}c2\r\n * @param {number} [precision]\r\n * @return {boolean} true if numbers are equal, false if not\r\n */\r\nexport function compareComplex(c1, c2, precision = 12) {\r\n    return c1[0].toFixed(precision) === c2[0].toFixed(precision) && c1[1].toFixed(precision) === c2[1].toFixed(precision);\r\n}\r\n\r\n/**\r\n * Compares two palettes / arrays of three numbers with given precision (transitively uses the compareComplex)\r\n * @param {PALETTE} p1\r\n * @param {PALETTE} p2\r\n * @param {number} [precision]\r\n * @return {boolean} true if palettes are equal, false if not\r\n */\r\nexport function comparePalettes(p1, p2, precision = 6) {\r\n    return p1[0].toFixed(precision) === p2[0].toFixed(precision) &&\r\n        p1[1].toFixed(precision) === p2[1].toFixed(precision) &&\r\n        p1[2].toFixed(precision) === p2[2].toFixed(precision);\r\n}\r\n\r\n/**\r\n * HSB to RGB conversion helper function\r\n * @param h Hue\r\n * @param s Saturation\r\n * @param b Brightness\r\n * @returns {PALETTE} rgb\r\n */\r\nexport function hsbToRgb(h, s, b) {\r\n    const i = Math.floor(h * 6);\r\n    const f = h * 6 - i;\r\n    const p = b * (1 - s);\r\n    const q = b * (1 - f * s);\r\n    const t = b * (1 - (1 - f) * s);\r\n\r\n    let r, g, bl;\r\n    // @formatter:off\r\n    switch (i % 6) {\r\n        case 0: r = b; g = t; bl = p; break;\r\n        case 1: r = q; g = b; bl = p; break;\r\n        case 2: r = p; g = b; bl = t; break;\r\n        case 3: r = p; g = q; bl = b; break;\r\n        case 4: r = t; g = p; bl = b; break;\r\n        case 5: r = b; g = p; bl = q; break;\r\n    }\r\n    // @formatter:on\r\n    return [r, g, bl];\r\n}\r\n\r\n/**\r\n * Convert HSL (h in [0,1], s in [0,1], l in [0,1]) to RGB (each channel in [0,1])\r\n * @param {number} h Hue\r\n * @param {number} s Saturation\r\n * @param {number} l Lightness\r\n * @return {PALETTE} [r, g ,b]\r\n */\r\nexport function hslToRgb(h, s, l) {\r\n    let r, g, b;\r\n    if (s === 0) {\r\n        r = g = b = l; // achromatic\r\n    } else {\r\n        const hue2rgb = (p, q, t) => {\r\n            if (t < 0) t += 1;\r\n            if (t > 1) t -= 1;\r\n            if (t < 1 / 6) return p + (q - p) * 6 * t;\r\n            if (t < 1 / 2) return q;\r\n            if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;\r\n            return p;\r\n        };\r\n        const q = l < 0.5 ? l * (1 + s) : l + s - l * s;\r\n        const p = 2 * l - q;\r\n        r = hue2rgb(p, q, h + 1 / 3);\r\n        g = hue2rgb(p, q, h);\r\n        b = hue2rgb(p, q, h - 1 / 3);\r\n    }\r\n    return [r, g, b];\r\n}\r\n\r\n/**\r\n * Converts RGB (each in [0,1]) to HSL (h in [0,1], s in [0,1], l in [0,1])\r\n * @param {number} r Red\r\n * @param {number} g Green\r\n * @param {number} b Blue\r\n * @return {Array<number, number, number>} [h, s, l]\r\n */\r\nexport function rgbToHsl(r, g, b) {\r\n    let max = Math.max(r, g, b), min = Math.min(r, g, b);\r\n    let h, s, l = (max + min) / 2;\r\n    if (max === min) {\r\n        h = s = 0; // achromatic\r\n    } else {\r\n        let d = max - min;\r\n        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\r\n        if (max === r) {\r\n            h = (g - b) / d + (g < b ? 6 : 0);\r\n        } else if (max === g) {\r\n            h = (b - r) / d + 2;\r\n        } else {\r\n            h = (r - g) / d + 4;\r\n        }\r\n        h /= 6;\r\n    }\r\n    return [h, s, l];\r\n}\r\n\r\n/**\r\n * Converts HTML hex color notation to rgb object\r\n * @param {string} hex HTML hex color\r\n * @param {number} [normalize] interval to normalize onto\r\n * @return {{r: number, g: number, b: number}|null}\r\n */\r\nexport function hexToRGB(hex, normalize = 255) {\r\n    // Ensure it's a string and remove any leading #\r\n    hex = hex.toLowerCase().replace(/^#/, \"\");\r\n\r\n    // Convert shorthand \"#abc\"  \"aabbcc\"\r\n    if (hex.length === 3) {\r\n        hex = hex.split(\"\").map(char => char + char).join(\"\");\r\n    }\r\n\r\n    // Validate format\r\n    if (!/^([\\da-f]{6})$/i.test(hex)) {\r\n        return null;\r\n    }\r\n\r\n    // Convert HEX to RGB (0-255)\r\n    const r = parseInt(hex.substring(0, 2), 16);\r\n    const g = parseInt(hex.substring(2, 4), 16);\r\n    const b = parseInt(hex.substring(4, 6), 16);\r\n\r\n    // Normalize to 0-1 range\r\n    return {\r\n        r: r / normalize,\r\n        g: g / normalize,\r\n        b: b / normalize\r\n    };\r\n}\r\n\r\n/**\r\n * Converts HTML hex color notation to rgb array\r\n * @param {string} hex HTML hex color\r\n * @param {number} [normalize] interval to normalize onto\r\n * @return {number[]|null} [r, g, b]\r\n */\r\nexport function hexToRGBArray(hex, normalize = 255) {\r\n    const rgb = hexToRGB(hex, normalize);\r\n    return [rgb.r, rgb.g, rgb.b];\r\n}\r\n\r\n/**\r\n * Helper function for ease-in-out timing. This function accelerates in the first half (using 2*t) and decelerates in\r\n * the second half.\r\n * @param {number} time A value between 0 and 1 representing the progress.\r\n * @return {number} The eased value.\r\n */\r\nexport function easeInOut(time) {\r\n    return time < 0.5 ? 2 * time * time : -1 + (4 - 2 * time) * time;\r\n}\r\n\r\n/**\r\n * Helper function for ease-in-out timing. The cubic version tends to have a smoother acceleration at the beginning and\r\n * a gentler deceleration at the end, to start more gradually and then slow down more smoothly toward the end.\r\n * @param {number} time A value between 0 and 1 representing the progress.\r\n * @return {number} The eased value.\r\n */\r\nexport function easeInOutCubic(time) {\r\n    return time < 0.5\r\n        ? 4 * time * time * time\r\n        : 1 - Math.pow(-2 * time + 2, 3) / 2;\r\n}\r\n\r\n/**\r\n * Helper function for ease-in-out timing using a quintic curve.\r\n * This function starts gradually, accelerates, then decelerates more gently near the end.\r\n * @param {number} time A value between 0 and 1 representing the progress.\r\n * @return {number} The eased value.\r\n */\r\nexport function easeInOutQuint(time) {\r\n    return time < 0.5\r\n        ? 16 * Math.pow(time, 5)\r\n        : 1 - Math.pow(-2 * time + 2, 5) / 2;\r\n}\r\n\r\n/**\r\n * Helper function for linear interpolation\r\n * @param {number} start\r\n * @param {number} end\r\n * @param {number} time A value between 0 and 1 representing the progress.\r\n * @return {number}\r\n */\r\nexport function lerp(start, end, time) {\r\n    return start + (end - start) * time;\r\n}\r\n\r\n/**\r\n * Converts degrees from JSON to Radians for GLSL uniforms\r\n * @param {number} degrees\r\n * @returns {number} radians\r\n */\r\nexport function degToRad(degrees) {\r\n    return degrees * (PI / 180);\r\n}\r\n\r\n/**\r\n * Normalizes rotation into into [0, 2*PI] interval\r\n * @param {number} rotation in rad\r\n * @return {number} rotation in rad\r\n */\r\nexport function normalizeRotation(rotation) {\r\n    const twoPi = 2 * PI;\r\n    return (rotation % twoPi + twoPi) % twoPi;\r\n}\r\n\r\n/**\r\n * Computes a duration based on the travel distance between current and target parameters. Iterates over each property\r\n * in target (assuming current and target have the same structure)\r\n * @param {number} seed - A scaling factor to adjust the overall duration.\r\n * @param {object} current - An object with current values\r\n * @param {object} target - An object with target values\r\n * @param {object} [weights] - Optional weights\r\n * @returns {number} The computed duration.\r\n */\r\nexport function getAnimationDuration(seed, current, target, weights = {}) {\r\n    let compositeDistance = 0;\r\n    for (const key in target) {\r\n        if (Object.prototype.hasOwnProperty.call(target, key)) {\r\n            const w = weights[key] !== undefined ? weights[key] : 1.0;\r\n            const currVal = current[key];\r\n            const targVal = target[key];\r\n            let diff = 0;\r\n\r\n            // If the property is a number, use absolute difference.\r\n            if (typeof targVal === 'number' && typeof currVal === 'number') {\r\n                diff = Math.abs(targVal - currVal);\r\n            }\r\n            // If the property is an array, compute the Euclidean distance between the two arrays.\r\n            else if (Array.isArray(targVal) && Array.isArray(currVal)) {\r\n                // Assume both arrays have the same length.\r\n                diff = Math.hypot(...targVal.map((v, i) => v - (currVal[i] || 0)));\r\n            }\r\n\r\n            compositeDistance += w * diff;\r\n        }\r\n    }\r\n    return Math.round(seed * compositeDistance);\r\n}\r\n\r\n/**\r\n * Helper function that returns a Promise that resolves after timeout.\r\n * @param {number} timeout in ms\r\n * @return {Promise<unknown>}\r\n */\r\nexport async function asyncDelay(timeout) {\r\n    return new Promise(resolve => setTimeout(resolve, timeout));\r\n}\r\n\r\n/**\r\n * Calculates the change in pan based on the movement delta, the canvas rectangle, current zoom, and rotation.\r\n *\r\n * @param {number} currentX The current X coordinate (clientX or touch.clientX).\r\n * @param {number} currentY The current Y coordinate.\r\n * @param {number} lastX The previous X coordinate.\r\n * @param {number} lastY The previous Y coordinate.\r\n * @param {DOMRect} rect The canvas bounding rectangle.\r\n * @param {number} rotation The current rotation (in radians).\r\n * @param {number} zoom The current zoom factor.\r\n * @returns {Array<number>} An array [deltaPanX, deltaPanY] that should be added to the current pan.\r\n */\r\nexport function calculatePanDelta(currentX, currentY, lastX, lastY, rect, rotation, zoom) {\r\n    const moveX = currentX - lastX;\r\n    const moveY = currentY - lastY;\r\n\r\n    const ref = Math.min(rect.width, rect.height);\r\n\r\n    // Apply inverse rotation to the movement, so it aligns with fractal pan direction.\r\n    const cosR = Math.cos(-rotation);\r\n    const sinR = Math.sin(-rotation);\r\n    const rotatedMoveX = cosR * moveX - sinR * moveY;\r\n    const rotatedMoveY = sinR * moveX + cosR * moveY;\r\n\r\n    // Scale movement relative to canvas size and zoom.\r\n    const deltaPanX = -(rotatedMoveX / ref) * zoom;\r\n    const deltaPanY = +(rotatedMoveY / ref) * zoom;\r\n\r\n    return [deltaPanX, deltaPanY];\r\n}\r\n\r\n/**\r\n * Removes array of buttons from the scene and clears it.\r\n * @param {Array<HTMLButtonElement>} buttons\r\n */\r\nexport function destroyArrayOfButtons(buttons) {\r\n    if (Array.isArray(buttons)) {\r\n        buttons.forEach(btn => {\r\n            if (btn.parentNode) {\r\n                btn.parentNode.removeChild(btn);\r\n            }\r\n        });\r\n        buttons.length = 0;\r\n    }\r\n}\r\n\r\n/**\r\n * Returns the name of the fractal mode.\r\n * @param {number} type\r\n */\r\nexport function getFractalName(type) {\r\n    return Object.keys(FRACTAL_TYPE).find(key => FRACTAL_TYPE[key] === type) || \"UNKNOWN\";\r\n}","import {CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE} from \"../global/constants\";\r\n\r\n/**\r\n * Abstract base class for WebGL-based renderers.\r\n * Provides common WebGL context initialization and management functionality.\r\n * \r\n * @abstract\r\n */\r\nclass Renderer {\r\n    /**\r\n     * Creates a new Renderer instance and initializes the WebGL context.\r\n     *\r\n     * @param {HTMLCanvasElement} canvas - The canvas element to render to.\r\n     */\r\n    constructor(canvas) {\r\n        this.canvas = canvas;\r\n\r\n        this.gl = this.canvas.getContext(\"webgl\", {\r\n            antialias: false,\r\n            alpha: false,\r\n            depth: false,\r\n            stencil: false,\r\n            preserveDrawingBuffer: false,\r\n            powerPreference: \"high-performance\",\r\n        });\r\n\r\n        if (!this.gl) {\r\n            alert('WebGL is not supported by your browser or crashed.');\r\n            return;\r\n        }\r\n\r\n        this.onWebGLContextLost = this.onWebGLContextLost.bind(this);\r\n        this.canvas.addEventListener('webglcontextlost', this.onWebGLContextLost);\r\n    }\r\n\r\n    /**\r\n     * Handles WebGL context lost events and attempts to recover the context.\r\n     *\r\n     * @param {WebGLContextEvent} event - The context lost event.\r\n     */\r\n    onWebGLContextLost(event) {\r\n        event.preventDefault();\r\n        console.error(\r\n            `%c ${this.constructor.name}: onWebGLContextLost %c WebGL context lost. Attempting to recover...`,\r\n            CONSOLE_GROUP_STYLE,\r\n            CONSOLE_MESSAGE_STYLE\r\n        );\r\n        this.init();\r\n    }\r\n\r\n    /**\r\n     * Initializes the renderer. Must be implemented by subclasses.\r\n     *\r\n     * @abstract\r\n     * @throws {Error} Always throws an error if not implemented.\r\n     */\r\n    init() {\r\n        throw new Error('Not implemented');\r\n    }\r\n\r\n    /**\r\n     * Performs the rendering operation. Must be implemented by subclasses.\r\n     *\r\n     * @abstract\r\n     * @throws {Error} Always throws an error if not implemented.\r\n     */\r\n    draw() {\r\n        throw new Error('Not implemented');\r\n    }\r\n\r\n    /**\r\n     * Resets the renderer to its initial state. Must be implemented by subclasses.\r\n     *\r\n     * @abstract\r\n     * @throws {Error} Always throws an error if not implemented.\r\n     */\r\n    reset() {\r\n        throw new Error('Not implemented');\r\n    }\r\n\r\n    /**\r\n     * Cleans up renderer resources and releases references.\r\n     */\r\n    destroy() {\r\n        this.gl = null;\r\n        this.canvas = null;\r\n    }\r\n}\r\n\r\nexport default Renderer;","import {debugPanel, updateInfo} from \"../ui/ui\";\r\nimport {\r\n    compareComplex,\r\n    comparePalettes,\r\n    ddAdd,\r\n    ddMake,\r\n    ddSet,\r\n    ddValue,\r\n    hslToRgb,\r\n    lerp,\r\n    normalizeRotation,\r\n    rgbToHsl\r\n} from \"../global/utils\";\r\nimport {\r\n    ADAPTIVE_QUALITY_COOLDOWN,\r\n    ADAPTIVE_QUALITY_MIN,\r\n    ADAPTIVE_QUALITY_STEP,\r\n    ADAPTIVE_QUALITY_THRESHOLD_HIGH,\r\n    ADAPTIVE_QUALITY_THRESHOLD_LOW,\r\n    CONSOLE_GROUP_STYLE,\r\n    CONSOLE_MESSAGE_STYLE,\r\n    DEBUG_MODE,\r\n    EASE_TYPE,\r\n    FF_ADAPTIVE_QUALITY,\r\n    FF_DEMO_ALWAYS_RESETS,\r\n    log,\r\n    PI\r\n} from \"../global/constants\";\r\nimport vertexFragmentShaderRaw from '../shaders/vertexShaderInit.vert';\r\nimport Renderer from \"./renderer\";\r\n\r\n/**\r\n * FractalRenderer\r\n *\r\n * @author Radim Brnka (c) 2025-2026\r\n * @description This module defines a fractalRenderer abstract class that encapsulates the WebGL code, including shader compilation, drawing, reset, and screenToFractal conversion. It also includes common animation methods.\r\n * @copyright Synaptory Fractal Traveler, 2025-2026\r\n * @license MIT\r\n * @abstract\r\n */\r\nclass FractalRenderer extends Renderer {\r\n\r\n    /**\r\n     * @param {HTMLCanvasElement} canvas\r\n     */\r\n    constructor(canvas) {\r\n        super(canvas);\r\n\r\n        // Defaults:\r\n        this.MAX_ITER = 2000;\r\n\r\n        this.DEFAULT_ROTATION = 0;\r\n        this.DEFAULT_ZOOM = 3.0;\r\n        /** @type {COMPLEX} */\r\n        this.DEFAULT_PAN = [0, 0];\r\n        this.DEFAULT_PALETTE = [1.0, 1.0, 1.0];\r\n        this.MAX_ZOOM = 1e-80;\r\n        this.MIN_ZOOM = 40;\r\n\r\n        /**\r\n         * Interesting points / details / zooms / views\r\n         * @type {Array.<PRESET>}\r\n         */\r\n        this.PRESETS = [];\r\n\r\n        /** @type {number} */\r\n        this.zoom = this.DEFAULT_ZOOM;\r\n\r\n        /** @type {COMPLEX} */\r\n        this.pan = [...this.DEFAULT_PAN];\r\n\r\n        /** DD accumulator mirrors into this.pan */\r\n        this.panDD = {\r\n            x: ddMake(this.pan[0], 0),\r\n            y: ddMake(this.pan[1], 0),\r\n        };\r\n\r\n        /**\r\n         * Rotation in rad\r\n         * @type {number}\r\n         */\r\n        this.rotation = this.DEFAULT_ROTATION;\r\n\r\n        this.currentPanAnimationFrame = null;\r\n        this.currentZoomAnimationFrame = null;\r\n        this.currentRotationAnimationFrame = null;\r\n        this.currentColorAnimationFrame = null;\r\n        /** Resolve callback for pending color animation (to handle interruption) */\r\n        this._colorAnimationResolve = null;\r\n\r\n        this.demoActive = false;\r\n        this.currentPresetIndex = 0;\r\n\r\n        this.interactionActive = false;\r\n        this.interactionTimer = null;\r\n\r\n        /** @type {number} */\r\n        this.iterations = 0;\r\n        this.extraIterations = 0;\r\n\r\n        /** Timestamp of last adaptive quality adjustment */\r\n        this.adaptiveQualityLastAdjustment = 0;\r\n\r\n        /** Runtime toggle for adaptive quality (initialized from constant) */\r\n        this.adaptiveQualityEnabled = FF_ADAPTIVE_QUALITY;\r\n\r\n        /** Runtime adjustable min iterations offset (initialized from constant) */\r\n        this.adaptiveQualityMin = ADAPTIVE_QUALITY_MIN;\r\n\r\n        /** @type PALETTE */\r\n        this.colorPalette = [...this.DEFAULT_PALETTE];\r\n\r\n        // Uniform dirty tracking - only upload uniforms when values change\r\n        this._uniformCache = {\r\n            resW: -1,\r\n            resH: -1,\r\n            pan0: NaN,\r\n            pan1: NaN,\r\n            zoom: NaN,\r\n            rotation: NaN,\r\n            iterations: NaN,\r\n            color0: NaN,\r\n            color1: NaN,\r\n            color2: NaN,\r\n        };\r\n\r\n        /** Vertex shader */\r\n        this.vertexShaderSource = vertexFragmentShaderRaw;\r\n    }\r\n\r\n    /**\r\n     * Hook for perturbation renderers to request orbit rebuild.\r\n     * No-op by default.\r\n     */\r\n    markOrbitDirty() {}\r\n\r\n    /**\r\n     * Invalidates the uniform cache, forcing all uniforms to be re-uploaded on next draw().\r\n     * Called after GL program creation/recreation.\r\n     */\r\n    invalidateUniformCache() {\r\n        this._uniformCache.resW = -1;\r\n        this._uniformCache.resH = -1;\r\n        this._uniformCache.pan0 = NaN;\r\n        this._uniformCache.pan1 = NaN;\r\n        this._uniformCache.zoom = NaN;\r\n        this._uniformCache.rotation = NaN;\r\n        this._uniformCache.iterations = NaN;\r\n        this._uniformCache.color0 = NaN;\r\n        this._uniformCache.color1 = NaN;\r\n        this._uniformCache.color2 = NaN;\r\n    }\r\n\r\n    // --------- Pan API (use these; they keep DD + array in sync) ---------\r\n\r\n    /** @returns {number[]} the canonical array */\r\n    getPan() {\r\n        return [this.pan[0], this.pan[1]];\r\n    }\r\n\r\n    /**\r\n     * Sets the pan values for the object.\r\n     *\r\n     * @param {number} x - The horizontal pan value.\r\n     * @param {number} y - The vertical pan value.\r\n     * @return {void}\r\n     */\r\n    setPan(x, y) {\r\n        ddSet(this.panDD.x, x);\r\n        ddSet(this.panDD.y, y);\r\n        this.pan[0] = ddValue(this.panDD.x);\r\n        this.pan[1] = ddValue(this.panDD.y);\r\n    }\r\n\r\n    /**\r\n     * Adjusts the pan values by adding the specified deltas to the current pan values.\r\n     *\r\n     * @param {number} dx - The change in the x-direction to be added to the pan.\r\n     * @param {number} dy - The change in the y-direction to be added to the pan.\r\n     * @return {void}\r\n     */\r\n    addPan(dx, dy) {\r\n        ddAdd(this.panDD.x, dx);\r\n        ddAdd(this.panDD.y, dy);\r\n        this.pan[0] = ddValue(this.panDD.x);\r\n        this.pan[1] = ddValue(this.panDD.y);\r\n    }\r\n\r\n    /**\r\n     * Set pan so that fractal point (fxAnchor,fyAnchor) remains under a screen point\r\n     * whose view vector is (vx,vy).\r\n     */\r\n    setPanFromAnchor(fxAnchor, fyAnchor, vx, vy) {\r\n        const px = fxAnchor - vx * this.zoom;\r\n        const py = fyAnchor - vy * this.zoom;\r\n        this.setPan(px, py);\r\n    }\r\n\r\n    /**\r\n     * Sets zoom while keeping the fractal point under a given screen anchor fixed.\r\n     * Uses DD-preserving arithmetic to avoid precision loss at deep zoom.\r\n     *\r\n     * @param {number} targetZoom\r\n     * @param {number} anchorX CSS px relative to canvas\r\n     * @param {number} anchorY CSS px relative to canvas\r\n     */\r\n    setZoomKeepingAnchor(targetZoom, anchorX, anchorY) {\r\n        const [vx, vy] = this.screenToViewVector(anchorX, anchorY);\r\n        const deltaZoom = this.zoom - targetZoom;\r\n\r\n        this.addPan(vx * deltaZoom, vy * deltaZoom);\r\n        this.zoom = targetZoom;\r\n    }\r\n\r\n    /**\r\n     * Marks the app as \"in interaction\" (drag/wheel/key-pan) and schedules a settle phase.\r\n     * Perturbation renderers can use this to defer expensive orbit rebuilds until the user stops moving.\r\n     *\r\n     * @param {number} settleMs\r\n     */\r\n    noteInteraction(settleMs = 160) {\r\n        this.interactionActive = true;\r\n        this._lastInteractionTime = performance.now();\r\n\r\n        if (this.interactionTimer) {\r\n            clearTimeout(this.interactionTimer);\r\n            this.interactionTimer = null;\r\n        }\r\n\r\n        this.interactionTimer = setTimeout(() => {\r\n            this.interactionActive = false;\r\n\r\n            // Request a clean rebuild at rest for perturbation renderers (safe no-op otherwise)\r\n            this.markOrbitDirty();\r\n\r\n            // One clean redraw at settle time (prevents swim and removes lingering error)\r\n            this.draw();\r\n            updateInfo(true);\r\n        }, settleMs);\r\n    }\r\n\r\n    /** Destructor */\r\n    destroy() {\r\n        console.groupCollapsed(`%c ${this.constructor.name}: %c destroy`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n        // Cancel any ongoing animations.\r\n        this.stopAllNonColorAnimations();\r\n        this.stopCurrentColorAnimations();\r\n\r\n        // Remove event listeners from the canvas.\r\n        if (this.canvas) {\r\n            this.canvas.removeEventListener('webglcontextlost', this.onWebGLContextLost);\r\n        }\r\n\r\n        // Free WebGL resources.\r\n        if (this.program) {\r\n            this.gl.deleteProgram(this.program);\r\n            this.program = null;\r\n        }\r\n        if (this.vertexShader) {\r\n            this.gl.deleteShader(this.vertexShader);\r\n            this.vertexShader = null;\r\n        }\r\n        if (this.fragmentShader) {\r\n            this.gl.deleteShader(this.fragmentShader);\r\n            this.fragmentShader = null;\r\n        }\r\n\r\n        if (this.interactionTimer) {\r\n            clearTimeout(this.interactionTimer);\r\n            this.interactionTimer = null;\r\n        }\r\n\r\n        super.destroy();\r\n\r\n        console.groupEnd();\r\n    }\r\n\r\n    //region > CONTROL METHODS -----------------------------------------------------------------------------------------\r\n\r\n    generatePresetIDs() {\r\n        this.PRESETS.forEach((preset, index) => {\r\n            preset.index = index;\r\n        });\r\n    }\r\n\r\n    init() {\r\n        this.generatePresetIDs();\r\n        this.initGLProgram();\r\n        this.draw();\r\n    }\r\n\r\n    resizeCanvas() {\r\n        log(`resizeCanvas`, this.constructor.name);\r\n\r\n        this.gl.useProgram(this.program);\r\n\r\n        // Keep the center fixed\r\n        const oldRect = this.canvas.getBoundingClientRect();\r\n        const cx = oldRect.width / 2;\r\n        const cy = oldRect.height / 2;\r\n\r\n        const [centerFx, centerFy] = this.screenToFractal(cx, cy);\r\n\r\n        const dpr = window.devicePixelRatio || 1;\r\n        this.canvas.width = Math.floor(oldRect.width * dpr);\r\n        this.canvas.height = Math.floor(oldRect.height * dpr);\r\n\r\n        this.gl.viewport(0, 0, this.canvas.width, this.canvas.height);\r\n        if (this.resolutionLoc) this.gl.uniform2f(this.resolutionLoc, this.canvas.width, this.canvas.height);\r\n\r\n        const [vx, vy] = this.screenToViewVector(cx, cy);\r\n        this.setPanFromAnchor(centerFx, centerFy, vx, vy);\r\n\r\n        // After resizing, request a clean rebuild for perturbation renderers (safe no-op otherwise)\r\n        this.markOrbitDirty();\r\n        this.draw();\r\n    }\r\n\r\n\r\n    /**\r\n     * Defines the shader code for rendering the fractal shape\r\n     *\r\n     * @abstract\r\n     * @returns {string}\r\n     */\r\n    createFragmentShaderSource() {\r\n        throw new Error('The draw method must be implemented in child classes');\r\n    }\r\n\r\n    /**\r\n     * Compiles shader code\r\n     * @param {string} source\r\n     * @param {GLenum} type\r\n     * @return {WebGLShader|null}\r\n     */\r\n    compileShader(source, type) {\r\n        if (DEBUG_MODE) {\r\n            console.groupCollapsed(`%c ${this.constructor.name}: %c compileShader`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n            console.log(`Shader GLenum type: ${type}\\nShader code: ${source}`);\r\n        }\r\n\r\n        const shader = this.gl.createShader(type);\r\n        this.gl.shaderSource(shader, source);\r\n        this.gl.compileShader(shader);\r\n\r\n        if (!this.gl.getShaderParameter(shader, this.gl.COMPILE_STATUS)) {\r\n            console.error(this.gl.getShaderInfoLog(shader));\r\n            this.gl.deleteShader(shader);\r\n            if (DEBUG_MODE) console.groupEnd();\r\n            return null;\r\n        }\r\n        if (DEBUG_MODE) console.groupEnd();\r\n\r\n        return shader;\r\n    }\r\n\r\n    /**\r\n     * Initializes WebGL program, shaders, quad, and uniform caches.\r\n     */\r\n    initGLProgram() {\r\n        if (DEBUG_MODE) console.groupCollapsed(`%c ${this.constructor.name}:%c initGLProgram`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n\r\n        if (this.program) this.gl.deleteProgram(this.program);\r\n        if (this.fragmentShader) this.gl.deleteShader(this.fragmentShader);\r\n\r\n        if (!this.vertexShader) {\r\n            this.vertexShader = this.compileShader(this.vertexShaderSource, this.gl.VERTEX_SHADER);\r\n        }\r\n        this.fragmentShader = this.compileShader(this.createFragmentShaderSource(), this.gl.FRAGMENT_SHADER);\r\n\r\n        this.program = this.gl.createProgram();\r\n        this.gl.attachShader(this.program, this.vertexShader);\r\n        this.gl.attachShader(this.program, this.fragmentShader);\r\n        this.gl.linkProgram(this.program);\r\n\r\n        if (!this.gl.getProgramParameter(this.program, this.gl.LINK_STATUS)) {\r\n            console.error(this.gl.getProgramInfoLog(this.program));\r\n        }\r\n        this.gl.useProgram(this.program);\r\n\r\n        // Full-screen quad\r\n        const positionBuffer = this.gl.createBuffer();\r\n        this.gl.bindBuffer(this.gl.ARRAY_BUFFER, positionBuffer);\r\n        const positions = new Float32Array([-1, -1, 1, -1, -1, 1, 1, 1]);\r\n        this.gl.bufferData(this.gl.ARRAY_BUFFER, positions, this.gl.STATIC_DRAW);\r\n        const positionLoc = this.gl.getAttribLocation(this.program, \"a_position\");\r\n        this.gl.enableVertexAttribArray(positionLoc);\r\n        this.gl.vertexAttribPointer(positionLoc, 2, this.gl.FLOAT, false, 0, 0);\r\n\r\n        this.updateUniforms();\r\n        this.invalidateUniformCache();\r\n\r\n        if (typeof this.onProgramCreated === \"function\") {\r\n            this.onProgramCreated();\r\n        }\r\n\r\n        if (DEBUG_MODE) console.groupEnd();\r\n    }\r\n\r\n    /** @abstract */\r\n    onProgramCreated() {\r\n        throw new Error(\"The onProgramCreated method must be implemented in child classes\");\r\n    }\r\n\r\n    /**\r\n     * kept for compatibility; perturbation renderers may ignore\r\n     * @abstract\r\n     */\r\n    needsRebase() {\r\n        throw new Error(\"The needsRebase method must be implemented in child classes\");\r\n    }\r\n\r\n    /**\r\n     * Cache common uniforms used by all renderers\r\n     */\r\n    updateUniforms() {\r\n        this.gl.useProgram(this.program);\r\n        this.panLoc = this.gl.getUniformLocation(this.program, \"u_pan\");\r\n        this.zoomLoc = this.gl.getUniformLocation(this.program, \"u_zoom\");\r\n        this.iterLoc = this.gl.getUniformLocation(this.program, \"u_iterations\");\r\n        this.colorLoc = this.gl.getUniformLocation(this.program, \"u_colorPalette\");\r\n        this.rotationLoc = this.gl.getUniformLocation(this.program, \"u_rotation\");\r\n        this.resolutionLoc = this.gl.getUniformLocation(this.program, \"u_resolution\");\r\n    }\r\n\r\n    /**\r\n     * Draws the fractal and sets basic uniforms.\r\n     * Subclasses can override draw() but must call super.draw() for viewport+common uniforms+draw call.\r\n     * Uses dirty checking to avoid redundant uniform uploads.\r\n     */\r\n    draw() {\r\n        this.gl.useProgram(this.program);\r\n\r\n        const w = this.canvas.width;\r\n        const h = this.canvas.height;\r\n        const uc = this._uniformCache;\r\n\r\n        this.gl.viewport(0, 0, w, h);\r\n\r\n        // Only upload uniforms that have changed\r\n        if (this.resolutionLoc && (uc.resW !== w || uc.resH !== h)) {\r\n            this.gl.uniform2f(this.resolutionLoc, w, h);\r\n            uc.resW = w;\r\n            uc.resH = h;\r\n        }\r\n\r\n        if (this.panLoc && (uc.pan0 !== this.pan[0] || uc.pan1 !== this.pan[1])) {\r\n            this.gl.uniform2fv(this.panLoc, this.pan);\r\n            uc.pan0 = this.pan[0];\r\n            uc.pan1 = this.pan[1];\r\n        }\r\n\r\n        if (this.zoomLoc && uc.zoom !== this.zoom) {\r\n            this.gl.uniform1f(this.zoomLoc, this.zoom);\r\n            uc.zoom = this.zoom;\r\n        }\r\n\r\n        if (this.rotationLoc && uc.rotation !== this.rotation) {\r\n            this.gl.uniform1f(this.rotationLoc, this.rotation);\r\n            uc.rotation = this.rotation;\r\n        }\r\n\r\n        if (this.iterLoc && uc.iterations !== this.iterations) {\r\n            this.gl.uniform1f(this.iterLoc, this.iterations);\r\n            uc.iterations = this.iterations;\r\n        }\r\n\r\n        if (this.colorLoc && (uc.color0 !== this.colorPalette[0] ||\r\n            uc.color1 !== this.colorPalette[1] ||\r\n            uc.color2 !== this.colorPalette[2])) {\r\n            this.gl.uniform3fv(this.colorLoc, this.colorPalette);\r\n            uc.color0 = this.colorPalette[0];\r\n            uc.color1 = this.colorPalette[1];\r\n            uc.color2 = this.colorPalette[2];\r\n        }\r\n\r\n        this.gl.clearColor(0, 0, 0, 1);\r\n        this.gl.clear(this.gl.COLOR_BUFFER_BIT);\r\n        debugPanel?.beginGpuTimer();\r\n        this.gl.drawArrays(this.gl.TRIANGLE_STRIP, 0, 4);\r\n        debugPanel?.endGpuTimer();\r\n        this.adjustAdaptiveQuality();\r\n    }\r\n\r\n    /**\r\n     * Adjusts extraIterations based on GPU performance metrics.\r\n     * Called after each frame when adaptive quality is enabled.\r\n     */\r\n    adjustAdaptiveQuality() {\r\n        if (!this.adaptiveQualityEnabled) return;\r\n        if (!debugPanel?.perf) return;\r\n\r\n        const gpuMs = debugPanel.perf.gpuMsSmoothed;\r\n        if (!Number.isFinite(gpuMs)) return;\r\n\r\n        // Don't adjust during active interaction (avoid jarring quality shifts while dragging)\r\n        if (this.interactionActive) return;\r\n\r\n        // Cooldown between adjustments\r\n        const now = performance.now();\r\n        if (now - this.adaptiveQualityLastAdjustment < ADAPTIVE_QUALITY_COOLDOWN) return;\r\n\r\n        // Reduce quality if GPU time too high\r\n        if (gpuMs > ADAPTIVE_QUALITY_THRESHOLD_HIGH) {\r\n            const newExtra = Math.max(this.adaptiveQualityMin, this.extraIterations - ADAPTIVE_QUALITY_STEP);\r\n            if (newExtra !== this.extraIterations) {\r\n                this.extraIterations = newExtra;\r\n                this.adaptiveQualityLastAdjustment = now;\r\n            }\r\n        }\r\n        // Restore quality if GPU time is comfortable and we're below baseline\r\n        else if (gpuMs < ADAPTIVE_QUALITY_THRESHOLD_LOW && this.extraIterations < 0) {\r\n            const newExtra = Math.min(0, this.extraIterations + ADAPTIVE_QUALITY_STEP);\r\n            if (newExtra !== this.extraIterations) {\r\n                this.extraIterations = newExtra;\r\n                this.adaptiveQualityLastAdjustment = now;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Toggles adaptive quality on/off.\r\n     * When turning off, resets extraIterations to 0.\r\n     */\r\n    toggleAdaptiveQuality() {\r\n        this.adaptiveQualityEnabled = !this.adaptiveQualityEnabled;\r\n        if (!this.adaptiveQualityEnabled) {\r\n            this.extraIterations = 0;\r\n        }\r\n        log(`Adaptive quality: ${this.adaptiveQualityEnabled ? 'ON' : 'OFF'}`, this.constructor.name);\r\n        this.draw();\r\n    }\r\n\r\n    /**\r\n     * Adjusts the minimum iterations offset for adaptive quality.\r\n     * @param {number} delta - Amount to change (positive = less aggressive, negative = more aggressive)\r\n     */\r\n    adjustAdaptiveQualityMin(delta) {\r\n        const oldMin = this.adaptiveQualityMin;\r\n        // Clamp between -3000 (very aggressive) and -100 (minimal)\r\n        this.adaptiveQualityMin = Math.max(-3000, Math.min(-100, this.adaptiveQualityMin + delta));\r\n        // Also clamp current extraIterations to new min\r\n        if (this.extraIterations < this.adaptiveQualityMin) {\r\n            this.extraIterations = this.adaptiveQualityMin;\r\n        }\r\n        log(`Adaptive quality min: ${oldMin}  ${this.adaptiveQualityMin} (delta: ${delta > 0 ? '+' : ''}${delta})`, this.constructor.name);\r\n        this.draw();\r\n    }\r\n\r\n    /**\r\n     * Directly adjusts extraIterations for manual quality control.\r\n     * Useful for finding the right adaptiveQualityMin limit or boosting quality.\r\n     * @param {number} delta - Amount to change (positive = more iterations, negative = fewer)\r\n     */\r\n    adjustExtraIterations(delta) {\r\n        const oldExtra = this.extraIterations;\r\n        // Clamp between adaptiveQualityMin and its positive counterpart\r\n        const maxExtra = Math.abs(this.adaptiveQualityMin);\r\n        this.extraIterations = Math.max(this.adaptiveQualityMin, Math.min(maxExtra, this.extraIterations + delta));\r\n        if (oldExtra !== this.extraIterations) {\r\n            log(`extraIterations: ${oldExtra}  ${this.extraIterations} (delta: ${delta > 0 ? '+' : ''}${delta})`, this.constructor.name);\r\n            this.draw();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Resets the fractal to its initial state (default pan, zoom, palette, rotation, etc.), resizes and redraws.\r\n     */\r\n    reset() {\r\n        console.groupCollapsed(`%c ${this.constructor.name}: reset`, CONSOLE_GROUP_STYLE);\r\n\r\n        this.stopAllNonColorAnimations();\r\n        this.stopCurrentColorAnimations();\r\n\r\n        this.colorPalette = [...this.DEFAULT_PALETTE];\r\n        this.setPan(this.DEFAULT_PAN[0], this.DEFAULT_PAN[1]);\r\n        this.zoom = this.DEFAULT_ZOOM;\r\n        this.rotation = this.DEFAULT_ROTATION;\r\n        this.extraIterations = 0;\r\n        this.currentPresetIndex = 0;\r\n\r\n        this.resizeCanvas();\r\n\r\n        this.markOrbitDirty();\r\n        this.draw();\r\n\r\n        console.groupEnd();\r\n        updateInfo();\r\n    }\r\n\r\n    /**\r\n     * Screen point -> fractal coordinates (float64 JS side; fine for UI)\r\n     * @param {number} screenX\r\n     * @param {number} screenY\r\n     * @returns {COMPLEX}\r\n     */\r\n    screenToFractal(screenX, screenY) {\r\n        const dpr = window.devicePixelRatio || 1;\r\n        const rect = this.canvas.getBoundingClientRect();\r\n        const w = rect.width * dpr;\r\n        const h = rect.height * dpr;\r\n\r\n        const bufferX = screenX * dpr;\r\n        const bufferY = screenY * dpr;\r\n\r\n        const normX = bufferX / w;\r\n        const normY = bufferY / h;\r\n\r\n        let stX = normX - 0.5;\r\n        let stY = (1 - normY) - 0.5;\r\n\r\n        const aspect = w / h;\r\n        stX *= aspect;\r\n\r\n        const cosR = Math.cos(this.rotation);\r\n        const sinR = Math.sin(this.rotation);\r\n        const rotatedX = cosR * stX - sinR * stY;\r\n        const rotatedY = sinR * stX + cosR * stY;\r\n\r\n        return [rotatedX * this.zoom + this.pan[0], rotatedY * this.zoom + this.pan[1]];\r\n    }\r\n\r\n    /**\r\n     * Returns the pan delta needed to center on a screen point.\r\n     * This avoids precision loss at deep zoom by returning only the offset,\r\n     * which can be applied via addPan() to preserve DD precision.\r\n     *\r\n     * @param {number} screenX CSS px relative to canvas\r\n     * @param {number} screenY CSS px relative to canvas\r\n     * @returns {COMPLEX} [deltaX, deltaY] offset from current pan\r\n     */\r\n    screenToPanDelta(screenX, screenY) {\r\n        const [vx, vy] = this.screenToViewVector(screenX, screenY);\r\n        return [vx * this.zoom, vy * this.zoom];\r\n    }\r\n\r\n    /**\r\n     * Convert a screen point to the rotated, aspect-corrected \"view vector\" (no pan/zoom applied).\r\n     * This is exactly what your shader calls `rotated`.\r\n     *\r\n     * @param {number} screenX CSS pixels relative to canvas (like your handlers use)\r\n     * @param {number} screenY CSS pixels relative to canvas\r\n     * @returns {number[]} view-space rotated vector\r\n     */\r\n    screenToViewVector(screenX, screenY) {\r\n        const dpr = window.devicePixelRatio || 1;\r\n        const rect = this.canvas.getBoundingClientRect();\r\n        const w = rect.width * dpr;\r\n        const h = rect.height * dpr;\r\n\r\n        const bufferX = screenX * dpr;\r\n        const bufferY = screenY * dpr;\r\n\r\n        const normX = bufferX / w;\r\n        const normY = bufferY / h;\r\n\r\n        let stX = normX - 0.5;\r\n        let stY = (1 - normY) - 0.5;\r\n\r\n        const aspect = w / h;\r\n        stX *= aspect;\r\n\r\n        const cosR = Math.cos(this.rotation);\r\n        const sinR = Math.sin(this.rotation);\r\n\r\n        return [cosR * stX - sinR * stY, sinR * stX + cosR * stY];\r\n    }\r\n\r\n    /**\r\n     * Compute CSS-space center of the canvas (for default anchored zoom).\r\n     * @returns {number[]}\r\n     */\r\n    getCanvasCssCenter() {\r\n        const rect = this.canvas.getBoundingClientRect();\r\n        return [rect.width / 2, rect.height / 2];\r\n    }\r\n\r\n    // endregion--------------------------------------------------------------------------------------------------------\r\n    // region > ANIMATION METHODS --------------------------------------------------------------------------------------\r\n\r\n    /** Stops all currently running animations that are not a color transition */\r\n    stopAllNonColorAnimations() {\r\n        console.log(`%c ${this.constructor.name}: %c stopAllNonColorAnimations`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n\r\n        this.stopCurrentPanAnimation();\r\n        this.stopCurrentZoomAnimation();\r\n        this.stopCurrentRotationAnimation();\r\n    }\r\n\r\n    /** Stops currently running pan animation */\r\n    stopCurrentPanAnimation() {\r\n        console.log(`%c ${this.constructor.name}: %c stopCurrentPanAnimation`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n\r\n        if (this.currentPanAnimationFrame !== null) {\r\n            cancelAnimationFrame(this.currentPanAnimationFrame);\r\n            this.currentPanAnimationFrame = null;\r\n        }\r\n    }\r\n\r\n    /** Stops currently running zoom animation */\r\n    stopCurrentZoomAnimation() {\r\n        console.log(`%c ${this.constructor.name}: %c stopCurrentZoomAnimation`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n\r\n        if (this.currentZoomAnimationFrame !== null) {\r\n            cancelAnimationFrame(this.currentZoomAnimationFrame);\r\n            this.currentZoomAnimationFrame = null;\r\n        }\r\n    }\r\n\r\n    /** Stops currently running rotation animation */\r\n    stopCurrentRotationAnimation() {\r\n        console.log(`%c ${this.constructor.name}: %c stopCurrentRotationAnimation`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n\r\n        if (this.currentRotationAnimationFrame !== null) {\r\n            cancelAnimationFrame(this.currentRotationAnimationFrame);\r\n            this.currentRotationAnimationFrame = null;\r\n        }\r\n    }\r\n\r\n    /** Stops currently running color animation */\r\n    stopCurrentColorAnimations() {\r\n        console.log(`%c ${this.constructor.name}: %c stopCurrentColorAnimation`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n\r\n        // Track if we're stopping an active cycle\r\n        const wasActivelyCycling = this.paletteCyclingActive && !this._inPaletteCycleTransition;\r\n\r\n        // Stop palette cycling if active (but not during internal palette transition)\r\n        if (this.paletteCyclingActive && !this._inPaletteCycleTransition) {\r\n            this.paletteCyclingActive = false;\r\n            if (this.paletteCyclingTimeoutId) {\r\n                clearTimeout(this.paletteCyclingTimeoutId);\r\n                this.paletteCyclingTimeoutId = null;\r\n            }\r\n        }\r\n\r\n        if (this.currentColorAnimationFrame !== null) {\r\n            // Handle both requestAnimationFrame and setTimeout\r\n            cancelAnimationFrame(this.currentColorAnimationFrame);\r\n            clearTimeout(this.currentColorAnimationFrame);\r\n            this.currentColorAnimationFrame = null;\r\n        }\r\n\r\n        // Resolve any pending color animation promise so Promise.all doesn't hang\r\n        if (this._colorAnimationResolve) {\r\n            this._colorAnimationResolve();\r\n            this._colorAnimationResolve = null;\r\n        }\r\n\r\n        // Update UI button state if cycling was stopped\r\n        if (wasActivelyCycling && typeof window !== 'undefined') {\r\n            const cycleBtn = document.getElementById('palette-cycle');\r\n            if (cycleBtn) {\r\n                cycleBtn.classList.remove('active');\r\n            }\r\n        }\r\n    }\r\n\r\n    /** Stops current demo and resets demo variables */\r\n    stopDemo() {\r\n        console.log(`%c ${this.constructor.name}: %c stopDemo`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n        this.demoActive = false;\r\n        if (FF_DEMO_ALWAYS_RESETS) this.currentPresetIndex = 0;\r\n        this.stopAllNonColorAnimations();\r\n    }\r\n\r\n    /** Default callback after every animation that requires on-screen info update */\r\n    onAnimationFinished() {\r\n        setTimeout(() => updateInfo(), 50);\r\n    }\r\n\r\n    /**\r\n     * Smoothly transitions fractalApp.colorPalette from its current value\r\n     * to the provided newPalette over the specified duration (in milliseconds).\r\n     *\r\n     * @param {PALETTE} newPalette - The target palette as [r, g, b] (each in [0,1]).\r\n     * @param {number} [duration] - Duration of the transition in milliseconds.\r\n     * @param {Function} [coloringCallback] A method called at every animation step\r\n     * @return {Promise<void>}\r\n     */\r\n    async animateColorPaletteTransition(newPalette, duration = 250, coloringCallback = null) {\r\n        console.groupCollapsed(`%c ${this.constructor.name}: animateColorPaletteTransition`, CONSOLE_GROUP_STYLE);\r\n        this.stopCurrentColorAnimations();\r\n\r\n        if (comparePalettes(this.colorPalette, newPalette)) {\r\n            console.warn(`Identical palette found. Skipping.`);\r\n            return;\r\n        }\r\n        console.log(`Animating to ${newPalette}.`);\r\n\r\n        const startPalette = [...this.colorPalette];\r\n\r\n        await new Promise((resolve) => {\r\n            // Store resolve so stopCurrentColorAnimations can call it if interrupted\r\n            this._colorAnimationResolve = resolve;\r\n            let startTime = null;\r\n\r\n            const step = (timestamp) => {\r\n                if (!startTime) startTime = timestamp;\r\n                const progress = Math.min((timestamp - startTime) / duration, 1);\r\n\r\n                this.colorPalette = [\r\n                    lerp(startPalette[0], newPalette[0], progress),\r\n                    lerp(startPalette[1], newPalette[1], progress),\r\n                    lerp(startPalette[2], newPalette[2], progress),\r\n                ];\r\n                this.draw();\r\n\r\n                if (coloringCallback) coloringCallback();\r\n\r\n                if (progress < 1) {\r\n                    this.currentColorAnimationFrame = requestAnimationFrame(step);\r\n                } else {\r\n                    this._colorAnimationResolve = null;\r\n                    this.stopCurrentColorAnimations();\r\n                    console.groupEnd();\r\n                    resolve();\r\n                }\r\n            };\r\n            this.currentColorAnimationFrame = requestAnimationFrame(step);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Animates fractalApp.colorPalette by cycling through the entire color space.\r\n     * The palette will continuously change hue from 0 to 360 degrees and starts from the current palette\r\n     *\r\n     * @param {number} [duration] - Duration (in milliseconds) for one full color cycle.\r\n     * @param {Function} [coloringCallback]\r\n     * @return {Promise<void>}\r\n     */\r\n    async animateFullColorSpaceCycle(duration = 15000, coloringCallback = null) {\r\n        console.log(`%c ${this.constructor.name}: animateFullColorSpaceCycle`, CONSOLE_GROUP_STYLE);\r\n        this.stopCurrentColorAnimations();\r\n\r\n        const currentRGB = this.colorPalette;\r\n        const hsl = rgbToHsl(currentRGB[0], currentRGB[1], currentRGB[2]);\r\n        const startHue = hsl[0]; // starting hue in [0, 1]\r\n        const fixedS = 1.0;\r\n        const fixedL = 0.6;\r\n\r\n        // Return a Promise that never resolves (continuous animation)\r\n        await new Promise(() => {\r\n            let startTime = null;\r\n\r\n            const step = (timestamp) => {\r\n                if (!startTime) startTime = timestamp;\r\n                const progress = Math.min((timestamp - startTime) / duration, 1);\r\n\r\n                const newHue = (startHue + progress) % 1;\r\n\r\n                this.colorPalette = hslToRgb(newHue, fixedS, fixedL);\r\n                this.draw();\r\n\r\n                if (coloringCallback) coloringCallback();\r\n\r\n                this.currentColorAnimationFrame = requestAnimationFrame(step);\r\n            };\r\n            this.currentColorAnimationFrame = requestAnimationFrame(step);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Starts continuous sequential palette cycling.\r\n     * Smoothly transitions through all palettes in order, looping indefinitely.\r\n     *\r\n     * @param {number} [transitionDuration=2000] - Duration for each palette transition in ms.\r\n     * @param {number} [holdDuration=3000] - Duration to hold each palette before transitioning.\r\n     * @param {Function} [coloringCallback] - Callback during transitions (called per frame).\r\n     * @param {Function} [onPaletteComplete] - Callback when each palette transition completes.\r\n     * @return {Promise<void>}\r\n     */\r\n    async startPaletteCycling(transitionDuration = 2000, holdDuration = 3000, coloringCallback = null, onPaletteComplete = null) {\r\n        console.log(`%c ${this.constructor.name}: startPaletteCycling`, CONSOLE_GROUP_STYLE);\r\n        this.stopCurrentColorAnimations();\r\n\r\n        if (!this.PALETTES || this.PALETTES.length === 0) {\r\n            console.warn('No palettes available for cycling');\r\n            return;\r\n        }\r\n\r\n        // Use a cycling flag since applyPaletteByIndex clears currentColorAnimationFrame\r\n        this.paletteCyclingActive = true;\r\n\r\n        // Update UI button state\r\n        if (typeof window !== 'undefined') {\r\n            const cycleBtn = document.getElementById('palette-cycle');\r\n            if (cycleBtn && !cycleBtn.classList.contains('active')) {\r\n                cycleBtn.classList.add('active');\r\n            }\r\n        }\r\n\r\n        // Start from current palette or 0\r\n        let nextIndex = (this.currentPaletteIndex >= 0 ? this.currentPaletteIndex + 1 : 1) % this.PALETTES.length;\r\n\r\n        const cycleNext = async () => {\r\n            if (!this.paletteCyclingActive) return; // Stopped\r\n\r\n            // Apply next palette with transition (protect cycling flag during transition)\r\n            this._inPaletteCycleTransition = true;\r\n            await this.applyPaletteByIndex(nextIndex, transitionDuration, coloringCallback);\r\n            this._inPaletteCycleTransition = false;\r\n\r\n            // Notify that palette transition completed\r\n            if (this.paletteCyclingActive && onPaletteComplete) {\r\n                onPaletteComplete();\r\n            }\r\n\r\n            if (!this.paletteCyclingActive) return; // Stopped during transition\r\n\r\n            // Move to next palette\r\n            nextIndex = (nextIndex + 1) % this.PALETTES.length;\r\n\r\n            // Schedule next cycle after hold duration\r\n            this.paletteCyclingTimeoutId = setTimeout(() => {\r\n                if (this.paletteCyclingActive) {\r\n                    cycleNext();\r\n                }\r\n            }, holdDuration);\r\n        };\r\n\r\n        // Mark as active (for stopCurrentColorAnimations check) and start\r\n        this.currentColorAnimationFrame = 1; // Non-null marker\r\n        await cycleNext();\r\n    }\r\n\r\n    /**\r\n     * Transitions between palettes by their unique identifiers, animating the change over the specified duration.\r\n     *\r\n     * @param {PRESET} preset - The configuration object containing the palette definition.\r\n     * @param {string} preset.paletteId - The unique identifier for the target palette.\r\n     * @param {number} duration - The duration of the animation in milliseconds.\r\n     * @param {function} coloringCallback\r\n     * @return {Promise<void>} Resolves once the palette transition animation is complete.\r\n     */\r\n    async animatePaletteByIdTransition(preset, duration, coloringCallback = null) {\r\n        console.groupCollapsed(`%c ${this.constructor.name}: animatePaletteByIdTransition`, CONSOLE_GROUP_STYLE);\r\n        if (preset.paletteId) {\r\n            log(`Preset palette definition found: \"${preset.paletteId}\"`);\r\n            const paletteIndex = this.PALETTES.findIndex(p => p.id === preset.paletteId);\r\n            if (paletteIndex >= 0) {\r\n                await this.applyPaletteByIndex(paletteIndex, duration, coloringCallback);\r\n            } else {\r\n                console.warn(`Palette \"${preset.paletteId}\" not found in PALETTES`);\r\n            }\r\n        } else {\r\n            log(`Preset palette definition not found, keeping current palette.`);\r\n        }\r\n        console.groupEnd();\r\n    }\r\n\r\n    /**\r\n     * Animates pan from current position to the new one\r\n     *\r\n     * @param {COMPLEX} targetPan\r\n     * @param [duration] in ms\r\n     * @param {EASE_TYPE|Function} easeFunction\r\n     * @return {Promise<void>}\r\n     */\r\n    async animatePanTo(targetPan, duration = 200, easeFunction = EASE_TYPE.NONE) {\r\n        console.groupCollapsed(`%c ${this.constructor.name}: animatePanTo`, CONSOLE_GROUP_STYLE);\r\n        this.stopCurrentPanAnimation();\r\n\r\n        this.markOrbitDirty();\r\n\r\n        if (compareComplex(this.pan, targetPan, 6)) {\r\n            console.log(`Already at the target pan. Skipping.`);\r\n            console.groupEnd();\r\n            return;\r\n        }\r\n        console.log(`Panning to ${targetPan}.`);\r\n\r\n        const startPan = [...this.pan];\r\n\r\n        await new Promise((resolve) => {\r\n            let startTime = null;\r\n\r\n            const step = (timestamp) => {\r\n                if (!startTime) startTime = timestamp;\r\n                const t = Math.min((timestamp - startTime) / duration, 1);\r\n\r\n                const k = easeFunction(t);\r\n\r\n                const nx = lerp(startPan[0], targetPan[0], k);\r\n                const ny = lerp(startPan[1], targetPan[1], k);\r\n                this.setPan(nx, ny);\r\n\r\n                this.draw();\r\n                updateInfo(true);\r\n\r\n                if (t < 1) {\r\n                    this.currentPanAnimationFrame = requestAnimationFrame(step);\r\n                } else {\r\n                    this.markOrbitDirty();\r\n                    this.draw();\r\n                    this.stopCurrentPanAnimation();\r\n                    this.onAnimationFinished();\r\n                    console.groupEnd();\r\n                    resolve();\r\n                }\r\n            };\r\n            this.currentPanAnimationFrame = requestAnimationFrame(step);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Animates pan by a delta (DD-stable). Unlike animatePanTo, this avoids computing\r\n     * targetPan = startPan + delta in a single float64 operation (which breaks in deep zoom).\r\n     *\r\n     * This method applies incremental DD pan updates based on animation progress.\r\n     *\r\n     * @param {COMPLEX} deltaPan\r\n     * @param [duration] in ms\r\n     * @param {EASE_TYPE|Function} easeFunction\r\n     * @return {Promise}\r\n     */\r\n    async animatePanBy(deltaPan, duration = 200, easeFunction = EASE_TYPE.NONE) {\r\n        console.groupCollapsed(`%c ${this.constructor.name}: animatePanBy`, CONSOLE_GROUP_STYLE);\r\n        this.stopCurrentPanAnimation();\r\n\r\n        this.markOrbitDirty();\r\n\r\n        if (Math.abs(deltaPan[0]) < 1e-30 && Math.abs(deltaPan[1]) < 1e-30) {\r\n            console.log(`Zero delta pan. Skipping.`);\r\n            console.groupEnd();\r\n            return;\r\n        }\r\n\r\n        console.log(`Panning by ${deltaPan}.`);\r\n\r\n        await new Promise((resolve) => {\r\n            let startTime = null;\r\n            let prevK = 0;\r\n\r\n            const step = (timestamp) => {\r\n                if (!startTime) startTime = timestamp;\r\n\r\n                const t = Math.min((timestamp - startTime) / duration, 1);\r\n                const k = easeFunction(t);\r\n\r\n                const dk = k - prevK;\r\n                prevK = k;\r\n\r\n                if (dk !== 0) {\r\n                    this.addPan(deltaPan[0] * dk, deltaPan[1] * dk);\r\n                }\r\n\r\n                this.draw();\r\n                updateInfo(true);\r\n\r\n                if (t < 1) {\r\n                    this.currentPanAnimationFrame = requestAnimationFrame(step);\r\n                } else {\r\n                    this.markOrbitDirty();\r\n                    this.draw();\r\n                    this.stopCurrentPanAnimation();\r\n                    this.onAnimationFinished();\r\n                    console.groupEnd();\r\n                    resolve();\r\n                }\r\n            };\r\n\r\n            this.currentPanAnimationFrame = requestAnimationFrame(step);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Animates zoom while keeping the fractal point under an anchor screen coordinate fixed.\r\n     *\r\n     * @param {number} targetZoom\r\n     * @param {number} [duration]\r\n     * @param {EASE_TYPE|Function} easeFunction\r\n     * @param {number|null} [anchorX] CSS px relative to canvas; defaults to canvas center\r\n     * @param {number|null} [anchorY] CSS px relative to canvas; defaults to canvas center\r\n     */\r\n    async animateZoomTo(targetZoom, duration = 500, easeFunction = EASE_TYPE.NONE, anchorX = null, anchorY = null) {\r\n        console.groupCollapsed(`%c ${this.constructor.name}: animateZoomTo`, CONSOLE_GROUP_STYLE);\r\n        this.stopCurrentZoomAnimation();\r\n\r\n        if (this.zoom.toFixed(20) === targetZoom.toFixed(20)) {\r\n            console.log(`Already at the target zoom. Skipping.`);\r\n            console.groupEnd();\r\n            return;\r\n        }\r\n\r\n        // Default anchor = canvas center (CSS)\r\n        if (anchorX === null || anchorY === null) {\r\n            const [cx, cy] = this.getCanvasCssCenter();\r\n            anchorX = cx;\r\n            anchorY = cy;\r\n        }\r\n\r\n        const startZoom = this.zoom;\r\n        const ratio = targetZoom / startZoom;\r\n\r\n        // Compute anchor once. During zoom animation, rotation is constant, so view-vector stays valid.\r\n        const [vx, vy] = this.screenToViewVector(anchorX, anchorY);\r\n        const fxAnchor = vx * startZoom + this.pan[0];\r\n        const fyAnchor = vy * startZoom + this.pan[1];\r\n\r\n        // orbit boundary policy hook (safe no-op for non-perturbation renderers)\r\n        this.markOrbitDirty();\r\n\r\n        await new Promise((resolve) => {\r\n            let startTime = null;\r\n\r\n            const step = (timestamp) => {\r\n                if (!startTime) startTime = timestamp;\r\n\r\n                const t = Math.min((timestamp - startTime) / duration, 1);\r\n\r\n                if (easeFunction !== EASE_TYPE.NONE) {\r\n                    const k = easeFunction(t);\r\n                    this.zoom = startZoom + (targetZoom - startZoom) * k;\r\n                } else {\r\n                    this.zoom = startZoom * Math.pow(ratio, t);\r\n                }\r\n\r\n                // Recompute pan from the fixed anchor point (stable in deep zoom)\r\n                this.setPanFromAnchor(fxAnchor, fyAnchor, vx, vy);\r\n\r\n                this.markOrbitDirty();\r\n                this.draw();\r\n                updateInfo(true);\r\n\r\n                if (t < 1) {\r\n                    this.currentZoomAnimationFrame = requestAnimationFrame(step);\r\n                } else {\r\n                    this.markOrbitDirty();\r\n                    this.draw();\r\n                    this.stopCurrentZoomAnimation();\r\n                    this.onAnimationFinished();\r\n                    console.groupEnd();\r\n                    resolve();\r\n                }\r\n            };\r\n\r\n            this.currentZoomAnimationFrame = requestAnimationFrame(step);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Animates zoom from current value to target zoom without adjusting pan position.\r\n     * Unlike animateZoomTo, this method does not keep any anchor point fixed during zooming.\r\n     * The fractal will appear to zoom in/out from its current center position.\r\n     *\r\n     * @param {number} targetZoom - The target zoom level to animate to\r\n     * @param {number} [duration=500] - Duration of the animation in milliseconds\r\n     * @param {EASE_TYPE|Function} [easeFunction=EASE_TYPE.NONE] - Easing function to apply; EASE_TYPE.NONE uses exponential interpolation\r\n     * @returns {Promise<void>} Promise that resolves when the animation completes\r\n     */\r\n    async animateZoomToNoPan(targetZoom, duration = 500, easeFunction = EASE_TYPE.NONE) {\r\n        console.groupCollapsed(`%c ${this.constructor.name}: animateZoomToNoPan`, CONSOLE_GROUP_STYLE);\r\n\r\n        this.stopCurrentZoomAnimation();\r\n\r\n        this.markOrbitDirty();\r\n\r\n        if (this.zoom.toFixed(20) === targetZoom.toFixed(20)) {\r\n            console.log(`Already at the target zoom. Skipping.`);\r\n            console.groupEnd();\r\n            return;\r\n        }\r\n\r\n        const startZoom = this.zoom;\r\n\r\n        await new Promise((resolve) => {\r\n            let startTime = null;\r\n\r\n            const step = (timestamp) => {\r\n                if (!startTime) startTime = timestamp;\r\n                const t = Math.min((timestamp - startTime) / duration, 1);\r\n\r\n                if (easeFunction !== EASE_TYPE.NONE) {\r\n                    const k = easeFunction(t);\r\n                    this.zoom = startZoom + (targetZoom - startZoom) * k;\r\n                } else {\r\n                    this.zoom = startZoom * Math.pow(targetZoom / startZoom, t);\r\n                }\r\n\r\n                this.draw();\r\n                updateInfo(true);\r\n\r\n                if (t < 1) {\r\n                    this.currentZoomAnimationFrame = requestAnimationFrame(step);\r\n                } else {\r\n                    this.markOrbitDirty();\r\n                    this.draw();\r\n                    this.stopCurrentZoomAnimation();\r\n                    this.onAnimationFinished();\r\n                    console.groupEnd();\r\n                    resolve();\r\n                }\r\n            };\r\n            this.currentZoomAnimationFrame = requestAnimationFrame(step);\r\n        });\r\n    }\r\n\r\n    async animateRotationTo(targetRotation, duration = 500, easeFunction = EASE_TYPE.NONE) {\r\n        console.groupCollapsed(`%c ${this.constructor.name}: animateRotationTo`, CONSOLE_GROUP_STYLE);\r\n        this.stopCurrentRotationAnimation();\r\n\r\n        // Compare actual values (not normalized) to allow multi-spin animations\r\n        if (this.rotation.toFixed(6) === targetRotation.toFixed(6)) {\r\n            console.log(`Already at the target rotation \"${targetRotation}\". Skipping.`);\r\n            console.groupEnd();\r\n            return;\r\n        }\r\n        console.log(`Rotating from ${this.rotation.toFixed(6)} to ${targetRotation.toFixed(6)}.`);\r\n\r\n        const startRotation = this.rotation;\r\n\r\n        await new Promise((resolve) => {\r\n            let startTime = null;\r\n\r\n            const step = (timestamp) => {\r\n                if (!startTime) startTime = timestamp;\r\n                const t = Math.min((timestamp - startTime) / duration, 1);\r\n\r\n                const k = easeFunction(t);\r\n\r\n                this.rotation = lerp(startRotation, targetRotation, k);\r\n                this.draw();\r\n                updateInfo(true);\r\n\r\n                if (t < 1) {\r\n                    this.currentRotationAnimationFrame = requestAnimationFrame(step);\r\n                } else {\r\n                    // Normalize final rotation to keep it in valid range\r\n                    this.rotation = normalizeRotation(this.rotation);\r\n                    this.draw();\r\n                    this.stopCurrentRotationAnimation();\r\n                    this.onAnimationFinished();\r\n                    console.groupEnd();\r\n                    resolve();\r\n                }\r\n            };\r\n            this.currentRotationAnimationFrame = requestAnimationFrame(step);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Animates sequential pan and then zooms into the target location.\r\n     *\r\n     * @param {COMPLEX} targetPan\r\n     * @param {number} targetZoom\r\n     * @param {number} panDuration in milliseconds\r\n     * @param {number} zoomDuration in milliseconds\r\n     * @param {EASE_TYPE|Function} easeFunction\r\n     * @return {Promise<void>}\r\n     */\r\n    async animatePanThenZoomTo(targetPan, targetZoom, panDuration, zoomDuration, easeFunction = EASE_TYPE.NONE) {\r\n        console.groupCollapsed(`%c ${this.constructor.name}: animatePanThenZoomTo`, CONSOLE_GROUP_STYLE);\r\n\r\n        await this.animatePanTo(targetPan, panDuration, easeFunction);\r\n        await this.animateZoomTo(targetZoom, zoomDuration, easeFunction);\r\n\r\n        console.groupEnd();\r\n    }\r\n\r\n    /**\r\n     * Animates pan and zoom simultaneously.\r\n     *\r\n     * @param {COMPLEX} targetPan\r\n     * @param {number} targetZoom\r\n     * @param {number} [duration] in milliseconds\r\n     * @param {EASE_TYPE|Function} easeFunction\r\n     * @return {Promise<void>}\r\n     */\r\n    async animatePanAndZoomTo(targetPan, targetZoom, duration = 1000, easeFunction = EASE_TYPE.NONE) {\r\n        console.groupCollapsed(`%c ${this.constructor.name}: animatePanAndZoomTo`, CONSOLE_GROUP_STYLE);\r\n\r\n        await Promise.all([\r\n            this.animatePanTo(targetPan, duration, easeFunction),\r\n            this.animateZoomToNoPan(targetZoom, duration, easeFunction),\r\n        ]);\r\n\r\n        console.groupEnd();\r\n    }\r\n\r\n    /**\r\n     * Animates pan by delta and zoom simultaneously.\r\n     * Uses addPan() internally to preserve DD precision at deep zoom levels.\r\n     *\r\n     * @param {COMPLEX} deltaPan - offset to add to current pan\r\n     * @param {number} targetZoom\r\n     * @param {number} [duration] in milliseconds\r\n     * @param {EASE_TYPE|Function} easeFunction\r\n     * @return {Promise<void>}\r\n     */\r\n    async animatePanByAndZoomTo(deltaPan, targetZoom, duration = 1000, easeFunction = EASE_TYPE.NONE) {\r\n        console.groupCollapsed(`%c ${this.constructor.name}: animatePanByAndZoomTo`, CONSOLE_GROUP_STYLE);\r\n\r\n        await Promise.all([\r\n            this.animatePanBy(deltaPan, duration, easeFunction),\r\n            this.animateZoomToNoPan(targetZoom, duration, easeFunction),\r\n        ]);\r\n\r\n        console.groupEnd();\r\n    }\r\n\r\n    async animateZoomRotationTo(targetZoom, targetRotation, duration = 500, easeFunction = EASE_TYPE.NONE) {\r\n        console.groupCollapsed(`%c ${this.constructor.name}: animateZoomRotationTo`, CONSOLE_GROUP_STYLE);\r\n\r\n        await Promise.all([\r\n            this.animateZoomTo(targetZoom, duration, easeFunction),\r\n            this.animateRotationTo(targetRotation, duration, EASE_TYPE.CUBIC)\r\n        ]);\r\n\r\n        console.groupEnd();\r\n    }\r\n\r\n    async animatePanZoomRotationTo(targetPan, targetZoom, targetRotation, duration = 500, easeFunction = EASE_TYPE.NONE) {\r\n        console.groupCollapsed(`%c ${this.constructor.name}: animatePanZoomRotationTo`, CONSOLE_GROUP_STYLE);\r\n\r\n        await Promise.all([\r\n            this.animatePanTo(targetPan, duration, easeFunction),\r\n            this.animateZoomToNoPan(targetZoom, duration, easeFunction),\r\n            this.animateRotationTo(targetRotation, duration, easeFunction)\r\n        ]);\r\n\r\n        console.groupEnd();\r\n    }\r\n\r\n    async animateInfiniteRotation(direction, step = 0.001) {\r\n        console.groupCollapsed(`%c ${this.constructor.name}: animateInfiniteRotation`, CONSOLE_GROUP_STYLE);\r\n        this.stopCurrentRotationAnimation();\r\n\r\n        const dir = direction >= 0 ? 1 : -1;\r\n\r\n        await new Promise(() => {\r\n            const rotationStep = () => {\r\n                this.rotation = normalizeRotation(this.rotation + dir * step + 2 * PI);\r\n                this.draw();\r\n                updateInfo(true);\r\n                this.currentRotationAnimationFrame = requestAnimationFrame(rotationStep);\r\n            };\r\n            this.currentRotationAnimationFrame = requestAnimationFrame(rotationStep);\r\n        });\r\n        console.groupEnd();\r\n    }\r\n\r\n    // endregion--------------------------------------------------------------------------------------------------------\r\n}\r\n\r\nexport default FractalRenderer;","/** @type {string} */\r\nimport fragmentShaderRaw from '../shaders/julia.preview.frag';\r\nimport FractalRenderer from \"./fractalRenderer\";\r\nimport data from '../data/julia.json';\r\nimport {DEFAULT_JULIA_PALETTE} from \"../global/constants\";\r\n\r\n/**\r\n * Julia Set Preview Renderer (legacy)\r\n *\r\n * @author Radim Brnka\r\n * @description Simplified renderer for Julia preview in Mandelbrot mode\r\n * @extends FractalRenderer\r\n * @since 1.9\r\n */\r\nexport class JuliaPreviewRenderer extends FractalRenderer {\r\n\r\n    constructor(canvas) {\r\n        super(canvas);\r\n\r\n        this.MAX_ITER = 500;\r\n        this.extraIterations = 0;\r\n\r\n        this.DEFAULT_ZOOM = 2.5;\r\n\r\n        /** @type COMPLEX */\r\n        this.DEFAULT_C = [-0.246, 0.64235];\r\n\r\n        this.zoom = this.DEFAULT_ZOOM;\r\n        this.pan = [...this.DEFAULT_PAN]; // Copy\r\n        this.rotation = this.DEFAULT_ROTATION;\r\n        this.DEFAULT_PALETTE = data.palettes[0].theme || DEFAULT_JULIA_PALETTE.theme;\r\n        this.colorPalette = [...this.DEFAULT_PALETTE];\r\n\r\n        /** @type COMPLEX */\r\n        this.c = [...this.DEFAULT_C];\r\n\r\n        /** @type {Array.<JULIA_PRESET>} */\r\n        this.PRESETS = [];\r\n\r\n        /** @type {Array.<DIVE>} */\r\n        this.DIVES = [];\r\n\r\n        this.innerStops = new Float32Array(this.DEFAULT_PALETTE);\r\n\r\n        this.currentCAnimationFrame = null;\r\n        this.demoTime = 0;\r\n\r\n        this.init();\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    createFragmentShaderSource() {\r\n        return fragmentShaderRaw.replace('__MAX_ITER__', this.MAX_ITER).toString();\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    updateUniforms() {\r\n        super.updateUniforms();\r\n\r\n        this.cLoc = this.gl.getUniformLocation(this.program, 'u_c');\r\n        this.innerStopsLoc = this.gl.getUniformLocation(this.program, 'u_innerStops');\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    draw() {\r\n        this.gl.useProgram(this.program);\r\n\r\n        const baseIters = Math.floor(3000 * Math.pow(2, -Math.log2(this.zoom)));\r\n        this.iterations = Math.min(2000, baseIters + this.extraIterations);\r\n\r\n        // Pass Julia constant `c`\r\n        this.gl.uniform2fv(this.cLoc, this.c);\r\n        this.gl.uniform3fv(this.innerStopsLoc, this.innerStops);\r\n\r\n        super.draw();\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    reset() {\r\n        this.c = [...this.DEFAULT_C];\r\n        this.colorPalette = [...this.DEFAULT_PALETTE];\r\n        this.innerStops = new Float32Array(this.colorPalette);\r\n        this.extraIterations = 0;\r\n\r\n        this.draw();\r\n    }\r\n\r\n    // region > ANIMATION METHODS --------------------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Updates the palette and redraws.\r\n     * @param {number[]|Float32Array} newPalette - The inner stops array (15 floats for 5 RGB colors)\r\n     * @param {number} [duration] - Ignored for preview (instant transition)\r\n     * @param {Function} [coloringCallback] - Callback after palette change\r\n     * @return {Promise<void>}\r\n     */\r\n    async animateColorPaletteTransition(newPalette, duration = 250, coloringCallback = null) {\r\n        if (!newPalette) return Promise.resolve();\r\n\r\n        // Update inner stops from the provided palette\r\n        this.innerStops = new Float32Array(newPalette);\r\n\r\n        // Derive colorPalette from stop index 3 (brightest color typically)\r\n        const stopIndex = 3;\r\n        this.colorPalette = [\r\n            newPalette[stopIndex * 3] * 1.5,\r\n            newPalette[stopIndex * 3 + 1] * 1.5,\r\n            newPalette[stopIndex * 3 + 2] * 1.5\r\n        ];\r\n\r\n        // Redraw with new palette\r\n        this.draw();\r\n\r\n        if (coloringCallback) coloringCallback();\r\n\r\n        return Promise.resolve();\r\n    }\r\n\r\n    needsRebase() {\r\n        return false;\r\n    }\r\n\r\n    onProgramCreated() {\r\n\r\n    }\r\n\r\n    // endregion--------------------------------------------------------------------------------------------------------\r\n}","/**\r\n * @module JuliaPreview\r\n * @author Radim Brnka\r\n * @description Manages the floating Julia set preview shown on middle-click in Mandelbrot mode.\r\n * @copyright Synaptory Fractal Traveler, 2025-2026\r\n * @license MIT\r\n */\r\n\r\nimport {CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE} from \"../global/constants\";\r\nimport {JuliaPreviewRenderer} from \"../renderers/juliaPreviewRenderer\";\r\n\r\n/** @type {HTMLCanvasElement} */\r\nlet floatingCanvas = null;\r\n\r\n/** @type {JuliaPreviewRenderer} */\r\nlet previewRenderer = null;\r\n\r\n/** @type {boolean} */\r\nlet previewActive = false;\r\n\r\n/** @type {Float32Array|null} */\r\nlet pendingInnerStops = null;\r\n\r\n/** Preview canvas size in pixels */\r\nconst PREVIEW_WIDTH = 250;\r\nconst PREVIEW_HEIGHT = 200;\r\n\r\n/** Offset from cursor position */\r\nconst CURSOR_OFFSET_X = 20;\r\nconst CURSOR_OFFSET_Y = 20;\r\n\r\n/**\r\n * Initializes the Julia preview system.\r\n * Should be called once during app initialization.\r\n */\r\nexport function initJuliaPreview() {\r\n    floatingCanvas = document.getElementById('floatingCanvas');\r\n    if (!floatingCanvas) {\r\n        console.error('floatingCanvas element not found!');\r\n        return;\r\n    }\r\n\r\n    // Set canvas dimensions (physical pixels for rendering)\r\n    floatingCanvas.width = PREVIEW_WIDTH * window.devicePixelRatio;\r\n    floatingCanvas.height = PREVIEW_HEIGHT * window.devicePixelRatio;\r\n\r\n    // Set CSS dimensions (display size)\r\n    floatingCanvas.style.width = `${PREVIEW_WIDTH}px`;\r\n    floatingCanvas.style.height = `${PREVIEW_HEIGHT}px`;\r\n}\r\n\r\n/**\r\n * Shows the Julia preview at the given screen position with the specified c parameter.\r\n * @param {number} screenX - Screen X coordinate (clientX)\r\n * @param {number} screenY - Screen Y coordinate (clientY)\r\n * @param {number} cx - Real part of Julia c parameter\r\n * @param {number} cy - Imaginary part of Julia c parameter\r\n */\r\nexport function showJuliaPreview(screenX, screenY, cx, cy) {\r\n    if (!floatingCanvas) {\r\n        initJuliaPreview();\r\n    }\r\n\r\n    // Create renderer on first show\r\n    if (!previewRenderer) {\r\n        previewRenderer = new JuliaPreviewRenderer(floatingCanvas);\r\n        // Use lower iteration count for responsiveness\r\n        previewRenderer.MAX_ITER = 500;\r\n        previewRenderer.extraIterations = 0;\r\n        console.log(`%c JuliaPreview: %c Created preview renderer`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n\r\n        // Apply any pending palette that was set before renderer was created\r\n        if (pendingInnerStops) {\r\n            previewRenderer.innerStops = pendingInnerStops;\r\n            pendingInnerStops = null;\r\n        }\r\n    }\r\n\r\n    // Update c parameter\r\n    previewRenderer.c = [cx, cy];\r\n    previewRenderer.markOrbitDirty();\r\n\r\n    // Position the canvas near cursor\r\n    updatePreviewPosition(screenX, screenY);\r\n\r\n    // Show the canvas\r\n    floatingCanvas.style.display = 'block';\r\n    previewActive = true;\r\n\r\n    // Render the Julia set\r\n    previewRenderer.draw();\r\n}\r\n\r\n/**\r\n * Updates the Julia preview position and c parameter as the mouse moves.\r\n * @param {number} screenX - Screen X coordinate (clientX)\r\n * @param {number} screenY - Screen Y coordinate (clientY)\r\n * @param {number} cx - Real part of Julia c parameter\r\n * @param {number} cy - Imaginary part of Julia c parameter\r\n */\r\nexport function updateJuliaPreview(screenX, screenY, cx, cy) {\r\n    if (!previewActive || !previewRenderer) return;\r\n\r\n    // Update c parameter\r\n    previewRenderer.c = [cx, cy];\r\n    previewRenderer.markOrbitDirty();\r\n\r\n    // Update position\r\n    updatePreviewPosition(screenX, screenY);\r\n\r\n    // Re-render\r\n    previewRenderer.draw();\r\n}\r\n\r\n/**\r\n * Updates the floating canvas position relative to cursor.\r\n * Ensures the preview stays within viewport bounds.\r\n * @param {number} screenX - Screen X coordinate\r\n * @param {number} screenY - Screen Y coordinate\r\n */\r\nfunction updatePreviewPosition(screenX, screenY) {\r\n    if (!floatingCanvas) return;\r\n\r\n    const viewportWidth = window.innerWidth;\r\n    const viewportHeight = window.innerHeight;\r\n\r\n    // Default position: below and to the right of cursor\r\n    let left = screenX + CURSOR_OFFSET_X;\r\n    let top = screenY + CURSOR_OFFSET_Y;\r\n\r\n    // Flip to left side if would overflow right edge\r\n    if (left + PREVIEW_WIDTH > viewportWidth) {\r\n        left = screenX - PREVIEW_WIDTH - CURSOR_OFFSET_X;\r\n    }\r\n\r\n    // Flip to above cursor if would overflow bottom edge\r\n    if (top + PREVIEW_HEIGHT > viewportHeight) {\r\n        top = screenY - PREVIEW_HEIGHT - CURSOR_OFFSET_Y;\r\n    }\r\n\r\n    // Clamp to viewport bounds\r\n    left = Math.max(0, Math.min(left, viewportWidth - PREVIEW_WIDTH));\r\n    top = Math.max(0, Math.min(top, viewportHeight - PREVIEW_HEIGHT));\r\n\r\n    floatingCanvas.style.left = `${left}px`;\r\n    floatingCanvas.style.top = `${top}px`;\r\n}\r\n\r\n/**\r\n * Hides the Julia preview.\r\n */\r\nexport function hideJuliaPreview() {\r\n    if (!previewActive) return;\r\n\r\n    previewActive = false;\r\n\r\n    if (floatingCanvas) {\r\n        floatingCanvas.style.display = 'none';\r\n    }\r\n\r\n    console.log(`%c JuliaPreview: %c Preview hidden`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n}\r\n\r\n/**\r\n * Recolors the Julia preview with a new palette.\r\n * @param {number[]} palette - RGB palette [r, g, b] in range [0,1]\r\n */\r\nexport function recolorJuliaPreview(palette) {\r\n    if (!palette || palette.length < 3) return;\r\n\r\n    // Convert 3-float RGB palette to 15-float inner stops for Julia shader\r\n    // Pattern matches Cosmos palette: black -> color -> black -> bright -> dark\r\n    const innerStops = new Float32Array([\r\n        0, 0, 0,                                              // stop 0: black\r\n        palette[0], palette[1], palette[2],                   // stop 1: the color\r\n        0, 0, 0,                                              // stop 2: black (keeps dark background)\r\n        palette[0] * 1.2, palette[1] * 1.2, palette[2] * 1.2, // stop 3: brighter highlight\r\n        0.1, 0.1, 0.1                                         // stop 4: dark version\r\n    ]);\r\n\r\n    if (previewRenderer) {\r\n        // Renderer exists - update immediately\r\n        previewRenderer.animateColorPaletteTransition(innerStops).then();\r\n    } else {\r\n        // Store for later when renderer is created\r\n        pendingInnerStops = innerStops;\r\n    }\r\n}\r\n\r\n/**\r\n * Resets the Julia preview renderer to default state.\r\n */\r\nexport function resetJuliaPreview() {\r\n    if (!previewRenderer) {\r\n        console.warn(`%c JuliaPreview: %c Cannot reset - renderer not initialized`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n        return;\r\n    }\r\n\r\n    previewRenderer.reset();\r\n}\r\n\r\n/**\r\n * Destroys the Julia preview renderer and cleans up resources.\r\n * Call this when switching away from Mandelbrot mode.\r\n */\r\nexport function destroyJuliaPreview() {\r\n    hideJuliaPreview();\r\n\r\n    if (previewRenderer) {\r\n        previewRenderer.destroy();\r\n        previewRenderer = null;\r\n        console.log(`%c JuliaPreview: %c Preview renderer destroyed`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n    }\r\n}\r\n\r\n/**\r\n * Returns whether the preview is currently active.\r\n * @returns {boolean}\r\n */\r\nexport function isJuliaPreviewActive() {\r\n    return previewActive;\r\n}\r\n","/**\r\n * @module MouseEventHandlers\r\n * @author Radim Brnka\r\n * @description This module exports a function registerMouseEventHandlers that sets up all mouse events. It interacts directly with the fractalRenderer instance.\r\n * @copyright Synaptory Fractal Traveler, 2025-2026\r\n * @license MIT\r\n */\r\n\r\nimport {normalizeRotation, updateURLParams} from '../global/utils.js';\r\nimport {getCurrentPaletteId, isJuliaMode, resetAppState, updateInfo} from './ui.js';\r\nimport {CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE, DEBUG_MODE, EASE_TYPE, FRACTAL_TYPE} from \"../global/constants\";\r\nimport {hideJuliaPreview, initJuliaPreview, showJuliaPreview, updateJuliaPreview} from \"./juliaPreview\";\r\n\r\n/** How long should we wait before distinguish between double click and two single clicks. */\r\nconst DOUBLE_CLICK_THRESHOLD = 300;\r\n/** Tolerance of mouse movement before drag starts. */\r\nconst DRAG_THRESHOLD = 5;\r\nconst ZOOM_STEP = 0.05; // double-click zoom in/out\r\nconst ROTATION_SENSITIVITY = 0.01;\r\n/** Maximum distance from origin to prevent panning out of view */\r\nexport const MAX_PAN_DISTANCE = 3.5; // Fractals are contained within ~radius 2, allow some margin\r\n\r\n/** Long press zoom configuration */\r\nconst LONG_PRESS_THRESHOLD = 400; // ms before zoom starts\r\nconst LONG_PRESS_ZOOM_IN_FACTOR = 0.985; // zoom multiplier per frame (smaller = faster zoom in)\r\nconst LONG_PRESS_ZOOM_OUT_FACTOR = 1.015; // zoom multiplier per frame (larger = faster zoom out)\r\n\r\n// Wheel smoothing (reduces micro-jitter due to bursty wheel events)\r\nconst WHEEL_ZOOM_BASE = 1.1;\r\nconst WHEEL_DELTA_UNIT = 120;\r\n\r\nlet canvas;\r\nlet fractalApp;\r\n\r\n/** Global variable to track registration */\r\nlet mouseHandlersRegistered = false;\r\n\r\n// Stored references to event handler functions\r\nlet handleWheelEvent;\r\nlet handleMouseDownEvent;\r\nlet handleMouseMoveEvent;\r\nlet handleMouseUpEvent;\r\nlet handleMouseLeaveEvent;\r\n\r\nlet mouseDownX = 0, mouseDownY = 0;\r\nlet lastX = 0, lastY = 0;\r\nlet clickTimeout = null;\r\nlet wheelResetTimeout = null;\r\nlet isDragging = false;\r\nlet wasRotated = false;\r\n\r\n// Long press zoom state (left button - zoom in)\r\nlet longPressTimeout = null;\r\nlet longPressZoomActive = false;\r\nlet longPressZoomRAF = null;\r\nlet longPressAnchorX = 0;\r\nlet longPressAnchorY = 0;\r\n\r\n// Long press zoom state (right button - zoom out)\r\nlet rightLongPressTimeout = null;\r\nlet rightLongPressZoomActive = false;\r\nlet rightLongPressZoomRAF = null;\r\nlet rightLongPressAnchorX = 0;\r\nlet rightLongPressAnchorY = 0;\r\n\r\n// Rotation\r\nlet isRightDragging = false;\r\nlet startX = 0;\r\n\r\n// Middle-click Julia preview\r\nlet isMiddleButtonHeld = false;\r\n\r\n// Cached rect (avoid layout thrash / inconsistencies during drag)\r\nlet dragRectLeft = 0;\r\n\r\n/**\r\n * Clamps pan delta to ensure resulting pan stays within bounds\r\n * @param {Array<number>} currentPan - Current pan [x, y]\r\n * @param {Array<number>} deltaPan - Proposed delta [dx, dy]\r\n * @returns {Array<number>} - Clamped delta [dx, dy]\r\n */\r\nexport function clampPanDelta(currentPan, deltaPan) {\r\n    const newPanX = currentPan[0] + deltaPan[0];\r\n    const newPanY = currentPan[1] + deltaPan[1];\r\n    const distance = Math.sqrt(newPanX * newPanX + newPanY * newPanY);\r\n\r\n    // If within bounds, return unchanged\r\n    if (distance <= MAX_PAN_DISTANCE) {\r\n        return deltaPan;\r\n    }\r\n\r\n    // Clamp to max distance by scaling back the new position\r\n    const scale = MAX_PAN_DISTANCE / distance;\r\n    const clampedPanX = newPanX * scale;\r\n    const clampedPanY = newPanY * scale;\r\n\r\n    // Return the delta that would achieve the clamped position\r\n    const clampedDeltaX = clampedPanX - currentPan[0];\r\n    const clampedDeltaY = clampedPanY - currentPan[1];\r\n\r\n    console.log(`%c clampPanDelta: %c Pan would exceed bounds (distance: ${distance.toFixed(2)} > ${MAX_PAN_DISTANCE}). Clamping to [${clampedDeltaX.toFixed(4)}, ${clampedDeltaY.toFixed(4)}]`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n\r\n    return [clampedDeltaX, clampedDeltaY];\r\n}\r\nlet dragRectTop = 0;\r\nlet hasDragRect = false;\r\n\r\n// Wheel RAF aggregation\r\nlet wheelAccum = 0;\r\nlet wheelAnchorX = 0;\r\nlet wheelAnchorY = 0;\r\nlet wheelRAF = null;\r\n// Cached rect for wheel zoom (avoid sub-pixel jitter from repeated getBoundingClientRect calls)\r\nlet wheelRectLeft = 0;\r\nlet wheelRectTop = 0;\r\nlet hasWheelRect = false;\r\n\r\n/**\r\n * Mark orbit dirty if the current renderer supports perturbation caching.\r\n * IMPORTANT: must NOT trigger orbit rebuild immediately (renderers should defer).\r\n */\r\nfunction markOrbitDirtySafe() {\r\n    if (fractalApp && typeof fractalApp.markOrbitDirty === \"function\") {\r\n        fractalApp.markOrbitDirty();\r\n    } else if (fractalApp) {\r\n        // Fallback: do nothing; non-perturbation renderers won't need it.\r\n    }\r\n}\r\n\r\n/**\r\n * Initialization and registering of the event handlers.\r\n * @param {FractalRenderer} app\r\n */\r\nexport function initMouseHandlers(app) {\r\n    fractalApp = app;\r\n    canvas = app.canvas;\r\n    canvas.addEventListener(\"contextmenu\", (e) => e.preventDefault());\r\n    initJuliaPreview();\r\n    registerMouseEventHandlers();\r\n}\r\n\r\n/** Registers mouse handlers. */\r\nexport function registerMouseEventHandlers() {\r\n    if (mouseHandlersRegistered) {\r\n        console.warn(`%c registerMouseEventHandlers: %c Mouse event handlers already registered!`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n        return;\r\n    }\r\n\r\n    handleWheelEvent = (event) => handleWheel(event);\r\n    handleMouseDownEvent = (event) => handleMouseDown(event);\r\n    handleMouseMoveEvent = (event) => handleMouseMove(event);\r\n    handleMouseUpEvent = (event) => handleMouseUp(event);\r\n    handleMouseLeaveEvent = () => handleMouseLeave();\r\n\r\n    canvas.addEventListener('wheel', handleWheelEvent, {passive: false});\r\n    canvas.addEventListener('mousedown', handleMouseDownEvent);\r\n    canvas.addEventListener('mousemove', handleMouseMoveEvent);\r\n    canvas.addEventListener('mouseup', handleMouseUpEvent);\r\n    canvas.addEventListener('mouseleave', handleMouseLeaveEvent);\r\n\r\n    mouseHandlersRegistered = true;\r\n    console.log(`%c registerMouseEventHandlers: %c Event handlers registered`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n}\r\n\r\n/** Unregisters mouse handlers. */\r\nexport function unregisterMouseEventHandlers() {\r\n    if (!mouseHandlersRegistered) {\r\n        console.warn(`%c unregisterMouseEventHandlers: %c Event handlers are not registered so cannot be unregistered!`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n        return;\r\n    }\r\n\r\n    canvas.removeEventListener('wheel', handleWheelEvent, {passive: false});\r\n    canvas.removeEventListener('mousedown', handleMouseDownEvent);\r\n    canvas.removeEventListener('mousemove', handleMouseMoveEvent);\r\n    canvas.removeEventListener('mouseup', handleMouseUpEvent);\r\n    canvas.removeEventListener('mouseleave', handleMouseLeaveEvent);\r\n\r\n    mouseHandlersRegistered = false;\r\n    console.warn(`%c unregisterMouseEventHandlers: %c Event handlers unregistered`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n}\r\n\r\n// region > EVENT HANDLERS ---------------------------------------------------------------------------------------------\r\n\r\n/**\r\n * Start the continuous long press zoom-in loop (left button).\r\n * Zooms in toward the anchor point while allowing panning.\r\n */\r\nfunction startLongPressZoomIn() {\r\n    if (longPressZoomActive) return;\r\n    longPressZoomActive = true;\r\n    canvas.style.cursor = 'zoom-in';\r\n\r\n    function zoomLoop() {\r\n        if (!longPressZoomActive || !fractalApp) return;\r\n\r\n        const targetZoom = fractalApp.zoom * LONG_PRESS_ZOOM_IN_FACTOR;\r\n\r\n        if (targetZoom > fractalApp.MAX_ZOOM) {\r\n            // Use anchor-preserving zoom\r\n            fractalApp.setZoomKeepingAnchor(targetZoom, longPressAnchorX, longPressAnchorY);\r\n            markOrbitDirtySafe();\r\n            fractalApp.draw();\r\n            updateInfo(true);\r\n\r\n            longPressZoomRAF = requestAnimationFrame(zoomLoop);\r\n        } else {\r\n            // Reached max zoom, stop\r\n            stopLongPressZoomIn();\r\n        }\r\n    }\r\n\r\n    longPressZoomRAF = requestAnimationFrame(zoomLoop);\r\n    fractalApp.noteInteraction(160);\r\n}\r\n\r\n/**\r\n * Stop the long press zoom-in loop (left button).\r\n */\r\nfunction stopLongPressZoomIn() {\r\n    if (longPressTimeout) {\r\n        clearTimeout(longPressTimeout);\r\n        longPressTimeout = null;\r\n    }\r\n    if (longPressZoomRAF) {\r\n        cancelAnimationFrame(longPressZoomRAF);\r\n        longPressZoomRAF = null;\r\n    }\r\n    if (longPressZoomActive) {\r\n        longPressZoomActive = false;\r\n        canvas.style.cursor = 'crosshair';\r\n        resetAppState();\r\n    }\r\n}\r\n\r\n/**\r\n * Start the continuous long press zoom-out loop (right button).\r\n * Zooms out from the anchor point while allowing panning.\r\n */\r\nfunction startLongPressZoomOut() {\r\n    if (rightLongPressZoomActive) return;\r\n    rightLongPressZoomActive = true;\r\n    canvas.style.cursor = 'zoom-out';\r\n\r\n    function zoomLoop() {\r\n        if (!rightLongPressZoomActive || !fractalApp) return;\r\n\r\n        const targetZoom = fractalApp.zoom * LONG_PRESS_ZOOM_OUT_FACTOR;\r\n\r\n        if (targetZoom < fractalApp.MIN_ZOOM) {\r\n            // Use anchor-preserving zoom\r\n            fractalApp.setZoomKeepingAnchor(targetZoom, rightLongPressAnchorX, rightLongPressAnchorY);\r\n            markOrbitDirtySafe();\r\n            fractalApp.draw();\r\n            updateInfo(true);\r\n\r\n            rightLongPressZoomRAF = requestAnimationFrame(zoomLoop);\r\n        } else {\r\n            // Reached min zoom, stop\r\n            stopLongPressZoomOut();\r\n        }\r\n    }\r\n\r\n    rightLongPressZoomRAF = requestAnimationFrame(zoomLoop);\r\n    fractalApp.noteInteraction(160);\r\n}\r\n\r\n/**\r\n * Stop the long press zoom-out loop (right button).\r\n */\r\nfunction stopLongPressZoomOut() {\r\n    if (rightLongPressTimeout) {\r\n        clearTimeout(rightLongPressTimeout);\r\n        rightLongPressTimeout = null;\r\n    }\r\n    if (rightLongPressZoomRAF) {\r\n        cancelAnimationFrame(rightLongPressZoomRAF);\r\n        rightLongPressZoomRAF = null;\r\n    }\r\n    if (rightLongPressZoomActive) {\r\n        rightLongPressZoomActive = false;\r\n        canvas.style.cursor = 'crosshair';\r\n        resetAppState();\r\n    }\r\n}\r\n\r\n/**\r\n * Apply accumulated wheel delta once per RAF.\r\n * This reduces \"bursty wheel\" micro-jitter and keeps anchor math consistent.\r\n */\r\nfunction flushWheelZoom() {\r\n    wheelRAF = null;\r\n\r\n    if (!fractalApp) return;\r\n    if (!Number.isFinite(fractalApp.zoom)) return;\r\n\r\n    // Use cached rect to avoid sub-pixel jitter from repeated getBoundingClientRect calls\r\n    const mouseX = wheelAnchorX - wheelRectLeft; // CSS px\r\n    const mouseY = wheelAnchorY - wheelRectTop;  // CSS px\r\n\r\n    // Apply accumulated delta\r\n    const zoomFactor = Math.pow(WHEEL_ZOOM_BASE, wheelAccum / WHEEL_DELTA_UNIT);\r\n    const targetZoom = fractalApp.zoom * zoomFactor;\r\n\r\n    // reset accumulator early (avoid re-entrance issues)\r\n    wheelAccum = 0;\r\n\r\n    if (targetZoom < fractalApp.MAX_ZOOM || targetZoom > fractalApp.MIN_ZOOM) return;\r\n\r\n    // Stable deep-zoom anchor math (no before/after subtraction)\r\n    // Keeps the fractal point under cursor fixed while changing zoom.\r\n    fractalApp.setZoomKeepingAnchor(targetZoom, mouseX, mouseY);\r\n\r\n    // orbit rebuild request for perturbation renderers (deferred by renderer logic)\r\n    markOrbitDirtySafe();\r\n\r\n    updateInfo(true);\r\n    fractalApp.draw();\r\n}\r\n\r\nfunction handleWheel(event) {\r\n    event.preventDefault();\r\n\r\n    // Cache rect on first wheel event of a gesture to avoid sub-pixel jitter\r\n    if (!hasWheelRect) {\r\n        const rect = fractalApp.canvas.getBoundingClientRect();\r\n        wheelRectLeft = rect.left;\r\n        wheelRectTop = rect.top;\r\n        hasWheelRect = true;\r\n    }\r\n\r\n    // Aggregate wheel delta and apply once per frame.\r\n    wheelAccum += event.deltaY;\r\n    wheelAnchorX = event.clientX;\r\n    wheelAnchorY = event.clientY;\r\n\r\n    if (!wheelRAF) {\r\n        wheelRAF = requestAnimationFrame(flushWheelZoom);\r\n    }\r\n\r\n    if (wheelResetTimeout) clearTimeout(wheelResetTimeout);\r\n    wheelResetTimeout = setTimeout(() => {\r\n        hasWheelRect = false; // Reset rect cache when gesture ends\r\n        resetAppState();\r\n    }, 150);\r\n\r\n    fractalApp.noteInteraction(160);\r\n}\r\n\r\nfunction handleMouseDown(event) {\r\n    if (event.button === 0) {\r\n        isDragging = false;\r\n        mouseDownX = event.clientX;\r\n        mouseDownY = event.clientY;\r\n        lastX = event.clientX;\r\n        lastY = event.clientY;\r\n\r\n        // Cache rect origin for stable relative coordinates during the drag.\r\n        // (Avoids layout thrash and tiny inconsistencies.)\r\n        const rect = canvas.getBoundingClientRect();\r\n        dragRectLeft = rect.left;\r\n        dragRectTop = rect.top;\r\n        hasDragRect = true;\r\n\r\n        // Set up long press zoom anchor (relative to canvas)\r\n        longPressAnchorX = event.clientX - rect.left;\r\n        longPressAnchorY = event.clientY - rect.top;\r\n\r\n        // Start long press timer for zoom-in\r\n        if (longPressTimeout) clearTimeout(longPressTimeout);\r\n        longPressTimeout = setTimeout(() => {\r\n            // Only start zoom if we haven't started dragging\r\n            if (!isDragging) {\r\n                startLongPressZoomIn();\r\n            }\r\n        }, LONG_PRESS_THRESHOLD);\r\n    } else if (event.button === 2) { // Right-click\r\n        startX = event.clientX;\r\n\r\n        // Cache rect for right button long press zoom\r\n        const rect = canvas.getBoundingClientRect();\r\n        rightLongPressAnchorX = event.clientX - rect.left;\r\n        rightLongPressAnchorY = event.clientY - rect.top;\r\n\r\n        // Start long press timer for zoom-out\r\n        if (rightLongPressTimeout) clearTimeout(rightLongPressTimeout);\r\n        rightLongPressTimeout = setTimeout(() => {\r\n            // Only start zoom if we haven't started rotating\r\n            if (!isRightDragging) {\r\n                startLongPressZoomOut();\r\n            }\r\n        }, LONG_PRESS_THRESHOLD);\r\n    } else if (event.button === 1) { // Middle click - Julia preview\r\n        event.preventDefault();\r\n\r\n        // Only show Julia preview when in Mandelbrot mode\r\n        if (!isJuliaMode()) {\r\n            isMiddleButtonHeld = true;\r\n\r\n            // Get fractal coordinates at cursor position\r\n            const rect = canvas.getBoundingClientRect();\r\n            const mouseX = event.clientX - rect.left;\r\n            const mouseY = event.clientY - rect.top;\r\n            const [fx, fy] = fractalApp.screenToFractal(mouseX, mouseY);\r\n\r\n            // Show Julia preview with c = cursor fractal position\r\n            showJuliaPreview(event.clientX, event.clientY, fx, fy);\r\n        }\r\n    }\r\n}\r\n\r\nfunction handleMouseMove(event) {\r\n    const dx = event.clientX - mouseDownX;\r\n    const dy = event.clientY - mouseDownY;\r\n\r\n    if (event.buttons === 1) {\r\n        // If long press zoom is active, update anchor for panning while zooming\r\n        if (longPressZoomActive) {\r\n            const rect = canvas.getBoundingClientRect();\r\n            longPressAnchorX = event.clientX - rect.left;\r\n            longPressAnchorY = event.clientY - rect.top;\r\n            return; // Don't process as regular drag\r\n        }\r\n\r\n        if (!isDragging && (Math.abs(dx) > DRAG_THRESHOLD || Math.abs(dy) > DRAG_THRESHOLD)) {\r\n            isDragging = true;\r\n            // Cancel long press timer when drag starts\r\n            if (longPressTimeout) {\r\n                clearTimeout(longPressTimeout);\r\n                longPressTimeout = null;\r\n            }\r\n        }\r\n\r\n        if (isDragging) {\r\n            canvas.style.cursor = 'move';\r\n            if (clickTimeout) {\r\n                clearTimeout(clickTimeout);\r\n                clickTimeout = null;\r\n            }\r\n\r\n            // Use cached rect origin (fallback if not available).\r\n            let left = dragRectLeft;\r\n            let top = dragRectTop;\r\n            if (!hasDragRect) {\r\n                const rect = canvas.getBoundingClientRect();\r\n                left = rect.left;\r\n                top = rect.top;\r\n            }\r\n\r\n            // Stable deep-zoom pan delta:\r\n            // pan += zoom * (vLast - vNow)\r\n            const lastRelX = lastX - left;\r\n            const lastRelY = lastY - top;\r\n            const nowRelX = event.clientX - left;\r\n            const nowRelY = event.clientY - top;\r\n\r\n            const [vLastX, vLastY] = fractalApp.screenToViewVector(lastRelX, lastRelY);\r\n            const [vNowX,  vNowY ] = fractalApp.screenToViewVector(nowRelX, nowRelY);\r\n\r\n            if (Number.isFinite(fractalApp.zoom)) {\r\n                const deltaX = (vLastX - vNowX) * fractalApp.zoom;\r\n                const deltaY = (vLastY - vNowY) * fractalApp.zoom;\r\n\r\n                fractalApp.addPan(deltaX, deltaY);\r\n                // Mark orbit dirty (deferred rebuild)\r\n                markOrbitDirtySafe();\r\n\r\n                fractalApp.noteInteraction(160);\r\n            }\r\n\r\n            // Update last mouse coordinates.\r\n            lastX = event.clientX;\r\n            lastY = event.clientY;\r\n\r\n            fractalApp.draw();\r\n            updateInfo(true);\r\n        }\r\n    }\r\n\r\n    if (event.buttons === 2) {\r\n        // If right long press zoom is active, update anchor for panning while zooming\r\n        if (rightLongPressZoomActive) {\r\n            const rect = canvas.getBoundingClientRect();\r\n            rightLongPressAnchorX = event.clientX - rect.left;\r\n            rightLongPressAnchorY = event.clientY - rect.top;\r\n            return; // Don't process as rotation drag\r\n        }\r\n\r\n        if (!isRightDragging && (Math.abs(dx) > DRAG_THRESHOLD || Math.abs(dy) > DRAG_THRESHOLD)) {\r\n            isRightDragging = true;\r\n            // Cancel right long press timer when rotation drag starts\r\n            if (rightLongPressTimeout) {\r\n                clearTimeout(rightLongPressTimeout);\r\n                rightLongPressTimeout = null;\r\n            }\r\n        }\r\n\r\n        if (isRightDragging) {\r\n            event.preventDefault();\r\n            const deltaX = event.clientX - startX;\r\n\r\n            fractalApp.rotation = normalizeRotation(fractalApp.rotation + deltaX * ROTATION_SENSITIVITY);\r\n            fractalApp.draw();\r\n\r\n            startX = event.clientX; // Update starting point for smooth rotation\r\n            wasRotated = true;\r\n            canvas.style.cursor = 'grabbing'; // Use a grabbing cursor for rotation\r\n            updateInfo();\r\n        }\r\n    }\r\n\r\n    // Middle button held - update Julia preview\r\n    if (event.buttons === 4 && isMiddleButtonHeld && !isJuliaMode()) {\r\n        const rect = canvas.getBoundingClientRect();\r\n        const mouseX = event.clientX - rect.left;\r\n        const mouseY = event.clientY - rect.top;\r\n        const [fx, fy] = fractalApp.screenToFractal(mouseX, mouseY);\r\n\r\n        updateJuliaPreview(event.clientX, event.clientY, fx, fy);\r\n    }\r\n}\r\n\r\nfunction handleMouseUp(event) {\r\n    // Process only for left (0), middle (1), or right (2) mouse buttons.\r\n    if (![0, 1, 2].includes(event.button)) return;\r\n\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n\r\n    // Stop long press zoom-in on left button up\r\n    if (event.button === 0) {\r\n        if (longPressZoomActive) {\r\n            stopLongPressZoomIn();\r\n            return; // Don't process as click\r\n        }\r\n        // Cancel pending long press timer\r\n        if (longPressTimeout) {\r\n            clearTimeout(longPressTimeout);\r\n            longPressTimeout = null;\r\n        }\r\n    }\r\n\r\n    // Stop long press zoom-out on right button up\r\n    if (event.button === 2) {\r\n        if (rightLongPressZoomActive) {\r\n            stopLongPressZoomOut();\r\n            return; // Don't process as right-click\r\n        }\r\n        // Cancel pending right long press timer\r\n        if (rightLongPressTimeout) {\r\n            clearTimeout(rightLongPressTimeout);\r\n            rightLongPressTimeout = null;\r\n        }\r\n    }\r\n\r\n    if (event.button === 1) { // Middle-click - hide Julia preview\r\n        if (isMiddleButtonHeld) {\r\n            isMiddleButtonHeld = false;\r\n            hideJuliaPreview();\r\n        }\r\n        return;\r\n    }\r\n\r\n    if (event.button === 0) { // Left click\r\n        // Release drag cache\r\n        hasDragRect = false;\r\n\r\n        if (!isDragging) {\r\n            const rect = canvas.getBoundingClientRect();\r\n            const mouseX = event.clientX - rect.left;\r\n            const mouseY = event.clientY - rect.top;\r\n\r\n            // If there is already a pending click, then we have a double-click.\r\n            if (clickTimeout !== null) { // --- Double-click action ---\r\n                clearTimeout(clickTimeout);\r\n                clickTimeout = null;\r\n\r\n                const targetZoom = fractalApp.zoom * ZOOM_STEP;\r\n                if (targetZoom > fractalApp.MAX_ZOOM) {\r\n                    // Use delta-based pan to preserve DD precision at deep zoom\r\n                    let deltaPan = fractalApp.screenToPanDelta(mouseX, mouseY);\r\n\r\n                    // Clamp to prevent panning out of view\r\n                    deltaPan = clampPanDelta(fractalApp.pan, deltaPan);\r\n\r\n                    console.log(`%c handleMouseUp: %c Double Left Click: Centering on ${mouseX}x${mouseY} -> delta [${deltaPan[0]}, ${deltaPan[1]}] zoom ${fractalApp.zoom.toFixed(6)} -> ${targetZoom}`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n                    fractalApp.animatePanByAndZoomTo(deltaPan, targetZoom, 1000, EASE_TYPE.QUINT).then(resetAppState);\r\n                } else {\r\n                    console.log(`%c handleMouseUp: %c Double Left Click: Over max zoom. Skipping`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n                }\r\n            } else {\r\n                // Set a timeout for the single-click action.\r\n                clickTimeout = setTimeout(() => {\r\n                    // Use delta-based pan to preserve DD precision at deep zoom\r\n                    let deltaPan = fractalApp.screenToPanDelta(mouseX, mouseY);\r\n\r\n                    // Clamp to prevent panning out of view\r\n                    deltaPan = clampPanDelta(fractalApp.pan, deltaPan);\r\n\r\n                    console.log(`%c handleMouseUp: %c Single Left Click: Centering on ${mouseX}x${mouseY} -> delta [${deltaPan[0]}, ${deltaPan[1]}]`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n\r\n                    // Centering action using delta-based pan:\r\n                    fractalApp.animatePanBy(deltaPan, 500).then(() => {\r\n                        resetAppState();\r\n                        // Get the updated fractal coordinates after pan\r\n                        const [newFx, newFy] = fractalApp.screenToFractal(mouseX, mouseY);\r\n                        if (isJuliaMode()) {\r\n                            updateURLParams(FRACTAL_TYPE.JULIA, newFx, newFy, fractalApp.zoom, fractalApp.rotation, fractalApp.c[0], fractalApp.c[1], getCurrentPaletteId());\r\n                        } else {\r\n                            updateURLParams(FRACTAL_TYPE.MANDELBROT, newFx, newFy, fractalApp.zoom, fractalApp.rotation, null, null, getCurrentPaletteId());\r\n                        }\r\n                    });\r\n\r\n                    navigator.clipboard.writeText(window.location.href).then(\r\n                        () => console.log(`%c handleMouseUp: %c Copied URL to clipboard!`, CONSOLE_MESSAGE_STYLE),\r\n                        (err) => console.error(`%c handleMouseUp: %c Not copied to clipboard! ${err}`, CONSOLE_MESSAGE_STYLE)\r\n                    );\r\n\r\n                    clickTimeout = null;\r\n                }, DOUBLE_CLICK_THRESHOLD);\r\n            }\r\n        } else {\r\n            resetAppState();\r\n            isDragging = false;\r\n\r\n            // Final settle rebuild request (renderer decides when to rebuild)\r\n            markOrbitDirtySafe();\r\n            fractalApp.draw();\r\n        }\r\n    }\r\n\r\n    if (event.button === 2) { // Right mouse button released\r\n        if (isRightDragging) {\r\n            isRightDragging = false;\r\n\r\n            if (DEBUG_MODE) console.log(`%c handleMouseUp: %c Single Right Click: Doing nothing.`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n\r\n            if (wasRotated) resetAppState();\r\n            wasRotated = false;\r\n            canvas.style.cursor = 'crosshair';\r\n            return; // Prevent further processing if it was a drag\r\n        }\r\n\r\n        // Handle right-click double-click detection\r\n        const rect = canvas.getBoundingClientRect();\r\n        const mouseX = event.clientX - rect.left;\r\n        const mouseY = event.clientY - rect.top;\r\n\r\n        if (clickTimeout !== null) {\r\n            // Double-click detected\r\n            clearTimeout(clickTimeout);\r\n            clickTimeout = null;\r\n\r\n            const targetZoom = fractalApp.zoom / ZOOM_STEP;\r\n            if (targetZoom < fractalApp.MIN_ZOOM) {\r\n                // Use delta-based pan to preserve DD precision at deep zoom\r\n                let deltaPan = fractalApp.screenToPanDelta(mouseX, mouseY);\r\n\r\n                // Clamp to prevent panning out of view\r\n                deltaPan = clampPanDelta(fractalApp.pan, deltaPan);\r\n\r\n                console.log(`%c handleMouseUp: %c Double Right Click: Centering on ${mouseX}x${mouseY} -> delta [${deltaPan[0]}, ${deltaPan[1]}] zoom ${fractalApp.zoom.toFixed(6)} -> ${targetZoom}`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n                fractalApp.animatePanByAndZoomTo(deltaPan, targetZoom, 1000, EASE_TYPE.QUINT).then(resetAppState);\r\n            } else {\r\n                console.log(`%c handleMouseUp: %c Double Right Click: Over min zoom. Skipping`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n            }\r\n        } else {\r\n            clickTimeout = setTimeout(() => { clickTimeout = null; }, DOUBLE_CLICK_THRESHOLD);\r\n        }\r\n\r\n        isRightDragging = false;\r\n    }\r\n\r\n    canvas.style.cursor = 'crosshair';\r\n}\r\n\r\nfunction handleMouseLeave() {\r\n    // Stop long press zooms if mouse leaves canvas\r\n    stopLongPressZoomIn();\r\n    stopLongPressZoomOut();\r\n\r\n    // Hide Julia preview if mouse leaves canvas while middle button is held\r\n    if (isMiddleButtonHeld) {\r\n        isMiddleButtonHeld = false;\r\n        hideJuliaPreview();\r\n    }\r\n}\r\n\r\n// endregion -----------------------------------------------------------------------------------------------------------","/**\r\n * @module TouchEventHandlers\r\n * @author Radim Brnka\r\n * @description This module exports a function registerTouchEventHandlers that sets up all touch events. It interacts directly with the fractalRenderer instance.\r\n * @copyright Synaptory Fractal Traveler, 2025-2026\r\n * @license MIT\r\n */\r\n\r\nimport {normalizeRotation, updateURLParams} from '../global/utils.js';\r\nimport {getCurrentPaletteId, isJuliaMode, resetAppState, updateInfo} from './ui.js';\r\nimport {CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE, FRACTAL_TYPE} from \"../global/constants\";\r\nimport {clampPanDelta} from \"./mouseEventHandlers\";\r\n\r\n/** How long should we wait before distinguish between double tap and two single taps. */\r\nconst DOUBLE_TAP_THRESHOLD = 300;\r\n/** Tolerance of finger movements before drag starts with move gesture. */\r\nconst DRAG_THRESHOLD = 5;\r\nconst ZOOM_STEP = 0.05;\r\n/** Tolerance of finger movements before rotation starts with pinch gesture. */\r\nconst ROTATION_THRESHOLD = 0.05;\r\nconst ROTATION_SENSITIVITY = 1;\r\n\r\n/** Long press zoom configuration */\r\nconst LONG_PRESS_THRESHOLD = 400; // ms before zoom starts\r\nconst LONG_PRESS_ZOOM_IN_FACTOR = 0.965; // zoom multiplier per frame (smaller = faster zoom in)\r\n\r\nlet canvas;\r\nlet fractalApp;\r\n\r\n/** Global variable to track registration */\r\nlet touchHandlersRegistered = false;\r\n\r\n// Stored references to event handler functions\r\nlet handleTouchStartEvent;\r\nlet handleTouchMoveEvent;\r\nlet handleTouchEndEvent;\r\n\r\nlet touchDownX = 0, touchDownY = 0;\r\nlet lastTouchX = 0, lastTouchY = 0;\r\nlet touchClickTimeout = null;\r\nlet isTouchDragging = false;\r\n\r\n// Cached rect (avoid layout thrash / inconsistencies during drag)\r\nlet dragRectLeft = 0;\r\nlet dragRectTop = 0;\r\nlet hasDragRect = false;\r\n\r\n// Pinch state variables\r\nlet isPinching = false;\r\nlet pinchStartDistance = null;\r\nlet pinchStartAngle = null;\r\nlet lastPinchCenterX = null;\r\nlet lastPinchCenterY = null;\r\n\r\n// Long press zoom state\r\nlet longPressTimeout = null;\r\nlet longPressZoomActive = false;\r\nlet longPressZoomRAF = null;\r\nlet longPressAnchorX = 0;\r\nlet longPressAnchorY = 0;\r\n\r\n/**\r\n * Mark orbit dirty if the current renderer supports perturbation caching.\r\n * IMPORTANT: must NOT trigger orbit rebuild immediately (renderers should defer).\r\n */\r\nfunction markOrbitDirtySafe() {\r\n    if (fractalApp && typeof fractalApp.markOrbitDirty === \"function\") {\r\n        fractalApp.markOrbitDirty();\r\n    } else if (fractalApp) {\r\n        // Fallback: do nothing; non-perturbation renderers won't need it.\r\n    }\r\n}\r\n\r\n/**\r\n * Initialization and registering of the event handlers.\r\n * @param {FractalRenderer} app\r\n */\r\nexport function initTouchHandlers(app) {\r\n    if (!app || !app.canvas) {\r\n        console.warn(`%c initTouchHandlers: %c App or canvas not provided.`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n        return;\r\n    }\r\n\r\n    fractalApp = app;\r\n    canvas = app.canvas;\r\n    canvas.addEventListener('contextmenu', (e) => e.preventDefault());\r\n\r\n    registerTouchEventHandlers();\r\n}\r\n\r\n/** Registers touch handlers. */\r\nexport function registerTouchEventHandlers() {\r\n    if (!canvas) {\r\n        console.warn(`%c registerTouchEventHandlers: %c Canvas not initialized. Call initTouchHandlers first.`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n        return;\r\n    }\r\n\r\n    if (touchHandlersRegistered) {\r\n        console.warn(`%c registerTouchEventHandlers: %c Event handlers already registered!`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n        return;\r\n    }\r\n\r\n    handleTouchStartEvent = (event) => handleTouchStart(event);\r\n    handleTouchMoveEvent = (event) => handleTouchMove(event);\r\n    handleTouchEndEvent = (event) => handleTouchEnd(event);\r\n\r\n    canvas.addEventListener('touchstart', handleTouchStartEvent, {passive: false});\r\n    canvas.addEventListener('touchmove', handleTouchMoveEvent, {passive: false});\r\n    canvas.addEventListener('touchend', handleTouchEndEvent, {passive: false});\r\n\r\n    touchHandlersRegistered = true;\r\n    console.log(`%c registerTouchEventHandlers: %c Touch event handlers registered`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n}\r\n\r\n/** Unregisters touch handlers. */\r\nexport function unregisterTouchEventHandlers() {\r\n    if (!canvas || !touchHandlersRegistered) {\r\n        return;\r\n    }\r\n\r\n    canvas.removeEventListener('touchstart', handleTouchStartEvent, {passive: false});\r\n    canvas.removeEventListener('touchmove', handleTouchMoveEvent, {passive: false});\r\n    canvas.removeEventListener('touchend', handleTouchEndEvent, {passive: false});\r\n\r\n    touchHandlersRegistered = false;\r\n    console.warn(`%c unregisterTouchEventHandlers: %c Event handlers unregistered`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n}\r\n\r\n// region > EVENT HANDLERS ---------------------------------------------------------------------------------------------\r\n\r\n/**\r\n * Start the continuous long press zoom-in loop for touch.\r\n * Zooms in toward the anchor point while allowing panning.\r\n */\r\nfunction startLongPressZoomIn() {\r\n    if (longPressZoomActive) return;\r\n    longPressZoomActive = true;\r\n\r\n    function zoomLoop() {\r\n        if (!longPressZoomActive || !fractalApp) return;\r\n\r\n        const targetZoom = fractalApp.zoom * LONG_PRESS_ZOOM_IN_FACTOR;\r\n\r\n        if (targetZoom > fractalApp.MAX_ZOOM) {\r\n            // Use anchor-preserving zoom\r\n            fractalApp.setZoomKeepingAnchor(targetZoom, longPressAnchorX, longPressAnchorY);\r\n            markOrbitDirtySafe();\r\n            fractalApp.draw();\r\n            updateInfo(true);\r\n\r\n            longPressZoomRAF = requestAnimationFrame(zoomLoop);\r\n        } else {\r\n            // Reached max zoom, stop\r\n            stopLongPressZoomIn();\r\n        }\r\n    }\r\n\r\n    longPressZoomRAF = requestAnimationFrame(zoomLoop);\r\n    fractalApp.noteInteraction(160);\r\n}\r\n\r\n/**\r\n * Stop the long press zoom-in loop for touch.\r\n */\r\nfunction stopLongPressZoomIn() {\r\n    if (longPressTimeout) {\r\n        clearTimeout(longPressTimeout);\r\n        longPressTimeout = null;\r\n    }\r\n    if (longPressZoomRAF) {\r\n        cancelAnimationFrame(longPressZoomRAF);\r\n        longPressZoomRAF = null;\r\n    }\r\n    if (longPressZoomActive) {\r\n        longPressZoomActive = false;\r\n        resetAppState();\r\n    }\r\n}\r\n\r\nfunction handleTouchStart(event) {\r\n    if (!fractalApp) return;\r\n\r\n    if (event.touches.length === 1) {\r\n        event.preventDefault();\r\n\r\n        isTouchDragging = false;\r\n        isPinching = false;\r\n\r\n        pinchStartDistance = null;\r\n        pinchStartAngle = null;\r\n\r\n        const touch = event.touches[0];\r\n        touchDownX = touch.clientX;\r\n        touchDownY = touch.clientY;\r\n        lastTouchX = touch.clientX;\r\n        lastTouchY = touch.clientY;\r\n\r\n        // Cache rect origin for stable relative coordinates during the drag.\r\n        const rect = canvas.getBoundingClientRect();\r\n        dragRectLeft = rect.left;\r\n        dragRectTop = rect.top;\r\n        hasDragRect = true;\r\n\r\n        // Set up long press zoom anchor (relative to canvas)\r\n        longPressAnchorX = touch.clientX - rect.left;\r\n        longPressAnchorY = touch.clientY - rect.top;\r\n\r\n        // Start long press timer\r\n        if (longPressTimeout) clearTimeout(longPressTimeout);\r\n        longPressTimeout = setTimeout(() => {\r\n            // Only start zoom if we haven't started dragging or pinching\r\n            if (!isTouchDragging && !isPinching) {\r\n                startLongPressZoomIn();\r\n            }\r\n        }, LONG_PRESS_THRESHOLD);\r\n\r\n        return;\r\n    }\r\n\r\n    if (event.touches.length === 2) {\r\n        event.preventDefault();\r\n\r\n        // Stop any long press zoom when switching to pinch\r\n        stopLongPressZoomIn();\r\n\r\n        // Two-finger gesture: pinch zoom + rotation + pan\r\n        isPinching = true;\r\n        isTouchDragging = false;\r\n\r\n        // Release drag cache (rect on-demand for pinch)\r\n        hasDragRect = false;\r\n\r\n        const touch0 = event.touches[0];\r\n        const touch1 = event.touches[1];\r\n\r\n        pinchStartDistance = Math.hypot(\r\n            touch0.clientX - touch1.clientX,\r\n            touch0.clientY - touch1.clientY\r\n        );\r\n\r\n        pinchStartAngle = Math.atan2(\r\n            touch1.clientY - touch0.clientY,\r\n            touch1.clientX - touch0.clientX\r\n        );\r\n\r\n        // Initialize midpoint for panning\r\n        const rect = canvas.getBoundingClientRect();\r\n        const centerClientX = (touch0.clientX + touch1.clientX) / 2;\r\n        const centerClientY = (touch0.clientY + touch1.clientY) / 2;\r\n        lastPinchCenterX = centerClientX - rect.left;\r\n        lastPinchCenterY = centerClientY - rect.top;\r\n\r\n        // Stop any pending single-tap click when pinch starts\r\n        if (touchClickTimeout) {\r\n            clearTimeout(touchClickTimeout);\r\n            touchClickTimeout = null;\r\n        }\r\n\r\n        fractalApp.noteInteraction(160);\r\n    }\r\n}\r\n\r\nfunction handleTouchMove(event) {\r\n    if (!fractalApp) return;\r\n\r\n    // Single touch drag (pan)\r\n    if (event.touches.length === 1 && !isPinching) {\r\n        event.preventDefault();\r\n\r\n        const touch = event.touches[0];\r\n\r\n        // If long press zoom is active, update anchor for panning while zooming\r\n        if (longPressZoomActive) {\r\n            const rect = canvas.getBoundingClientRect();\r\n            longPressAnchorX = touch.clientX - rect.left;\r\n            longPressAnchorY = touch.clientY - rect.top;\r\n            return; // Don't process as regular drag\r\n        }\r\n\r\n        const dx = touch.clientX - touchDownX;\r\n        const dy = touch.clientY - touchDownY;\r\n\r\n        if (!isTouchDragging && (Math.abs(dx) > DRAG_THRESHOLD || Math.abs(dy) > DRAG_THRESHOLD)) {\r\n            isTouchDragging = true;\r\n            // Cancel long press timer when drag starts\r\n            if (longPressTimeout) {\r\n                clearTimeout(longPressTimeout);\r\n                longPressTimeout = null;\r\n            }\r\n            if (touchClickTimeout) {\r\n                clearTimeout(touchClickTimeout);\r\n                touchClickTimeout = null;\r\n            }\r\n        }\r\n\r\n        if (isTouchDragging) {\r\n            // Use cached rect origin (fallback if not available).\r\n            let left = dragRectLeft;\r\n            let top = dragRectTop;\r\n            if (!hasDragRect) {\r\n                const rect = canvas.getBoundingClientRect();\r\n                left = rect.left;\r\n                top = rect.top;\r\n            }\r\n\r\n            // Stable deep-zoom pan delta:\r\n            // pan += zoom * (vLast - vNow)\r\n            const lastRelX = lastTouchX - left;\r\n            const lastRelY = lastTouchY - top;\r\n            const nowRelX = touch.clientX - left;\r\n            const nowRelY = touch.clientY - top;\r\n\r\n            const [vLastX, vLastY] = fractalApp.screenToViewVector(lastRelX, lastRelY);\r\n            const [vNowX,  vNowY ] = fractalApp.screenToViewVector(nowRelX, nowRelY);\r\n\r\n            if (Number.isFinite(fractalApp.zoom)) {\r\n                const deltaX = (vLastX - vNowX) * fractalApp.zoom;\r\n                const deltaY = (vLastY - vNowY) * fractalApp.zoom;\r\n\r\n                fractalApp.addPan(deltaX, deltaY);\r\n                markOrbitDirtySafe();\r\n                fractalApp.noteInteraction(160);\r\n            }\r\n\r\n            lastTouchX = touch.clientX;\r\n            lastTouchY = touch.clientY;\r\n\r\n            fractalApp.draw();\r\n            updateInfo(true);\r\n        }\r\n\r\n        return;\r\n    }\r\n\r\n    // Two-finger pinch: pan + zoom + rotation around midpoint\r\n    if (event.touches.length === 2) {\r\n        event.preventDefault();\r\n        isPinching = true;\r\n\r\n        const touch0 = event.touches[0];\r\n        const touch1 = event.touches[1];\r\n\r\n        const currentDistance = Math.hypot(\r\n            touch0.clientX - touch1.clientX,\r\n            touch0.clientY - touch1.clientY\r\n        );\r\n\r\n        const currentAngle = Math.atan2(\r\n            touch1.clientY - touch0.clientY,\r\n            touch1.clientX - touch0.clientX\r\n        );\r\n\r\n        // Midpoint in screen space\r\n        const centerClientX = (touch0.clientX + touch1.clientX) / 2;\r\n        const centerClientY = (touch0.clientY + touch1.clientY) / 2;\r\n\r\n        const rect = canvas.getBoundingClientRect();\r\n        const centerX = centerClientX - rect.left; // CSS px relative to canvas\r\n        const centerY = centerClientY - rect.top;\r\n\r\n        // Initialize baseline if missing (or if gesture restarted)\r\n        if (!pinchStartDistance || !pinchStartAngle || lastPinchCenterX === null || lastPinchCenterY === null) {\r\n            pinchStartDistance = currentDistance;\r\n            pinchStartAngle = currentAngle;\r\n            lastPinchCenterX = centerX;\r\n            lastPinchCenterY = centerY;\r\n            return;\r\n        }\r\n\r\n        // Pan: detect midpoint movement and apply pan delta\r\n        const centerDeltaX = centerX - lastPinchCenterX;\r\n        const centerDeltaY = centerY - lastPinchCenterY;\r\n\r\n        if (Math.abs(centerDeltaX) > 0.1 || Math.abs(centerDeltaY) > 0.1) {\r\n            // Convert screen delta to view delta and apply pan\r\n            const [vLastX, vLastY] = fractalApp.screenToViewVector(lastPinchCenterX, lastPinchCenterY);\r\n            const [vNowX, vNowY] = fractalApp.screenToViewVector(centerX, centerY);\r\n\r\n            if (Number.isFinite(fractalApp.zoom)) {\r\n                const deltaX = (vLastX - vNowX) * fractalApp.zoom;\r\n                const deltaY = (vLastY - vNowY) * fractalApp.zoom;\r\n                fractalApp.addPan(deltaX, deltaY);\r\n            }\r\n        }\r\n\r\n        // Zoom:\r\n        // If distance increases -> zoom in (smaller zoom value).\r\n        // So scale zoom proportionally: zoom *= (startDistance / currentDistance)\r\n        let targetZoom = fractalApp.zoom;\r\n        if (currentDistance > 0) {\r\n            const zoomFactor = pinchStartDistance / currentDistance;\r\n            targetZoom = fractalApp.zoom * zoomFactor;\r\n        }\r\n\r\n        // Clamp (same semantics as your mouse/wheel handlers)\r\n        if (targetZoom < fractalApp.MAX_ZOOM) targetZoom = fractalApp.MAX_ZOOM;\r\n        if (targetZoom > fractalApp.MIN_ZOOM) targetZoom = fractalApp.MIN_ZOOM;\r\n\r\n        // Apply zoom (without anchor adjustment since we handled pan separately)\r\n        fractalApp.zoom = targetZoom;\r\n\r\n        // Rotation (incremental, like mouse right-drag)\r\n        const angleDifference = currentAngle - pinchStartAngle;\r\n        if (Math.abs(angleDifference) > ROTATION_THRESHOLD) {\r\n            fractalApp.rotation = normalizeRotation(fractalApp.rotation + angleDifference * ROTATION_SENSITIVITY);\r\n        }\r\n\r\n        // Update baselines for next frame\r\n        pinchStartDistance = currentDistance;\r\n        pinchStartAngle = currentAngle;\r\n        lastPinchCenterX = centerX;\r\n        lastPinchCenterY = centerY;\r\n\r\n        markOrbitDirtySafe();\r\n        fractalApp.noteInteraction(160);\r\n\r\n        fractalApp.draw();\r\n        updateInfo();\r\n    }\r\n}\r\n\r\nfunction handleTouchEnd(event) {\r\n    if (!fractalApp) return;\r\n\r\n    // Reset pinch baseline when leaving 2-finger gesture.\r\n    if (event.touches.length < 2) {\r\n        pinchStartDistance = null;\r\n        pinchStartAngle = null;\r\n        lastPinchCenterX = null;\r\n        lastPinchCenterY = null;\r\n    }\r\n\r\n    // When all touches end, decide if it was tap/double-tap or drag/pinch end.\r\n    if (event.touches.length === 0) {\r\n        // Stop long press zoom on touch end\r\n        if (longPressZoomActive) {\r\n            stopLongPressZoomIn();\r\n            return; // Don't process as tap\r\n        }\r\n        // Cancel pending long press timer\r\n        if (longPressTimeout) {\r\n            clearTimeout(longPressTimeout);\r\n            longPressTimeout = null;\r\n        }\r\n\r\n        // End of a pinch gesture: just settle.\r\n        if (isPinching) {\r\n            isPinching = false;\r\n            resetAppState();\r\n\r\n            // Final settle rebuild request (renderer decides when to rebuild)\r\n            markOrbitDirtySafe();\r\n            fractalApp.draw();\r\n\r\n            return;\r\n        }\r\n\r\n        // Release drag cache\r\n        hasDragRect = false;\r\n\r\n        if (!isTouchDragging) {\r\n            const touch = event.changedTouches[0];\r\n\r\n            const rect = canvas.getBoundingClientRect();\r\n            const touchX = touch.clientX - rect.left;\r\n            const touchY = touch.clientY - rect.top;\r\n\r\n            if (touchClickTimeout !== null) {\r\n                clearTimeout(touchClickTimeout);\r\n                touchClickTimeout = null;\r\n\r\n                // Use delta-based pan to preserve DD precision at deep zoom\r\n                let deltaPan = fractalApp.screenToPanDelta(touchX, touchY);\r\n\r\n                // Clamp to prevent panning out of view\r\n                deltaPan = clampPanDelta(fractalApp.pan, deltaPan);\r\n\r\n                console.log(`%c handleTouchEnd: %c Double Tap: Centering on ${touchX}x${touchY} -> delta [${deltaPan[0]}, ${deltaPan[1]}]`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n\r\n                const targetZoom = fractalApp.zoom * ZOOM_STEP;\r\n                if (targetZoom > fractalApp.MAX_ZOOM) {\r\n                    fractalApp.animatePanByAndZoomTo(deltaPan, targetZoom).then(resetAppState);\r\n                }\r\n            } else {\r\n                touchClickTimeout = setTimeout(() => {\r\n                    // Use delta-based pan to preserve DD precision at deep zoom\r\n                    let deltaPan = fractalApp.screenToPanDelta(touchX, touchY);\r\n\r\n                    // Clamp to prevent panning out of view\r\n                    deltaPan = clampPanDelta(fractalApp.pan, deltaPan);\r\n\r\n                    console.log(`%c handleTouchEnd: %c Single Tap Click: Centering on ${touchX}x${touchY} -> delta [${deltaPan[0]}, ${deltaPan[1]}]`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n\r\n                    // Centering action using delta-based pan:\r\n                    fractalApp.animatePanBy(deltaPan, 400).then(() => {\r\n                        resetAppState();\r\n                        // Get the updated fractal coordinates after pan\r\n                        const [newFx, newFy] = fractalApp.screenToFractal(touchX, touchY);\r\n                        if (isJuliaMode()) {\r\n                            updateURLParams(FRACTAL_TYPE.JULIA, newFx, newFy, fractalApp.zoom, fractalApp.rotation, fractalApp.c[0], fractalApp.c[1], getCurrentPaletteId());\r\n                        } else {\r\n                            updateURLParams(FRACTAL_TYPE.MANDELBROT, newFx, newFy, fractalApp.zoom, fractalApp.rotation, null, null, getCurrentPaletteId());\r\n                        }\r\n                    });\r\n\r\n                    touchClickTimeout = null;\r\n                }, DOUBLE_TAP_THRESHOLD);\r\n            }\r\n        } else {\r\n            resetAppState();\r\n            isTouchDragging = false;\r\n\r\n            // Final settle rebuild request (renderer decides when to rebuild)\r\n            markOrbitDirtySafe();\r\n            fractalApp.draw();\r\n        }\r\n\r\n        isTouchDragging = false;\r\n    }\r\n}\r\n\r\n// endregion -----------------------------------------------------------------------------------------------------------","/**\r\n * @module ScreenshotController\r\n * @author Radim Brnka\r\n * @description Screenshot capturing logic.\r\n * @copyright Synaptory Fractal Traveler, 2025-2026\r\n * @license MIT\r\n */\r\n\r\nimport {JuliaRenderer} from \"../renderers/juliaRenderer\";\r\nimport {APP_NAME, CONSOLE_GROUP_STYLE, SCREENSHOT_JPEG_COMPRESSION_QUALITY} from \"../global/constants\";\r\nimport {expandComplexToString} from \"../global/utils\";\r\nimport {isJuliaMode} from \"./ui\";\r\n\r\n/**\r\n * Generates filename based on current timestamp\r\n * @return {string}\r\n */\r\nfunction getFilename() {\r\n    const now = new Date();\r\n    const pad = (n) => String(n).padStart(2, '0');\r\n    return `fractal-${now.getFullYear()}-${pad(now.getMonth() + 1)}-${pad(now.getDate())}_${pad(now.getHours())}-${pad(now.getMinutes())}-${pad(now.getSeconds())}.jpg`;\r\n}\r\n\r\n/**\r\n * Returns watermark text lines for current fractal type and its properties.\r\n * @param {FractalRenderer} fractalApp\r\n * @return {{line1: string, line2: string}}\r\n */\r\nfunction getWatermarkLines(fractalApp) {\r\n    const fractalType = isJuliaMode() ? 'Julia' : 'Mandelbrot';\r\n    const line1 = APP_NAME;\r\n    const line2 = `${fractalType}: p=${expandComplexToString(fractalApp.pan.slice(), 6)}, zoom=${fractalApp.zoom.toExponential(2)}` +\r\n        `${(fractalApp instanceof JuliaRenderer) ? `, c=${expandComplexToString(fractalApp.c)}` : ``}`;\r\n    return {line1, line2};\r\n}\r\n\r\n/**\r\n * Draws rectangle with rounded borders\r\n * @param {CanvasRenderingContext2D} ctx\r\n * @param {number} x\r\n * @param {number} y\r\n * @param {number} width\r\n * @param {number} height\r\n * @param {number} radius\r\n */\r\nfunction drawRoundRect(ctx, x, y, width, height, radius) {\r\n    ctx.beginPath();\r\n    ctx.moveTo(x + radius, y);\r\n    ctx.lineTo(x + width - radius, y);\r\n    ctx.quadraticCurveTo(x + width, y, x + width, y + radius);\r\n    ctx.lineTo(x + width, y + height - radius);\r\n    ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);\r\n    ctx.lineTo(x + radius, y + height);\r\n    ctx.quadraticCurveTo(x, y + height, x, y + height - radius);\r\n    ctx.lineTo(x, y + radius);\r\n    ctx.quadraticCurveTo(x, y, x + radius, y);\r\n    ctx.closePath();\r\n}\r\n\r\n/**\r\n * Generates screenshot of the canvas, adds watermark and emulates link click to download the file.\r\n * @param {HTMLCanvasElement} canvas\r\n * @param {FractalRenderer} fractalApp\r\n * @param {string} accentColor\r\n */\r\nexport function takeScreenshot(canvas, fractalApp, accentColor) {\r\n    console.groupCollapsed(`%c takeScreenshot`, CONSOLE_GROUP_STYLE);\r\n\r\n    // Ensure the fractal is fully rendered before taking a screenshot\r\n    fractalApp.draw();\r\n\r\n    // Create an offscreen canvas for watermarking\r\n    const offscreenCanvas = document.createElement('canvas');\r\n    offscreenCanvas.width = canvas.width;\r\n    offscreenCanvas.height = canvas.height;\r\n    const ctx = offscreenCanvas.getContext('2d');\r\n\r\n    if (!ctx) {\r\n        console.error('Unable to get 2D context for the canvas.');\r\n        return;\r\n    }\r\n\r\n    // Copy the fractal canvas content to the offscreen canvas\r\n    ctx.drawImage(canvas, 0, 0);\r\n\r\n    // Define the watermark text and style\r\n    const {line1, line2} = getWatermarkLines(fractalApp);\r\n    const fontSize = 12;\r\n    const lineSpacing = 4;\r\n    const padding = 6;\r\n    const borderWidth = 1;\r\n\r\n    // Font styles matching h1 for line1\r\n    const line1Font = `italic ${fontSize}px \"Bruno Ace SC\", sans-serif`;\r\n    const line2Font = `${fontSize}px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace`;\r\n\r\n    ctx.textAlign = 'center';\r\n    ctx.letterSpacing = '1px';\r\n    ctx.textBaseline = 'middle';\r\n\r\n    // Measure text widths\r\n    ctx.font = line1Font;\r\n    const line1Width = ctx.measureText(line1).width;\r\n    ctx.font = line2Font;\r\n    const line2Width = ctx.measureText(line2).width;\r\n\r\n    // Calculate rectangle size for two lines\r\n    const maxTextWidth = Math.max(line1Width, line2Width);\r\n    const rectWidth = maxTextWidth + padding * 2 + borderWidth * 2;\r\n    const rectHeight = fontSize * 2 + lineSpacing + padding * 2 + borderWidth * 2;\r\n\r\n    // Position the rectangle in the bottom-right corner\r\n    const x = offscreenCanvas.width - rectWidth - padding;\r\n    const y = offscreenCanvas.height - rectHeight - padding;\r\n\r\n    // Draw the semi-transparent black background\r\n    ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';\r\n    drawRoundRect(ctx, x, y, rectWidth, rectHeight, 8);\r\n    ctx.fill();\r\n\r\n    // Draw the text centered within the rectangle\r\n    const textX = x + rectWidth / 2;\r\n    const line1Y = y + padding + borderWidth + fontSize / 2;\r\n    const line2Y = line1Y + fontSize + lineSpacing;\r\n\r\n    // Draw line 1 (app name with h1 styling)\r\n    ctx.font = line1Font;\r\n    ctx.fillStyle = accentColor;\r\n    ctx.fillText(line1, textX, line1Y);\r\n\r\n    // Draw line 2 (coordinates)\r\n    ctx.font = line2Font;\r\n    ctx.fillStyle = accentColor;\r\n    ctx.fillText(line2, textX, line2Y);\r\n\r\n    // Create a temporary link for downloading the image\r\n    const link = document.createElement('a');\r\n\r\n    // Set the download attributes\r\n    link.setAttribute('download', getFilename());\r\n    link.setAttribute('href', offscreenCanvas.toDataURL(\"image/jpeg\", SCREENSHOT_JPEG_COMPRESSION_QUALITY));\r\n    link.click();\r\n\r\n    console.log('Screenshot successfully taken.');\r\n    console.groupEnd();\r\n}","/**\r\n * @module HotKeyController\r\n * @author Radim Brnka\r\n * @description Keyboard shortcuts controller attached to the UI\r\n * @link https://www.freecodecamp.org/news/javascript-keycode-list-keypress-event-key-codes/\r\n * @copyright Synaptory Fractal Traveler, 2025-2026\r\n * @license MIT\r\n */\r\n\r\nimport {\r\n    captureScreenshot,\r\n    copyInfoToClipboard,\r\n    isAnimationActive,\r\n    isJuliaMode,\r\n    randomizeColors,\r\n    reset,\r\n    resetAppState,\r\n    showEditCoordsDialog,\r\n    showSaveViewDialog,\r\n    startJuliaDive,\r\n    switchFractalMode,\r\n    switchFractalTypeWithPersistence,\r\n    toggleCenterLines,\r\n    toggleDebugMode,\r\n    toggleDemo,\r\n    toggleHeader,\r\n    travelToPreset,\r\n    updateColorTheme,\r\n    updatePaletteCycleButtonState,\r\n    updatePaletteDropdownState,\r\n} from \"./ui\";\r\nimport {\r\n    CONSOLE_GROUP_STYLE,\r\n    CONSOLE_MESSAGE_STYLE,\r\n    DEBUG_LEVEL,\r\n    DEBUG_MODE,\r\n    FF_PERSISTENT_FRACTAL_SWITCHING,\r\n    FRACTAL_TYPE,\r\n    log,\r\n    ROTATION_DIRECTION\r\n} from \"../global/constants\";\r\nimport {JuliaRenderer} from \"../renderers/juliaRenderer\";\r\n\r\n//region CONSTANTS > ---------------------------------------------------------------------------------------------------\r\n/**\r\n * Keys not allowed to work in animation mode\r\n * @type {string[]}\r\n */\r\nconst ANIMATION_KEYS_BLACKLIST = [\"ArrowLeft\", \"ArrowRight\", \"ArrowUp\", \"ArrowDown\", \"Space\", \"KeyQ\", \"KeyW\"];\r\n\r\n/**\r\n * Pan movement animation duration\r\n * @type {number}\r\n */\r\nconst PAN_SPEED = 50;\r\n\r\n/**\r\n * Pan step size per keystroke\r\n * @type {number}\r\n */\r\nconst PAN_STEP = .1;\r\n\r\n/**\r\n * Smooth (Shift) pan step size per keystroke\r\n * @type {number}\r\n */\r\nconst PAN_SMOOTH_STEP = .01;\r\n\r\n/**\r\n * Normal rotation animation step size\r\n * @type {number}\r\n */\r\nconst ROTATION_ANIMATION_STEP = .1;\r\n\r\n/**\r\n * Smooth rotation animation step size\r\n * @type {number}\r\n */\r\nconst ROTATION_ANIMATION_SMOOTH_STEP = .01;\r\n\r\n/**\r\n * Zoom step per keystroke\r\n * @type {number}\r\n */\r\nconst ZOOM_ANIMATION_STEP = .1;\r\n\r\n/**\r\n * Smooth (Shift) zoom step per keystroke\r\n * @type {number}\r\n */\r\nconst ZOOM_ANIMATION_SMOOTH_STEP = .01;\r\n\r\n/**\r\n * Smooth stepping: step size\r\n * @type {number}\r\n */\r\nconst JULIA_HOTKEY_C_STEP = .001;\r\n\r\n/**\r\n * Super smooth stepping multiplier (SHIFT)\r\n * @type {number}\r\n */\r\nconst JULIA_HOTKEY_C_SMOOTH_MULTIPLIER = .1;\r\n\r\n/**\r\n * Smooth stepping: animation duration\r\n * @type {number}\r\n */\r\nconst JULIA_HOTKEY_C_SPEED = 10;\r\n//endregion ------------------------------------------------------------------------------------------------------------\r\n\r\nlet rotationActive = false;\r\nlet initialized = false;\r\nlet fractalApp;\r\n\r\n/**\r\n * Keydown event handler\r\n * @param {KeyboardEvent} event\r\n * @return {Promise<void>}\r\n */\r\nasync function onKeyDown(event) {\r\n\r\n    // Do not steal hotkeys from user input fields (search boxes, sliders, etc.)\r\n    const target = /** @type {HTMLElement|null} */ (event.target);\r\n    const tag = target?.tagName?.toLowerCase();\r\n    const isTypingTarget =\r\n        !!target &&\r\n        (\r\n            tag === 'input' ||\r\n            tag === 'textarea' ||\r\n            tag === 'select' ||\r\n            target.isContentEditable\r\n        );\r\n\r\n    if (isTypingTarget) return;\r\n\r\n    if (DEBUG_MODE) console.log(`%c onKeyDown: %c Pressed key/code ${event.shiftKey ? 'Shift + ' : ''}${event.ctrlKey ? 'CTRL + ' : ''}${event.altKey ? 'ALT + ' : ''}${event.code}/${event.key}`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n\r\n    let handled = false;\r\n\r\n    const rotationSpeed = event.shiftKey ? ROTATION_ANIMATION_SMOOTH_STEP : ROTATION_ANIMATION_STEP;\r\n    let rotationDirection = ROTATION_DIRECTION.CW;\r\n\r\n    let deltaPanX = 0;\r\n    let deltaPanY = 0;\r\n    let deltaCx = 0;\r\n    let deltaCy = 0;\r\n\r\n    // Treat MAC Option button as Alt\r\n    const altKey = event.altKey || event.code === 'Alt';\r\n\r\n    if (isAnimationActive() && ANIMATION_KEYS_BLACKLIST.includes(event.code)) {\r\n        event.preventDefault();\r\n        return;\r\n    }\r\n    switch (event.code) {\r\n        // TODO add shift/non-shift to slow down or speed up the rotation instead of stop.\r\n        case 'KeyQ': // Rotation counter-clockwise\r\n            rotationDirection = ROTATION_DIRECTION.CCW;\r\n        case 'KeyW': // Rotation clockwise\r\n            if (rotationActive) {\r\n                fractalApp.stopCurrentRotationAnimation();\r\n                rotationActive = false;\r\n            } else {\r\n                rotationActive = true;\r\n                await fractalApp.animateInfiniteRotation(rotationDirection, rotationSpeed);\r\n            }\r\n            handled = true;\r\n            break;\r\n\r\n        case 'KeyE': // Debug lines\r\n            toggleCenterLines();\r\n            handled = true;\r\n            break;\r\n\r\n        case 'KeyR': // Reset\r\n            if (event.shiftKey) await reset();\r\n            handled = true;\r\n            break;\r\n\r\n        case 'KeyC': // Copy info to clipboard\r\n            copyInfoToClipboard();\r\n            handled = true;\r\n            break;\r\n\r\n        case 'KeyL': // DEBUG BAR toggle\r\n            toggleDebugMode();\r\n            handled = true;\r\n            break;\r\n\r\n        case 'KeyZ': // Switch between fractals with constant p/c\r\n            if (!FF_PERSISTENT_FRACTAL_SWITCHING) break;\r\n\r\n            await switchFractalTypeWithPersistence(isJuliaMode() ? FRACTAL_TYPE.MANDELBROT : FRACTAL_TYPE.JULIA);\r\n            handled = true;\r\n            break;\r\n\r\n        case 'KeyT': // Random colors / cycle palettes\r\n            if (altKey) {\r\n                // Alt+T: Reset to first palette (matches UI button behavior)\r\n                await fractalApp.applyPaletteByIndex(0, 250, updateColorTheme);\r\n                updatePaletteDropdownState();\r\n                updatePaletteCycleButtonState();\r\n            } else if (event.shiftKey) {\r\n                // Shift+T: Toggle palette cycling\r\n                if (fractalApp.paletteCyclingActive) {\r\n                    // Stop cycling\r\n                    fractalApp.stopCurrentColorAnimations();\r\n                } else {\r\n                    // Start cycling\r\n                    fractalApp.startPaletteCycling(2000, 3000, updateColorTheme, updatePaletteDropdownState);\r\n                }\r\n                updatePaletteCycleButtonState();\r\n            } else {\r\n                // T: Pick a random palette\r\n                await randomizeColors();\r\n            }\r\n            handled = true;\r\n            break;\r\n\r\n        case 'KeyA': // Forced resize\r\n            fractalApp.resizeCanvas();\r\n            handled = true;\r\n            break;\r\n\r\n        case 'KeyS': // Screenshot or Save View\r\n            if (altKey) {\r\n                // Alt+S: Save current view\r\n                showSaveViewDialog();\r\n            } else if (event.shiftKey) {\r\n                // Shift+S: Screenshot\r\n                captureScreenshot();\r\n            }\r\n            handled = true;\r\n            break;\r\n\r\n        case 'KeyB': // Julia legacy renderer toggle\r\n            if (isJuliaMode() && DEBUG_MODE === DEBUG_LEVEL.FULL) {\r\n                JuliaRenderer.FF_LEGACY_JULIA_RENDERER = !JuliaRenderer.FF_LEGACY_JULIA_RENDERER\r\n                await switchFractalMode(FRACTAL_TYPE.JULIA);\r\n            }\r\n            handled = true;\r\n            break;\r\n\r\n        case 'KeyD': // Start/stop demo\r\n            await toggleDemo();\r\n            handled = true;\r\n            break;\r\n\r\n        case 'KeyM': // Riemann Mode\r\n            if (DEBUG_MODE === DEBUG_LEVEL.FULL) await switchFractalMode(FRACTAL_TYPE.RIEMANN);\r\n            handled = true;\r\n            break;\r\n\r\n        case 'KeyN':\r\n            if (DEBUG_MODE) {\r\n                log('Analytic Extension toggled.');\r\n                fractalApp.useAnalyticExtension = !fractalApp.useAnalyticExtension;\r\n                fractalApp.draw();\r\n            }\r\n            handled = true;\r\n            break;\r\n\r\n        case 'KeyF': // Toggle adaptive quality\r\n            fractalApp.toggleAdaptiveQuality();\r\n            handled = true;\r\n            break;\r\n\r\n        case 'NumpadAdd': // Numpad + (Shift for soft step)\r\n        case 'Equal': // = or + key\r\n            if (fractalApp.adaptiveQualityEnabled) {\r\n                const step = event.shiftKey ? 25 : 100;\r\n                fractalApp.adjustExtraIterations(step);\r\n            }\r\n            handled = true;\r\n            break;\r\n\r\n        case 'NumpadSubtract': // Numpad - (Shift for soft step)\r\n        case 'Minus': // - key\r\n            if (fractalApp.adaptiveQualityEnabled) {\r\n                const step = event.shiftKey ? -25 : -100;\r\n                fractalApp.adjustExtraIterations(step);\r\n            }\r\n            handled = true;\r\n            break;\r\n\r\n        case 'KeyP':\r\n            showEditCoordsDialog();\r\n            handled = true;\r\n            break;\r\n\r\n        case \"ArrowLeft\":\r\n            deltaPanX = altKey ? 0 : -(event.shiftKey ? PAN_SMOOTH_STEP : PAN_STEP);\r\n            deltaCx = altKey ? (JULIA_HOTKEY_C_STEP * (event.shiftKey ? JULIA_HOTKEY_C_SMOOTH_MULTIPLIER : 1)) : 0;\r\n            handled = true;\r\n            break;\r\n\r\n        case \"ArrowRight\":\r\n            deltaPanX = altKey ? 0 : (event.shiftKey ? PAN_SMOOTH_STEP : PAN_STEP);\r\n            deltaCx = altKey ? (JULIA_HOTKEY_C_STEP * (event.shiftKey ? -JULIA_HOTKEY_C_SMOOTH_MULTIPLIER : -1)) : 0;\r\n            handled = true;\r\n            break;\r\n\r\n        case \"ArrowDown\":\r\n            deltaPanY = altKey ? 0 : -(event.shiftKey ? PAN_SMOOTH_STEP : PAN_STEP);\r\n            deltaCy = altKey ? (JULIA_HOTKEY_C_STEP * (event.shiftKey ? -JULIA_HOTKEY_C_SMOOTH_MULTIPLIER : -1)) : 0;\r\n            handled = true;\r\n            break;\r\n\r\n        case \"ArrowUp\":\r\n            deltaPanY = altKey ? 0 : (event.shiftKey ? PAN_SMOOTH_STEP : PAN_STEP);\r\n            deltaCy = altKey ? (JULIA_HOTKEY_C_STEP * (event.shiftKey ? JULIA_HOTKEY_C_SMOOTH_MULTIPLIER : 1)) : 0;\r\n            handled = true;\r\n            break;\r\n\r\n        case \"Space\":\r\n            const increment = event.shiftKey ? ZOOM_ANIMATION_SMOOTH_STEP : ZOOM_ANIMATION_STEP;\r\n            const zoomFactor = (event.ctrlKey || altKey) ? (1 + increment) : (1 - increment);\r\n\r\n            let targetZoom = fractalApp.zoom * zoomFactor;\r\n\r\n            if (targetZoom >= fractalApp.MAX_ZOOM && targetZoom <= fractalApp.MIN_ZOOM) {\r\n                // Use animateZoomToNoPan to preserve DD pan precision at deep zooms\r\n                await fractalApp.animateZoomToNoPan(targetZoom, 20);\r\n                resetAppState();\r\n            }\r\n            handled = true;\r\n            break;\r\n\r\n        case \"Enter\":\r\n            toggleHeader();\r\n            handled = true;\r\n            break;\r\n\r\n        default: // Case nums and others:\r\n            const match = event.code.match(/^(Digit|Numpad)(\\d)$/);\r\n            if (match) {\r\n                const index = parseInt(match[2], 0); // match[2] contains the digit pressed\r\n                if (event.shiftKey && isJuliaMode()) {\r\n                    await startJuliaDive(fractalApp.DIVES, index);\r\n                } else {\r\n                    await travelToPreset(fractalApp.PRESETS, index);\r\n                }\r\n                handled = true;\r\n            }\r\n            break;\r\n    }\r\n\r\n    // Handling pan changes\r\n    if (deltaPanX || deltaPanY) {\r\n        let r = fractalApp.rotation;\r\n\r\n        // Reflect the zoom factor for consistent pan speed at different zoom levels\r\n        const effectiveDeltaX = (deltaPanX * fractalApp.zoom) * Math.cos(r) - (deltaPanY * fractalApp.zoom) * Math.sin(r);\r\n        const effectiveDeltaY = (deltaPanX * fractalApp.zoom) * Math.sin(r) + (deltaPanY * fractalApp.zoom) * Math.cos(r);\r\n\r\n        await fractalApp.animatePanBy([effectiveDeltaX, effectiveDeltaY], PAN_SPEED);\r\n        fractalApp.noteInteraction(160);\r\n\r\n        resetAppState();\r\n    }\r\n\r\n    // Handling C changes\r\n    if ((deltaCx || deltaCy) && isJuliaMode()) {\r\n        const effectiveDeltaCx = deltaCx * fractalApp.zoom;\r\n        const effectiveDeltaCy = deltaCy * fractalApp.zoom;\r\n\r\n        await fractalApp.animateToC([fractalApp.c[0] + effectiveDeltaCx, fractalApp.c[1] + effectiveDeltaCy], JULIA_HOTKEY_C_SPEED);\r\n        resetAppState();\r\n    }\r\n\r\n    if (handled) {\r\n        event.preventDefault();\r\n    }\r\n}\r\n\r\n/**\r\n * Initializes the keyboard event listener\r\n * @param {FractalRenderer} app\r\n */\r\nexport function initHotKeys(app) {\r\n    if (initialized) {\r\n        console.warn(`%c initHotKeys: %c Redundant initialization skipped!`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n        return;\r\n    }\r\n\r\n    fractalApp = app;\r\n    document.addEventListener(\"keydown\", onKeyDown);\r\n    initialized = true;\r\n\r\n    log('Initialized.', 'initHotKeys');\r\n}\r\n\r\n/** Destructor. Removes event listeners and cleans up */\r\nexport function destroyHotKeys() {\r\n    if (!initialized) {\r\n        console.warn(`%c destroyHotKeys: %c Nothing to destroy!`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n        return;\r\n    }\r\n\r\n    fractalApp = null;\r\n    initialized = false;\r\n\r\n    document.removeEventListener(\"keydown\", onKeyDown);\r\n\r\n    console.log(`%c destroyHotKeys: %c Destroyed.`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n}","import FractalRenderer from \"./fractalRenderer\";\r\nimport {asyncDelay, ddSubDD, hexToRGBArray, lerp, normalizeRotation, splitFloat} from \"../global/utils\";\r\nimport {CONSOLE_GROUP_STYLE, EASE_TYPE, log, PI} from \"../global/constants\";\r\nimport presetsData from '../data/mandelbrot.json';\r\n/** @type {string} */\r\nimport fragmentShaderRaw from '../shaders/mandelbrot.frag';\r\n\r\n/**\r\n * MandelbrotRenderer (Rebased Perturbation)\r\n *\r\n * @author Radim Brnka\r\n * @description This module defines a MandelbrotRenderer class that inherits from fractalRenderer, implements the shader fragment code for the Mandelbrot set fractal and sets preset zoom-ins.\r\n * @extends FractalRenderer\r\n * @copyright Synaptory Fractal Traveler, 2025-2026\r\n * @license MIT\r\n */\r\nclass MandelbrotRenderer extends FractalRenderer {\r\n\r\n    constructor(canvas) {\r\n        super(canvas);\r\n\r\n        this.DEFAULT_PAN = [-0.5, 0];\r\n        this.setPan(this.DEFAULT_PAN[0], this.DEFAULT_PAN[1]); // sync DD + array\r\n\r\n        // Reference state with DD precision\r\n        this.refPan = [...this.DEFAULT_PAN];\r\n        this.refPanDD = {\r\n            x: { hi: this.DEFAULT_PAN[0], lo: 0 },\r\n            y: { hi: this.DEFAULT_PAN[1], lo: 0 }\r\n        };\r\n        this.orbitDirty = true;\r\n\r\n        /** IMPORTANT: MAX_ITER must remain constant after shader compilation + orbit buffer allocation. */\r\n        this.MAX_ITER = 5000;\r\n\r\n        // Reference search parameters (for perturbation rebasing)\r\n        this.REF_SEARCH_GRID = 7;\r\n        this.REF_SEARCH_RADIUS = 0.50;\r\n\r\n        // Hysteresis state for rebasing\r\n        this.rebaseArmed = true;\r\n\r\n        // WebGL resources\r\n        this.orbitTex = null;\r\n        this.orbitData = null;\r\n        this.floatTexExt = null;\r\n\r\n        /** Mandelbrot-specific presets */\r\n        this.PRESETS = presetsData.views;\r\n\r\n        /**\r\n         * @type {Array.<PALETTE>}\r\n         * @description Palettes loaded from JSON (empty = random only)\r\n         */\r\n        this.PALETTES = presetsData.palettes || [];\r\n        this.currentPaletteIndex = 0; // Start with Default palette\r\n\r\n        // Default color parameters matching original hardcoded values\r\n        this.DEFAULT_FREQUENCY = [3.1415, 6.2830, 1.7200];\r\n        this.DEFAULT_PHASE = [0, 0, 0];\r\n        this.frequency = [...this.DEFAULT_FREQUENCY];\r\n        this.phase = [...this.DEFAULT_PHASE];\r\n\r\n        this.init();\r\n    }\r\n\r\n    markOrbitDirty = () => this.orbitDirty = true;\r\n\r\n    /**\r\n     * Called by FractalRenderer.initGLProgram() after program creation + common uniform cache.\r\n     * Creates float texture, allocates orbit buffer, and binds texture unit.\r\n     */\r\n    onProgramCreated() {\r\n        this.floatTexExt = this.gl.getExtension(\"OES_texture_float\");\r\n        if (!this.floatTexExt) {\r\n            console.error('Missing OES_texture_float. Perturbation orbit texture upload requires it.');\r\n            return;\r\n        }\r\n\r\n        this.orbitTex = this.gl.createTexture();\r\n        this.gl.activeTexture(this.gl.TEXTURE0);\r\n        this.gl.bindTexture(this.gl.TEXTURE_2D, this.orbitTex);\r\n\r\n        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, this.gl.NEAREST);\r\n        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, this.gl.NEAREST);\r\n        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_S, this.gl.CLAMP_TO_EDGE);\r\n        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_T, this.gl.CLAMP_TO_EDGE);\r\n\r\n        this.orbitData = new Float32Array(this.MAX_ITER * 4);\r\n\r\n        // Shader expects orbit sampler in unit 0\r\n        if (this.orbitTexLoc) this.gl.uniform1i(this.orbitTexLoc, 0);\r\n        if (this.orbitWLoc) this.gl.uniform1f(this.orbitWLoc, this.MAX_ITER);\r\n\r\n        this.orbitDirty = true;\r\n    }\r\n\r\n    createFragmentShaderSource() {\r\n        return fragmentShaderRaw.replace('__MAX_ITER__', this.MAX_ITER).toString();\r\n    }\r\n\r\n    updateUniforms() {\r\n        super.updateUniforms();\r\n\r\n        // delta pan hi/lo (viewPan - refPan, computed on JS side for precision)\r\n        this.deltaPanHLoc = this.gl.getUniformLocation(this.program, 'u_delta_pan_h');\r\n        this.deltaPanLLoc = this.gl.getUniformLocation(this.program, 'u_delta_pan_l');\r\n\r\n        // zoom hi/lo\r\n        this.zoomHLoc = this.gl.getUniformLocation(this.program, 'u_zoom_h');\r\n        this.zoomLLoc = this.gl.getUniformLocation(this.program, 'u_zoom_l');\r\n\r\n        // orbit texture uniforms\r\n        this.orbitTexLoc = this.gl.getUniformLocation(this.program, 'u_orbitTex');\r\n        this.orbitWLoc = this.gl.getUniformLocation(this.program, 'u_orbitW');\r\n\r\n        // color parameters\r\n        this.frequencyLoc = this.gl.getUniformLocation(this.program, 'u_frequency');\r\n        this.phaseLoc = this.gl.getUniformLocation(this.program, 'u_phase');\r\n    }\r\n\r\n    /** Reference picking + orbit build */\r\n    escapeItersDouble(cx, cy, iters) {\r\n        let zx = 0.0, zy = 0.0;\r\n        for (let i = 0; i < iters; i++) {\r\n            const zx2 = zx * zx - zy * zy + cx;\r\n            const zy2 = 2.0 * zx * zy + cy;\r\n            zx = zx2;\r\n            zy = zy2;\r\n            if (zx * zx + zy * zy > 4.0) return i;\r\n        }\r\n        return iters;\r\n    }\r\n\r\n    /**\r\n     * Choose a good refPan near view center:\r\n     * - sample a grid around view center (radius scales with zoom)\r\n     * - pick the point with the highest escape iteration (prefer inside / late escape)\r\n     * - prefer keeping the current reference to avoid jitter unless a significantly better one is found\r\n     * @param {boolean} useViewCenter - If true, skip grid search and use view center directly (for stability during interaction)\r\n     */\r\n    pickReferenceNearViewCenter(useViewCenter = false) {\r\n        // During interaction, use view center directly to prevent jitter from grid search\r\n        // Copy DD components to preserve deep zoom precision\r\n        if (useViewCenter) {\r\n            this.refPan[0] = this.pan[0];\r\n            this.refPan[1] = this.pan[1];\r\n            this.refPanDD.x.hi = this.panDD.x.hi;\r\n            this.refPanDD.x.lo = this.panDD.x.lo;\r\n            this.refPanDD.y.hi = this.panDD.y.hi;\r\n            this.refPanDD.y.lo = this.panDD.y.lo;\r\n            return;\r\n        }\r\n\r\n        const grid = this.REF_SEARCH_GRID;\r\n        const half = (grid - 1) / 2;\r\n        const step = (2.0 * this.REF_SEARCH_RADIUS) / (grid - 1);\r\n\r\n        const base = this.zoom; // scale offsets by current zoom\r\n\r\n        const probeIters = Math.min(this.MAX_ITER, Math.max(200, Math.floor(this.iterations)));\r\n\r\n        // Evaluate current reference point's score (if we have one within reasonable distance)\r\n        let currentRefScore = -1;\r\n        const currentRefDist = Math.hypot(this.refPan[0] - this.pan[0], this.refPan[1] - this.pan[1]);\r\n        const maxRefDist = base * this.REF_SEARCH_RADIUS * 2.5; // Allow some margin beyond search radius\r\n\r\n        if (currentRefDist < maxRefDist) {\r\n            currentRefScore = this.escapeItersDouble(this.refPan[0], this.refPan[1], probeIters);\r\n        }\r\n\r\n        // Start with view center as fallback\r\n        let bestCx = this.pan[0];\r\n        let bestCy = this.pan[1];\r\n        let bestScore = this.escapeItersDouble(this.pan[0], this.pan[1], probeIters);\r\n\r\n        for (let j = 0; j < grid; j++) {\r\n            for (let i = 0; i < grid; i++) {\r\n                const ox = (i - half) * step;\r\n                const oy = (j - half) * step;\r\n                const cx = this.pan[0] + ox * base;\r\n                const cy = this.pan[1] + oy * base;\r\n\r\n                const score = this.escapeItersDouble(cx, cy, probeIters);\r\n                if (score > bestScore) {\r\n                    bestScore = score;\r\n                    bestCx = cx;\r\n                    bestCy = cy;\r\n                }\r\n            }\r\n        }\r\n\r\n        // Stability: only switch reference if the new one is significantly better.\r\n        // This prevents jitter from small score differences between frames.\r\n        // Require at least 10% improvement or 50 iterations better to switch.\r\n        const improvementThreshold = Math.max(currentRefScore * 0.10, 50);\r\n        const shouldSwitch = currentRefScore < 0 || (bestScore - currentRefScore) > improvementThreshold;\r\n\r\n        if (shouldSwitch) {\r\n            this.refPan[0] = bestCx;\r\n            this.refPan[1] = bestCy;\r\n            // New reference point from grid search - no DD precision accumulated yet\r\n            this.refPanDD.x.hi = bestCx;\r\n            this.refPanDD.x.lo = 0;\r\n            this.refPanDD.y.hi = bestCy;\r\n            this.refPanDD.y.lo = 0;\r\n        }\r\n        // else: keep current refPan for stability\r\n    }\r\n\r\n    computeReferenceOrbit() {\r\n        if (!this.orbitData || !this.orbitTex) return;\r\n\r\n        const cx = this.refPan[0];\r\n        const cy = this.refPan[1];\r\n\r\n        let zx = 0.0, zy = 0.0;\r\n\r\n        for (let n = 0; n < this.MAX_ITER; n++) {\r\n            const sx = splitFloat(zx);\r\n            const sy = splitFloat(zy);\r\n\r\n            const idx = n * 4;\r\n            this.orbitData[idx] = sx.high;\r\n            this.orbitData[idx + 1] = sx.low;\r\n            this.orbitData[idx + 2] = sy.high;\r\n            this.orbitData[idx + 3] = sy.low;\r\n\r\n            const zx2 = zx * zx - zy * zy + cx;\r\n            const zy2 = 2.0 * zx * zy + cy;\r\n            zx = zx2;\r\n            zy = zy2;\r\n\r\n            if (zx * zx + zy * zy > 4.0) {\r\n                // Fill remainder with last value (keeps texture defined)\r\n                const fx = splitFloat(zx);\r\n                const fy = splitFloat(zy);\r\n                for (let k = n + 1; k < this.MAX_ITER; k++) {\r\n                    const j = k * 4;\r\n                    this.orbitData[j] = fx.high;\r\n                    this.orbitData[j + 1] = fx.low;\r\n                    this.orbitData[j + 2] = fy.high;\r\n                    this.orbitData[j + 3] = fy.low;\r\n                }\r\n                break;\r\n            }\r\n        }\r\n\r\n        this.gl.activeTexture(this.gl.TEXTURE0);\r\n        this.gl.bindTexture(this.gl.TEXTURE_2D, this.orbitTex);\r\n\r\n        // Upload 1D orbit texture: width=MAX_ITER, height=1\r\n        this.gl.texImage2D(\r\n            this.gl.TEXTURE_2D,\r\n            0,\r\n            this.gl.RGBA,\r\n            this.MAX_ITER,\r\n            1,\r\n            0,\r\n            this.gl.RGBA,\r\n            this.gl.FLOAT,\r\n            this.orbitData\r\n        );\r\n\r\n        if (this.orbitTexLoc) this.gl.uniform1i(this.orbitTexLoc, 0);\r\n        if (this.orbitWLoc) this.gl.uniform1f(this.orbitWLoc, this.MAX_ITER);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    draw() {\r\n        this.gl.useProgram(this.program);\r\n\r\n        // Iteration strategy avoids exploding to infinity at tiny zooms\r\n        // TODO Tune! main point is: clamp to MAX_ITER.\r\n        const safe = Math.max(this.zoom, 1e-300);\r\n        const log2Depth = Math.log2(this.DEFAULT_ZOOM / safe);\r\n        const baseIters = Math.floor(200 + 50 * log2Depth);\r\n        this.iterations = Math.max(50, Math.min(this.MAX_ITER, baseIters + this.extraIterations));\r\n\r\n        const mustRebaseNow = this.needsRebase();\r\n        const canRebaseNow = !this.interactionActive || mustRebaseNow;\r\n\r\n        if (this.orbitDirty && canRebaseNow) {\r\n            this.pickReferenceNearViewCenter();\r\n            this.computeReferenceOrbit();\r\n            this.orbitDirty = false;\r\n        }\r\n\r\n        // Compute deltaPan = panDD - refPanDD on JS side (float64) for precision\r\n        // This avoids float32 precision loss when the shader subtracts viewPan - refPan\r\n        const deltaPanX = ddSubDD(this.panDD.x, this.refPanDD.x);\r\n        const deltaPanY = ddSubDD(this.panDD.y, this.refPanDD.y);\r\n\r\n        // Upload deltaPan hi/lo\r\n        if (this.deltaPanHLoc) this.gl.uniform2f(this.deltaPanHLoc, deltaPanX.hi, deltaPanY.hi);\r\n        if (this.deltaPanLLoc) this.gl.uniform2f(this.deltaPanLLoc, deltaPanX.lo, deltaPanY.lo);\r\n\r\n        // Upload zoom hi/lo\r\n        const z = splitFloat(this.zoom);\r\n        if (this.zoomHLoc) this.gl.uniform1f(this.zoomHLoc, z.high);\r\n        if (this.zoomLLoc) this.gl.uniform1f(this.zoomLLoc, z.low);\r\n\r\n        // Upload color parameters\r\n        if (this.frequencyLoc) this.gl.uniform3fv(this.frequencyLoc, this.frequency);\r\n        if (this.phaseLoc) this.gl.uniform3fv(this.phaseLoc, this.phase);\r\n\r\n        super.draw();\r\n    }\r\n\r\n    needsRebase() {\r\n        const dx = this.pan[0] - this.refPan[0];\r\n        const dy = this.pan[1] - this.refPan[1];\r\n\r\n        // Rebase threshold is proportional to zoom (view scale).\r\n        // 0.75 is consistent with the Julia policy.\r\n        return Math.hypot(dx, dy) > this.zoom * 0.75;\r\n    }\r\n\r\n    /**\r\n     * Resets renderer to default state including frequency and phase.\r\n     * @override\r\n     */\r\n    reset() {\r\n        this.frequency = [...this.DEFAULT_FREQUENCY];\r\n        this.phase = [...this.DEFAULT_PHASE];\r\n        this.currentPaletteIndex = 0;\r\n        this.orbitDirty = true;\r\n        super.reset();\r\n    }\r\n\r\n    // region > ANIMATION METHODS\r\n\r\n    /**\r\n     * Applies a specific palette by index.\r\n     * @param {number} index - Palette index (-1 for random)\r\n     * @param {number} [duration=250] - Transition duration in ms\r\n     * @param {Function} [coloringCallback] - Callback when done\r\n     * @return {Promise<void>}\r\n     */\r\n    async applyPaletteByIndex(index, duration = 250, coloringCallback = null) {\r\n        this.currentPaletteIndex = index;\r\n\r\n        if (index >= 0 && index < this.PALETTES.length) {\r\n            const palette = this.PALETTES[index];\r\n            // Wrap callback to use keyColor for UI instead of theme\r\n            const wrappedCallback = coloringCallback && palette.keyColor\r\n                ? () => coloringCallback(hexToRGBArray(palette.keyColor, 255))\r\n                : coloringCallback;\r\n            await this.animateColorPaletteTransition({\r\n                theme: palette.theme,\r\n                frequency: palette.frequency || this.DEFAULT_FREQUENCY,\r\n                phase: palette.phase || this.DEFAULT_PHASE\r\n            }, duration, wrappedCallback);\r\n        } else {\r\n            // Random palette (index -1 or out of range)\r\n            await this.animateColorPaletteTransition(null, duration, coloringCallback);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Generates a random palette with theme, frequency, and phase.\r\n     * Creates visually distinct palettes by varying all three parameters.\r\n     * @returns {{theme: number[], frequency: number[], phase: number[]}}\r\n     */\r\n    generateRandomPalette() {\r\n        // Random hue with high saturation for theme\r\n        const hue = Math.random();\r\n        const angle = hue * Math.PI * 2;\r\n\r\n        // Create base color from hue (simplified HSV to RGB at full saturation)\r\n        const r = Math.max(0, Math.cos(angle));\r\n        const g = Math.max(0, Math.cos(angle - Math.PI * 2 / 3));\r\n        const b = Math.max(0, Math.cos(angle + Math.PI * 2 / 3));\r\n\r\n        // Scale to multiplier range (0.8 - 2.2) with some base brightness\r\n        const base = 0.8 + Math.random() * 0.4; // 0.8-1.2\r\n        const scale = 1.0 + Math.random() * 0.8; // 1.0-1.8\r\n\r\n        const theme = [\r\n            base + r * scale,\r\n            base + g * scale,\r\n            base + b * scale,\r\n        ];\r\n\r\n        // Generate random frequency - controls how fast colors cycle\r\n        // Values 1-10 give nice variety without being too chaotic\r\n        const frequency = [\r\n            1.0 + Math.random() * 9.0,\r\n            1.0 + Math.random() * 9.0,\r\n            1.0 + Math.random() * 9.0,\r\n        ];\r\n\r\n        // Generate random phase - shifts the color bands\r\n        // Values 0 to 2*PI cover full phase range\r\n        const phase = [\r\n            Math.random() * Math.PI * 2,\r\n            Math.random() * Math.PI * 2,\r\n            Math.random() * Math.PI * 2,\r\n        ];\r\n\r\n        return { theme, frequency, phase };\r\n    }\r\n\r\n    /**\r\n     * Animates transition to a new palette (theme, frequency, phase).\r\n     * Accepts either:\r\n     * - Object: {theme: [...], frequency: [...], phase: [...]}\r\n     * - Array (legacy): [r, g, b] - uses current frequency/phase\r\n     * - null: generates random palette\r\n     * @param {{theme: number[], frequency: number[], phase: number[]}|number[]|null} newPalette\r\n     * @param {number} duration\r\n     * @param {Function|null} coloringCallback\r\n     */\r\n    async animateColorPaletteTransition(newPalette, duration = 250, coloringCallback = null) {\r\n        // Normalize input to object format\r\n        if (!newPalette) {\r\n            newPalette = this.generateRandomPalette();\r\n        } else if (Array.isArray(newPalette)) {\r\n            // Legacy array format - just theme, keep current frequency/phase\r\n            newPalette = {\r\n                theme: newPalette,\r\n                frequency: [...this.frequency],\r\n                phase: [...this.phase]\r\n            };\r\n        }\r\n\r\n        this.stopCurrentColorAnimations();\r\n\r\n        const startTheme = [...this.colorPalette];\r\n        const startFrequency = [...this.frequency];\r\n        const startPhase = [...this.phase];\r\n\r\n        const targetTheme = newPalette.theme;\r\n        const targetFrequency = newPalette.frequency || this.DEFAULT_FREQUENCY;\r\n        const targetPhase = newPalette.phase || this.DEFAULT_PHASE;\r\n\r\n        await new Promise((resolve) => {\r\n            // Store resolve so stopCurrentColorAnimations can call it if interrupted\r\n            this._colorAnimationResolve = resolve;\r\n            let startTime = null;\r\n\r\n            const step = (timestamp) => {\r\n                if (!startTime) startTime = timestamp;\r\n                const progress = Math.min((timestamp - startTime) / duration, 1);\r\n\r\n                // Lerp theme (colorPalette)\r\n                this.colorPalette = [\r\n                    lerp(startTheme[0], targetTheme[0], progress),\r\n                    lerp(startTheme[1], targetTheme[1], progress),\r\n                    lerp(startTheme[2], targetTheme[2], progress),\r\n                ];\r\n\r\n                // Lerp frequency\r\n                this.frequency = [\r\n                    lerp(startFrequency[0], targetFrequency[0], progress),\r\n                    lerp(startFrequency[1], targetFrequency[1], progress),\r\n                    lerp(startFrequency[2], targetFrequency[2], progress),\r\n                ];\r\n\r\n                // Lerp phase\r\n                this.phase = [\r\n                    lerp(startPhase[0], targetPhase[0], progress),\r\n                    lerp(startPhase[1], targetPhase[1], progress),\r\n                    lerp(startPhase[2], targetPhase[2], progress),\r\n                ];\r\n\r\n                this.draw();\r\n\r\n                if (coloringCallback) coloringCallback();\r\n\r\n                if (progress < 1) {\r\n                    this.currentColorAnimationFrame = requestAnimationFrame(step);\r\n                } else {\r\n                    this._colorAnimationResolve = null;\r\n                    this.stopCurrentColorAnimations();\r\n                    resolve();\r\n                }\r\n            };\r\n\r\n            this.currentColorAnimationFrame = requestAnimationFrame(step);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Animates travel to a preset. It first zooms out to the default zoom, then rotates, then animates pan and zoom-in.\r\n     * If any of the final params is the same as the target, it won't animate it.\r\n     *\r\n     * @param {MANDELBROT_PRESET} preset An instance-specific object to define exact spot in the fractal\r\n     * @param {number} [zoomOutDuration=2000] Duration (ms) for zoom-out stage\r\n     * @param {number} [panDuration=1000] Duration (ms) for pan stage\r\n     * @param {number} [zoomInDuration=3500] Duration (ms) for zoom-in stage\r\n     * @param {Function} [coloringCallback=null] Optional callback for UI color updates\r\n     * @return {Promise<void>}\r\n     */\r\n    async animateTravelToPreset(preset, zoomOutDuration = 2000, panDuration = 1000, zoomInDuration = 3500, coloringCallback = null) {\r\n        console.groupCollapsed(`%c ${this.constructor.name}: animateTravelToPreset`, CONSOLE_GROUP_STYLE);\r\n        log(`Traveling to preset: ${JSON.stringify(preset)}`);\r\n\r\n        const presetRotation = normalizeRotation(preset.rotation ?? this.DEFAULT_ROTATION);\r\n\r\n        // Determine how far we are from the preset\r\n        // Zoom ratio: how many \"zoom levels\" away (log scale makes sense for exponential zoom)\r\n        const zoomRatio = Math.abs(Math.log(this.zoom / preset.zoom));\r\n        const atTargetZoom = zoomRatio < 0.01; // Within ~1% zoom\r\n        const nearTargetZoom = zoomRatio < 2.5; // Within ~12x zoom difference\r\n\r\n        // Pan distance relative to TARGET view size (what matters at the end)\r\n        const panDist = Math.hypot(this.pan[0] - preset.pan[0], this.pan[1] - preset.pan[1]);\r\n        const targetViewSize = preset.zoom;\r\n        const panRatio = panDist / targetViewSize;\r\n        const atTargetPan = panRatio < 0.1; // Essentially same position at target zoom\r\n        const nearTargetPan = panRatio < 3.0; // Within 3 view-widths at target zoom\r\n\r\n        // Palette proximity check\r\n        let targetPaletteIndex = -1;\r\n        let atTargetPalette = true;\r\n        if (preset.paletteId) {\r\n            targetPaletteIndex = this.PALETTES.findIndex(p => p.id === preset.paletteId);\r\n            atTargetPalette = targetPaletteIndex < 0 || targetPaletteIndex === this.currentPaletteIndex;\r\n        }\r\n\r\n        const zoomInDurationWithSpeed = zoomInDuration * (preset.speed ?? 1);\r\n\r\n        // Readjust duration scales with how far off we are (min 500ms, max panDuration)\r\n        const readjustDuration = Math.max(500, Math.min(panDuration, 300 + panRatio * 200 + zoomRatio * 150));\r\n\r\n        if (atTargetZoom && atTargetPan && atTargetPalette) {\r\n            // Already at target - only rotate if needed\r\n            await this.animateRotationTo(presetRotation, zoomOutDuration, EASE_TYPE.QUINT);\r\n        } else if (atTargetZoom && atTargetPan) {\r\n            // At position and zoom, but different palette - rotate with palette transition\r\n            const animations = [\r\n                this.animateRotationTo(presetRotation, zoomOutDuration, EASE_TYPE.QUINT)\r\n            ];\r\n            if (!atTargetPalette) {\r\n                animations.push(this.animatePaletteByIdTransition(preset, zoomOutDuration, coloringCallback));\r\n            }\r\n            await Promise.all(animations);\r\n        } else if (nearTargetZoom && nearTargetPan) {\r\n            // Close to preset - smooth readjustment without cinematic animation\r\n            log(`Near preset, readjusting (zoomRatio=${zoomRatio.toFixed(2)}, panRatio=${panRatio.toFixed(2)})`);\r\n            const animations = [\r\n                this.animatePanAndZoomTo(preset.pan, preset.zoom, readjustDuration, EASE_TYPE.CUBIC),\r\n                this.animateRotationTo(presetRotation, readjustDuration, EASE_TYPE.CUBIC)\r\n            ];\r\n            if (!atTargetPalette) {\r\n                animations.push(this.animatePaletteByIdTransition(preset, readjustDuration, coloringCallback));\r\n            }\r\n            await Promise.all(animations);\r\n        } else if (atTargetZoom) {\r\n            // Same zoom but panned far away - pan back with rotation and palette\r\n            const animations = [\r\n                this.animatePanTo(preset.pan, panDuration, EASE_TYPE.CUBIC),\r\n                this.animateRotationTo(presetRotation, panDuration, EASE_TYPE.CUBIC)\r\n            ];\r\n            if (!atTargetPalette) {\r\n                animations.push(this.animatePaletteByIdTransition(preset, panDuration, coloringCallback));\r\n            }\r\n            await Promise.all(animations);\r\n        } else if (atTargetPan) {\r\n            // Same position, just zoom and rotate with palette\r\n            const animations = [\r\n                this.animateZoomRotationTo(preset.zoom, presetRotation, readjustDuration, EASE_TYPE.QUINT)\r\n            ];\r\n            if (!atTargetPalette) {\r\n                animations.push(this.animatePaletteByIdTransition(preset, readjustDuration, coloringCallback));\r\n            }\r\n            await Promise.all(animations);\r\n        } else {\r\n            // Full 3-stage cinematic animation:\r\n\r\n            // Stage 1: Zoom out to default zoom with random rotation (if significantly zoomed in)\r\n            const needsZoomOut = this.zoom < this.DEFAULT_ZOOM * 0.9;\r\n            if (needsZoomOut) {\r\n                const zoomOutRotation = this.rotation + (Math.random() * PI * 2 - PI);\r\n                await this.animateZoomRotationTo(this.DEFAULT_ZOOM, zoomOutRotation, zoomOutDuration, EASE_TYPE.QUINT);\r\n            }\r\n\r\n            // Stage 2: Pan to target coordinates\r\n            await this.animatePanTo(preset.pan, panDuration, EASE_TYPE.CUBIC);\r\n\r\n            // Stage 3: Zoom in with cinematic rotation AND palette transition in parallel\r\n            // Calculate extra rotations\r\n            const extraFullRotations = Math.floor(Math.random() * 2); // 1 or 2 full rotations\r\n            const rotationDirection = Math.random() > 0.5 ? 1 : -1;\r\n\r\n            // Calculate shortest angular path from current to preset rotation\r\n            let deltaAngle = presetRotation - this.rotation;\r\n            while (deltaAngle > PI) deltaAngle -= PI * 2;\r\n            while (deltaAngle < -PI) deltaAngle += PI * 2;\r\n\r\n            // Target includes the path to preset plus extra full rotations\r\n            // This will end exactly at presetRotation after normalization\r\n            const targetRotationWithSpins = this.rotation + deltaAngle + (rotationDirection * extraFullRotations * PI * 2);\r\n\r\n            const finalAnimations = [\r\n                this.animateZoomRotationTo(preset.zoom, targetRotationWithSpins, zoomInDurationWithSpeed, EASE_TYPE.NONE)\r\n            ];\r\n            if (!atTargetPalette) {\r\n                finalAnimations.push(this.animatePaletteByIdTransition(preset, zoomInDurationWithSpeed, coloringCallback));\r\n            }\r\n            await Promise.all(finalAnimations);\r\n        }\r\n\r\n        // Normalize rotation to ensure it's exactly at preset value (handles 2 wrapping)\r\n        this.rotation = normalizeRotation(this.rotation);\r\n\r\n        this.currentPresetIndex = preset.index || 0;\r\n\r\n        // Force a clean orbit rebuild with full grid search now that animation is complete\r\n        this.markOrbitDirty();\r\n        this.draw();\r\n\r\n        console.log(`Travel complete.`);\r\n        console.groupEnd();\r\n    }\r\n\r\n    /**\r\n     * Animates infinite demo loop of traveling to the presets\r\n     * @param {boolean} random Determines whether presets are looped in order from 1-9 or ordered randomly\r\n     * @param {Function} [coloringCallback] Optional callback for UI color updates\r\n     * @param {Function} [onPresetComplete] Optional callback when each preset completes\r\n     * @param {Array<PRESET>} [userPresets] Optional array of user-saved presets to include in the demo\r\n     * @return {Promise<void>}\r\n     */\r\n    async animateDemo(random = true, coloringCallback = null, onPresetComplete = null, userPresets = []) {\r\n        console.groupCollapsed(`%c ${this.constructor.name}: animateDemo`, CONSOLE_GROUP_STYLE);\r\n        this.stopAllNonColorAnimations();\r\n\r\n        // Merge built-in presets with user presets\r\n        const allPresets = [...this.PRESETS, ...userPresets];\r\n\r\n        if (!allPresets.length) {\r\n            console.warn('No presets defined for Mandelbrot mode ');\r\n            return;\r\n        }\r\n\r\n        console.log(`Demo includes ${this.PRESETS.length} built-in + ${userPresets.length} user presets`);\r\n        this.demoActive = true;\r\n\r\n        // Simple index cycling - just go through all presets\r\n        let demoIndex = 0;\r\n        const getNextPresetIndex = (random) => {\r\n            if (allPresets.length <= 1) {\r\n                return 0; // Only one preset, always return it\r\n            }\r\n\r\n            if (random) {\r\n                // Pick a random preset different from current\r\n                let index;\r\n                do {\r\n                    index = Math.floor(Math.random() * allPresets.length);\r\n                } while (index === demoIndex && allPresets.length > 1);\r\n                return index;\r\n            } else {\r\n                // Sequential: just increment\r\n                return (demoIndex + 1) % allPresets.length;\r\n            }\r\n        };\r\n\r\n        // Continue cycling through presets while demo is active.\r\n        while (this.demoActive) {\r\n            demoIndex = getNextPresetIndex(random);\r\n            const currentPreset = allPresets[demoIndex];\r\n\r\n            if (!currentPreset) {\r\n                console.warn(`No preset at index ${demoIndex}, stopping demo`);\r\n                break;\r\n            }\r\n\r\n            console.log(`Animating to preset ${demoIndex}/${allPresets.length}: \"${currentPreset.id}\"`);\r\n\r\n            await this.animateTravelToPreset(currentPreset, 3000, 1000, 3000, coloringCallback);\r\n\r\n            // Call completion callback to update UI state\r\n            if (onPresetComplete) {\r\n                onPresetComplete();\r\n            }\r\n\r\n            await asyncDelay(3500);\r\n        }\r\n\r\n        console.log(`Demo interrupted.`);\r\n        console.groupEnd();\r\n    }\r\n\r\n    // endregion--------------------------------------------------------------------------------------------------------\r\n}\r\n\r\nexport default MandelbrotRenderer","import FractalRenderer from \"./fractalRenderer\";\r\n/** @type {string} */\r\nimport fragmentShaderRaw from '../shaders/riemann.frag';\r\n\r\nclass RiemannRenderer extends FractalRenderer {\r\n\r\n    constructor(canvas) {\r\n        super(canvas);\r\n\r\n        this.termCount = 1000;\r\n        this.MIN_ZOOM = 4000;\r\n        this.DEFAULT_ZOOM = 30;\r\n\r\n        this.useAnalyticExtension = true;\r\n\r\n        this.init();\r\n    }\r\n\r\n    updateUniforms() {\r\n        this.termCountLoc = this.gl.getUniformLocation(this.program, 'u_termCount');\r\n        this.useAnalyticExtensionLoc = this.gl.getUniformLocation(this.program, 'u_useAnalyticExtension');\r\n\r\n        super.updateUniforms();\r\n    }\r\n\r\n    draw() {\r\n        this.gl.uniform1i(this.termCountLoc, this.termCount);\r\n        this.gl.uniform1i(this.useAnalyticExtensionLoc, this.useAnalyticExtension ? 1 : 0);\r\n\r\n        super.draw();\r\n    }\r\n\r\n    createFragmentShaderSource() {\r\n        return fragmentShaderRaw;\r\n\r\n    }\r\n\r\n    onProgramCreated() {\r\n\r\n    }\r\n\r\n    needsRebase() {\r\n        return undefined;\r\n    }\r\n}\r\n\r\nexport default RiemannRenderer;","/**\r\n * @module JuliaSlidersController\r\n * @author Radim Brnka\r\n * @description Controller of Julia slider elements directly interacting with the c-value of Julia fractal.\r\n * @copyright Synaptory Fractal Traveler, 2025-2026\r\n * @license MIT\r\n */\r\n\r\nimport {CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE} from \"../global/constants\";\r\nimport {isJuliaMode, resetPresetAndDiveButtonStates, updateInfo} from \"./ui\";\r\nimport {clearURLParams} from \"../global/utils\";\r\nimport {JuliaRenderer} from \"../renderers/juliaRenderer\";\r\n\r\n/**\r\n * Throttle limit in milliseconds.\r\n * 50ms = 20 updates/sec - smooth enough for visual feedback, reduces DOM thrash during animations.\r\n * @type {number}\r\n */\r\nconst SLIDER_UPDATE_THROTTLE_LIMIT = 50;\r\n\r\n/** Threshold for \"near zero\" visual feedback */\r\nconst ZERO_ZONE_THRESHOLD = 0.01;\r\n\r\n/** Threshold for snapping to exactly zero */\r\nconst ZERO_SNAP_THRESHOLD = 0.005;\r\n\r\nlet sliderContainer;\r\nlet realSlider;\r\nlet imagSlider;\r\nlet realSliderValue;\r\nlet imagSliderValue;\r\nlet lastSliderUpdate = 0; // Tracks the last time the sliders were updated\r\n\r\nlet fractalApp;\r\n\r\n/**\r\n * Initializes the elements and their event listeners\r\n * @param {FractalRenderer} app\r\n */\r\nexport function initJuliaSliders(app) {\r\n    if (!(app instanceof JuliaRenderer)) {\r\n        console.error(`%c initJuliaSliders: %c Can only attach to JuliaRenderer, not ${app}!`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n        return;\r\n    }\r\n\r\n    fractalApp = app;\r\n\r\n    realSlider = document.getElementById('realSlider');\r\n    realSliderValue = document.getElementById('realSliderValue');\r\n    imagSlider = document.getElementById('imagSlider');\r\n    imagSliderValue = document.getElementById('imagSliderValue');\r\n\r\n    realSlider.addEventListener('input', onRealSliderChange);\r\n    imagSlider.addEventListener('input', onImagSliderChange);\r\n\r\n    sliderContainer = document.getElementById('sliders');\r\n    sliderContainer.style.display = 'flex';\r\n\r\n    console.log(`%c initJuliaSliders: %c Initialized.`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n}\r\n\r\nfunction onSliderChangeFinished() {\r\n    fractalApp.draw();\r\n    updateInfo();\r\n    clearURLParams();\r\n    resetPresetAndDiveButtonStates();\r\n    fractalApp.demoTime = 0;\r\n}\r\n\r\n/**\r\n * Updates slider visual state based on proximity to zero\r\n * @param {HTMLInputElement} slider\r\n * @param {number} value\r\n */\r\nfunction updateZeroZoneState(slider, value) {\r\n    const isNearZero = Math.abs(value) < ZERO_ZONE_THRESHOLD;\r\n    slider.classList.toggle('near-zero', isNearZero);\r\n}\r\n\r\n/**\r\n * Snaps value to zero if within snap threshold\r\n * @param {number} value\r\n * @returns {number}\r\n */\r\nfunction snapToZero(value) {\r\n    return Math.abs(value) < ZERO_SNAP_THRESHOLD ? 0 : value;\r\n}\r\n\r\nconst onRealSliderChange = () => {\r\n    let cx = snapToZero(parseFloat(realSlider.value));\r\n    fractalApp.c[0] = cx;\r\n    realSliderValue.textContent = cx.toFixed(4);\r\n    updateZeroZoneState(realSlider, cx);\r\n    onSliderChangeFinished();\r\n};\r\n\r\nconst onImagSliderChange = () => {\r\n    let cy = snapToZero(parseFloat(imagSlider.value));\r\n    fractalApp.c[1] = cy;\r\n    imagSliderValue.textContent = `${cy.toFixed(4)}i`;\r\n    updateZeroZoneState(imagSlider, cy);\r\n    onSliderChangeFinished();\r\n};\r\n\r\n// region > External methods ------------------------------------------------------------------------------------------\r\n/** Destructor. Removes listeners and hides elements. */\r\nexport function destroyJuliaSliders() {\r\n    if (realSlider && imagSlider && sliderContainer) {\r\n        realSlider.removeEventListener('input', onRealSliderChange);\r\n        imagSlider.removeEventListener('input', onImagSliderChange);\r\n\r\n        sliderContainer.style.display = 'none';\r\n\r\n        console.log(`%c destroyJuliaSliders: %c Destroyed.`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n    } else {\r\n        console.warn(`%c destroyJuliaSliders: %c Called on not initialized state!`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n    }\r\n}\r\n\r\n/** Resets sliders */\r\nexport function resetJuliaSliders() {\r\n    if (!isJuliaMode()) {\r\n        console.warn(`%c resetJuliaSliders: %c Not in Julia mode!`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n        return;\r\n    }\r\n\r\n    realSlider.value = parseFloat(fractalApp.c[0].toFixed(2));\r\n    imagSlider.value = parseFloat(fractalApp.c[1].toFixed(2));\r\n    realSliderValue.innerText = realSlider.value;\r\n    imagSliderValue.innerText = imagSlider.value + 'i';\r\n    fractalApp.demoTime = 0;\r\n}\r\n\r\n/** Updates the real/imaginary sliders appropriately */\r\nexport function updateJuliaSliders() {\r\n    const now = performance.now();\r\n    const timeSinceLastUpdate = now - lastSliderUpdate;\r\n\r\n    if (timeSinceLastUpdate < SLIDER_UPDATE_THROTTLE_LIMIT) {\r\n        return; // Skip update if called too soon\r\n    }\r\n\r\n    // Update the last update time\r\n    lastSliderUpdate = now;\r\n    realSliderValue.innerText = fractalApp.c[0].toFixed(4);\r\n    imagSliderValue.innerText = fractalApp.c[1].toFixed(4) + 'i';\r\n    realSlider.value = parseFloat(fractalApp.c[0].toFixed(4));\r\n    imagSlider.value = parseFloat(fractalApp.c[1].toFixed(4));\r\n\r\n    // Update zero zone visual feedback\r\n    updateZeroZoneState(realSlider, fractalApp.c[0]);\r\n    updateZeroZoneState(imagSlider, fractalApp.c[1]);\r\n}\r\n\r\n/** Disable slider controls */\r\nexport const disableJuliaSliders = () => {\r\n    imagSlider.disabled = realSlider.disabled = true;\r\n    realSlider.classList.add('thumbDisabled');\r\n    imagSlider.classList.add('thumbDisabled');\r\n};\r\n\r\n/** Enable slider controls */\r\nexport const enableJuliaSliders = () => {\r\n    imagSlider.disabled = realSlider.disabled = false;\r\n    realSlider.classList.remove('thumbDisabled');\r\n    imagSlider.classList.remove('thumbDisabled');\r\n};\r\n\r\n// endregion -----------------------------------------------------------------------------------------------------------","import {ddValue, esc, isTouchDevice} from \"../global/utils\";\r\nimport {\r\n    ADAPTIVE_QUALITY_MIN,\r\n    ADAPTIVE_QUALITY_THRESHOLD_HIGH,\r\n    ADAPTIVE_QUALITY_THRESHOLD_LOW,\r\n    log,\r\n    LOG_LEVEL\r\n} from \"../global/constants\";\r\nimport {getFractalMode, isAnimationActive, isJuliaMode} from \"./ui\";\r\n\r\n/**\r\n * Debug Panel\r\n *\r\n * @author Radim Brnka\r\n * @description Provides an on-screen debugging panel for monitoring real-time application performance,\r\n * GPU capabilities, and rendering diagnostics related to WebGL fractal rendering.\r\n * @copyright Synaptory Fractal Traveler, 2025-2026\r\n * @license MIT\r\n */\r\nexport class DebugPanel {\r\n\r\n    panelSelector = 'debugInfo';\r\n\r\n    constructor(canvas, fractalApp) {\r\n        this.canvas = canvas;\r\n        this.fractalApp = fractalApp;\r\n        this.gl = fractalApp?.gl;\r\n\r\n        this.debugInfo = document.getElementById(this.panelSelector);\r\n        if (!this.debugInfo) {\r\n            console.warn(`DebugPanel: #${this.panelSelector} element not found.`);\r\n            return;\r\n        }\r\n\r\n        if (isTouchDevice()) {\r\n            let lastTap = 0;\r\n            this.debugInfo.addEventListener(\"pointerdown\", (e) => {\r\n                const now = Date.now();\r\n                if (now - lastTap < 300) { // Double tap detected\r\n                    this.toggle();\r\n                }\r\n                lastTap = now;\r\n                e.preventDefault();\r\n            });\r\n        }\r\n\r\n        this.debugInfo.addEventListener(\"auxclick\", (event) => {\r\n            if (event.button === 1) {\r\n                console.group('> DEBUG PANEL DUMP');\r\n                log(this.debugInfo.innerText, this.constructor.name, LOG_LEVEL.DEBUG);\r\n                console.groupEnd();\r\n\r\n                let dump = this.debugInfo.innerText.substring(this.debugInfo.innerText.indexOf('FRAG'));\r\n\r\n                navigator.clipboard.writeText(dump).then(function () {\r\n                    log('Debug dump copied to clipboard!');\r\n                }, function (err) {\r\n                    log('Debug dump not copied to clipboard! ' + err.toString(), \"\", LOG_LEVEL.ERROR);\r\n                });\r\n            }\r\n        });\r\n\r\n        // ---- Extensions / GPU info (cached) ----\r\n        this.extTimer =\r\n            this.gl?.getExtension(\"EXT_disjoint_timer_query\") ||\r\n            this.gl?.getExtension(\"EXT_disjoint_timer_query_webgl2\") ||\r\n            null;\r\n\r\n        // Renderer info (optional, blocked in some browsers unless allowed)\r\n        this.extRendererInfo =\r\n            this.gl?.getExtension(\"WEBGL_debug_renderer_info\") || null;\r\n\r\n        this.gpu = {\r\n            vendor: \"unknown\",\r\n            renderer: \"unknown\",\r\n            unmaskedVendor: null,\r\n            unmaskedRenderer: null,\r\n            webglVersion: \"unknown\",\r\n            shadingLanguageVersion: \"unknown\",\r\n            maxTextureSize: null,\r\n            maxVaryings: null,\r\n            maxFragUniforms: null,\r\n            maxVertUniforms: null,\r\n            maxViewportDims: null,\r\n        };\r\n\r\n        this._initGpuInfo();\r\n\r\n        // ---- Persistent perf state ----\r\n        this.perf = {\r\n            // rAF timing (debug panel update rate - typically monitor refresh rate)\r\n            lastRafTs: performance.now(),\r\n            fps: 0,\r\n            frameMs: 0,\r\n            frameMsSmoothed: NaN,\r\n\r\n            // Actual render FPS (how often draw() is called)\r\n            drawCount: 0,\r\n            lastDrawCountReset: performance.now(),\r\n            renderFps: 0,\r\n\r\n            // CPU timing of this panel update itself (not your fractal draw)\r\n            panelCpuMs: 0,\r\n            panelCpuMsSmoothed: NaN,\r\n\r\n            // GPU timing via timer query (requires beginGpuTimer/endGpuTimer around draw)\r\n            gpuSupported: !!this.extTimer,\r\n            gpuMs: NaN,\r\n            gpuMsSmoothed: NaN,\r\n            gpuDisjoint: false,\r\n            gpuLastUpdateTs: 0,  // timestamp of last GPU measurement\r\n\r\n            // Timer query bookkeeping\r\n            queryInFlight: null,\r\n            pendingQueries: [],\r\n        };\r\n\r\n        // Toggle visibility on creation\r\n        this.toggle();\r\n\r\n        // Bind-safe update loop\r\n        requestAnimationFrame(this.update);\r\n    }\r\n\r\n    setRenderer(renderer) {\r\n        this.fractalApp = renderer || null;\r\n        this.gl = renderer?.gl || null;\r\n    }\r\n\r\n    _initGpuInfo() {\r\n        const gl = this.gl;\r\n        if (!gl) return;\r\n\r\n        try {\r\n            this.gpu.webglVersion = gl.getParameter(gl.VERSION) || \"unknown\";\r\n            this.gpu.shadingLanguageVersion =\r\n                gl.getParameter(gl.SHADING_LANGUAGE_VERSION) || \"unknown\";\r\n            this.gpu.vendor = gl.getParameter(gl.VENDOR) || \"unknown\";\r\n            this.gpu.renderer = gl.getParameter(gl.RENDERER) || \"unknown\";\r\n\r\n            this.gpu.maxTextureSize = gl.getParameter(gl.MAX_TEXTURE_SIZE);\r\n            this.gpu.maxVaryings = gl.getParameter(gl.MAX_VARYING_VECTORS);\r\n            this.gpu.maxFragUniforms = gl.getParameter(gl.MAX_FRAGMENT_UNIFORM_VECTORS);\r\n            this.gpu.maxVertUniforms = gl.getParameter(gl.MAX_VERTEX_UNIFORM_VECTORS);\r\n            this.gpu.maxViewportDims = gl.getParameter(gl.MAX_VIEWPORT_DIMS);\r\n\r\n            if (this.extRendererInfo) {\r\n                const v = gl.getParameter(\r\n                    this.extRendererInfo.UNMASKED_VENDOR_WEBGL\r\n                );\r\n                const r = gl.getParameter(\r\n                    this.extRendererInfo.UNMASKED_RENDERER_WEBGL\r\n                );\r\n                this.gpu.unmaskedVendor = v || null;\r\n                this.gpu.unmaskedRenderer = r || null;\r\n            }\r\n        } catch (e) {\r\n            // Some browsers throw on blocked params; keep defaults\r\n            console.warn(\"DebugPanel: GPU info query failed:\", e);\r\n        }\r\n    }\r\n\r\n    // ---- GPU timer query helpers ----\r\n    beginGpuTimer() {\r\n        if (!this.extTimer || !this.gl) return;\r\n        if (this.perf.queryInFlight) return; // keep it simple: one in flight\r\n\r\n        // Track draw calls for render FPS\r\n        this.perf.drawCount++;\r\n\r\n        // EXT_disjoint_timer_query is async; begin/end must bracket the draw call\r\n        const q = this.extTimer.createQueryEXT();\r\n        this.extTimer.beginQueryEXT(this.extTimer.TIME_ELAPSED_EXT, q);\r\n        this.perf.queryInFlight = q;\r\n    }\r\n\r\n    endGpuTimer() {\r\n        if (!this.extTimer || !this.gl) return;\r\n        if (!this.perf.queryInFlight) return;\r\n\r\n        this.extTimer.endQueryEXT(this.extTimer.TIME_ELAPSED_EXT);\r\n        this.perf.pendingQueries.push(this.perf.queryInFlight);\r\n        this.perf.queryInFlight = null;\r\n    }\r\n\r\n    pollGpuTimers() {\r\n        if (!this.extTimer || !this.gl) return;\r\n\r\n        // disjoint means the result is unreliable (clock reset / driver event)\r\n        const disjoint = this.gl.getParameter(this.extTimer.GPU_DISJOINT_EXT);\r\n        this.perf.gpuDisjoint = !!disjoint;\r\n\r\n        if (this.perf.pendingQueries.length === 0) return;\r\n\r\n        // Read the oldest query only (avoid stalls)\r\n        const q = this.perf.pendingQueries[0];\r\n        const available = this.extTimer.getQueryObjectEXT(\r\n            q,\r\n            this.extTimer.QUERY_RESULT_AVAILABLE_EXT\r\n        );\r\n        if (!available) return;\r\n\r\n        const ns = this.extTimer.getQueryObjectEXT(q, this.extTimer.QUERY_RESULT_EXT);\r\n        this.extTimer.deleteQueryEXT(q);\r\n        this.perf.pendingQueries.shift();\r\n\r\n        if (!this.perf.gpuDisjoint) {\r\n            const ms = ns / 1e6;\r\n            this.perf.gpuMs = ms;\r\n            this.perf.gpuMsSmoothed = this.smooth(this.perf.gpuMsSmoothed, ms, 0.15);\r\n            this.perf.gpuLastUpdateTs = performance.now();\r\n        } else {\r\n            this.perf.gpuMs = NaN;\r\n            // keep previous smoothed value; disjoint is a transient condition\r\n        }\r\n    }\r\n\r\n    smooth(prev, next, alpha) {\r\n        if (!Number.isFinite(next)) return prev;\r\n        if (!Number.isFinite(prev)) return next;\r\n        return prev + (next - prev) * alpha;\r\n    }\r\n\r\n    update = (ts) => {\r\n        if (!this.debugInfo || !this.fractalApp) return;\r\n\r\n        const t0 = performance.now();\r\n\r\n        // Poll GPU timers first (results arrive later)\r\n        this.pollGpuTimers();\r\n\r\n        // rAF timing (debug panel update rate)\r\n        const dt = ts - this.perf.lastRafTs;\r\n        this.perf.lastRafTs = ts;\r\n        this.perf.frameMs = dt;\r\n        this.perf.frameMsSmoothed = this.smooth(this.perf.frameMsSmoothed, dt, 0.1);\r\n        this.perf.fps = dt > 0 ? 1000 / dt : 0;\r\n\r\n        // Calculate actual render FPS (based on draw() calls)\r\n        const now = performance.now();\r\n        const drawCountInterval = now - this.perf.lastDrawCountReset;\r\n        if (drawCountInterval >= 1000) {\r\n            // Update render FPS every second\r\n            this.perf.renderFps = (this.perf.drawCount * 1000) / drawCountInterval;\r\n            this.perf.drawCount = 0;\r\n            this.perf.lastDrawCountReset = now;\r\n        }\r\n\r\n        const dpr = window.devicePixelRatio || 1;\r\n\r\n        const gl = this.gl;\r\n        if (!gl || typeof gl.getShaderPrecisionFormat !== \"function\") return;\r\n\r\n        const hp = gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_FLOAT);\r\n\r\n        const hpInfo = {precision: hp.precision, rangeMin: hp.rangeMin, rangeMax: hp.rangeMax};\r\n\r\n        const viewPanX = ddValue(this.fractalApp.panDD.x);\r\n        const viewPanY = ddValue(this.fractalApp.panDD.y);\r\n        const cx = isJuliaMode() ? this.fractalApp.c[0] : 0;\r\n        const cy = isJuliaMode() ? this.fractalApp.c[1] : 0;\r\n\r\n        const refPanX = this.fractalApp.pan[0];\r\n        const refPanY = this.fractalApp.pan[1];\r\n\r\n        const zoom = this.fractalApp.zoom;\r\n        const safeZoom = Math.max(zoom, 1e-300);\r\n\r\n        // Scale diagnostics\r\n        const pxPerUnit = this.canvas.width / safeZoom;\r\n\r\n        // Precision stress heuristics\r\n        const absPan = Math.hypot(viewPanX, viewPanY);\r\n        const panOverZoom = absPan / safeZoom;\r\n        const mantissaUsedApprox = Math.log2(Math.max(panOverZoom, 1e-300));\r\n\r\n        // Perturbation drift\r\n        const driftAbs = Math.hypot(viewPanX - refPanX, viewPanY - refPanY);\r\n        const driftViewUnits = driftAbs / safeZoom;\r\n\r\n        const orbitStatus = this.fractalApp.orbitDirty ? \"DIRTY\" : \"cached\";\r\n        const zoomBucket = Math.floor(-Math.log10(safeZoom));\r\n\r\n        // ---------- Coloring helpers ----------\r\n        const levelClass = (level) => {\r\n            if (level === \"bad\") return \"dbg-bad\";\r\n            if (level === \"warn\") return \"dbg-warn\";\r\n            return \"dbg-ok\";\r\n        };\r\n\r\n        // ---------- Precision health model ----------\r\n        let score = 100;\r\n\r\n        let panLevel = \"ok\";\r\n        if (mantissaUsedApprox > 44) {\r\n            panLevel = \"bad\";\r\n            score -= 40;\r\n        } else if (mantissaUsedApprox > 34) {\r\n            panLevel = \"warn\";\r\n            score -= 20;\r\n        } else if (mantissaUsedApprox > 28) {\r\n            panLevel = \"warn\";\r\n            score -= 10;\r\n        }\r\n\r\n        let driftLevel = \"ok\";\r\n        if (driftViewUnits > 1.0) {\r\n            driftLevel = \"bad\";\r\n            score -= 25;\r\n        } else if (driftViewUnits > 0.5) {\r\n            driftLevel = \"warn\";\r\n            score -= 12;\r\n        } else if (driftViewUnits > 0.25) {\r\n            driftLevel = \"warn\";\r\n            score -= 6;\r\n        }\r\n\r\n        let scaleLevel = \"ok\";\r\n        if (pxPerUnit < 0.75) {\r\n            scaleLevel = \"warn\";\r\n            score -= 10;\r\n        }\r\n        if (pxPerUnit < 0.25) {\r\n            scaleLevel = \"bad\";\r\n            score -= 20;\r\n        }\r\n\r\n        score = Math.max(0, Math.min(100, Math.round(score)));\r\n\r\n        let healthLevel = \"ok\";\r\n        if (score < 70) healthLevel = \"warn\";\r\n        if (score < 45) healthLevel = \"bad\";\r\n\r\n        const worst =\r\n            healthLevel === \"bad\" || healthLevel === \"warn\"\r\n                ? ` (pan:${panLevel}, drift:${driftLevel}, scale:${scaleLevel})`\r\n                : \"\";\r\n\r\n        // ---------- Performance / bottleneck heuristics ----------\r\n        // Typical: if GPU_ms_smooth is close to frame budget, you're GPU-bound.\r\n        const frameBudgetMs = 1000 / 60; // 16.67ms\r\n        const gpuSmooth = this.perf.gpuMsSmoothed;\r\n        const gpuLevel =\r\n            !Number.isFinite(gpuSmooth) ? \"ok\"\r\n                : gpuSmooth > 22 ? \"bad\"\r\n                    : gpuSmooth > 14 ? \"warn\"\r\n                        : \"ok\";\r\n\r\n        const fpsLevel =\r\n            this.perf.renderFps < 30 ? \"bad\"\r\n                : this.perf.renderFps < 50 ? \"warn\"\r\n                    : \"ok\";\r\n\r\n        // panel CPU time (debug UI overhead)\r\n        const panelCpuMs = performance.now() - t0;\r\n        this.perf.panelCpuMs = panelCpuMs;\r\n        this.perf.panelCpuMsSmoothed = this.smooth(this.perf.panelCpuMsSmoothed, panelCpuMs, 0.2);\r\n\r\n        // Check if GPU measurements are stale (no recent draws)\r\n        const gpuAge = performance.now() - this.perf.gpuLastUpdateTs;\r\n        const gpuIsStale = gpuAge > 500;\r\n\r\n        const gpuHint =\r\n            this.perf.gpuSupported\r\n                ? (Number.isFinite(gpuSmooth)\r\n                    ? (gpuIsStale\r\n                        ? \"static\"\r\n                        : (gpuSmooth > frameBudgetMs ? \"GPU-bound\" : \"OK\"))\r\n                    : \"awaiting measurement\")\r\n                : \"No GPU timer\";\r\n\r\n        // ---------- Output ----------\r\n\r\n        // Animation state\r\n        const animState = [];\r\n        if (this.fractalApp.currentPanAnimationFrame) animState.push('pan');\r\n        if (this.fractalApp.currentZoomAnimationFrame) animState.push('zoom');\r\n        if (this.fractalApp.currentRotationAnimationFrame) animState.push('rotation');\r\n        if (this.fractalApp.currentColorAnimationFrame) animState.push('color');\r\n        if (this.fractalApp.currentCAnimationFrame) animState.push('c');\r\n        const animStatus = animState.length > 0 ? animState.join(', ') : 'none';\r\n        const isAnim = isAnimationActive();\r\n\r\n        // Rotation (convert to degrees for readability)\r\n        const rotationRad = this.fractalApp.rotation || 0;\r\n        const rotationDeg = (rotationRad * 180 / Math.PI) % 360;\r\n\r\n        // Color/palette info\r\n        const paletteIdx = this.fractalApp.currentPaletteIndex;\r\n        const paletteName = paletteIdx >= 0 && this.fractalApp.PALETTES?.[paletteIdx]?.id\r\n            ? this.fractalApp.PALETTES[paletteIdx].id\r\n            : (paletteIdx === -1 ? 'Random/Cycling' : 'n/a');\r\n        const colorPalette = this.fractalApp.colorPalette || [0, 0, 0];\r\n\r\n        // Mandelbrot-specific: frequency and phase\r\n        const hasFreqPhase = this.fractalApp.frequency && this.fractalApp.phase;\r\n        const freqStr = hasFreqPhase\r\n            ? `[${this.fractalApp.frequency.map(v => v.toFixed(2)).join(', ')}]`\r\n            : 'n/a';\r\n        const phaseStr = hasFreqPhase\r\n            ? `[${this.fractalApp.phase.map(v => v.toFixed(2)).join(', ')}]`\r\n            : 'n/a';\r\n\r\n        // DD precision breakdown\r\n        const panDDx = this.fractalApp.panDD?.x;\r\n        const panDDy = this.fractalApp.panDD?.y;\r\n        const ddXhi = panDDx?.hi ?? 0;\r\n        const ddXlo = panDDx?.lo ?? 0;\r\n        const ddYhi = panDDy?.hi ?? 0;\r\n        const ddYlo = panDDy?.lo ?? 0;\r\n\r\n        // Last interaction time\r\n        const lastInteraction = this.fractalApp._lastInteractionTime;\r\n        const timeSinceInteraction = lastInteraction\r\n            ? ((performance.now() - lastInteraction) / 1000).toFixed(1) + 's ago'\r\n            : 'n/a';\r\n\r\n        const gpuVendor = this.gpu.unmaskedVendor || this.gpu.vendor || \"unknown\";\r\n        const gpuRenderer = this.gpu.unmaskedRenderer || this.gpu.renderer || \"unknown\";\r\n\r\n        this.debugInfo.innerHTML = `\r\n            <span class=\"dbg-title\" id=\"copyDebugInfo\">DEBUG PANEL</span><span class=\"dbg-dim\"> ('L' to toggle, middle-click to copy)</span><br/>\r\n            <span class=\"dbg-dim\"></span><br/>\r\n            <span class=\"dbg-title\">FRAG highp</span>: precision=${esc(hpInfo.precision)} range=[${esc(hpInfo.rangeMin)}, ${esc(hpInfo.rangeMax)}]<br/>\r\n            <span class=\"dbg-title\">GPU</span>: ${esc(gpuRenderer)} <span class=\"dbg-dim\">(${esc(gpuVendor)})</span><br/>\r\n            <span class=\"dbg-title\">Mode:</span> ${esc(getFractalMode())} <span class=\"dbg-dim\">|</span> <span class=\"dbg-title\">Canvas:</span> ${esc(this.canvas.width)}x${esc(this.canvas.height)} <span class=\"dbg-dim\">(dpr=${esc(dpr)})</span><br/>\r\n            <br/>\r\n            <span class=\"dbg-title\"> Transform </span><br/>\r\n            <span class=\"dbg-title\">pan</span>=[${esc(viewPanX.toFixed(18))}, ${esc(viewPanY.toFixed(18))}]<br/>\r\n            <span class=\"dbg-dim\">  DD.x: hi=${esc(ddXhi.toExponential(6))} lo=${esc(ddXlo.toExponential(6))}</span><br/>\r\n            <span class=\"dbg-dim\">  DD.y: hi=${esc(ddYhi.toExponential(6))} lo=${esc(ddYlo.toExponential(6))}</span><br/>\r\n            <span class=\"dbg-title\">zoom</span>=${esc(zoom.toExponential(6))} <span class=\"dbg-dim\">(1e-${esc(zoomBucket)})</span><br/>\r\n            <span class=\"dbg-title\">rotation</span>=${esc(rotationDeg.toFixed(2))} <span class=\"dbg-dim\">(${esc(rotationRad.toFixed(4))} rad)</span><br/>\r\n            ${isJuliaMode() ? `<span class=\"dbg-title\">c</span>=[${esc(cx.toFixed(12))}, ${esc(cy.toFixed(12))}]<br/>` : ''}\r\n            <br/>\r\n            <span class=\"dbg-title\"> Coloring </span><br/>\r\n            <span class=\"dbg-title\">palette</span>: <span class=\"${paletteIdx === -1 ? 'dbg-warn' : 'dbg-ok'}\">${esc(paletteName)}</span> <span class=\"dbg-dim\">(idx=${esc(paletteIdx)})</span><br/>\r\n            <span class=\"dbg-title\">theme</span>=[${colorPalette.map(v => v.toFixed(3)).join(', ')}]<br/>\r\n            ${hasFreqPhase ? `<span class=\"dbg-title\">freq</span>=${esc(freqStr)} <span class=\"dbg-title\">phase</span>=${esc(phaseStr)}<br/>` : ''}\r\n            <br/>\r\n            <span class=\"dbg-title\"> State </span><br/>\r\n            <span class=\"dbg-title\">animations</span>: <span class=\"${animState.length > 0 ? 'dbg-warn' : 'dbg-ok'}\">${esc(animStatus)}</span> ${isAnim ? '<span class=\"dbg-badge dbg-warn\">ANIM</span>' : ''}<br/>\r\n            <span class=\"dbg-title\">iters</span>=${esc(this.fractalApp.iterations)} <span class=\"dbg-dim\">(max=${esc(this.fractalApp.MAX_ITER)})</span><br/>\r\n            <span class=\"dbg-title\">orbit</span>=<span class=\"${this.fractalApp.orbitDirty ? 'dbg-warn' : 'dbg-ok'}\">${esc(orbitStatus)}</span><br/>\r\n            <span class=\"dbg-title\">lastInput</span>: <span class=\"dbg-dim\">${esc(timeSinceInteraction)}</span><br/>\r\n            <br/>\r\n            <span class=\"dbg-title\"> Precision </span><br/>\r\n            <span class=\"dbg-title\">health</span>:<span class=\"dbg-badge ${levelClass(healthLevel)}\">${score}/100</span><span class=\"dbg-dim\">${esc(worst)}</span><br/>\r\n            px/unit=<span class=\"${levelClass(scaleLevel)}\">${esc(pxPerUnit.toExponential(2))}</span> <span class=\"dbg-dim\">|</span> log2(pan/z)=<span class=\"${levelClass(panLevel)}\">${esc(mantissaUsedApprox.toFixed(1))}</span><br/>\r\n            ref drift=<span class=\"${levelClass(driftLevel)}\">${esc(driftViewUnits.toFixed(4))}</span> <span class=\"dbg-dim\">view-units</span><br/>\r\n            <br/>\r\n            <span class=\"dbg-title\"> Performance </span><br/>\r\n            <span class=\"dbg-title\">renderFPS</span>=<span class=\"${levelClass(fpsLevel)}\">${esc(this.perf.renderFps.toFixed(1))}</span> <span class=\"dbg-dim\">(rAF=${esc(this.perf.fps.toFixed(0))})</span><br/>\r\n            <span class=\"dbg-title\">GPU</span>=<span class=\"${levelClass(gpuLevel)}\">${this._renderGpuTime(gpuSmooth)}</span> <span class=\"dbg-dim\">${esc(gpuHint)}</span><br/>\r\n            ${this._renderAdaptiveQuality()}<br/>\r\n            `;\r\n\r\n        requestAnimationFrame(this.update);\r\n    };\r\n\r\n    /**\r\n     * Renders adaptive quality status for the debug panel.\r\n     * @returns {string} HTML string for adaptive quality info\r\n     */\r\n    _renderAdaptiveQuality() {\r\n        const enabled = this.fractalApp.adaptiveQualityEnabled;\r\n\r\n        // Calculate FPS thresholds for display\r\n        const minFps = Math.round(1000 / ADAPTIVE_QUALITY_THRESHOLD_HIGH);\r\n        const targetFps = Math.round(1000 / ADAPTIVE_QUALITY_THRESHOLD_LOW);\r\n\r\n        if (!enabled) {\r\n            return `<span class=\"dbg-title\">adaptQ</span>: <span class=\"dbg-dim\">OFF</span> <span class=\"dbg-dim\">(F to toggle)</span>`;\r\n        }\r\n\r\n        const extraIters = this.fractalApp.extraIterations || 0;\r\n        const adaptiveMin = this.fractalApp.adaptiveQualityMin || ADAPTIVE_QUALITY_MIN;\r\n        const gpuMs = this.perf.gpuMsSmoothed;\r\n        const interacting = this.fractalApp.interactionActive;\r\n\r\n        // Determine current state\r\n        let state = 'stable';\r\n        let stateClass = 'dbg-ok';\r\n\r\n        if (interacting) {\r\n            state = 'paused';\r\n            stateClass = 'dbg-dim';\r\n        } else if (Number.isFinite(gpuMs)) {\r\n            if (gpuMs > ADAPTIVE_QUALITY_THRESHOLD_HIGH && extraIters > adaptiveMin) {\r\n                state = 'reducing';\r\n                stateClass = 'dbg-warn';\r\n            } else if (gpuMs < ADAPTIVE_QUALITY_THRESHOLD_LOW && extraIters < 0) {\r\n                state = 'restoring';\r\n                stateClass = 'dbg-ok';\r\n            }\r\n        }\r\n\r\n        // Quality level: 0 extraIters = 100%, negative = below, positive = above\r\n        const qualityPct = 100 + Math.round(100 * extraIters / Math.abs(adaptiveMin));\r\n        const qualityClass = extraIters < 0 ? (qualityPct < 50 ? 'dbg-bad' : 'dbg-warn') : (extraIters > 0 ? 'dbg-ok' : 'dbg-dim');\r\n        const maxExtra = Math.abs(adaptiveMin);\r\n\r\n        return `<span class=\"dbg-title\">adaptQ</span>: <span class=\"${qualityClass}\">${extraIters > 0 ? '+' : ''}${extraIters}</span> <span class=\"dbg-dim\">[${adaptiveMin}..+${maxExtra}]</span> <span class=\"dbg-dim\">(${qualityPct}%)</span> <span class=\"${stateClass}\">[${state}]</span> <span class=\"dbg-dim\">[${minFps}&larr;${targetFps} FPS]</span>`;\r\n    }\r\n\r\n    /**\r\n     * Renders GPU time with staleness indicator.\r\n     * @param {number} gpuSmooth - Smoothed GPU time in ms\r\n     * @returns {string} HTML string for GPU time\r\n     */\r\n    _renderGpuTime(gpuSmooth) {\r\n        if (!Number.isFinite(gpuSmooth)) {\r\n            return 'n/a';\r\n        }\r\n\r\n        const now = performance.now();\r\n        const gpuAge = now - this.perf.gpuLastUpdateTs;\r\n        const isStale = gpuAge > 500; // Consider stale after 500ms without updates\r\n\r\n        if (isStale) {\r\n            return `<span class=\"dbg-dim\">${gpuSmooth.toFixed(2)}ms (stale)</span>`;\r\n        }\r\n\r\n        return `${gpuSmooth.toFixed(2)}ms`;\r\n    }\r\n\r\n    /** Toggle the visibility of the debug panel. */\r\n    toggle = () => {\r\n        if (!this.debugInfo) return; // Safety check\r\n        this.debugInfo.style.display = this.debugInfo.style.display === 'block' ? 'none' : 'block';\r\n    }\r\n}\r\n","import {\r\n    clearURLParams,\r\n    ddValue,\r\n    destroyArrayOfButtons,\r\n    esc,\r\n    getAnimationDuration,\r\n    getFractalName,\r\n    isMobileDevice,\r\n    isTouchDevice,\r\n    normalizeRotation,\r\n    updateURLParams\r\n} from '../global/utils.js';\r\nimport {initMouseHandlers, registerMouseEventHandlers, unregisterMouseEventHandlers} from \"./mouseEventHandlers\";\r\nimport {initTouchHandlers, registerTouchEventHandlers, unregisterTouchEventHandlers} from \"./touchEventHandlers\";\r\nimport {JuliaRenderer} from \"../renderers/juliaRenderer\";\r\nimport {takeScreenshot} from \"./screenshotController\";\r\nimport {\r\n    CONSOLE_GROUP_STYLE,\r\n    CONSOLE_MESSAGE_STYLE,\r\n    DEBUG_LEVEL,\r\n    DEBUG_MODE,\r\n    DEFAULT_ACCENT_COLOR,\r\n    DEFAULT_BG_COLOR,\r\n    DEFAULT_JULIA_THEME_COLOR,\r\n    DEFAULT_MANDELBROT_THEME_COLOR,\r\n    FF_PERSISTENT_FRACTAL_SWITCHING_BUTTON_DISPLAYED,\r\n    FRACTAL_TYPE,\r\n    log,\r\n    PI,\r\n    VERSION\r\n} from \"../global/constants\";\r\nimport {destroyHotKeys, initHotKeys} from \"./hotkeyController\";\r\nimport MandelbrotRenderer from \"../renderers/mandelbrotRenderer\";\r\nimport RiemannRenderer from \"../renderers/riemannRenderer\";\r\nimport {\r\n    destroyJuliaSliders,\r\n    disableJuliaSliders,\r\n    enableJuliaSliders,\r\n    initJuliaSliders,\r\n    resetJuliaSliders,\r\n    updateJuliaSliders\r\n} from \"./juliaSlidersController\";\r\nimport {DebugPanel} from \"./debugPanel\";\r\nimport {destroyJuliaPreview, initJuliaPreview, recolorJuliaPreview, resetJuliaPreview} from \"./juliaPreview\";\r\nimport {calculateMandelbrotZoomFromJulia} from \"../global/utils.fractal\";\r\n\r\n/**\r\n * @module UI\r\n * @author Radim Brnka\r\n * @description Contains code to manage the UI (header interactions, buttons, infoText update, etc.).\r\n * @copyright Synaptory Fractal Traveler, 2025-2026\r\n * @license MIT\r\n */\r\n\r\nlet canvas;\r\nlet fractalApp;\r\n\r\nlet fractalMode = FRACTAL_TYPE.MANDELBROT;\r\n\r\n// LocalStorage keys for user presets\r\nconst USER_PRESETS_KEY_MANDELBROT = 'u_mandelbrot_presets';\r\nconst USER_PRESETS_KEY_JULIA = 'u_julia_presets';\r\n\r\nconst DEMO_BUTTON_DEFAULT_TEXT = 'Demo';\r\nconst DEMO_BUTTON_STOP_TEXT = 'Stop';\r\n\r\nlet accentColor = DEFAULT_ACCENT_COLOR;\r\nlet midColor = DEFAULT_BG_COLOR; // TODO use?\r\nlet bgColor = DEFAULT_BG_COLOR;\r\n\r\nlet headerMinimizeTimeout = null;\r\nlet uiInitialized = false;\r\n/** @type {boolean} */\r\nlet headerVisible = true;\r\n\r\nlet animationActive = false;\r\nlet activeJuliaDiveIndex = -1;\r\nlet activePresetIndex = 0;\r\nlet resizeTimeout;\r\n\r\n// HTML elements\r\nlet header;\r\nlet logo; // H1\r\nlet mandelbrotSwitch;\r\nlet juliaSwitch;\r\nlet persistSwitch;\r\nlet resetButton;\r\nlet saveViewButton;\r\nlet screenshotButton;\r\nlet demoButton;\r\n// Dialog elements\r\nlet saveViewDialog;\r\nlet saveViewNameInput;\r\nlet saveViewConfirmBtn;\r\nlet saveViewCancelBtn;\r\nlet editCoordsDialog;\r\nlet editPanXInput;\r\nlet editPanYInput;\r\nlet editZoomInput;\r\nlet editRotationInput;\r\nlet editCxInput;\r\nlet editCyInput;\r\nlet editJsonInput;\r\nlet editCoordsError;\r\nlet editCoordsApplyBtn;\r\nlet editCoordsCancelBtn;\r\nlet juliaCInputs;\r\nlet presetsToggle;\r\nlet presetsMenu;\r\nlet divesToggle;\r\nlet divesMenu;\r\nlet divesDropdown;\r\nlet paletteToggle;\r\nlet paletteMenu;\r\nlet paletteDropdown;\r\nlet presetButtons = [];\r\nlet diveButtons = [];\r\nlet paletteButtons = [];\r\nlet allButtons = [];\r\nlet infoLabel;\r\nlet infoText;\r\nexport let debugPanel;\r\n\r\nlet lastInfoUpdate = 0; // Tracks the last time the sliders were updated\r\nconst infoUpdateThrottleLimit = 100; // Throttle limit in milliseconds\r\n\r\nlet pendingInfoTimer = null;\r\n\r\n\r\nexport const getFractalMode = () => getFractalName(fractalMode);\r\n\r\n/**\r\n * Switches among fractal modes\r\n * @param {FRACTAL_TYPE} mode\r\n * @param {PRESET|MANDELBROT_PRESET|JULIA_PRESET} [preset] If present, it's set as the default state through travelToPreset\r\n */\r\nexport async function switchFractalMode(mode, preset = null) {\r\n    console.groupCollapsed(`%c switchFractalMode`, CONSOLE_GROUP_STYLE);\r\n\r\n    if (mode === fractalMode) {\r\n        console.warn(`Switching to the same mode? Why?`);\r\n        console.groupEnd();\r\n        if (DEBUG_MODE === DEBUG_LEVEL.NONE) return;\r\n    }\r\n\r\n    exitAnimationMode();\r\n\r\n    fractalApp.destroy();\r\n\r\n    switch (mode) {\r\n        case FRACTAL_TYPE.MANDELBROT:\r\n            enableMandelbrotMode();\r\n            break;\r\n\r\n        case FRACTAL_TYPE.JULIA:\r\n            enableJuliaMode();\r\n            break;\r\n\r\n        case FRACTAL_TYPE.RIEMANN:\r\n            enableRiemannMode();\r\n            break;\r\n\r\n        default:\r\n            console.error(`Unknown fractal mode \"${mode}\"!`);\r\n            console.groupEnd();\r\n            return;\r\n    }\r\n\r\n    // Detach debug panel from old renderer BEFORE destroy\r\n    debugPanel?.setRenderer?.(null);\r\n\r\n    // Attach debug panel to new renderer AFTER init/constructor\r\n    debugPanel?.setRenderer?.(fractalApp);\r\n\r\n    // Register control events\r\n    if (isTouchDevice()) {\r\n        unregisterTouchEventHandlers();\r\n        initTouchHandlers(fractalApp);\r\n    } else {\r\n        destroyHotKeys();\r\n        initHotKeys(fractalApp);\r\n\r\n        unregisterMouseEventHandlers();\r\n        initMouseHandlers(fractalApp);\r\n    }\r\n\r\n    fractalApp.reset();\r\n\r\n    if (preset) {\r\n        resetPresetAndDiveButtonStates();\r\n        initAnimationMode();\r\n\r\n        console.log(`Preset found, setting: ${JSON.stringify(preset)}`)\r\n        if (isJuliaMode()) {\r\n            await fractalApp.animateTravelToPreset({\r\n                pan: [0, 0], c: preset.c, zoom: preset.zoom, rotation: 0\r\n            }, 500);\r\n        } else {\r\n            await fractalApp.animateTravelToPreset({\r\n                pan: preset.pan, zoom: preset.zoom, rotation: 0\r\n            }, 500, 500, 500);\r\n        }\r\n\r\n        exitAnimationMode();\r\n        updateURLParams(fractalMode, fractalApp.pan[0], fractalApp.pan[1], fractalApp.zoom, fractalApp.rotation, fractalApp.c ? fractalApp.c[0] : null, fractalApp.c ? fractalApp.c[1] : null, getCurrentPaletteId());\r\n    }\r\n\r\n    console.log(`Switched to ${mode === FRACTAL_TYPE.MANDELBROT ? 'Mandelbrot' : 'Julia'}`);\r\n    console.groupEnd();\r\n}\r\n\r\n/**\r\n * Switches among fractal modes but keeps the c/pan settings so the fractals match each other.\r\n * @param {FRACTAL_TYPE} targetType\r\n * @return {Promise<void>}\r\n */\r\nexport async function switchFractalTypeWithPersistence(targetType) {\r\n    console.groupCollapsed(`%c switchFractalTypeWithPersistence`, CONSOLE_GROUP_STYLE);\r\n\r\n    if (targetType === fractalMode) {\r\n        console.warn(`Switching to the same fractal? Why?`);\r\n        console.groupEnd();\r\n        return;\r\n    }\r\n\r\n    if (targetType === FRACTAL_TYPE.MANDELBROT) {\r\n        // Julia  Mandelbrot: Use c value as pan position\r\n        // Calculate appropriate zoom based on point analysis and current Julia zoom\r\n        const [cx, cy] = fractalApp.c;\r\n        const juliaDefaultZoom = 3.5;\r\n        const finalZoom = calculateMandelbrotZoomFromJulia(cx, cy, fractalApp.zoom, juliaDefaultZoom);\r\n\r\n        console.log('Julia  Mandelbrot: c=', [cx, cy], 'juliaZoom:', fractalApp.zoom, 'finalZoom:', finalZoom);\r\n\r\n        await switchFractalMode(FRACTAL_TYPE.MANDELBROT, {\r\n            pan: fractalApp.c.slice(),\r\n            zoom: finalZoom,\r\n            rotation: 0\r\n        });\r\n    } else {\r\n        // Mandelbrot  Julia: Use Mandelbrot pan as Julia c parameter\r\n        // Always show the full Julia set at default zoom since Julia structures vary\r\n        // wildly depending on c - user should see the whole set first\r\n        const juliaDefaultZoom = 3.5;\r\n\r\n        await switchFractalMode(FRACTAL_TYPE.JULIA, {\r\n            pan: [0, 0], c: fractalApp.pan.slice(), zoom: juliaDefaultZoom, rotation: 0\r\n        });\r\n    }\r\n    console.groupEnd();\r\n}\r\n\r\nexport const isJuliaMode = () => fractalMode === FRACTAL_TYPE.JULIA;\r\n\r\n/**\r\n * Implemented in a way it's not needed to be called at the first render. Everything should be pre-initialized\r\n * for Mandelbrot mode.\r\n */\r\nexport function enableMandelbrotMode() {\r\n    juliaSwitch.classList.remove('active');\r\n    mandelbrotSwitch.classList.add('active');\r\n\r\n    destroyArrayOfButtons(diveButtons);\r\n    divesDropdown.style.display = 'none';\r\n\r\n    destroyJuliaSliders();\r\n    destroyJuliaPreview();\r\n\r\n    fractalApp.destroy();\r\n    fractalApp = new MandelbrotRenderer(canvas);\r\n    fractalMode = FRACTAL_TYPE.MANDELBROT;\r\n\r\n    // Remove each button from the DOM and reinitialize\r\n    destroyArrayOfButtons(presetButtons);\r\n    if (activePresetIndex !== 0) resetActivePresetIndex();\r\n    initPresetButtonEvents();\r\n\r\n    // Update palette dropdown for new renderer\r\n    initPaletteButtonEvents();\r\n\r\n    updateColorTheme(DEFAULT_MANDELBROT_THEME_COLOR);\r\n\r\n    updatePaletteDropdownState();\r\n\r\n    window.location.hash = ''; // Update URL hash\r\n}\r\n\r\nexport function enableJuliaMode() {\r\n    fractalApp.destroy();\r\n    fractalApp = new JuliaRenderer(canvas);\r\n    fractalMode = FRACTAL_TYPE.JULIA;\r\n\r\n    juliaSwitch.classList.add('active');\r\n    mandelbrotSwitch.classList.remove('active');\r\n\r\n    // Remove each button from the DOM and reinitialize\r\n    destroyArrayOfButtons(presetButtons);\r\n    initPresetButtonEvents();\r\n\r\n    initJuliaSliders(fractalApp);\r\n    updateJuliaSliders();\r\n\r\n    destroyArrayOfButtons(diveButtons);\r\n    initDiveButtons();\r\n\r\n    // Update palette dropdown for new renderer\r\n    initPaletteButtonEvents();\r\n\r\n    if (activePresetIndex !== 0) resetActivePresetIndex();\r\n\r\n    updateColorTheme(DEFAULT_JULIA_THEME_COLOR);\r\n    // Darker backgrounds for Julia as it renders on white\r\n    header.style.background = 'rgba(20, 20, 20, 0.8)';\r\n    infoLabel.style.background = 'rgba(20, 20, 20, 0.8)';\r\n\r\n    updatePaletteDropdownState();\r\n\r\n    window.location.hash = '#julia'; // Update URL hash\r\n}\r\n\r\nexport function enableRiemannMode() {\r\n    fractalApp = new RiemannRenderer(canvas);\r\n    fractalApp.useAnalyticExtension = false;\r\n    fractalMode = FRACTAL_TYPE.RIEMANN;\r\n\r\n    destroyArrayOfButtons(presetButtons);\r\n\r\n    window.location.hash = '#zeta'; // Update URL hash\r\n}\r\n\r\nexport function updatePaletteDropdownState() {\r\n    if (!paletteToggle) return;\r\n\r\n    const palettes = fractalApp.PALETTES || [];\r\n    const currentIndex = fractalApp.currentPaletteIndex;\r\n    const isCycling = fractalApp.paletteCyclingActive;\r\n\r\n    // Update tooltip\r\n    if (palettes.length > 0 && currentIndex >= 0) {\r\n        const currentPalette = palettes[currentIndex];\r\n        paletteToggle.title = `Current: \"${currentPalette.id}\" (T to cycle)`;\r\n    } else {\r\n        paletteToggle.title = 'Change Color Palette (T)';\r\n    }\r\n\r\n    // paletteButtons: [0] = Random, [1] = Palette Cycle, [2+] = palette indices\r\n    paletteButtons.forEach((btn, btnIndex) => {\r\n        if (btnIndex === 1) {\r\n            // Sync cycle button active state with actual cycling state\r\n            btn.classList.toggle('active', isCycling);\r\n        } else if (btnIndex >= 2) {\r\n            // Palette buttons - highlight current palette\r\n            const paletteIndex = btnIndex - 2;\r\n            btn.classList.toggle('active', currentIndex === paletteIndex);\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Returns the current palette ID from the fractal renderer\r\n * @returns {string|null}\r\n */\r\nexport function getCurrentPaletteId() {\r\n    const palettes = fractalApp?.PALETTES || [];\r\n    const currentIndex = fractalApp?.currentPaletteIndex;\r\n    if (palettes.length > 0 && currentIndex >= 0 && currentIndex < palettes.length) {\r\n        return palettes[currentIndex].id;\r\n    }\r\n    return null;\r\n}\r\n\r\n/**\r\n * Updates color scheme\r\n * @param {PALETTE} [palette] defaults to the fractal palette\r\n */\r\nexport function updateColorTheme(palette) {\r\n    palette ||= [...fractalApp.colorPalette];\r\n\r\n    const adjustChannel = (value, brightnessFactor = 1.9) => Math.min(255, Math.floor(value * 255 * brightnessFactor));\r\n\r\n    accentColor = `rgba(${adjustChannel(palette[0])}, ${adjustChannel(palette[1])}, ${adjustChannel(palette[2])}, 1)`;\r\n    midColor = `rgba(${adjustChannel(palette[0], .5)}, ${adjustChannel(palette[1], .5)}, ${adjustChannel(palette[2], .5)}, 0.2)`;\r\n    bgColor = `rgba(${Math.floor(palette[0] * 200)}, ${Math.floor(palette[1] * 200)}, ${Math.floor(palette[2] * 200)}, 0.1)`; // Slightly dimmed for borders\r\n\r\n    let root = document.querySelector(':root');\r\n    root.style.setProperty('--bg-color', bgColor);\r\n    root.style.setProperty('--mid-color', midColor);\r\n    root.style.setProperty('--accent-color', accentColor);\r\n\r\n    recolorJuliaPreview(palette);\r\n}\r\n\r\n/** Resets buttons, active presets and URL */\r\nexport function resetAppState() {\r\n    resetPresetAndDiveButtonStates();\r\n    resetActivePresetIndex();\r\n    clearURLParams();\r\n}\r\n\r\n/**\r\n * Updates the bottom info bar.\r\n * Throttled to avoid layout thrashing during animations (max ~10 updates/sec).\r\n * @param {boolean} force - If true, ensures an update is scheduled even if throttled (won't be dropped)\r\n */\r\nexport function updateInfo(force = false) {\r\n    const now = performance.now();\r\n    const timeSinceLastUpdate = now - lastInfoUpdate;\r\n\r\n    // Always apply throttle - even force=true respects timing to prevent layout thrash\r\n    if (timeSinceLastUpdate < infoUpdateThrottleLimit) {\r\n        // If force=true, ensure we schedule a deferred update (don't drop it)\r\n        if (force && !pendingInfoTimer) {\r\n            const delay = Math.max(infoUpdateThrottleLimit - timeSinceLastUpdate, 0);\r\n\r\n            pendingInfoTimer = setTimeout(() => {\r\n                pendingInfoTimer = null;\r\n                updateInfo(true);\r\n            }, delay);\r\n        }\r\n        return;\r\n    }\r\n\r\n    lastInfoUpdate = now;\r\n\r\n    if (!canvas || !fractalApp) {\r\n        return;\r\n    }\r\n\r\n    let text = (animationActive ? ` <span class=\"middot\"></span> ` : ``);\r\n\r\n    const panX = ddValue(fractalApp.panDD.x) ?? 0;\r\n    const panY = ddValue(fractalApp.panDD.y) ?? 0;\r\n\r\n    text += `p:&nbsp;[${panX.toFixed(8)}, ${panY.toFixed(8)}i] <span class=\"middot\">&middot;</span> `;\r\n\r\n    const currentZoom = fractalApp.zoom ?? 0;\r\n    const currentRotation = (fractalApp.rotation * 180 / PI) % 360;\r\n    const normalizedRotation = currentRotation < 0 ? currentRotation + 360 : currentRotation;\r\n    text += `r:&nbsp;${normalizedRotation.toFixed(0)} <span class=\"middot\">&middot;</span> zoom:&nbsp;${currentZoom.toExponential(0)}`;\r\n\r\n    if (fractalMode === FRACTAL_TYPE.JULIA) {\r\n        const cx = fractalApp.c[0] ?? 0;\r\n        const cy = fractalApp.c[1] ?? 0;\r\n\r\n        text += `<br/>c:&nbsp;[${cx.toFixed(4)}, ${cy.toFixed(4)}i]`;\r\n    }\r\n\r\n    if (animationActive) {\r\n        if (infoText && !infoText.classList.contains('animationActive')) infoText.classList.add('animationActive');\r\n    } else {\r\n        if (infoText?.classList.contains('animationActive')) infoText.classList.remove('animationActive');\r\n    }\r\n\r\n    if (infoText.innerHTML !== text) infoText.innerHTML = text;\r\n}\r\n\r\n/** @returns {boolean} */\r\nexport const isAnimationActive = () => animationActive;\r\n\r\n/**\r\n * Updates the palette cycle button state to match the actual cycling state\r\n */\r\nexport function updatePaletteCycleButtonState() {\r\n    const cycleBtn = document.getElementById('palette-cycle');\r\n    if (!cycleBtn) return;\r\n\r\n    const shouldBeActive = fractalApp?.paletteCyclingActive || false;\r\n    const isActive = cycleBtn.classList.contains('active');\r\n\r\n    if (shouldBeActive && !isActive) {\r\n        cycleBtn.classList.add('active');\r\n    } else if (!shouldBeActive && isActive) {\r\n        cycleBtn.classList.remove('active');\r\n    }\r\n}\r\n\r\n/** Enables controls, resets demo button */\r\nfunction exitAnimationMode() {\r\n    console.groupCollapsed(`%c exitAnimationMode`, CONSOLE_GROUP_STYLE);\r\n\r\n    if (!animationActive) {\r\n        console.groupEnd();\r\n        return;\r\n    }\r\n\r\n    animationActive = false;\r\n    infoText?.classList.remove('animation');\r\n\r\n    fractalApp?.stopAllNonColorAnimations();\r\n    // Note: Don't stop color animations here - palette cycling should be independent\r\n\r\n    if (demoButton) {\r\n        demoButton.innerText = DEMO_BUTTON_DEFAULT_TEXT;\r\n        demoButton.classList.remove('active');\r\n    }\r\n\r\n    if (presetsToggle) presetsToggle.disabled = false;\r\n    if (divesToggle) divesToggle.disabled = false;\r\n\r\n    if (isTouchDevice()) {\r\n        registerTouchEventHandlers();\r\n    } else {\r\n        registerMouseEventHandlers();\r\n    }\r\n\r\n    if (isJuliaMode()) {\r\n        enableJuliaSliders();\r\n    }\r\n\r\n    setTimeout(() => {\r\n        updateInfo();\r\n    }, 150);\r\n\r\n    console.groupEnd();\r\n}\r\n\r\n/** Disables controls, activates demo button */\r\nfunction initAnimationMode() {\r\n    console.groupCollapsed(`%c initAnimationMode`, CONSOLE_GROUP_STYLE);\r\n\r\n    if (animationActive) {\r\n        console.groupEnd();\r\n        return;\r\n    }\r\n\r\n    animationActive = true;\r\n    infoText?.classList.add('animation');\r\n\r\n    // resetPresetAndDiveButtons();\r\n    if (demoButton) {\r\n        demoButton.innerText = DEMO_BUTTON_STOP_TEXT;\r\n        demoButton.classList.add('active');\r\n    }\r\n\r\n    closePresetsDropdown();\r\n    if (presetsToggle) presetsToggle.disabled = true;\r\n    closeDivesDropdown();\r\n    if (divesToggle) divesToggle.disabled = true;\r\n\r\n    // Unregister control events\r\n    if (isTouchDevice()) {\r\n        unregisterTouchEventHandlers();\r\n    } else {\r\n        unregisterMouseEventHandlers();\r\n    }\r\n\r\n    if (isJuliaMode()) {\r\n        disableJuliaSliders();\r\n    }\r\n\r\n    clearURLParams();\r\n\r\n    console.groupEnd();\r\n}\r\n\r\n/**\r\n * Turns demo on/off and/or stops current animation\r\n * @return {Promise<void>}\r\n */\r\nexport async function toggleDemo() {\r\n    console.groupCollapsed(`%c toggleDemo`, CONSOLE_GROUP_STYLE);\r\n\r\n    if (animationActive) {\r\n        resetPresetAndDiveButtonStates();\r\n        activeJuliaDiveIndex = -1;\r\n        fractalApp.stopDemo();\r\n        exitAnimationMode();\r\n        console.groupEnd();\r\n        return;\r\n    }\r\n\r\n    resetPresetAndDiveButtonStates();\r\n    initAnimationMode();\r\n\r\n    // Stop palette cycling if active before starting demo\r\n    if (fractalApp.paletteCyclingActive) {\r\n        fractalApp.stopCurrentColorAnimations();\r\n        updatePaletteCycleButtonState();\r\n    }\r\n\r\n    switch (fractalMode) {\r\n        // @formatter:off\r\n        case FRACTAL_TYPE.MANDELBROT: await startMandelbrotDemo(); break;\r\n\r\n        case FRACTAL_TYPE.JULIA: await startJuliaDemo(); break;\r\n\r\n        default:\r\n            console.warn(`No demo defined for mode ${fractalMode}`);\r\n            exitAnimationMode();\r\n            break;\r\n        // @formatter:on\r\n    }\r\n\r\n    console.groupEnd();\r\n}\r\n\r\n/** Starts the Mandelbrot demo */\r\nasync function startMandelbrotDemo() {\r\n    console.groupCollapsed(`%c startMandelbrotDemo`, CONSOLE_GROUP_STYLE);\r\n\r\n    await fractalApp.animateDemo(true, updateColorTheme, updatePaletteDropdownState, getUserPresets());\r\n\r\n    console.log(\"Demo ended\");\r\n    console.groupEnd();\r\n}\r\n\r\n/**\r\n * Starts the Julia dive infinite animation\r\n * @param {Array<DIVE>} dives\r\n * @param {number} index Index of the dive\r\n * @return {Promise<void>}\r\n */\r\nexport async function startJuliaDive(dives, index) {\r\n    if (animationActive && index === activeJuliaDiveIndex) {\r\n        console.log(`%c startJuliaDive: %c Dive ${index} already in progress. Skipping.`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n        return;\r\n    }\r\n\r\n    if (animationActive) {\r\n        exitAnimationMode();\r\n    }\r\n\r\n    resetPresetAndDiveButtonStates();\r\n    activeJuliaDiveIndex = index;\r\n    diveButtons[index]?.classList.add('active');\r\n\r\n    const dive = dives[index];\r\n\r\n    // Stop palette cycling if dive has a defined palette\r\n    if (dive.paletteId) {\r\n        fractalApp.stopCurrentColorAnimations();\r\n        updatePaletteCycleButtonState();\r\n    }\r\n\r\n    // Validate configuration:\r\n    if (dive.cxDirection < 0 && dive.endC[0] >= dive.startC[0]) {\r\n        console.error(\"For negative cxDirection, endC[0] must be lower than startC[0].\");\r\n        return;\r\n    } else if (dive.cxDirection > 0 && dive.endC[0] <= dive.startC[0]) {\r\n        console.error(\"For positive cxDirection, endC[0] must be higher than startC[0].\");\r\n        return;\r\n    }\r\n    if (dive.cyDirection < 0 && dive.endC[1] >= dive.startC[1]) {\r\n        console.error(\"For negative cyDirection, endC[1] must be lower than startC[1].\");\r\n        return;\r\n    } else if (dive.cyDirection > 0 && dive.endC[1] <= dive.startC[1]) {\r\n        console.error(\"For positive cyDirection, endC[1] must be higher than startC[1].\");\r\n        return;\r\n    }\r\n\r\n    initAnimationMode();\r\n\r\n    //if (DEBUG_MODE) dive.step *= 10;\r\n\r\n    // Transition to the initial preset first.\r\n    const duration = getAnimationDuration(500, fractalApp, {c: dive.startC, pan: dive.pan, zoom: dive.zoom},\r\n        {pan: 0.5, zoom: 2, c: 1});\r\n    console.log(duration);\r\n\r\n    // Phase 1: Set initial state with optional palette transition\r\n    // await fractalApp.animateTravelToPreset({\r\n    //     pan: dive.pan, c: dive.startC.slice(), // copy initial c\r\n    //     zoom: dive.zoom, rotation: dive.rotation\r\n    // }, 1500, EASE_TYPE.QUINT);\r\n    // Alternatively:\r\n    await Promise.all([\r\n        fractalApp.animateToZoomAndC(fractalApp.DEFAULT_ZOOM, dive.startC, 1500),\r\n        fractalApp.animatePaletteByIdTransition(dive, 2500, updateColorTheme)\r\n    ]);\r\n\r\n    // Update palette button state if dive changed the palette\r\n    updatePaletteDropdownState();\r\n\r\n    // Phase 2: Enter dive mode (infinite animation - never resolves)\r\n    await Promise.all([\r\n        fractalApp.animateDive(dive),\r\n        fractalApp.animatePanZoomRotationTo(dive.pan, dive.zoom, dive.rotation, 1500)\r\n    ]);\r\n}\r\n\r\n/** Starts the Julia demo */\r\nasync function startJuliaDemo() {\r\n    console.groupCollapsed(`%c startJuliaDemo`, CONSOLE_GROUP_STYLE);\r\n\r\n    await fractalApp.animateDemo(false, updateColorTheme, updatePaletteDropdownState, getUserPresets());\r\n    // await fractalApp.animateRandomDemo(); // sin/cos original demo\r\n\r\n    console.log(\"Demo ended\");\r\n    console.groupEnd();\r\n}\r\n\r\n/**\r\n * Travels to preset at given index\r\n * @param {Array<PRESET>} presets\r\n * @param {number} index Preset array index\r\n * @return {Promise<void>}\r\n */\r\nexport async function travelToPreset(presets, index) {\r\n    if (animationActive) {\r\n        console.log(`%c travelToPreset: %c Travel to preset ${index} requested, active animation in progress, interrupting...`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n        exitAnimationMode();\r\n    }\r\n\r\n    if (index === activePresetIndex) {\r\n        console.log(`%c travelToPreset: %c Already on preset ${index}, skipping.`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n        return;\r\n    }\r\n\r\n    console.log(`%c travelToPreset: %c Executing travel to preset ${index}`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n\r\n    resetPresetAndDiveButtonStates();\r\n    initAnimationMode();\r\n\r\n    presetButtons[index]?.classList.add('active');\r\n\r\n    if (isJuliaMode()) {\r\n        fractalApp.demoTime = 0;\r\n        await fractalApp.animateTravelToPreset(presets[index], 1500, updateColorTheme);\r\n    } else {\r\n        // Cinematic animation with zoom-out, pan, zoom-in with rotation\r\n        await fractalApp.animateTravelToPreset(presets[index], 2000, 500, 1500, updateColorTheme);\r\n    }\r\n\r\n    // Sync button state after travel (in case preset had paletteId that stopped cycling)\r\n    updatePaletteCycleButtonState();\r\n\r\n    activePresetIndex = index;\r\n\r\n    // Update palette button state if preset changed the palette\r\n    updatePaletteDropdownState();\r\n\r\n    exitAnimationMode();\r\n    updateURLParams(fractalMode, fractalApp.pan[0], fractalApp.pan[1], fractalApp.zoom, fractalApp.rotation, fractalApp.c ? fractalApp.c[0] : null, fractalApp.c ? fractalApp.c[1] : null, getCurrentPaletteId());\r\n}\r\n\r\n/** Inits debug bar with various information permanently shown on the screen */\r\nexport function toggleDebugMode() {\r\n    if (debugPanel) {\r\n        debugPanel.toggle();\r\n    } else {\r\n        debugPanel = new DebugPanel(canvas, fractalApp, accentColor);\r\n        toggleCenterLines();\r\n    }\r\n}\r\n\r\n/** Toggles x/y axes */\r\nexport function toggleCenterLines() {\r\n    const verticalLine = document.getElementById('verticalLine');\r\n    const horizontalLine = document.getElementById('horizontalLine');\r\n\r\n    if (verticalLine.style.display === 'block' && horizontalLine.style.display === 'block') {\r\n        verticalLine.style.display = 'none';\r\n        horizontalLine.style.display = 'none';\r\n    } else {\r\n        verticalLine.style.display = 'block';\r\n        horizontalLine.style.display = 'block';\r\n    }\r\n}\r\n\r\nexport function resetPresetAndDiveButtonStates() {\r\n    if (DEBUG_MODE) console.log(`%c resetPresetAndDiveButtonStates: %c Button states reset.`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n    presetButtons.concat(diveButtons).forEach(b => b?.classList.remove('active'));\r\n}\r\n\r\n/**\r\n * This needs to happen on any fractal change\r\n */\r\nexport function resetActivePresetIndex() {\r\n    activePresetIndex = -1;\r\n}\r\n\r\nexport async function randomizeColors() {\r\n    const palettes = fractalApp.PALETTES || [];\r\n    if (palettes.length === 0) return;\r\n\r\n    // Pick a random palette index different from current if possible\r\n    let randomIndex;\r\n    if (palettes.length === 1) {\r\n        randomIndex = 0;\r\n    } else {\r\n        do {\r\n            randomIndex = Math.floor(Math.random() * palettes.length);\r\n        } while (randomIndex === fractalApp.currentPaletteIndex);\r\n    }\r\n\r\n    await fractalApp.applyPaletteByIndex(randomIndex, 250, updateColorTheme);\r\n    updatePaletteDropdownState();\r\n    updatePaletteCycleButtonState();\r\n}\r\n\r\nexport function captureScreenshot() {\r\n    takeScreenshot(canvas, fractalApp, accentColor);\r\n}\r\n\r\n/**\r\n * Shows/hides/toggles header.\r\n * @param {boolean|null} show Show header? If null, then toggles current state\r\n */\r\nexport function toggleHeader(show = null) {\r\n    let header = document.getElementById('headerContainer');\r\n\r\n    if (show === null) show = !headerVisible;\r\n\r\n    if (show) {\r\n        header.classList.remove('minimized');\r\n    } else {\r\n        header.classList.add('minimized');\r\n    }\r\n\r\n    headerVisible = show;\r\n}\r\n\r\nexport async function reset() {\r\n    console.groupCollapsed(`%c reset`, CONSOLE_GROUP_STYLE);\r\n\r\n    updateColorTheme(isJuliaMode() ? DEFAULT_JULIA_THEME_COLOR : DEFAULT_MANDELBROT_THEME_COLOR);\r\n\r\n    exitAnimationMode();\r\n\r\n    fractalApp.reset();\r\n\r\n    if (isJuliaMode()) {\r\n        resetJuliaSliders();\r\n    } else {\r\n        resetJuliaPreview();\r\n    }\r\n    resetAppState();\r\n    updatePaletteDropdownState();\r\n    updatePaletteCycleButtonState();\r\n    presetButtons[0].classList.add('active');\r\n\r\n    console.groupEnd();\r\n}\r\n\r\n// region > USER PRESETS -----------------------------------------------------------------------------------------------\r\n\r\n/**\r\n * Gets the localStorage key for user presets based on current fractal mode\r\n * @returns {string}\r\n */\r\nfunction getUserPresetsKey() {\r\n    return isJuliaMode() ? USER_PRESETS_KEY_JULIA : USER_PRESETS_KEY_MANDELBROT;\r\n}\r\n\r\n/**\r\n * Gets user presets from localStorage for current fractal mode\r\n * @returns {Array<PRESET>}\r\n */\r\nexport function getUserPresets() {\r\n    try {\r\n        const stored = localStorage.getItem(getUserPresetsKey());\r\n        return stored ? JSON.parse(stored) : [];\r\n    } catch (e) {\r\n        console.warn('Failed to load user presets:', e);\r\n        return [];\r\n    }\r\n}\r\n\r\n/**\r\n * Saves user presets to localStorage for current fractal mode\r\n * @param {Array<PRESET>} presets\r\n */\r\nfunction saveUserPresets(presets) {\r\n    try {\r\n        localStorage.setItem(getUserPresetsKey(), JSON.stringify(presets));\r\n    } catch (e) {\r\n        console.error('Failed to save user presets:', e);\r\n    }\r\n}\r\n\r\n/**\r\n * Saves the current view as a user preset\r\n * @param {string} name - The name for the preset\r\n */\r\nfunction saveCurrentViewAsPreset(name) {\r\n    const userPresets = getUserPresets();\r\n\r\n    // Create the preset object with u_ prefix\r\n    const preset = {\r\n        // id: `u_${Date.now()}`,\r\n        id: name,\r\n        pan: [ddValue(fractalApp.panDD.x), ddValue(fractalApp.panDD.y)],\r\n        zoom: fractalApp.zoom,\r\n        rotation: fractalApp.rotation,\r\n        speed: 10\r\n    };\r\n\r\n    // Add Julia-specific c parameter\r\n    if (isJuliaMode() && fractalApp.c) {\r\n        preset.c = [...fractalApp.c];\r\n    }\r\n\r\n    // Store the current palette ID\r\n    if (fractalApp.PALETTES && fractalApp.currentPaletteIndex >= 0 &&\r\n        fractalApp.currentPaletteIndex < fractalApp.PALETTES.length) {\r\n        preset.paletteId = fractalApp.PALETTES[fractalApp.currentPaletteIndex].id;\r\n    }\r\n\r\n    userPresets.push(preset);\r\n    saveUserPresets(userPresets);\r\n\r\n    // Refresh the presets dropdown to include the new preset\r\n    destroyArrayOfButtons(presetButtons);\r\n    initPresetButtonEvents();\r\n\r\n    log(`Saved user preset: ${name}`, 'saveCurrentViewAsPreset');\r\n}\r\n\r\n/**\r\n * Deletes a user preset by its id\r\n * @param {string} presetId\r\n */\r\nfunction deleteUserPreset(presetId) {\r\n    let userPresets = getUserPresets();\r\n    userPresets = userPresets.filter(p => p.id !== presetId);\r\n    saveUserPresets(userPresets);\r\n\r\n    // Refresh the presets dropdown\r\n    destroyArrayOfButtons(presetButtons);\r\n    initPresetButtonEvents();\r\n\r\n    log(`Deleted user preset: ${presetId}`, 'deleteUserPreset');\r\n}\r\n\r\n/**\r\n * Shows the save view dialog\r\n */\r\nexport function showSaveViewDialog() {\r\n    if (!saveViewDialog) return;\r\n\r\n    saveViewNameInput.value = '';\r\n    saveViewConfirmBtn.disabled = true;\r\n    saveViewDialog.classList.add('show');\r\n    saveViewNameInput.focus();\r\n}\r\n\r\n/**\r\n * Hides the save view dialog\r\n */\r\nfunction hideSaveViewDialog() {\r\n    if (!saveViewDialog) return;\r\n    saveViewDialog.classList.remove('show');\r\n}\r\n\r\n/**\r\n * Initializes the save view dialog events\r\n */\r\nfunction initSaveViewDialog() {\r\n    if (!saveViewDialog) return;\r\n\r\n    // Enable/disable save button based on input content\r\n    saveViewNameInput.addEventListener('input', () => {\r\n        saveViewConfirmBtn.disabled = !saveViewNameInput.value.trim();\r\n    });\r\n\r\n    saveViewConfirmBtn.addEventListener('click', () => {\r\n        const name = saveViewNameInput.value.trim();\r\n        if (name) {\r\n            saveCurrentViewAsPreset(name);\r\n            hideSaveViewDialog();\r\n        }\r\n    });\r\n\r\n    saveViewCancelBtn.addEventListener('click', () => {\r\n        hideSaveViewDialog();\r\n    });\r\n\r\n    // Close on overlay click\r\n    saveViewDialog.addEventListener('click', (e) => {\r\n        if (e.target === saveViewDialog) {\r\n            hideSaveViewDialog();\r\n        }\r\n    });\r\n\r\n    // Handle Enter key in input\r\n    saveViewNameInput.addEventListener('keydown', (e) => {\r\n        e.stopPropagation(); // Prevent hotkeys from firing\r\n        if (e.key === 'Enter') {\r\n            const name = saveViewNameInput.value.trim();\r\n            if (name) {\r\n                saveCurrentViewAsPreset(name);\r\n                hideSaveViewDialog();\r\n            }\r\n        } else if (e.key === 'Escape') {\r\n            hideSaveViewDialog();\r\n        }\r\n    });\r\n\r\n    log('Initialized.', 'initSaveViewDialog');\r\n}\r\n\r\n/**\r\n * Shows the edit coordinates dialog\r\n */\r\nexport function showEditCoordsDialog() {\r\n    if (!editCoordsDialog) return;\r\n\r\n    // Show/hide Julia C inputs based on current mode\r\n    if (juliaCInputs) {\r\n        juliaCInputs.style.display = isJuliaMode() ? 'contents' : 'none';\r\n    }\r\n\r\n    // Populate individual fields with current values (shortened precision)\r\n    const viewPanX = ddValue(fractalApp.panDD.x);\r\n    const viewPanY = ddValue(fractalApp.panDD.y);\r\n\r\n    editPanXInput.value = viewPanX.toFixed(8);\r\n    editPanYInput.value = viewPanY.toFixed(8);\r\n    editZoomInput.value = fractalApp.zoom.toExponential(6);\r\n    editRotationInput.value = (fractalApp.rotation * 180 / Math.PI).toFixed(2);\r\n\r\n    if (isJuliaMode()) {\r\n        editCxInput.value = fractalApp.c[0].toFixed(8);\r\n        editCyInput.value = fractalApp.c[1].toFixed(8);\r\n    }\r\n\r\n    // Clear JSON textarea and error\r\n    editJsonInput.value = '';\r\n    editCoordsError.textContent = '';\r\n\r\n    // Clear validation states\r\n    [editPanXInput, editPanYInput, editZoomInput, editRotationInput, editCxInput, editCyInput, editJsonInput].forEach(input => {\r\n        if (input) input.classList.remove('invalid');\r\n    });\r\n\r\n    editCoordsDialog.classList.add('show');\r\n    editPanXInput.focus();\r\n}\r\n\r\n/**\r\n * Hides the edit coordinates dialog\r\n */\r\nfunction hideEditCoordsDialog() {\r\n    if (!editCoordsDialog) return;\r\n    editCoordsDialog.classList.remove('show');\r\n}\r\n\r\n/**\r\n * Parses user input from either JSON or individual fields\r\n * Tries JSON first, then falls back to field-by-field parsing\r\n * @returns {Object} Parsed coordinates object or {error: string}\r\n */\r\nfunction parseEditCoordsInput() {\r\n    const jsonText = editJsonInput.value.trim();\r\n\r\n    // If JSON textarea has content, prioritize that\r\n    if (jsonText) {\r\n        try {\r\n            const parsed = JSON.parse(jsonText);\r\n\r\n            // Validate required fields\r\n            if (!parsed.pan || !Array.isArray(parsed.pan) || parsed.pan.length !== 2) {\r\n                return {error: 'JSON must include \"pan\" as array [x, y]'};\r\n            }\r\n            if (typeof parsed.pan[0] !== 'number' || isNaN(parsed.pan[0])) {\r\n                return {error: 'JSON \"pan[0]\" must be a valid number'};\r\n            }\r\n            if (typeof parsed.pan[1] !== 'number' || isNaN(parsed.pan[1])) {\r\n                return {error: 'JSON \"pan[1]\" must be a valid number'};\r\n            }\r\n            if (typeof parsed.zoom !== 'number' || isNaN(parsed.zoom)) {\r\n                return {error: 'JSON \"zoom\" must be a valid number'};\r\n            }\r\n            if (parsed.zoom <= 0) {\r\n                return {error: 'JSON \"zoom\" must be positive'};\r\n            }\r\n            if (typeof parsed.rotation !== 'number' || isNaN(parsed.rotation)) {\r\n                return {error: 'JSON \"rotation\" must be a valid number (in radians)'};\r\n            }\r\n\r\n            // Validate Julia C if in Julia mode\r\n            if (isJuliaMode()) {\r\n                if (!parsed.c || !Array.isArray(parsed.c) || parsed.c.length !== 2) {\r\n                    return {error: 'JSON must include \"c\" as array [real, imag] in Julia mode'};\r\n                }\r\n                if (typeof parsed.c[0] !== 'number' || isNaN(parsed.c[0])) {\r\n                    return {error: 'JSON \"c[0]\" must be a valid number'};\r\n                }\r\n                if (typeof parsed.c[1] !== 'number' || isNaN(parsed.c[1])) {\r\n                    return {error: 'JSON \"c[1]\" must be a valid number'};\r\n                }\r\n            }\r\n\r\n            // Return only the necessary fields (strip id, paletteId if empty, etc.)\r\n            const result = {\r\n                pan: [parsed.pan[0], parsed.pan[1]],\r\n                zoom: parsed.zoom,\r\n                rotation: parsed.rotation\r\n            };\r\n\r\n            // Add optional fields if present and non-empty\r\n            if (parsed.c && Array.isArray(parsed.c) && parsed.c.length === 2) {\r\n                result.c = [parsed.c[0], parsed.c[1]];\r\n            }\r\n            if (parsed.paletteId && parsed.paletteId.trim()) {\r\n                result.paletteId = parsed.paletteId;\r\n            }\r\n\r\n            return result;\r\n\r\n        } catch (e) {\r\n            return {error: `Invalid JSON: ${e.message}`};\r\n        }\r\n    }\r\n\r\n    // Otherwise, parse from individual fields\r\n    const panXStr = editPanXInput.value.trim();\r\n    const panYStr = editPanYInput.value.trim();\r\n    const zoomStr = editZoomInput.value.trim();\r\n    const rotationStr = editRotationInput.value.trim();\r\n\r\n    // Check for empty fields\r\n    if (!panXStr) return {error: 'Pan X is required'};\r\n    if (!panYStr) return {error: 'Pan Y is required'};\r\n    if (!zoomStr) return {error: 'Zoom is required'};\r\n    if (!rotationStr) return {error: 'Rotation is required'};\r\n\r\n    const panX = parseFloat(panXStr);\r\n    const panY = parseFloat(panYStr);\r\n    const zoom = parseFloat(zoomStr);\r\n    const rotationDeg = parseFloat(rotationStr);\r\n\r\n    // Validate numbers\r\n    if (isNaN(panX)) return {error: `Pan X \"${panXStr}\" is not a valid number`};\r\n    if (isNaN(panY)) return {error: `Pan Y \"${panYStr}\" is not a valid number`};\r\n    if (isNaN(zoom)) return {error: `Zoom \"${zoomStr}\" is not a valid number`};\r\n    if (zoom <= 0) return {error: 'Zoom must be a positive number'};\r\n    if (isNaN(rotationDeg)) return {error: `Rotation \"${rotationStr}\" is not a valid number`};\r\n\r\n    const result = {\r\n        pan: [panX, panY],\r\n        zoom: zoom,\r\n        rotation: normalizeRotation(rotationDeg * Math.PI / 180) // Convert degrees to radians\r\n    };\r\n\r\n    // Add Julia C if in Julia mode\r\n    if (isJuliaMode()) {\r\n        const cxStr = editCxInput.value.trim();\r\n        const cyStr = editCyInput.value.trim();\r\n\r\n        if (!cxStr) return {error: 'C Real is required in Julia mode'};\r\n        if (!cyStr) return {error: 'C Imag is required in Julia mode'};\r\n\r\n        const cx = parseFloat(cxStr);\r\n        const cy = parseFloat(cyStr);\r\n\r\n        if (isNaN(cx)) return {error: `C Real \"${cxStr}\" is not a valid number`};\r\n        if (isNaN(cy)) return {error: `C Imag \"${cyStr}\" is not a valid number`};\r\n\r\n        result.c = [cx, cy];\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\n/**\r\n * Validates current input and updates UI accordingly\r\n * @returns {boolean} True if valid\r\n */\r\nfunction validateEditCoordsInput() {\r\n    const result = parseEditCoordsInput();\r\n\r\n    // Clear all invalid states first\r\n    [editPanXInput, editPanYInput, editZoomInput, editRotationInput, editCxInput, editCyInput, editJsonInput].forEach(input => {\r\n        if (input) input.classList.remove('invalid');\r\n    });\r\n\r\n    if (result.error) {\r\n        editCoordsError.textContent = result.error;\r\n        editCoordsApplyBtn.disabled = true;\r\n\r\n        // Mark specific field as invalid based on error message\r\n        if (editJsonInput.value.trim()) {\r\n            editJsonInput.classList.add('invalid');\r\n        } else {\r\n            // Mark individual field based on error\r\n            if (result.error.includes('Pan X')) editPanXInput.classList.add('invalid');\r\n            else if (result.error.includes('Pan Y')) editPanYInput.classList.add('invalid');\r\n            else if (result.error.includes('Zoom')) editZoomInput.classList.add('invalid');\r\n            else if (result.error.includes('Rotation')) editRotationInput.classList.add('invalid');\r\n            else if (result.error.includes('C Real')) editCxInput.classList.add('invalid');\r\n            else if (result.error.includes('C Imag')) editCyInput.classList.add('invalid');\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    // Clear error and enable apply button\r\n    editCoordsError.textContent = '';\r\n    editCoordsApplyBtn.disabled = false;\r\n\r\n    return true;\r\n}\r\n\r\n/**\r\n * Applies the edited coordinates and animates travel\r\n */\r\nasync function applyEditedCoords() {\r\n    const result = parseEditCoordsInput();\r\n\r\n    if (result.error) {\r\n        editCoordsError.textContent = result.error;\r\n        return;\r\n    }\r\n\r\n    hideEditCoordsDialog();\r\n\r\n    // Animate travel to the new coordinates\r\n    initAnimationMode();\r\n\r\n    // Different signatures for different fractal types\r\n    if (isJuliaMode()) {\r\n        // JuliaRenderer: animateTravelToPreset(preset, duration, coloringCallback)\r\n        await fractalApp.animateTravelToPreset(result, 1500, updateColorTheme);\r\n    } else {\r\n        // MandelbrotRenderer: animateTravelToPreset(preset, zoomOutDuration, panDuration, zoomInDuration, coloringCallback)\r\n        await fractalApp.animateTravelToPreset(result, 1000, 500, 1000, updateColorTheme);\r\n    }\r\n\r\n    exitAnimationMode();\r\n}\r\n\r\n/**\r\n * Initializes the edit coordinates dialog events\r\n */\r\nfunction initEditCoordsDialog() {\r\n    if (!editCoordsDialog) return;\r\n\r\n    // Filter input to allow only valid number characters\r\n    const numericInputs = [editPanXInput, editPanYInput, editZoomInput, editRotationInput, editCxInput, editCyInput];\r\n    numericInputs.forEach(input => {\r\n        if (!input) return;\r\n\r\n        input.addEventListener('input', (e) => {\r\n            let value = e.target.value;\r\n\r\n            // 1. Initial cleanup: Keep only digits, dots, minus signs, and e/E\r\n            let filtered = value.replace(/[^0-9.\\-eE]/g, '');\r\n\r\n            // 2. Ensure only one decimal point\r\n            const dotParts = filtered.split('.');\r\n            if (dotParts.length > 2) {\r\n                filtered = dotParts[0] + '.' + dotParts.slice(1).join('');\r\n            }\r\n\r\n            // 3. Allow minus at start OR after 'e'\r\n            filtered = filtered.replace(/-/g, (match, offset) => {\r\n                if (offset === 0) return match;\r\n                const prevChar = filtered[offset - 1];\r\n                if (prevChar === 'e' || prevChar === 'E') return match;\r\n                return '';\r\n            });\r\n\r\n            // 4. Ensure only one 'e'\r\n            const eParts = filtered.split(/[eE]/);\r\n            if (eParts.length > 2) {\r\n                filtered = eParts[0] + 'e' + eParts[1];\r\n            }\r\n\r\n            // Update value if it changed\r\n            if (value !== filtered) {\r\n                e.target.value = filtered;\r\n            }\r\n        });\r\n    });\r\n\r\n    // Validate on input change\r\n    const allInputs = [editPanXInput, editPanYInput, editZoomInput, editRotationInput, editCxInput, editCyInput, editJsonInput];\r\n    allInputs.forEach(input => {\r\n        if (!input) return;\r\n        input.addEventListener('input', validateEditCoordsInput);\r\n    });\r\n\r\n    // Apply button\r\n    editCoordsApplyBtn.addEventListener('click', async () => {\r\n        await applyEditedCoords();\r\n    });\r\n\r\n    // Cancel button\r\n    editCoordsCancelBtn.addEventListener('click', () => {\r\n        hideEditCoordsDialog();\r\n    });\r\n\r\n    // Close on overlay click\r\n    editCoordsDialog.addEventListener('click', (e) => {\r\n        if (e.target === editCoordsDialog) {\r\n            hideEditCoordsDialog();\r\n        }\r\n    });\r\n\r\n    // Handle keyboard shortcuts in inputs\r\n    allInputs.forEach(input => {\r\n        if (!input) return;\r\n        input.addEventListener('keydown', (e) => {\r\n            e.stopPropagation(); // Prevent hotkeys from firing\r\n\r\n            if (e.key === 'Enter') {\r\n                if (validateEditCoordsInput()) {\r\n                    applyEditedCoords();\r\n                }\r\n            } else if (e.key === 'Escape') {\r\n                hideEditCoordsDialog();\r\n            }\r\n        });\r\n    });\r\n\r\n    log('Initialized.', 'initEditCoordsDialog');\r\n}\r\n\r\n// endregion -----------------------------------------------------------------------------------------------------------\r\n\r\n// region > INITIALIZERS -----------------------------------------------------------------------------------------------\r\n\r\nfunction initHeaderEvents() {\r\n\r\n    let lastPointerType = 'mouse';\r\n\r\n    logo.addEventListener('pointerdown', (e) => {\r\n        lastPointerType = e.pointerType;\r\n    });\r\n\r\n    logo.addEventListener('pointerenter', (e) => {\r\n        // Skip hover behavior for touch - handled by click\r\n        if (e.pointerType === 'touch') return;\r\n\r\n        if (headerMinimizeTimeout) {\r\n            clearTimeout(headerMinimizeTimeout);\r\n            headerMinimizeTimeout = null;\r\n        }\r\n        toggleHeader(true);\r\n    });\r\n\r\n    // Toggle on tap/click for touch devices (and debug mode)\r\n    logo.addEventListener('click', () => {\r\n        if (lastPointerType === 'touch' || DEBUG_MODE > DEBUG_LEVEL.NONE) {\r\n            toggleHeader();\r\n        }\r\n    });\r\n\r\n    header.addEventListener('pointerleave', (e) => {\r\n        // Skip auto-hide for touch - handled by tapping outside\r\n        if (e.pointerType === 'touch') return;\r\n\r\n        // Only minimize if it hasn't been toggled manually\r\n        if (headerVisible && !DEBUG_MODE) {\r\n            headerMinimizeTimeout = setTimeout(() => {\r\n                toggleHeader(false);\r\n                headerMinimizeTimeout = null;\r\n            }, 3000);\r\n        }\r\n    });\r\n\r\n    // When user clicks/taps outside of the header\r\n    canvas.addEventListener('pointerdown', () => {\r\n        if (DEBUG_MODE) return;\r\n        toggleHeader(false);\r\n    });\r\n\r\n    log('Initialized.', 'initHeaderEvents');\r\n}\r\n\r\nfunction initControlButtonEvents() {\r\n    resetButton.addEventListener('click', async () => {\r\n        await reset();\r\n    });\r\n\r\n    saveViewButton.addEventListener('click', showSaveViewDialog);\r\n\r\n    demoButton.addEventListener('click', toggleDemo);\r\n\r\n    screenshotButton.addEventListener('click', captureScreenshot);\r\n\r\n    log('Initialized.', 'initControlButtonEvents');\r\n}\r\n\r\nfunction initPresetButtonEvents() {\r\n    const presetBlock = document.getElementById('presets');\r\n    presetButtons = [];\r\n\r\n    // Add built-in presets\r\n    const presets = [...fractalApp.PRESETS];\r\n    presets.forEach((preset) => {\r\n        const btn = document.createElement('button');\r\n        btn.id = 'preset-' + (preset.index);\r\n        btn.className = 'preset';\r\n        btn.title = `${(preset.id || ('Preset ' + preset.index))} ` +\r\n            `${preset.index < 10 ? '(Num ' : '('}${preset.index})`;\r\n\r\n        btn.textContent = (preset.id || preset.index).toString();\r\n\r\n        // Apply palette keyColor as border if preset has a paletteId\r\n        if (preset.paletteId && fractalApp.PALETTES) {\r\n            const palette = fractalApp.PALETTES.find(p => p.id === preset.paletteId);\r\n            if (palette && palette.keyColor) {\r\n                btn.style.borderColor = palette.keyColor;\r\n                btn.style.setProperty('--palette-color', palette.keyColor);\r\n                btn.classList.add('has-palette');\r\n            }\r\n        }\r\n\r\n        btn.addEventListener('click', async () => {\r\n            closePresetsDropdown();\r\n            await travelToPreset(presets, preset.index);\r\n        });\r\n\r\n        presetBlock.appendChild(btn);\r\n        presetButtons.push(btn);\r\n    });\r\n\r\n    // Add user presets from localStorage\r\n    const userPresets = getUserPresets();\r\n    userPresets.forEach((preset) => {\r\n        const btn = document.createElement('button');\r\n        btn.id = 'preset-' + preset.id;\r\n        btn.className = 'preset user-preset';\r\n        btn.title = `${preset.id} (User) - Right-click to delete`;\r\n        btn.textContent = preset.id;\r\n\r\n        // Apply palette keyColor as border if preset has a paletteId\r\n        if (preset.paletteId && fractalApp.PALETTES) {\r\n            const palette = fractalApp.PALETTES.find(p => p.id === preset.paletteId);\r\n            if (palette && palette.keyColor) {\r\n                btn.style.borderColor = palette.keyColor;\r\n                btn.style.setProperty('--palette-color', palette.keyColor);\r\n                btn.classList.add('has-palette');\r\n            }\r\n        }\r\n\r\n        // Left click to travel to preset\r\n        btn.addEventListener('click', async () => {\r\n            closePresetsDropdown();\r\n            resetPresetAndDiveButtonStates();\r\n            initAnimationMode();\r\n            btn.classList.add('active');\r\n\r\n            if (isJuliaMode()) {\r\n                await fractalApp.animateTravelToPreset(preset, 1500, updateColorTheme);\r\n            } else {\r\n                await fractalApp.animateTravelToPreset(preset, 2000, 500, 1500, updateColorTheme);\r\n            }\r\n\r\n            exitAnimationMode();\r\n            updateURLParams(fractalMode, fractalApp.pan[0], fractalApp.pan[1], fractalApp.zoom, fractalApp.rotation, fractalApp.c ? fractalApp.c[0] : null, fractalApp.c ? fractalApp.c[1] : null, getCurrentPaletteId());\r\n        });\r\n\r\n        // Right click to delete\r\n        btn.addEventListener('contextmenu', (e) => {\r\n            e.preventDefault();\r\n            if (confirm(`Delete view \"${preset.id}\"?`)) {\r\n                deleteUserPreset(preset.id);\r\n            }\r\n        });\r\n\r\n        // Long press to delete (touch devices)\r\n        let longPressTimer = null;\r\n        let touchMoved = false;\r\n        btn.addEventListener('touchstart', (e) => {\r\n            touchMoved = false;\r\n            longPressTimer = setTimeout(() => {\r\n                if (!touchMoved) {\r\n                    e.preventDefault();\r\n                    if (confirm(`Delete view \"${preset.id}\"?`)) {\r\n                        deleteUserPreset(preset.id);\r\n                    }\r\n                }\r\n            }, 600);\r\n        }, {passive: false});\r\n        btn.addEventListener('touchmove', () => {\r\n            touchMoved = true;\r\n            if (longPressTimer) {\r\n                clearTimeout(longPressTimer);\r\n                longPressTimer = null;\r\n            }\r\n        });\r\n        btn.addEventListener('touchend', () => {\r\n            if (longPressTimer) {\r\n                clearTimeout(longPressTimer);\r\n                longPressTimer = null;\r\n            }\r\n        });\r\n\r\n        presetBlock.appendChild(btn);\r\n        presetButtons.push(btn);\r\n    });\r\n\r\n    if (presetButtons.length > 0) {\r\n        presetButtons[0].classList.add('active');\r\n    }\r\n\r\n    log('Initialized.', 'initPresetButtonEvents');\r\n}\r\n\r\n/** Toggles the presets dropdown menu */\r\nfunction togglePresetsDropdown() {\r\n    presetsMenu.classList.toggle('show');\r\n    const isOpen = presetsMenu.classList.contains('show');\r\n    presetsToggle.textContent = isOpen ? 'View ' : 'View ';\r\n}\r\n\r\n/** Closes the presets dropdown menu */\r\nfunction closePresetsDropdown() {\r\n    presetsMenu?.classList.remove('show');\r\n    if (presetsToggle) presetsToggle.textContent = 'View ';\r\n}\r\n\r\nfunction initPresetsDropdown() {\r\n    presetsToggle.addEventListener('click', (e) => {\r\n        e.stopPropagation();\r\n        closeDivesDropdown();\r\n        closePaletteDropdown();\r\n        togglePresetsDropdown();\r\n    });\r\n\r\n    // Close dropdown when clicking outside\r\n    document.addEventListener('click', (e) => {\r\n        if (!presetsMenu.contains(e.target) && e.target !== presetsToggle) {\r\n            closePresetsDropdown();\r\n        }\r\n    });\r\n\r\n    log('Initialized.', 'initPresetsDropdown');\r\n}\r\n\r\n/** Toggles the dives dropdown menu */\r\nfunction toggleDivesDropdown() {\r\n    divesMenu.classList.toggle('show');\r\n    const isOpen = divesMenu.classList.contains('show');\r\n    divesToggle.textContent = isOpen ? 'Dive ' : 'Dive ';\r\n}\r\n\r\n/** Closes the dives dropdown menu */\r\nfunction closeDivesDropdown() {\r\n    divesMenu?.classList.remove('show');\r\n    if (divesToggle) divesToggle.textContent = 'Dive ';\r\n}\r\n\r\nfunction initDivesDropdown() {\r\n    divesToggle.addEventListener('click', (e) => {\r\n        e.stopPropagation();\r\n        closePresetsDropdown();\r\n        closePaletteDropdown();\r\n        toggleDivesDropdown();\r\n    });\r\n\r\n    // Close dropdown when clicking outside\r\n    document.addEventListener('click', (e) => {\r\n        if (!divesMenu.contains(e.target) && e.target !== divesToggle) {\r\n            closeDivesDropdown();\r\n        }\r\n    });\r\n\r\n    log('Initialized.', 'initDivesDropdown');\r\n}\r\n\r\n/** Toggles the palette dropdown menu */\r\nfunction togglePaletteDropdown() {\r\n    paletteMenu.classList.toggle('show');\r\n    const isOpen = paletteMenu.classList.contains('show');\r\n    paletteToggle.textContent = isOpen ? 'Palette ' : 'Palette ';\r\n}\r\n\r\n/** Closes the palette dropdown menu */\r\nfunction closePaletteDropdown() {\r\n    paletteMenu.classList.remove('show');\r\n    paletteToggle.textContent = 'Palette ';\r\n}\r\n\r\nfunction initPaletteButtonEvents() {\r\n    paletteButtons = [];\r\n    paletteMenu.innerHTML = ''; // Clear existing\r\n\r\n    const palettes = fractalApp.PALETTES || [];\r\n\r\n    // Always add \"Random\" option first\r\n    const randomBtn = document.createElement('button');\r\n    randomBtn.id = 'palette-random';\r\n    randomBtn.className = 'palette';\r\n    randomBtn.title = 'Pick a random palette (T)';\r\n    randomBtn.innerHTML = '<span class=\"color-swatch\" style=\"background: linear-gradient(135deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3);\"></span>Random';\r\n    randomBtn.addEventListener('click', async () => {\r\n        closePaletteDropdown();\r\n        await randomizeColors();\r\n    });\r\n    paletteMenu.appendChild(randomBtn);\r\n    paletteButtons.push(randomBtn);\r\n\r\n    // Add \"Color Cycle\" option (Shift+T functionality)\r\n    const cycleBtn = document.createElement('button');\r\n    cycleBtn.id = 'palette-cycle';\r\n    cycleBtn.className = 'palette';\r\n    cycleBtn.title = 'Cycle through palettes sequentially (Shift+T)';\r\n    cycleBtn.innerHTML = '<span class=\"color-swatch color-cycle-swatch\"></span>Palette Cycle';\r\n    cycleBtn.addEventListener('click', async () => {\r\n        if (fractalApp.paletteCyclingActive) {\r\n            fractalApp.stopCurrentColorAnimations();\r\n        } else {\r\n            closePaletteDropdown();\r\n            await fractalApp.startPaletteCycling(5000, 2000, updateColorTheme, updatePaletteDropdownState);\r\n        }\r\n        // Ensure button state is synced\r\n        updatePaletteCycleButtonState();\r\n    });\r\n    paletteMenu.appendChild(cycleBtn);\r\n    paletteButtons.push(cycleBtn);\r\n\r\n    // Add palette options if available\r\n    palettes.forEach((palette, index) => {\r\n        const btn = document.createElement('button');\r\n        btn.id = 'palette-' + index;\r\n        btn.className = 'palette';\r\n        btn.title = palette.id;\r\n\r\n        // Create two-color swatch to better represent palette\r\n        const primaryColor = palette.keyColor || '#888';\r\n        let secondaryColor = primaryColor;\r\n\r\n        if (palette.theme) {\r\n            if (palette.theme.length === 15) {\r\n                // Julia: extract color from stop 3 (index 9-11)\r\n                const r = Math.min(255, Math.round(palette.theme[9] * 255));\r\n                const g = Math.min(255, Math.round(palette.theme[10] * 255));\r\n                const b = Math.min(255, Math.round(palette.theme[11] * 255));\r\n                secondaryColor = `rgb(${r}, ${g}, ${b})`;\r\n            } else if (palette.theme.length === 3) {\r\n                // Mandelbrot: derive color from theme multipliers applied to keyColor\r\n                const hex = primaryColor.replace('#', '');\r\n                const kr = parseInt(hex.substring(0, 2), 16);\r\n                const kg = parseInt(hex.substring(2, 4), 16);\r\n                const kb = parseInt(hex.substring(4, 6), 16);\r\n                const r = Math.min(255, Math.round(kr * palette.theme[0] * 0.7));\r\n                const g = Math.min(255, Math.round(kg * palette.theme[1] * 0.7));\r\n                const b = Math.min(255, Math.round(kb * palette.theme[2] * 0.7));\r\n                secondaryColor = `rgb(${r}, ${g}, ${b})`;\r\n            }\r\n        }\r\n\r\n        btn.innerHTML = `<span class=\"color-swatch\" style=\"background: linear-gradient(135deg, ${primaryColor} 50%, ${secondaryColor} 50%);\"></span>${palette.id}`;\r\n\r\n        btn.addEventListener('click', async () => {\r\n            closePaletteDropdown();\r\n            await fractalApp.applyPaletteByIndex(index, 250, updateColorTheme);\r\n            updatePaletteDropdownState();\r\n            updatePaletteCycleButtonState();\r\n        });\r\n\r\n        paletteMenu.appendChild(btn);\r\n        paletteButtons.push(btn);\r\n    });\r\n\r\n    // Set initial active state\r\n    updatePaletteDropdownState();\r\n\r\n    log('Initialized.', 'initPaletteButtonEvents');\r\n}\r\n\r\nfunction initPaletteDropdown() {\r\n    paletteToggle.addEventListener('click', (e) => {\r\n        e.stopPropagation();\r\n        closePresetsDropdown();\r\n        closeDivesDropdown();\r\n        togglePaletteDropdown();\r\n    });\r\n\r\n    // Close dropdown when clicking outside\r\n    document.addEventListener('click', (e) => {\r\n        if (!paletteMenu.contains(e.target) && e.target !== paletteToggle) {\r\n            closePaletteDropdown();\r\n        }\r\n    });\r\n\r\n    log('Initialized.', 'initPaletteDropdown');\r\n}\r\n\r\n/**\r\n * Inits behavior common for all buttons\r\n */\r\nfunction initCommonButtonEvents() {\r\n    allButtons = diveButtons.concat(presetButtons).concat(paletteButtons);\r\n    allButtons.push(resetButton, saveViewButton, screenshotButton, demoButton);\r\n\r\n    allButtons.forEach((btn) => {\r\n        btn.addEventListener('mouseleave', () => {\r\n            btn.blur();\r\n        });\r\n\r\n        btn.addEventListener('mouseup', () => {\r\n            btn.blur();\r\n        });\r\n    });\r\n\r\n    log('Initialized.', 'initCommonButtonEvents');\r\n}\r\n\r\nfunction initDiveButtons() {\r\n    if (isJuliaMode()) {\r\n        const diveBlock = document.getElementById('dives');\r\n        diveButtons = [];\r\n\r\n        const dives = [...fractalApp.DIVES];\r\n        dives.forEach((dive, index) => {\r\n            const btn = document.createElement('button');\r\n            btn.id = 'dive' + (index);\r\n            btn.className = 'dive';\r\n            btn.title = (dive.id || ('Preset ' + index)) + ` (Shift+${index})`;\r\n            btn.textContent = dive.id || (index).toString();\r\n\r\n            // Apply palette keyColor as border if dive has a paletteId\r\n            if (dive.paletteId && fractalApp.PALETTES) {\r\n                const palette = fractalApp.PALETTES.find(p => p.id === dive.paletteId);\r\n                if (palette && palette.keyColor) {\r\n                    btn.style.borderColor = palette.keyColor;\r\n                    btn.style.setProperty('--palette-color', palette.keyColor);\r\n                    btn.classList.add('has-palette');\r\n                }\r\n            }\r\n\r\n            btn.addEventListener('click', async () => {\r\n                closeDivesDropdown();\r\n                await startJuliaDive(dives, index);\r\n            });\r\n\r\n            diveBlock.appendChild(btn);\r\n            diveButtons.push(btn);\r\n        });\r\n\r\n        divesDropdown.style.display = 'inline-block';\r\n    }\r\n\r\n    log('Initialized.', 'initDiveButtons');\r\n}\r\n\r\nfunction initFractalSwitchButtons() {\r\n    mandelbrotSwitch.addEventListener('click', async (e) => {\r\n        if (e.ctrlKey) {\r\n            console.log('mandelbrotSwitch clicked (with persistence).');\r\n            await switchFractalTypeWithPersistence(FRACTAL_TYPE.MANDELBROT);\r\n        } else {\r\n            console.log('mandelbrotSwitch clicked.');\r\n            await switchFractalMode(FRACTAL_TYPE.MANDELBROT);\r\n        }\r\n    });\r\n\r\n    juliaSwitch.addEventListener('click', async (e) => {\r\n        if (e.ctrlKey) {\r\n            console.log('juliaSwitch clicked (with persistence).');\r\n            await switchFractalTypeWithPersistence(FRACTAL_TYPE.JULIA);\r\n        } else {\r\n            await switchFractalMode(FRACTAL_TYPE.JULIA);\r\n        }\r\n    });\r\n\r\n    if (FF_PERSISTENT_FRACTAL_SWITCHING_BUTTON_DISPLAYED) {\r\n        persistSwitch.addEventListener('click', async () => {\r\n            console.log('persistSwitch clicked.');\r\n            persistSwitch.blur(); // Release focus to prevent space key from re-triggering\r\n            if (isJuliaMode()) {\r\n                await switchFractalTypeWithPersistence(FRACTAL_TYPE.MANDELBROT)\r\n            } else {\r\n                await switchFractalTypeWithPersistence(FRACTAL_TYPE.JULIA);\r\n            }\r\n        });\r\n\r\n        persistSwitch.style.display = 'inline-flex';\r\n    }\r\n\r\n    log('Initialized.', 'initFractalSwitchButtons');\r\n}\r\n\r\nfunction initWindowEvents() {\r\n    // Resize canvas on window resize\r\n    window.addEventListener('resize', () => {\r\n        clearTimeout(resizeTimeout);\r\n        resizeTimeout = setTimeout(() => {\r\n            fractalApp.resizeCanvas(); // Adjust canvas dimensions\r\n        }, 200); // Adjust delay as needed\r\n    });\r\n\r\n    // Initialize draggable elements (debug info)\r\n    const dragElements = document.querySelectorAll(\".draggable\");\r\n\r\n    const move = (event, element) => {\r\n        let leftValue = parseInt(window.getComputedStyle(element).left);\r\n        let topValue = parseInt(window.getComputedStyle(element).top);\r\n        element.style.left = `${leftValue + event.movementX}px`;\r\n        element.style.top = `${topValue + event.movementY}px`;\r\n    }\r\n\r\n    dragElements.forEach((element) => {\r\n        element.addEventListener(\"mousedown\", () => {\r\n            const onMove = (event) => move(event, element);\r\n\r\n            document.addEventListener(\"mousemove\", onMove);\r\n            document.addEventListener(\"mouseup\", () => {\r\n                document.removeEventListener(\"mousemove\", onMove);\r\n            }, {once: true});\r\n        });\r\n    });\r\n\r\n    log('Initialized.', 'initWindowEvents');\r\n}\r\n\r\nfunction initInfoText() {\r\n    infoText.addEventListener('mouseenter', () => {\r\n        if (animationActive) return; // Disable during animations\r\n        infoText.innerHTML = 'Left click to copy, Right click to edit.';\r\n    });\r\n\r\n    infoText.addEventListener('mouseleave', () => {\r\n        if (animationActive) return; // Disable during animations\r\n        updateInfo();\r\n    });\r\n\r\n    infoText.addEventListener('click', () => {\r\n        if (animationActive) return; // Disable during animations\r\n\r\n        copyInfoToClipboard();\r\n    });\r\n\r\n    // Right-click to edit coordinates\r\n    infoText.addEventListener('contextmenu', (e) => {\r\n        e.preventDefault();\r\n        if (animationActive) return; // Disable during animations\r\n\r\n        showEditCoordsDialog();\r\n    });\r\n\r\n    // Long touch to edit coordinates (for touch devices)\r\n    let longTouchTimer = null;\r\n    const LONG_TOUCH_DURATION = 500; // ms\r\n\r\n    infoText.addEventListener('touchstart', (e) => {\r\n        if (animationActive) return;\r\n\r\n        longTouchTimer = setTimeout(() => {\r\n            e.preventDefault();\r\n            showEditCoordsDialog();\r\n            longTouchTimer = null;\r\n        }, LONG_TOUCH_DURATION);\r\n    }, { passive: false });\r\n\r\n    infoText.addEventListener('touchend', () => {\r\n        if (longTouchTimer) {\r\n            clearTimeout(longTouchTimer);\r\n            longTouchTimer = null;\r\n        }\r\n    });\r\n\r\n    infoText.addEventListener('touchmove', () => {\r\n        if (longTouchTimer) {\r\n            clearTimeout(longTouchTimer);\r\n            longTouchTimer = null;\r\n        }\r\n    });\r\n}\r\n\r\nexport function copyInfoToClipboard() {\r\n    const viewPanX = ddValue(fractalApp.panDD.x);\r\n    const viewPanY = ddValue(fractalApp.panDD.y);\r\n    const randomTitle = Math.random().toString(36).slice(2).substring(2, 2 + 4);\r\n    const paletteId = getCurrentPaletteId() || '';\r\n\r\n    let text =\r\n        `{\"id\": \"${randomTitle}\", ` +\r\n        (isJuliaMode() ? `\"c\": [${fractalApp.c}], ` : ``) +\r\n        `\"pan\": [${esc(viewPanX.toFixed(24))}, ${esc(viewPanY.toFixed(24))}], ` +\r\n        `\"rotation\": ${normalizeRotation(fractalApp.rotation)}, \"zoom\": ${fractalApp.zoom}, \"paletteId\": \"${paletteId}\"}`;\r\n\r\n    navigator.clipboard.writeText(text).then(function () {\r\n        infoText.innerHTML = 'Copied to clipboard!';\r\n    }, function (err) {\r\n        console.error('Not copied to clipboard! ' + err.toString());\r\n    });\r\n}\r\n\r\nfunction bindHTMLElements() {\r\n    // Element binding\r\n    mandelbrotSwitch = document.getElementById('mandelbrotSwitch');\r\n    juliaSwitch = document.getElementById('juliaSwitch');\r\n    persistSwitch = document.getElementById('persistSwitch');\r\n    header = document.getElementById('headerContainer');\r\n    logo = document.getElementById('logo');\r\n    infoLabel = document.getElementById('infoLabel');\r\n    infoText = document.getElementById('infoText');\r\n    resetButton = document.getElementById('reset');\r\n    saveViewButton = document.getElementById('saveView');\r\n    screenshotButton = document.getElementById('screenshot');\r\n    demoButton = document.getElementById('demo');\r\n    presetsToggle = document.getElementById('presets-toggle');\r\n    presetsMenu = document.getElementById('presets');\r\n    divesToggle = document.getElementById('dives-toggle');\r\n    divesMenu = document.getElementById('dives');\r\n    divesDropdown = document.getElementById('dives-dropdown');\r\n    paletteToggle = document.getElementById('palette-toggle');\r\n    paletteMenu = document.getElementById('palettes');\r\n    paletteDropdown = document.getElementById('palette-dropdown');\r\n    // Save View Dialog elements\r\n    saveViewDialog = document.getElementById('saveViewDialog');\r\n    saveViewNameInput = document.getElementById('saveViewName');\r\n    saveViewConfirmBtn = document.getElementById('saveViewConfirm');\r\n    saveViewCancelBtn = document.getElementById('saveViewCancel');\r\n    // Edit Coordinates Dialog elements\r\n    editCoordsDialog = document.getElementById('editCoordsDialog');\r\n    editPanXInput = document.getElementById('editPanX');\r\n    editPanYInput = document.getElementById('editPanY');\r\n    editZoomInput = document.getElementById('editZoom');\r\n    editRotationInput = document.getElementById('editRotation');\r\n    editCxInput = document.getElementById('editCx');\r\n    editCyInput = document.getElementById('editCy');\r\n    editJsonInput = document.getElementById('editJsonInput');\r\n    editCoordsError = document.getElementById('editCoordsError');\r\n    editCoordsApplyBtn = document.getElementById('editCoordsApply');\r\n    editCoordsCancelBtn = document.getElementById('editCoordsCancel');\r\n    juliaCInputs = document.getElementById('juliaCInputs');\r\n}\r\n\r\n/**\r\n * Initializes the UI and registers UI event handlers\r\n * @param fractalRenderer\r\n */\r\nexport async function initUI(fractalRenderer) {\r\n    if (uiInitialized) {\r\n        console.warn(\"UI already initialized!\");\r\n        return;\r\n    }\r\n\r\n    fractalApp = fractalRenderer;\r\n    canvas = fractalApp.canvas;\r\n\r\n    bindHTMLElements();\r\n\r\n    if (fractalRenderer instanceof JuliaRenderer) {\r\n        fractalMode = FRACTAL_TYPE.JULIA;\r\n        juliaSwitch.classList.add('active');\r\n        mandelbrotSwitch.classList.remove('active');\r\n\r\n        initJuliaSliders(fractalApp);\r\n        updateJuliaSliders();\r\n        initDiveButtons();\r\n\r\n        updateColorTheme(DEFAULT_JULIA_THEME_COLOR);\r\n        // Darker backgrounds for Julia as it renders on white\r\n        header.style.background = 'rgba(20, 20, 20, 0.8)';\r\n        infoLabel.style.background = 'rgba(20, 20, 20, 0.8)';\r\n\r\n        window.location.hash = '#julia'; // Update URL hash\r\n    } else {\r\n        initJuliaPreview();\r\n    }\r\n\r\n    initPresetButtonEvents();\r\n    initPresetsDropdown();\r\n    initDivesDropdown();\r\n    initPaletteButtonEvents();\r\n    initPaletteDropdown();\r\n    initWindowEvents();\r\n    initHeaderEvents();\r\n    initControlButtonEvents();\r\n    initSaveViewDialog();\r\n    initEditCoordsDialog();\r\n    initInfoText();\r\n    initFractalSwitchButtons();\r\n    initCommonButtonEvents(); // After all dynamic buttons are set\r\n\r\n    // Register control events\r\n    if (isTouchDevice()) {\r\n        initTouchHandlers(fractalApp);\r\n    } else {\r\n        initHotKeys(fractalApp);\r\n        initMouseHandlers(fractalApp);\r\n    }\r\n\r\n    updatePaletteDropdownState();\r\n\r\n    if (DEBUG_MODE === DEBUG_LEVEL.FULL && !isMobileDevice()) {\r\n        toggleDebugMode();\r\n    }\r\n\r\n    document.getElementById(\"versionLink\").innerHTML = `v${VERSION}`;\r\n\r\n    // Tap-to-toggle for controls hint on touch devices\r\n    const controlsHint = document.getElementById(\"controlsHint\");\r\n    if (controlsHint) {\r\n        controlsHint.addEventListener(\"click\", (e) => {\r\n            if (window.matchMedia(\"(pointer: coarse)\").matches) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                controlsHint.classList.toggle(\"active\");\r\n            }\r\n        });\r\n        // Close tooltip when tapping outside\r\n        document.addEventListener(\"click\", (e) => {\r\n            if (!controlsHint.contains(e.target)) {\r\n                controlsHint.classList.remove(\"active\");\r\n            }\r\n        });\r\n    }\r\n\r\n    uiInitialized = true;\r\n}\r\n\r\n// endregion------------------------------------------------------------------------------------------------------------","/**\r\n * @module utils.fractal\r\n * @author Radim Brnka\r\n * @description Contains mathematical functions for fractal analysis and calculations.\r\n * @copyright Synaptory Fractal Traveler, 2025-2026\r\n * @license MIT\r\n */\r\n\r\n/**\r\n * Analyzes a point c to determine its relationship to the Mandelbrot set.\r\n * Uses distance estimation and period detection to find appropriate zoom level.\r\n *\r\n * @param {number} cx - Real part of c\r\n * @param {number} cy - Imaginary part of c\r\n * @param {number} maxIter - Maximum iterations\r\n * @returns {{escaped: boolean, iterations: number, distance: number, period: number, recommendedZoom: number}}\r\n */\r\nexport function analyzeMandelbrotPoint(cx, cy, maxIter = 1000) {\r\n    let zx = 0, zy = 0;\r\n    // Derivative dz/dc for distance estimation\r\n    let dzx = 0, dzy = 0;\r\n\r\n    // Period detection: store orbit points to detect cycles\r\n    const orbitHistory = [];\r\n    const PERIOD_CHECK_START = 50;\r\n    const PERIOD_TOLERANCE = 1e-10;\r\n\r\n    let escaped = false;\r\n    let escapeIter = maxIter;\r\n    let finalMag = 0;\r\n    let finalDerivMag = 0;\r\n\r\n    for (let i = 0; i < maxIter; i++) {\r\n        // Track derivative: d(z+c)/dc = 2z * dz/dc + 1\r\n        const newDzx = 2 * (zx * dzx - zy * dzy) + 1;\r\n        const newDzy = 2 * (zx * dzy + zy * dzx);\r\n        dzx = newDzx;\r\n        dzy = newDzy;\r\n\r\n        // z = z + c\r\n        const newZx = zx * zx - zy * zy + cx;\r\n        const newZy = 2 * zx * zy + cy;\r\n        zx = newZx;\r\n        zy = newZy;\r\n\r\n        const mag2 = zx * zx + zy * zy;\r\n\r\n        // Period detection for interior points\r\n        if (i >= PERIOD_CHECK_START && i % 10 === 0) {\r\n            for (let j = 0; j < orbitHistory.length; j++) {\r\n                const [hx, hy, hi] = orbitHistory[j];\r\n                const dx = zx - hx, dy = zy - hy;\r\n                if (dx * dx + dy * dy < PERIOD_TOLERANCE) {\r\n                    // Found period\r\n                    const period = i - hi;\r\n                    // Period correlates with feature size: smaller period = larger feature\r\n                    // Main cardioid (period 1) -> zoom ~1.0\r\n                    // Period 2 bulb -> zoom ~0.3\r\n                    // Higher periods -> smaller features\r\n                    const recommendedZoom = Math.max(0.01, Math.min(1.5, 1.5 / Math.pow(period, 0.7)));\r\n                    return { escaped: false, iterations: maxIter, distance: 0, period, recommendedZoom };\r\n                }\r\n            }\r\n            orbitHistory.push([zx, zy, i]);\r\n            if (orbitHistory.length > 100) orbitHistory.shift();\r\n        }\r\n\r\n        if (mag2 > 1e8) { // Use larger bailout for better distance estimation\r\n            escaped = true;\r\n            escapeIter = i;\r\n            finalMag = Math.sqrt(mag2);\r\n            finalDerivMag = Math.sqrt(dzx * dzx + dzy * dzy);\r\n            break;\r\n        }\r\n    }\r\n\r\n    if (escaped && finalDerivMag > 0) {\r\n        // Distance estimation: d = |z| * log(|z|) / |dz/dc|\r\n        const distance = (finalMag * Math.log(finalMag)) / finalDerivMag;\r\n\r\n        // High iteration count = close to boundary = deep structure\r\n        // Use iteration-based zoom: more iters = deeper zoom needed\r\n        // At 100 iters -> zoom ~0.1, at 500 iters -> zoom ~0.001, at 1000+ -> zoom ~0.0001\r\n        const iterZoom = Math.pow(10, -escapeIter / 300);\r\n\r\n        // Also use distance - but squared for more aggressive scaling\r\n        const distZoom = Math.pow(distance, 0.7);\r\n\r\n        // Take the smaller (deeper) of the two estimates\r\n        const recommendedZoom = Math.max(1e-8, Math.min(2.0, Math.min(iterZoom, distZoom)));\r\n\r\n        return { escaped: true, iterations: escapeIter, distance, period: 0, recommendedZoom };\r\n    }\r\n\r\n    // Didn't escape and no period found - deep interior, use moderate zoom\r\n    return { escaped: false, iterations: maxIter, distance: 0, period: 0, recommendedZoom: 0.5 };\r\n}\r\n\r\n/**\r\n * Calculates the appropriate zoom level when switching from Julia to Mandelbrot.\r\n * Combines the point analysis with the current Julia zoom factor.\r\n *\r\n * @param {number} cx - Real part of c (Julia parameter)\r\n * @param {number} cy - Imaginary part of c (Julia parameter)\r\n * @param {number} currentJuliaZoom - Current zoom level in Julia mode\r\n * @param {number} juliaDefaultZoom - Default Julia zoom level (typically 3.5)\r\n * @returns {number} Recommended zoom level for Mandelbrot\r\n */\r\nexport function calculateMandelbrotZoomFromJulia(cx, cy, currentJuliaZoom, juliaDefaultZoom = 3.5) {\r\n    const analysis = analyzeMandelbrotPoint(cx, cy, 2000);\r\n\r\n    // Factor in current Julia zoom: if deeply zoomed in Julia, scale Mandelbrot zoom deeper\r\n    // Julia default zoom is ~3.5, so juliaZoomFactor > 1 means zoomed in\r\n    const juliaZoomFactor = juliaDefaultZoom / Math.max(currentJuliaZoom, 0.001);\r\n\r\n    // Combine distance-based zoom with Julia zoom influence\r\n    // Use geometric mean to balance both factors\r\n    let finalZoom = analysis.recommendedZoom;\r\n    if (juliaZoomFactor > 1) {\r\n        // User is zoomed into Julia - scale Mandelbrot zoom proportionally\r\n        // But don't go too extreme - use sqrt to dampen the effect\r\n        finalZoom = analysis.recommendedZoom / Math.sqrt(juliaZoomFactor);\r\n    }\r\n\r\n    // Clamp to reasonable range\r\n    return Math.max(1e-6, Math.min(2.0, finalZoom));\r\n}\r\n","import {updateInfo} from \"../ui/ui\";\r\nimport FractalRenderer from \"./fractalRenderer\";\r\nimport {\r\n    asyncDelay,\r\n    compareComplex,\r\n    ddSubDD,\r\n    degToRad,\r\n    hexToRGB,\r\n    lerp,\r\n    normalizeRotation,\r\n    splitFloat,\r\n} from \"../global/utils\";\r\nimport \"../global/types\";\r\nimport {CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE, DEFAULT_JULIA_PALETTE, EASE_TYPE,} from \"../global/constants\";\r\nimport {updateJuliaSliders} from \"../ui/juliaSlidersController\";\r\n/** @type {string} */\r\nimport fragmentShaderRaw from '../shaders/julia.frag';\r\nimport fragmentShaderRawLegacy from '../shaders/julia.legacy.frag';\r\nimport data from '../data/julia.json';\r\n\r\n/**\r\n * JuliaRenderer (Rebased Perturbation)\r\n *\r\n * @author Radim Brnka\r\n * @description This module defines a JuliaRenderer class that inherits from fractalRenderer, implements the shader fragment code for the Julia set fractal, and sets preset zoom-ins.\r\n * Reference orbit is for current c and a chosen z0_ref (near the view center).\r\n * For each pixel:\r\n *   z0 = pan + zoom * rotated(st)\r\n *   dz0 = z0 - z0_ref\r\n *   dz_{n+1} = 2*zref*dz + dz^2 (NO +dc each step for Julia!)\r\n * @extends FractalRenderer\r\n * @see MandelbrotRenderer\r\n * @copyright Synaptory Fractal Traveler, 2025-2026\r\n * @license MIT\r\n */\r\nexport class JuliaRenderer extends FractalRenderer {\r\n\r\n    /**\r\n     * Enables legacy Julia renderer for intermittent troubleshooting of the perturbation renderer\r\n     * @type {boolean}\r\n     */\r\n    static FF_LEGACY_JULIA_RENDERER = true;\r\n\r\n    constructor(canvas) {\r\n        super(canvas);\r\n\r\n        this.DEFAULT_ZOOM = data.views[0].zoom;\r\n        this.MAX_ZOOM = JuliaRenderer.FF_LEGACY_JULIA_RENDERER ? 3e-3 : 1e-17;\r\n        this.zoom = this.DEFAULT_ZOOM;\r\n\r\n        this.DEFAULT_ROTATION = degToRad(data.views[0].rotation || 0);\r\n        this.rotation = this.DEFAULT_ROTATION;\r\n\r\n        // TODO Use less detailed initial set for less performant devices\r\n        /** @type COMPLEX */\r\n        this.DEFAULT_C = [data.views[0].c[0], data.views[0].c[1]];\r\n        /** @type COMPLEX */\r\n        this.c = [...this.DEFAULT_C];\r\n\r\n        // IMPORTANT: use setPan (syncs DD + array)  keep this.pan canonical (TODO remove pan completely at some point)\r\n        this.setPan(this.DEFAULT_PAN[0], this.DEFAULT_PAN[1]);\r\n\r\n        // --- Perturbation state with DD precision ---\r\n        this.refZ0 = [0, 0];\r\n        this.refZ0DD = {\r\n            x: { hi: 0, lo: 0 },\r\n            y: { hi: 0, lo: 0 }\r\n        };\r\n        this.refPan = [...this.DEFAULT_PAN];\r\n        this.refPanDD = {\r\n            x: { hi: this.DEFAULT_PAN[0], lo: 0 },\r\n            y: { hi: this.DEFAULT_PAN[1], lo: 0 }\r\n        };\r\n        this.orbitDirty = true;\r\n\r\n        this._prevPan0 = NaN;\r\n        this._prevPan1 = NaN;\r\n        this._prevZoom = NaN;\r\n        this._prevC0 = NaN;\r\n        this._prevC1 = NaN;\r\n\r\n        this.MAX_ITER = 5000;\r\n        this.REF_SEARCH_GRID = 7;\r\n        this.REF_SEARCH_RADIUS = 0.50;\r\n\r\n        this.orbitTex = null;\r\n        this.orbitData = null;\r\n        this.floatTexExt = null;\r\n\r\n        this.rebaseArmed = true;\r\n\r\n        /** @type {Array.<JULIA_PRESET>} */\r\n        this.PRESETS = data.views.map(p => ({\r\n            ...p,\r\n            rotation: degToRad(p.rotation || 0)\r\n        }));\r\n\r\n        /** @type {Array.<DIVE>} */\r\n        this.DIVES = data.dives.map(d => ({\r\n            ...d,\r\n            rotation: degToRad(d.rotation || 0)\r\n        }));\r\n\r\n        /** @type {Array.<JULIA_PALETTE>} */\r\n        this.PALETTES = data.palettes || [];\r\n\r\n        // Derive default palette index from the first preset's paletteId\r\n        const firstPresetPaletteId = data.views[0]?.paletteId;\r\n        this.DEFAULT_PALETTE_INDEX = firstPresetPaletteId\r\n            ? this.PALETTES.findIndex(p => p.id === firstPresetPaletteId)\r\n            : 0;\r\n        if (this.DEFAULT_PALETTE_INDEX < 0) this.DEFAULT_PALETTE_INDEX = 0;\r\n\r\n        this.currentPaletteIndex = this.DEFAULT_PALETTE_INDEX;\r\n        this.innerStops = this.PALETTES.length > 0\r\n            ? new Float32Array(this.PALETTES[this.currentPaletteIndex].theme)\r\n            : new Float32Array(DEFAULT_JULIA_PALETTE.theme);\r\n\r\n        // Initialize colorPalette (3-element RGB) for UI theming from keyColor\r\n        const initialPalette = this.PALETTES[this.currentPaletteIndex] || DEFAULT_JULIA_PALETTE;\r\n        const keyColor = initialPalette.keyColor ? hexToRGB(initialPalette.keyColor) : null;\r\n        this.colorPalette = keyColor\r\n            ? [keyColor.r, keyColor.g, keyColor.b]\r\n            : [initialPalette.theme[9], initialPalette.theme[10], initialPalette.theme[11]]; // Fallback to 4th stop\r\n\r\n        this.currentCAnimationFrame = null;\r\n        this.cAnimationActive = false; // Defers orbit rebuild during C-animation for performance\r\n        this.demoTime = 0;\r\n\r\n        this.init();\r\n    }\r\n\r\n    markOrbitDirty = () => this.orbitDirty = true;\r\n\r\n    onProgramCreated() {\r\n        this.floatTexExt = this.gl.getExtension(\"OES_texture_float\");\r\n        if (!this.floatTexExt) {\r\n            console.error(\"Missing OES_texture_float. Julia deep zoom perturbation requires it.\");\r\n            return;\r\n        }\r\n\r\n        this.orbitTex = this.gl.createTexture();\r\n        this.gl.activeTexture(this.gl.TEXTURE0);\r\n        this.gl.bindTexture(this.gl.TEXTURE_2D, this.orbitTex);\r\n\r\n        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, this.gl.NEAREST);\r\n        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, this.gl.NEAREST);\r\n        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_S, this.gl.CLAMP_TO_EDGE);\r\n        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_T, this.gl.CLAMP_TO_EDGE);\r\n\r\n        this.orbitData = new Float32Array(this.MAX_ITER * 4);\r\n\r\n        if (this.orbitTexLoc) this.gl.uniform1i(this.orbitTexLoc, 0);\r\n        if (this.orbitWLoc) this.gl.uniform1f(this.orbitWLoc, this.MAX_ITER);\r\n\r\n        this.orbitDirty = true;\r\n    }\r\n\r\n    createFragmentShaderSource() {\r\n        return (JuliaRenderer.FF_LEGACY_JULIA_RENDERER\r\n            ? fragmentShaderRawLegacy\r\n            : fragmentShaderRaw).replace('__MAX_ITER__', this.MAX_ITER).toString();\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    updateUniforms() {\r\n        super.updateUniforms();\r\n\r\n        this.cLoc = this.gl.getUniformLocation(this.program, \"u_c\");\r\n        this.innerStopsLoc = this.gl.getUniformLocation(this.program, \"u_innerStops\");\r\n\r\n        // delta z0 (pan - refZ0) computed on JS side for float64 precision\r\n        this.deltaZ0HLoc = this.gl.getUniformLocation(this.program, \"u_delta_z0_h\");\r\n        this.deltaZ0LLoc = this.gl.getUniformLocation(this.program, \"u_delta_z0_l\");\r\n        this.zoomHLoc = this.gl.getUniformLocation(this.program, \"u_zoom_h\");\r\n        this.zoomLLoc = this.gl.getUniformLocation(this.program, \"u_zoom_l\");\r\n\r\n        this.orbitTexLoc = this.gl.getUniformLocation(this.program, \"u_orbitTex\");\r\n        this.orbitWLoc = this.gl.getUniformLocation(this.program, \"u_orbitW\");\r\n    }\r\n\r\n    // --- Reference orbit building ---\r\n\r\n    escapeItersJulia(zx0, zy0, iters) {\r\n        let zx = zx0, zy = zy0;\r\n        const cx = this.c[0], cy = this.c[1];\r\n        for (let i = 0; i < iters; i++) {\r\n            const zx2 = zx * zx - zy * zy + cx;\r\n            const zy2 = 2.0 * zx * zy + cy;\r\n            zx = zx2; zy = zy2;\r\n            if (zx * zx + zy * zy > 4.0) return i;\r\n        }\r\n        return iters;\r\n    }\r\n\r\n    /**\r\n     * Choose a good refZ0 near view center:\r\n     * - sample a grid around view center (radius scales with zoom)\r\n     * - pick the point with the highest escape iteration (prefer inside / late escape)\r\n     * - prefer keeping the current reference to avoid jitter unless a significantly better one is found\r\n     * @param {boolean} useViewCenter - If true, skip grid search and use view center directly (for stability during interaction)\r\n     */\r\n    pickReferenceNearViewCenter(useViewCenter = false) {\r\n        // During interaction, use view center directly to prevent jitter from grid search\r\n        // Copy DD components to preserve deep zoom precision\r\n        if (useViewCenter) {\r\n            this.refZ0[0] = this.pan[0];\r\n            this.refZ0[1] = this.pan[1];\r\n            this.refZ0DD.x.hi = this.panDD.x.hi;\r\n            this.refZ0DD.x.lo = this.panDD.x.lo;\r\n            this.refZ0DD.y.hi = this.panDD.y.hi;\r\n            this.refZ0DD.y.lo = this.panDD.y.lo;\r\n            // Keep refPan in sync for needsRebase() to work correctly\r\n            this.refPan[0] = this.pan[0];\r\n            this.refPan[1] = this.pan[1];\r\n            this.refPanDD.x.hi = this.panDD.x.hi;\r\n            this.refPanDD.x.lo = this.panDD.x.lo;\r\n            this.refPanDD.y.hi = this.panDD.y.hi;\r\n            this.refPanDD.y.lo = this.panDD.y.lo;\r\n            return;\r\n        }\r\n\r\n        const grid = this.REF_SEARCH_GRID;\r\n        const half = (grid - 1) / 2;\r\n        const step = (2.0 * this.REF_SEARCH_RADIUS) / (grid - 1);\r\n\r\n        const base = this.zoom;\r\n        const probeIters = Math.min(this.MAX_ITER, Math.max(200, Math.floor(this.iterations)));\r\n\r\n        // Evaluate current reference point's score (if we have one within reasonable distance)\r\n        let currentRefScore = -1;\r\n        const currentRefDist = Math.hypot(this.refZ0[0] - this.pan[0], this.refZ0[1] - this.pan[1]);\r\n        const maxRefDist = base * this.REF_SEARCH_RADIUS * 2.5; // Allow some margin beyond search radius\r\n\r\n        if (currentRefDist < maxRefDist) {\r\n            currentRefScore = this.escapeItersJulia(this.refZ0[0], this.refZ0[1], probeIters);\r\n        }\r\n\r\n        // Start with view center as fallback\r\n        let bestX = this.pan[0];\r\n        let bestY = this.pan[1];\r\n        let bestScore = this.escapeItersJulia(this.pan[0], this.pan[1], probeIters);\r\n\r\n        for (let j = 0; j < grid; j++) {\r\n            for (let i = 0; i < grid; i++) {\r\n                const ox = (i - half) * step;\r\n                const oy = (j - half) * step;\r\n\r\n                const zx0 = this.pan[0] + ox * base;\r\n                const zy0 = this.pan[1] + oy * base;\r\n\r\n                const score = this.escapeItersJulia(zx0, zy0, probeIters);\r\n                if (score > bestScore) {\r\n                    bestScore = score;\r\n                    bestX = zx0;\r\n                    bestY = zy0;\r\n                }\r\n            }\r\n        }\r\n\r\n        // Stability: only switch reference if the new one is significantly better.\r\n        // This prevents jitter from small score differences between frames.\r\n        // Require at least 10% improvement or 50 iterations better to switch.\r\n        const improvementThreshold = Math.max(currentRefScore * 0.10, 50);\r\n        const shouldSwitch = currentRefScore < 0 || (bestScore - currentRefScore) > improvementThreshold;\r\n\r\n        if (shouldSwitch) {\r\n            this.refZ0[0] = bestX;\r\n            this.refZ0[1] = bestY;\r\n            // New reference point from grid search - no DD precision accumulated yet\r\n            this.refZ0DD.x.hi = bestX;\r\n            this.refZ0DD.x.lo = 0;\r\n            this.refZ0DD.y.hi = bestY;\r\n            this.refZ0DD.y.lo = 0;\r\n            // Keep refPan in sync for needsRebase() to work correctly\r\n            this.refPan[0] = bestX;\r\n            this.refPan[1] = bestY;\r\n            this.refPanDD.x.hi = bestX;\r\n            this.refPanDD.x.lo = 0;\r\n            this.refPanDD.y.hi = bestY;\r\n            this.refPanDD.y.lo = 0;\r\n        }\r\n        // else: keep current refZ0 for stability\r\n    }\r\n\r\n    computeReferenceOrbit() {\r\n        if (!this.orbitData || !this.orbitTex) return;\r\n\r\n        const cx = this.c[0];\r\n        const cy = this.c[1];\r\n\r\n        let zx = this.refZ0[0];\r\n        let zy = this.refZ0[1];\r\n\r\n        for (let n = 0; n < this.MAX_ITER; n++) {\r\n            const sx = splitFloat(zx);\r\n            const sy = splitFloat(zy);\r\n\r\n            const idx = n * 4;\r\n            this.orbitData[idx] = sx.high;\r\n            this.orbitData[idx + 1] = sx.low;\r\n            this.orbitData[idx + 2] = sy.high;\r\n            this.orbitData[idx + 3] = sy.low;\r\n\r\n            const zx2 = zx * zx - zy * zy + cx;\r\n            const zy2 = 2.0 * zx * zy + cy;\r\n            zx = zx2; zy = zy2;\r\n\r\n            if (zx * zx + zy * zy > 4.0) {\r\n                const fx = splitFloat(zx);\r\n                const fy = splitFloat(zy);\r\n                for (let k = n + 1; k < this.MAX_ITER; k++) {\r\n                    const j = k * 4;\r\n                    this.orbitData[j] = fx.high;\r\n                    this.orbitData[j + 1] = fx.low;\r\n                    this.orbitData[j + 2] = fy.high;\r\n                    this.orbitData[j + 3] = fy.low;\r\n                }\r\n                break;\r\n            }\r\n        }\r\n\r\n        this.gl.activeTexture(this.gl.TEXTURE0);\r\n        this.gl.bindTexture(this.gl.TEXTURE_2D, this.orbitTex);\r\n\r\n        this.gl.texImage2D(\r\n            this.gl.TEXTURE_2D,\r\n            0,\r\n            this.gl.RGBA,\r\n            this.MAX_ITER,\r\n            1,\r\n            0,\r\n            this.gl.RGBA,\r\n            this.gl.FLOAT,\r\n            this.orbitData\r\n        );\r\n\r\n        if (this.orbitTexLoc) this.gl.uniform1i(this.orbitTexLoc, 0);\r\n        if (this.orbitWLoc) this.gl.uniform1f(this.orbitWLoc, this.MAX_ITER);\r\n    }\r\n\r\n    /**\r\n     * Julia \"needsRebase\": keep reference initial condition close to view center.\r\n     * Same intent as Mandelbrot, but for z0 reference.\r\n     */\r\n    needsRebase() {\r\n        const REBASE_ON = 1.75;\r\n        const REBASE_OFF = 0.90;\r\n\r\n        if (this.rebaseArmed === undefined) this.rebaseArmed = true;\r\n\r\n        if (!this.refPan) return true;\r\n        if (!Number.isFinite(this.zoom)) return false;\r\n\r\n        const z = Math.max(this.zoom, 1e-300);\r\n\r\n        const dx = this.pan[0] - this.refPan[0];\r\n        const dy = this.pan[1] - this.refPan[1];\r\n        const deltaView = Math.hypot(dx, dy) / z;\r\n\r\n        if (!this.rebaseArmed && deltaView < REBASE_OFF) {\r\n            this.rebaseArmed = true;\r\n            return false;\r\n        }\r\n\r\n        if (this.rebaseArmed && deltaView > REBASE_ON) {\r\n            this.rebaseArmed = false;\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    draw() {\r\n        this.gl.useProgram(this.program);\r\n\r\n        // Iteration strategy avoids exploding to infinity at tiny zooms\r\n        // const safe = Math.max(this.zoom, 1e-300);\r\n        // const log2Depth = Math.log2(this.DEFAULT_ZOOM / safe);\r\n        // const baseIters = Math.floor(200 + 50 * log2Depth);\r\n        // this.iterations = Math.max(50, Math.min(this.MAX_ITER, baseIters + this.extraIterations));\r\n\r\n\r\n        const baseIters = Math.floor(3000 * Math.pow(2, -Math.log2(this.zoom)));\r\n        this.iterations = Math.min(2000, baseIters + this.extraIterations);\r\n\r\n        // Detect view changes -> mark orbit dirty (use tolerant checks to avoid noise)\r\n        const panMoved =\r\n            Number.isFinite(this._prevPan0) && Number.isFinite(this._prevPan1)\r\n                ? (Math.abs(this.pan[0] - this._prevPan0) + Math.abs(this.pan[1] - this._prevPan1)) > (this.zoom * 1e-6)\r\n                : true;\r\n\r\n        const zoomChanged =\r\n            Number.isFinite(this._prevZoom)\r\n                ? Math.abs(this.zoom - this._prevZoom) > (this.zoom * 1e-8)\r\n                : true;\r\n\r\n        const cChanged =\r\n            Number.isFinite(this._prevC0) && Number.isFinite(this._prevC1)\r\n                ? (Math.abs(this.c[0] - this._prevC0) + Math.abs(this.c[1] - this._prevC1)) > 0.0\r\n                : true;\r\n\r\n        if (panMoved || zoomChanged || cChanged) {\r\n            this.orbitDirty = true;\r\n            this._prevPan0 = this.pan[0];\r\n            this._prevPan1 = this.pan[1];\r\n            this._prevZoom = this.zoom;\r\n            this._prevC0 = this.c[0];\r\n            this._prevC1 = this.c[1];\r\n        }\r\n\r\n        // Rebase policy for Julia:\r\n        // - c changes REQUIRE orbit rebuild (orbit depends on c) - cannot be deferred\r\n        // - during C-animation, skip expensive grid search (use view center directly)\r\n        // - pan/zoom during interaction can defer until settled\r\n        const mustRebaseNow = cChanged || this.needsRebase();\r\n        const isDeferringForAnimation = this.cAnimationActive || this.interactionActive;\r\n        const canRebaseNow = !isDeferringForAnimation || mustRebaseNow;\r\n\r\n        if (this.orbitDirty && canRebaseNow) {\r\n            // During interaction/animation, skip grid search (use view center directly)\r\n            this.pickReferenceNearViewCenter(isDeferringForAnimation);\r\n            this.computeReferenceOrbit();\r\n            this.orbitDirty = false;\r\n        }\r\n\r\n        // Compute deltaZ0 = panDD - refZ0DD on JS side (float64) for precision\r\n        // This avoids float32 precision loss when the shader subtracts pan - refZ0\r\n        const deltaZ0X = ddSubDD(this.panDD.x, this.refZ0DD.x);\r\n        const deltaZ0Y = ddSubDD(this.panDD.y, this.refZ0DD.y);\r\n\r\n        // Upload deltaZ0 hi/lo\r\n        if (this.deltaZ0HLoc) this.gl.uniform2f(this.deltaZ0HLoc, deltaZ0X.hi, deltaZ0Y.hi);\r\n        if (this.deltaZ0LLoc) this.gl.uniform2f(this.deltaZ0LLoc, deltaZ0X.lo, deltaZ0Y.lo);\r\n\r\n        // Upload zoom hi/lo\r\n        const z = splitFloat(this.zoom);\r\n        if (this.zoomHLoc) this.gl.uniform1f(this.zoomHLoc, z.high);\r\n        if (this.zoomLLoc) this.gl.uniform1f(this.zoomLLoc, z.low);\r\n\r\n        if (this.cLoc) this.gl.uniform2fv(this.cLoc, this.c);\r\n        if (this.innerStopsLoc) this.gl.uniform3fv(this.innerStopsLoc, this.innerStops);\r\n\r\n        super.draw();\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    reset() {\r\n        this.c = [...this.DEFAULT_C];\r\n\r\n        // Reset to the palette matching the first preset (Event Horizon, index 13)\r\n        this.currentPaletteIndex = this.DEFAULT_PALETTE_INDEX;\r\n        const resetPalette = this.PALETTES[this.currentPaletteIndex] || DEFAULT_JULIA_PALETTE;\r\n        this.innerStops = new Float32Array(resetPalette.theme);\r\n\r\n        // Update colorPalette for UI theming\r\n        const keyColor = resetPalette.keyColor ? hexToRGB(resetPalette.keyColor) : null;\r\n        this.colorPalette = keyColor\r\n            ? [keyColor.r, keyColor.g, keyColor.b]\r\n            : [resetPalette.theme[9], resetPalette.theme[10], resetPalette.theme[11]];\r\n\r\n        this.orbitDirty = true;\r\n        this._prevPan0 = NaN;\r\n        this._prevPan1 = NaN;\r\n        this._prevZoom = NaN;\r\n        this._prevC0 = NaN;\r\n        this._prevC1 = NaN;\r\n\r\n        super.reset();\r\n    }\r\n\r\n    // region > ANIMATION METHODS --------------------------------------------------------------------------------------\r\n\r\n    /** Stops currently running C animation and triggers final orbit rebuild */\r\n    stopCurrentCAnimation() {\r\n        console.log(`%c ${this.constructor.name}: %c stopCurrentCAnimation`, CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n\r\n        if (this.currentCAnimationFrame !== null) {\r\n            cancelAnimationFrame(this.currentCAnimationFrame);\r\n            this.currentCAnimationFrame = null;\r\n        }\r\n\r\n        // Clear animation flag and force accurate orbit rebuild\r\n        if (this.cAnimationActive) {\r\n            this.cAnimationActive = false;\r\n            this.markOrbitDirty();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    stopAllNonColorAnimations() {\r\n        this.stopCurrentCAnimation();\r\n\r\n        super.stopAllNonColorAnimations();\r\n    }\r\n\r\n    /**\r\n     * Smoothly transitions the inner color stops (used by the shader for inner coloring)\r\n     * from the current value to the provided toPalette over the specified duration.\r\n     * Also updates the colorPalette to match the theme (using the first stop, for example).\r\n     *\r\n     * @param {JULIA_PALETTE} toPalette - The target theme as an array of numbers (e.g., 15 numbers for 5 stops).\r\n     * @param {number} [duration=250] - Duration of the transition in milliseconds.\r\n     * @param {Function} [callback] - A callback invoked when the transition completes.\r\n     * @return {Promise<void>}\r\n     */\r\n    async animateInnerStopsTransition(toPalette, duration = 250, callback = null) {\r\n        console.groupCollapsed(`%c ${this.constructor.name}: animateInnerStopsTransition`, CONSOLE_GROUP_STYLE);\r\n        this.stopCurrentColorAnimations();\r\n\r\n        // Save the starting stops as a plain array.\r\n        const startStops = Array.from(this.innerStops);\r\n\r\n        await new Promise((resolve) => {\r\n            // Store resolve so stopCurrentColorAnimations can call it if interrupted\r\n            this._colorAnimationResolve = resolve;\r\n            let startTime = null;\r\n\r\n            const step = (timestamp) => {\r\n                if (!startTime) startTime = timestamp;\r\n                const progress = Math.min((timestamp - startTime) / duration, 1);\r\n\r\n                // Interpolate each component of the inner stops.\r\n                const interpolated = startStops.map((v, i) => lerp(v, toPalette.theme[i], progress));\r\n                this.innerStops = new Float32Array(interpolated);\r\n\r\n                let keyColor;\r\n\r\n                if (toPalette.keyColor) {\r\n                    keyColor = hexToRGB(toPalette.keyColor);\r\n                    if (keyColor) this.colorPalette = [keyColor.r, keyColor.g, keyColor.b];\r\n                }\r\n\r\n                if (!keyColor) {\r\n                    const stopIndex = 3;\r\n                    this.colorPalette = [\r\n                        toPalette.theme[stopIndex * 3] * 1.5,\r\n                        toPalette.theme[stopIndex * 3 + 1] * 1.5,\r\n                        toPalette.theme[stopIndex * 3 + 2] * 1.5\r\n                    ];\r\n                }\r\n\r\n                this.draw();\r\n\r\n                if (callback) callback();\r\n\r\n                if (progress < 1) {\r\n                    this.currentColorAnimationFrame = requestAnimationFrame(step);\r\n                } else {\r\n                    this._colorAnimationResolve = null;\r\n                    this.stopCurrentColorAnimations();\r\n                    console.groupEnd();\r\n                    resolve();\r\n                }\r\n            };\r\n\r\n            this.currentColorAnimationFrame = requestAnimationFrame(step);\r\n        });\r\n    }\r\n\r\n    /** @inheritDoc */\r\n    async animateColorPaletteTransition(duration = 250, coloringCallback = null) {\r\n        if (this.PALETTES.length === 0) {\r\n            // No palettes defined - just trigger random color (handled by base class)\r\n            return super.animateColorPaletteTransition(duration, coloringCallback);\r\n        }\r\n        this.currentPaletteIndex = (this.currentPaletteIndex + 1) % this.PALETTES.length;\r\n        await this.animateInnerStopsTransition(this.PALETTES[this.currentPaletteIndex], duration, coloringCallback);\r\n    }\r\n\r\n    /**\r\n     * Applies a specific palette by index\r\n     * @param {number} index - Palette index\r\n     * @param {number} [duration=250] - Transition duration in ms\r\n     * @param {Function} [coloringCallback] - Callback when done\r\n     * @return {Promise<void>}\r\n     */\r\n    async applyPaletteByIndex(index, duration = 250, coloringCallback = null) {\r\n        if (this.PALETTES.length === 0 || index < 0 || index >= this.PALETTES.length) {\r\n            return;\r\n        }\r\n        this.currentPaletteIndex = index;\r\n        await this.animateInnerStopsTransition(this.PALETTES[index], duration, coloringCallback);\r\n    }\r\n\r\n    /** @inheritDoc */\r\n    async animateFullColorSpaceCycle(duration = 15000, coloringCallback = null) {\r\n        await new Promise(() => {\r\n            this.animateColorPaletteTransition(duration, coloringCallback);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Animates Julia from current C to target C\r\n     *\r\n     * @param {COMPLEX} [targetC] Defaults to default C\r\n     * @param {number} [duration] in ms\r\n     * @param {EASE_TYPE|Function} easeFunction\r\n     * @return {Promise<void>}\r\n     */\r\n    async animateToC(targetC = [...this.DEFAULT_C], duration = 500, easeFunction = EASE_TYPE.QUINT) {\r\n        console.groupCollapsed(`%c ${this.constructor.name}: animateToC`, CONSOLE_GROUP_STYLE);\r\n        this.stopCurrentCAnimation();\r\n\r\n        if (compareComplex(this.c, targetC)) {\r\n            console.log(`Already at the target c. Skipping.`);\r\n            console.groupEnd();\r\n            return;\r\n        }\r\n\r\n        console.log(`Animating c from ${this.c} to ${targetC}.`);\r\n\r\n        const startC = [...this.c];\r\n        this.cAnimationActive = true; // Defer orbit rebuilds during animation\r\n\r\n        await new Promise((resolve) => {\r\n            let startTime = null;\r\n\r\n            const step = (timestamp) => {\r\n                if (!startTime) startTime = timestamp;\r\n                const progress = Math.min((timestamp - startTime) / duration, 1);\r\n\r\n                // Interpolate `c` smoothly\r\n                const easedProgress = easeFunction(progress);\r\n                this.c[0] = lerp(startC[0], targetC[0], easedProgress);\r\n                this.c[1] = lerp(startC[1], targetC[1], easedProgress);\r\n\r\n                this.draw();\r\n\r\n                updateInfo(true);\r\n                updateJuliaSliders();\r\n\r\n                if (progress < 1) {\r\n                    this.currentCAnimationFrame = requestAnimationFrame(step);\r\n                } else {\r\n                    this.cAnimationActive = false;\r\n                    // Force final orbit rebuild with accurate reference\r\n                    this.markOrbitDirty();\r\n                    this.draw();\r\n\r\n                    this.stopCurrentCAnimation();\r\n                    this.onAnimationFinished();\r\n                    console.groupEnd();\r\n                    resolve();\r\n                }\r\n            };\r\n            this.currentCAnimationFrame = requestAnimationFrame(step);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Animates Julia from current C and zoom to target C and zoom\r\n     *\r\n     * @param {number} [targetZoom] Target zoom\r\n     * @param {COMPLEX} [targetC] Defaults to default C\r\n     * @param {number} [duration] in ms\r\n     * @param {EASE_TYPE|Function} easeFunction\r\n     * @return {Promise<void>}\r\n     */\r\n    async animateToZoomAndC(targetZoom, targetC = [...this.DEFAULT_C], duration = 500, easeFunction = EASE_TYPE.QUINT) {\r\n        console.groupCollapsed(`%c ${this.constructor.name}: animateToZoomAndC`, CONSOLE_GROUP_STYLE);\r\n        this.stopCurrentCAnimation();\r\n\r\n        await Promise.all([\r\n            this.animateZoomTo(targetZoom, duration, easeFunction),\r\n            this.animateToC(targetC, duration, easeFunction)\r\n        ]);\r\n        console.groupEnd();\r\n    }\r\n\r\n    /**\r\n     * Animates travel to a preset using a single consolidated animation loop.\r\n     *\r\n     * @param {JULIA_PRESET|PRESET} preset\r\n     * @param {number} [duration] in ms\r\n     * @param {Function} [coloringCallback=null] Optional callback for UI color updates\r\n     * @return {Promise<void>}\r\n     */\r\n    async animateTravelToPreset(preset, duration = 500, coloringCallback = null) {\r\n        console.groupCollapsed(`%c ${this.constructor.name}: animateTravelToPreset`, CONSOLE_GROUP_STYLE);\r\n        this.stopAllNonColorAnimations();\r\n        this.stopCurrentColorAnimations();\r\n\r\n        const durationWithSpeed = duration * (preset.speed ?? 1);\r\n\r\n        // Phase 1: Setting default params (zoom out to default view)\r\n        await this.animatePanAndZoomTo(this.DEFAULT_PAN, this.DEFAULT_ZOOM, 1000);\r\n\r\n        // Phase 2: Consolidated animation to preset\r\n        // Capture start values\r\n        const startC = [...this.c];\r\n        const startPan = [...this.pan];\r\n        const startZoom = this.zoom;\r\n        const startRotation = this.rotation;\r\n        const startStops = Array.from(this.innerStops);\r\n\r\n        // Target values\r\n        const targetC = preset.c || this.DEFAULT_C;\r\n        const targetPan = preset.pan || this.DEFAULT_PAN;\r\n        const targetZoom = preset.zoom || this.DEFAULT_ZOOM;\r\n        const targetRotation = preset.rotation ?? 0;\r\n\r\n        // Target palette (if specified)\r\n        let targetPalette = null;\r\n        if (preset.paletteId) {\r\n            const paletteIndex = this.PALETTES.findIndex(p => p.id === preset.paletteId);\r\n            if (paletteIndex >= 0) {\r\n                targetPalette = this.PALETTES[paletteIndex];\r\n                this.currentPaletteIndex = paletteIndex;\r\n            }\r\n        }\r\n\r\n        // Use the longer duration for the main animation\r\n        const mainDuration = Math.max(duration, durationWithSpeed);\r\n        const easeFunc = EASE_TYPE.QUINT;\r\n\r\n        this.cAnimationActive = true;\r\n        this.markOrbitDirty();\r\n\r\n        await new Promise((resolve) => {\r\n            let startTime = null;\r\n\r\n            const step = (timestamp) => {\r\n                if (!startTime) startTime = timestamp;\r\n                const t = Math.min((timestamp - startTime) / mainDuration, 1);\r\n                const k = easeFunc(t);\r\n\r\n                // Interpolate C\r\n                this.c[0] = lerp(startC[0], targetC[0], k);\r\n                this.c[1] = lerp(startC[1], targetC[1], k);\r\n\r\n                // Interpolate pan\r\n                this.setPan(\r\n                    lerp(startPan[0], targetPan[0], k),\r\n                    lerp(startPan[1], targetPan[1], k)\r\n                );\r\n\r\n                // Interpolate zoom (exponential for smooth zoom feel)\r\n                this.zoom = startZoom * Math.pow(targetZoom / startZoom, k);\r\n\r\n                // Interpolate rotation\r\n                this.rotation = lerp(startRotation, targetRotation, k);\r\n\r\n                // Interpolate palette if target specified\r\n                if (targetPalette) {\r\n                    const interpolatedStops = startStops.map((v, i) =>\r\n                        lerp(v, targetPalette.theme[i], k)\r\n                    );\r\n                    this.innerStops = new Float32Array(interpolatedStops);\r\n\r\n                    // Update colorPalette for UI theme\r\n                    if (targetPalette.keyColor) {\r\n                        const keyColor = hexToRGB(targetPalette.keyColor);\r\n                        if (keyColor) {\r\n                            this.colorPalette = [keyColor.r, keyColor.g, keyColor.b];\r\n                        }\r\n                    }\r\n                }\r\n\r\n                // Single draw call per frame\r\n                this.draw();\r\n                updateInfo(true);\r\n                updateJuliaSliders();\r\n\r\n                if (coloringCallback) {\r\n                    coloringCallback();\r\n                }\r\n\r\n                if (t < 1) {\r\n                    this.currentCAnimationFrame = requestAnimationFrame(step);\r\n                } else {\r\n                    // Animation complete - finalize state\r\n                    this.cAnimationActive = false;\r\n                    this.markOrbitDirty();\r\n                    this.draw();\r\n                    this.currentPresetIndex = preset.index;\r\n                    console.groupEnd();\r\n                    resolve();\r\n                }\r\n            };\r\n\r\n            this.currentCAnimationFrame = requestAnimationFrame(step);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Infinite animation of the dive (c-param interpolations)\r\n     * @param {DIVE} dive\r\n     * @return {Promise<void>}\r\n     */\r\n    async animateDive(dive) {\r\n        console.groupCollapsed(`%c ${this.constructor.name}: animateDive`, CONSOLE_GROUP_STYLE);\r\n        this.stopCurrentCAnimation();\r\n\r\n        console.log(`Diving to ${dive}.`);\r\n        // Note: Do NOT set cAnimationActive for continuous animations.\r\n        // The grid search in pickReferenceNearViewCenter is needed for stability\r\n        // when c changes to values where view center might escape immediately.\r\n\r\n        // Return a Promise that never resolves (continuous animation)\r\n        await new Promise(() => {\r\n            // Ensure phases are defined\r\n            dive.phases ||= [1, 2, 3, 4];\r\n            let phase = dive.phases[0];\r\n\r\n            const diveStep = () => {\r\n                const step = dive.step;\r\n                // Phase 1: Animate cx (real part) toward endC[0]\r\n                if (phase === 1) {\r\n                    this.c[0] += dive.cxDirection * step;\r\n                    if ((dive.cxDirection < 0 && this.c[0] <= dive.endC[0]) || (dive.cxDirection > 0 && this.c[0] >= dive.endC[0])) {\r\n                        this.c[0] = dive.endC[0];\r\n                        phase = 2;\r\n                    }\r\n                }\r\n                // Phase 2: Animate cy (imaginary part) toward endC[1]\r\n                else if (phase === 2) {\r\n                    this.c[1] += dive.cyDirection * step;\r\n                    if ((dive.cyDirection < 0 && this.c[1] <= dive.endC[1]) || (dive.cyDirection > 0 && this.c[1] >= dive.endC[1])) {\r\n                        this.c[1] = dive.endC[1];\r\n                        phase = 3;\r\n                    }\r\n                }\r\n                // Phase 3: Animate cx back toward startC[0]\r\n                else if (phase === 3) {\r\n                    this.c[0] -= dive.cxDirection * step;\r\n                    if ((dive.cxDirection < 0 && this.c[0] >= dive.startC[0]) || (dive.cxDirection > 0 && this.c[0] <= dive.startC[0])) {\r\n                        this.c[0] = dive.startC[0];\r\n                        phase = 4;\r\n                    }\r\n                }\r\n                // Phase 4: Animate cy back toward startC[1]\r\n                else if (phase === 4) {\r\n                    this.c[1] -= dive.cyDirection * step;\r\n                    if ((dive.cyDirection < 0 && this.c[1] >= dive.startC[1]) || (dive.cyDirection > 0 && this.c[1] <= dive.startC[1])) {\r\n                        this.c[1] = dive.startC[1];\r\n                        phase = 1; // Loop back to start phase.\r\n                    }\r\n                }\r\n\r\n                this.draw();\r\n                updateInfo(true);\r\n                updateJuliaSliders();\r\n\r\n                this.currentCAnimationFrame = requestAnimationFrame(diveStep);\r\n            };\r\n            this.currentCAnimationFrame = requestAnimationFrame(diveStep);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Animates infinite demo loop with oscillating c between predefined values\r\n     * @return {Promise<void>}\r\n     */\r\n    async animateRandomDemo() {\r\n        console.log(`%c ${this.constructor.name}: animateDemo`, CONSOLE_GROUP_STYLE);\r\n        this.stopAllNonColorAnimations();\r\n\r\n        this.demoActive = true;\r\n        // Note: Do NOT set cAnimationActive for continuous animations - grid search needed for stability\r\n\r\n        // Return a Promise that never resolves (continuous animation)\r\n        await new Promise(() => {\r\n            const step = () => {\r\n                this.c = [\r\n                    ((Math.sin(this.demoTime) + 1) / 2) * 1.5 - 1,   // Oscillates between -1 and 0.5\r\n                    ((Math.cos(this.demoTime) + 1) / 2) * 1.4 - 0.7  // Oscillates between -0.7 and 0.7\r\n                ];\r\n                this.rotation = normalizeRotation(this.rotation - 0.001);\r\n                this.demoTime += 0.0005; // Speed\r\n\r\n                this.draw();\r\n                updateInfo(true);\r\n                updateJuliaSliders();\r\n\r\n                this.currentCAnimationFrame = requestAnimationFrame(step);\r\n            };\r\n            this.currentCAnimationFrame = requestAnimationFrame(step);\r\n        });\r\n    }\r\n\r\n\r\n    /**\r\n     * Animates infinite demo loop of traveling to the presets\r\n     * @param {boolean} random Determines whether presets are looped in order or randomly\r\n     * @param {Function} [coloringCallback] Optional callback for UI color updates\r\n     * @param {Function} [onPresetComplete] Optional callback when each preset completes\r\n     * @param {Array<JULIA_PRESET>} [userPresets] Optional array of user-saved presets to include in the demo\r\n     * @return {Promise<void>}\r\n     */\r\n    async animateDemo(random = true, coloringCallback = null, onPresetComplete = null, userPresets = []) {\r\n        console.groupCollapsed(`%c ${this.constructor.name}: animateDemo`, CONSOLE_GROUP_STYLE);\r\n        this.stopAllNonColorAnimations();\r\n\r\n        // Merge built-in presets with user presets\r\n        const allPresets = [...this.PRESETS, ...userPresets];\r\n\r\n        if (!allPresets.length) {\r\n            console.warn('No presets defined for Julia mode');\r\n            console.groupEnd();\r\n            return;\r\n        }\r\n\r\n        console.log(`Demo includes ${this.PRESETS.length} built-in + ${userPresets.length} user presets`);\r\n        this.demoActive = true;\r\n\r\n        // Simple index cycling - just go through all presets\r\n        let demoIndex = 0;\r\n        const getNextPresetIndex = (random) => {\r\n            if (allPresets.length <= 1) {\r\n                return 0; // Only one preset, always return it\r\n            }\r\n\r\n            if (random) {\r\n                // Pick a random preset different from current\r\n                let index;\r\n                do {\r\n                    index = Math.floor(Math.random() * allPresets.length);\r\n                } while (index === demoIndex && allPresets.length > 1);\r\n                return index;\r\n            } else {\r\n                // Sequential: just increment\r\n                return (demoIndex + 1) % allPresets.length;\r\n            }\r\n        };\r\n\r\n        // Continue cycling through presets while demo is active.\r\n        while (this.demoActive) {\r\n            demoIndex = getNextPresetIndex(random);\r\n            const currentPreset = allPresets[demoIndex];\r\n\r\n            if (!currentPreset) {\r\n                console.warn(`No preset at index ${demoIndex}, stopping demo`);\r\n                break;\r\n            }\r\n\r\n            console.log(`Animating to preset ${demoIndex}/${allPresets.length}: \"${currentPreset.id}\"`);\r\n\r\n            await this.animateTravelToPreset(currentPreset, 4000, coloringCallback);\r\n\r\n            // Call completion callback to update UI state\r\n            if (onPresetComplete) {\r\n                onPresetComplete();\r\n            }\r\n\r\n            await asyncDelay(500);\r\n        }\r\n\r\n        console.log(`Demo interrupted.`);\r\n        console.groupEnd();\r\n    }\r\n\r\n    // endregion--------------------------------------------------------------------------------------------------------\r\n}","/**\r\n * @module Main\r\n * @author Radim Brnka\r\n * @description The entry point that imports modules, creates the fractal renderer instance (passing the canvas ID), initializes the UI and the fractal.\r\n * @copyright Synaptory Fractal Traveler, 2025-2026\r\n * @license MIT\r\n */\r\n\r\nimport './css/style.css';\r\nimport './css/debugPanel.css';\r\nimport {JuliaRenderer} from \"./renderers/juliaRenderer\";\r\nimport MandelbrotRenderer from \"./renderers/mandelbrotRenderer\";\r\nimport RiemannRenderer from \"./renderers/riemannRenderer\";\r\nimport {initUI, resetActivePresetIndex, resetPresetAndDiveButtonStates, updateInfo} from \"./ui/ui\";\r\nimport {asyncDelay, clearURLParams, loadFractalParamsFromURL} from \"./global/utils\";\r\nimport {CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE, DEBUG_LEVEL, DEBUG_MODE, FRACTAL_TYPE} from \"./global/constants\";\r\n\r\n/**\r\n * Initializes the canvas, reads URL params and triggers respective fractal rendering\r\n */\r\nasync function initFractalApp() {\r\n    if (DEBUG_MODE > DEBUG_LEVEL.VERBOSE) console.warn(' --- FULL DEBUG MODE ACTIVE! ---');\r\n    console.groupCollapsed(`%c initFractalApp`, CONSOLE_GROUP_STYLE);\r\n\r\n    const canvas = document.getElementById('fractalCanvas');\r\n    canvas.width = window.innerWidth;\r\n    canvas.height = window.innerHeight;\r\n\r\n    const params = loadFractalParamsFromURL();\r\n    console.log(`URL Params found:  ${JSON.stringify(params)}`);\r\n\r\n    // Do we have all the params needed for initial travel?\r\n    const validMandelbrotTravelPreset = params.px != null && params.py != null && params.zoom != null && params.r != null;\r\n    const validJuliaTravelPreset = validMandelbrotTravelPreset && params.cx != null && params.cy != null;\r\n    const preset = {\r\n        pan: [params.px, params.py],\r\n        zoom: params.zoom,\r\n        c: [params.cx, params.cy],\r\n        rotation: params.r,\r\n        paletteId: params.paletteId\r\n    };\r\n\r\n    const onDefault = () => {\r\n        console.log(`Default fractal settings used.`);\r\n        fractalApp.resizeCanvas();\r\n        clearURLParams();\r\n    }\r\n\r\n    let fractalApp;\r\n\r\n    switch (params.mode) {\r\n        /************\r\n         * JULIA SET\r\n         ************/\r\n        case FRACTAL_TYPE.JULIA:\r\n            console.log(`Constructing Julia.`);\r\n            fractalApp = new JuliaRenderer(canvas);\r\n            break;\r\n\r\n        /****************\r\n         * MANDELBROT SET\r\n         ****************/\r\n        case FRACTAL_TYPE.MANDELBROT:\r\n            console.log(`Constructing Mandelbrot.`);\r\n            fractalApp = new MandelbrotRenderer(canvas);\r\n            break;\r\n\r\n        /****************\r\n         * RIEMANN ZETA\r\n         ****************/\r\n        case FRACTAL_TYPE.RIEMANN:\r\n            console.log(`Constructing Riemann Zeta.`);\r\n            fractalApp = new RiemannRenderer(canvas);\r\n            break;\r\n\r\n        default:\r\n            console.error('Unknown fractal mode: ' + params.mode);\r\n            break;\r\n    }\r\n\r\n    await asyncDelay(100); // Wait a moment for things to stabilize\r\n    await initUI(fractalApp); // TODO consider initializing after travel\r\n\r\n    if (validJuliaTravelPreset) {\r\n        console.log(`Traveling to URL params.`);\r\n        await fractalApp.animateTravelToPreset(preset, 1000);\r\n    } else if (validMandelbrotTravelPreset) {\r\n        console.log(`Traveling to URL params.`);\r\n        await fractalApp.animateTravelToPreset(preset, 100, 400, 1000);\r\n    } else {\r\n        onDefault();\r\n    }\r\n\r\n    await asyncDelay(100); // Wait a moment for things to stabilize\r\n\r\n    await new Promise(resolve => {\r\n        document.getElementById('headerContainer').classList.add('ready');\r\n        document.getElementById('infoLabel').classList.add('ready');\r\n        resolve();\r\n    });\r\n\r\n    // If URL contains a preset, reset buttons\r\n    if (validMandelbrotTravelPreset || validJuliaTravelPreset) {\r\n        resetPresetAndDiveButtonStates();\r\n        resetActivePresetIndex();\r\n    }\r\n\r\n    console.groupEnd();\r\n}\r\n\r\ndocument.addEventListener('DOMContentLoaded', async () => {\r\n        if (DEBUG_MODE) console.log('%c DOMContentLoaded: %c Initializing fractal.', CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n\r\n        await initFractalApp();\r\n        console.log('%c DOMContentLoaded: %c Fractal init complete.', CONSOLE_GROUP_STYLE, CONSOLE_MESSAGE_STYLE);\r\n\r\n        await asyncDelay(2000); // Wait a moment for things to stabilize\r\n        updateInfo();\r\n    }, {\r\n        once: true\r\n    }\r\n);"],"names":["DEBUG_LEVEL","DEBUG_MODE","LOG_LEVEL","log","message","scope","arguments","length","undefined","concat","ADAPTIVE_QUALITY_THRESHOLD_LOW","ADAPTIVE_QUALITY_MIN","FRACTAL_TYPE","MANDELBROT","JULIA","RIEMANN","EASE_TYPE","NONE","x","QUAD","time","CUBIC","Math","pow","QUINT","ROTATION_DIRECTION","DEFAULT_ACCENT_COLOR","DEFAULT_BG_COLOR","DEFAULT_JULIA_PALETTE","DEFAULT_MANDELBROT_THEME_COLOR","DEFAULT_JULIA_THEME_COLOR","hexToRGBArray","keyColor","PI","e","t","r","Symbol","n","iterator","o","toStringTag","i","c","prototype","Generator","u","Object","create","_regeneratorDefine2","f","p","y","G","v","a","d","bind","l","TypeError","call","done","value","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","__proto__","displayName","_regenerator","w","m","defineProperty","_invoke","enumerable","configurable","writable","asyncGeneratorStep","Promise","resolve","then","_toConsumableArray","Array","isArray","_arrayLikeToArray","_arrayWithoutHoles","from","_iterableToArray","_unsupportedIterableToArray","_nonIterableSpread","_slicedToArray","_arrayWithHoles","next","push","_iterableToArrayLimit","_nonIterableRest","toString","slice","constructor","name","test","urlParamsSet","updateURLParams","mode","px","py","zoom","rotation","cx","cy","paletteId","formatNumber","Number","toPrecision","params","toFixed","palette","some","el","encodedParams","btoa","JSON","stringify","hashPath","window","history","pushState","loadFractalParamsFromURL","hash","URL","location","href","_hash$slice$split2","split","queryString","URLSearchParams","get","decodedParams","parse","atob","parseFloat","clearURLParams","newUrl","origin","isTouchDevice","navigator","maxTouchPoints","msMaxTouchPoints","isMobileDevice","toMatchItem","userAgent","match","expandComplexToString","precision","withI","invalidValues","NaN","isNumber","isFinite","expanded","trimmedReal","trimmedImag","SPLIT_FLOAT_METHOD","splitFloat","high","fround","low","splitFloatED","temp","VELTKAMP_DEKKER_K","splitFloatVD","ddMake","hi","lo","twoSum","b","s","bb","err","quickTwoSum","ddAdd","dd","ddSet","ddValue","ddSubDD","ddAddDD","esc","String","replaceAll","compareComplex","c1","c2","comparePalettes","p1","p2","hslToRgb","h","g","hue2rgb","q","rgbToHsl","max","min","hexToRGB","hex","normalize","toLowerCase","replace","map","char","join","parseInt","substring","rgb","lerp","start","end","degToRad","degrees","normalizeRotation","twoPi","getAnimationDuration","seed","current","target","weights","compositeDistance","_loop","hasOwnProperty","key","currVal","targVal","diff","abs","hypot","apply","round","asyncDelay","_x","_asyncDelay","_callee","timeout","_context","setTimeout","_next","_throw","destroyArrayOfButtons","buttons","forEach","btn","parentNode","removeChild","Renderer","canvas","_classCallCheck","this","gl","getContext","antialias","alpha","depth","stencil","preserveDrawingBuffer","powerPreference","onWebGLContextLost","addEventListener","alert","event","preventDefault","init","Error","_asyncToGenerator","_defineProperties","_toPropertyKey","_typeof","toPrimitive","_toPrimitive","_callSuper","_getPrototypeOf","ReferenceError","_assertThisInitialized","_possibleConstructorReturn","_isNativeReflectConstruct","Reflect","construct","Boolean","valueOf","_get","_superPropBase","getOwnPropertyDescriptor","_setPrototypeOf","FractalRenderer","_Renderer","_this","MAX_ITER","DEFAULT_ROTATION","DEFAULT_ZOOM","DEFAULT_PAN","DEFAULT_PALETTE","MAX_ZOOM","MIN_ZOOM","PRESETS","pan","panDD","currentPanAnimationFrame","currentZoomAnimationFrame","currentRotationAnimationFrame","currentColorAnimationFrame","_colorAnimationResolve","demoActive","currentPresetIndex","interactionActive","interactionTimer","iterations","extraIterations","adaptiveQualityLastAdjustment","adaptiveQualityEnabled","adaptiveQualityMin","colorPalette","_uniformCache","resW","resH","pan0","pan1","color0","color1","color2","vertexShaderSource","_inherits","dx","dy","fxAnchor","fyAnchor","vx","vy","setPan","targetZoom","anchorX","anchorY","_this$screenToViewVec2","screenToViewVector","deltaZoom","addPan","_this2","settleMs","_lastInteractionTime","performance","now","clearTimeout","markOrbitDirty","draw","updateInfo","stopAllNonColorAnimations","stopCurrentColorAnimations","removeEventListener","program","deleteProgram","vertexShader","deleteShader","fragmentShader","preset","index","generatePresetIDs","initGLProgram","useProgram","oldRect","getBoundingClientRect","width","height","_this$screenToFractal2","screenToFractal","centerFx","centerFy","dpr","devicePixelRatio","floor","viewport","resolutionLoc","uniform2f","_this$screenToViewVec4","setPanFromAnchor","source","type","shader","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","VERTEX_SHADER","createFragmentShaderSource","FRAGMENT_SHADER","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","positionBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","positions","Float32Array","bufferData","STATIC_DRAW","positionLoc","getAttribLocation","enableVertexAttribArray","vertexAttribPointer","FLOAT","updateUniforms","invalidateUniformCache","onProgramCreated","panLoc","getUniformLocation","zoomLoc","iterLoc","colorLoc","rotationLoc","uc","uniform2fv","uniform1f","uniform3fv","clearColor","clear","COLOR_BUFFER_BIT","debugPanel","beginGpuTimer","drawArrays","TRIANGLE_STRIP","endGpuTimer","adjustAdaptiveQuality","perf","gpuMs","gpuMsSmoothed","newExtra","delta","oldMin","oldExtra","maxExtra","resizeCanvas","screenX","screenY","rect","stX","stY","cosR","cos","sinR","sin","rotatedY","_this$screenToViewVec6","stopCurrentPanAnimation","stopCurrentZoomAnimation","stopCurrentRotationAnimation","cancelAnimationFrame","wasActivelyCycling","paletteCyclingActive","_inPaletteCycleTransition","paletteCyclingTimeoutId","cycleBtn","document","getElementById","classList","remove","_animateColorPaletteTransition","newPalette","duration","coloringCallback","startPalette","_this3","_args","startTime","step","timestamp","progress","requestAnimationFrame","_animateFullColorSpaceCycle","_callee2","currentRGB","hsl","startHue","_this4","_args2","_context2","newHue","_startPaletteCycling","_callee4","transitionDuration","holdDuration","onPaletteComplete","nextIndex","_cycleNext","_this5","_args4","_context4","PALETTES","contains","add","currentPaletteIndex","cycleNext","_ref","_callee3","_context3","applyPaletteByIndex","_animatePaletteByIdTransition","_callee5","paletteIndex","_args5","_context5","findIndex","id","_x2","_x3","_animatePanTo","_callee6","targetPan","easeFunction","startPan","_this6","_args6","_context6","k","nx","ny","onAnimationFinished","_x4","_animatePanBy","_callee7","deltaPan","_this7","_args7","_context7","prevK","dk","_x5","_animateZoomTo","_callee8","_this$getCanvasCssCen","_this$getCanvasCssCen2","startZoom","ratio","_this$screenToViewVec7","_this$screenToViewVec8","_this8","_args8","_context8","getCanvasCssCenter","_x6","_animateZoomToNoPan","_callee9","_this9","_args9","_context9","_x7","_animateRotationTo","_callee0","targetRotation","startRotation","_this0","_args0","_context0","_x8","_animatePanThenZoomTo","_callee1","panDuration","zoomDuration","_args1","_context1","animatePanTo","animateZoomTo","_x9","_x0","_x1","_x10","_animatePanAndZoomTo","_callee10","_args10","_context10","all","animateZoomToNoPan","_x11","_x12","_animatePanByAndZoomTo","_callee11","_args11","_context11","animatePanBy","_x13","_x14","_animateZoomRotationTo","_callee12","_args12","_context12","animateRotationTo","_x15","_x16","_animatePanZoomRotationTo","_callee13","_args13","_context13","_x17","_x18","_x19","_animateInfiniteRotation","_callee14","direction","dir","_this1","_args14","_context14","rotationStep","_x20","_superPropGet","JuliaPreviewRenderer","_FractalRenderer","DEFAULT_C","data","theme","DIVES","innerStops","currentCAnimationFrame","demoTime","cLoc","innerStopsLoc","baseIters","log2","stopIndex","floatingCanvas","previewRenderer","previewActive","pendingInnerStops","PREVIEW_WIDTH","PREVIEW_HEIGHT","initJuliaPreview","style","updatePreviewPosition","viewportWidth","innerWidth","viewportHeight","innerHeight","left","top","hideJuliaPreview","display","resetJuliaPreview","reset","fractalApp","handleWheelEvent","handleMouseDownEvent","handleMouseMoveEvent","handleMouseUpEvent","handleMouseLeaveEvent","DOUBLE_CLICK_THRESHOLD","ZOOM_STEP","LONG_PRESS_THRESHOLD","mouseHandlersRegistered","mouseDownX","mouseDownY","lastX","lastY","clickTimeout","wheelResetTimeout","isDragging","wasRotated","longPressTimeout","longPressZoomActive","longPressZoomRAF","longPressAnchorX","longPressAnchorY","rightLongPressTimeout","rightLongPressZoomActive","rightLongPressZoomRAF","rightLongPressAnchorX","rightLongPressAnchorY","isRightDragging","startX","isMiddleButtonHeld","dragRectLeft","clampPanDelta","currentPan","newPanX","newPanY","distance","sqrt","scale","clampedPanY","dragRectTop","hasDragRect","wheelAccum","wheelAnchorX","wheelAnchorY","wheelRAF","wheelRectLeft","wheelRectTop","hasWheelRect","markOrbitDirtySafe","initMouseHandlers","app","registerMouseEventHandlers","deltaY","clientX","clientY","flushWheelZoom","resetAppState","noteInteraction","handleWheel","button","zoomLoop","setZoomKeepingAnchor","stopLongPressZoomIn","cursor","startLongPressZoomIn","stopLongPressZoomOut","startLongPressZoomOut","isJuliaMode","mouseX","mouseY","_fractalApp$screenToF2","fx","fy","handleMouseDown","lastRelX","lastRelY","nowRelX","nowRelY","_fractalApp$screenToV2","vLastX","vLastY","_fractalApp$screenToV4","vNowX","vNowY","deltaX","_fractalApp$screenToF4","handleMouseMove","includes","stopPropagation","screenToPanDelta","animatePanByAndZoomTo","_fractalApp$screenToF6","newFx","newFy","getCurrentPaletteId","clipboard","writeText","handleMouseUp","passive","unregisterMouseEventHandlers","zoomFactor","handleTouchStartEvent","handleTouchMoveEvent","handleTouchEndEvent","touchHandlersRegistered","touchDownX","touchDownY","lastTouchX","lastTouchY","touchClickTimeout","isTouchDragging","isPinching","pinchStartDistance","pinchStartAngle","lastPinchCenterX","lastPinchCenterY","initTouchHandlers","registerTouchEventHandlers","touches","touch","touch0","touch1","atan2","centerClientX","centerClientY","handleTouchStart","currentDistance","currentAngle","centerX","centerY","centerDeltaX","centerDeltaY","_fractalApp$screenToV6","_fractalApp$screenToV8","angleDifference","handleTouchMove","changedTouches","touchX","touchY","handleTouchEnd","unregisterTouchEventHandlers","takeScreenshot","accentColor","offscreenCanvas","createElement","ctx","drawImage","_getWatermarkLines","fractalType","line1","line2","toExponential","JuliaRenderer","getWatermarkLines","line1Font","line2Font","textAlign","letterSpacing","textBaseline","font","line1Width","measureText","line2Width","rectWidth","padding","borderWidth","fontSize","fillStyle","radius","beginPath","moveTo","lineTo","quadraticCurveTo","closePath","drawRoundRect","fill","textX","line1Y","line2Y","fillText","pad","link","setAttribute","Date","padStart","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","toDataURL","click","ANIMATION_KEYS_BLACKLIST","PAN_STEP","PAN_SMOOTH_STEP","JULIA_HOTKEY_C_STEP","JULIA_HOTKEY_C_SMOOTH_MULTIPLIER","rotationActive","initialized","onKeyDown","_onKeyDown","_target$tagName","tag","handled","rotationSpeed","rotationDirection","deltaPanX","deltaPanY","deltaCx","deltaCy","altKey","_step","increment","effectiveDeltaX","effectiveDeltaY","effectiveDeltaCx","effectiveDeltaCy","_t","tagName","isContentEditable","shiftKey","code","isAnimationActive","animateInfiniteRotation","toggleCenterLines","copyInfoToClipboard","toggleDebugMode","switchFractalTypeWithPersistence","updateColorTheme","updatePaletteDropdownState","updatePaletteCycleButtonState","startPaletteCycling","randomizeColors","showSaveViewDialog","captureScreenshot","FF_LEGACY_JULIA_RENDERER","switchFractalMode","toggleDemo","useAnalyticExtension","toggleAdaptiveQuality","adjustExtraIterations","showEditCoordsDialog","ctrlKey","toggleHeader","startJuliaDive","travelToPreset","animateToC","initHotKeys","destroyHotKeys","MandelbrotRenderer","orbitDirty","refPan","refPanDD","REF_SEARCH_GRID","REF_SEARCH_RADIUS","rebaseArmed","orbitTex","orbitData","floatTexExt","presetsData","DEFAULT_FREQUENCY","DEFAULT_PHASE","frequency","phase","getExtension","createTexture","activeTexture","TEXTURE0","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","orbitTexLoc","uniform1i","orbitWLoc","deltaPanHLoc","deltaPanLLoc","zoomHLoc","zoomLLoc","frequencyLoc","phaseLoc","iters","zx","zy","zy2","grid","half","base","probeIters","currentRefScore","escapeItersDouble","bestCx","bestCy","bestScore","j","ox","oy","score","improvementThreshold","sx","sy","idx","texImage2D","RGBA","safe","log2Depth","mustRebaseNow","needsRebase","canRebaseNow","pickReferenceNearViewCenter","computeReferenceOrbit","z","_applyPaletteByIndex","wrappedCallback","animateColorPaletteTransition","angle","random","startTheme","startFrequency","startPhase","targetTheme","targetFrequency","targetPhase","generateRandomPalette","_animateTravelToPreset","_preset$rotation","_preset$speed","zoomOutDuration","zoomInDuration","presetRotation","zoomRatio","atTargetZoom","nearTargetZoom","panDist","targetViewSize","panRatio","atTargetPan","nearTargetPan","targetPaletteIndex","atTargetPalette","zoomInDurationWithSpeed","readjustDuration","animations","_animations","_animations2","_animations3","zoomOutRotation","extraFullRotations","deltaAngle","targetRotationWithSpins","finalAnimations","_args3","speed","animatePaletteByIdTransition","animatePanAndZoomTo","animateZoomRotationTo","_animateDemo","onPresetComplete","userPresets","allPresets","demoIndex","getNextPresetIndex","currentPreset","animateTravelToPreset","RiemannRenderer","termCount","termCountLoc","useAnalyticExtensionLoc","sliderContainer","realSlider","imagSlider","realSliderValue","imagSliderValue","lastSliderUpdate","initJuliaSliders","onRealSliderChange","onImagSliderChange","onSliderChangeFinished","resetPresetAndDiveButtonStates","updateZeroZoneState","slider","isNearZero","toggle","snapToZero","textContent","resetJuliaSliders","innerText","updateJuliaSliders","DebugPanel","_this$gl","_this$gl2","_this$gl3","_defineProperty","ts","_this$fractalApp$PALE","_this$fractalApp$panD","_this$fractalApp$panD2","_panDDx$hi","_panDDx$lo","_panDDy$hi","_panDDy$lo","debugInfo","t0","pollGpuTimers","dt","lastRafTs","frameMs","frameMsSmoothed","smooth","fps","drawCountInterval","lastDrawCountReset","renderFps","drawCount","getShaderPrecisionFormat","hp","HIGH_FLOAT","hpInfo","rangeMin","rangeMax","viewPanX","viewPanY","refPanX","refPanY","safeZoom","pxPerUnit","panOverZoom","mantissaUsedApprox","driftViewUnits","orbitStatus","zoomBucket","log10","levelClass","level","panLevel","driftLevel","scaleLevel","healthLevel","worst","gpuSmooth","gpuLevel","fpsLevel","panelCpuMs","panelCpuMsSmoothed","gpuIsStale","gpuLastUpdateTs","gpuHint","gpuSupported","animState","animStatus","isAnim","rotationRad","rotationDeg","paletteIdx","paletteName","hasFreqPhase","freqStr","phaseStr","panDDx","panDDy","ddXhi","ddXlo","ddYhi","ddYlo","lastInteraction","timeSinceInteraction","gpuVendor","gpu","unmaskedVendor","vendor","gpuRenderer","unmaskedRenderer","renderer","innerHTML","getFractalMode","_renderGpuTime","_renderAdaptiveQuality","update","panelSelector","lastTap","dump","indexOf","extTimer","extRendererInfo","webglVersion","shadingLanguageVersion","maxTextureSize","maxVaryings","maxFragUniforms","maxVertUniforms","maxViewportDims","_initGpuInfo","gpuDisjoint","queryInFlight","pendingQueries","getParameter","VERSION","SHADING_LANGUAGE_VERSION","VENDOR","RENDERER","MAX_TEXTURE_SIZE","MAX_VARYING_VECTORS","MAX_FRAGMENT_UNIFORM_VECTORS","MAX_VERTEX_UNIFORM_VECTORS","MAX_VIEWPORT_DIMS","UNMASKED_VENDOR_WEBGL","UNMASKED_RENDERER_WEBGL","createQueryEXT","beginQueryEXT","TIME_ELAPSED_EXT","endQueryEXT","disjoint","GPU_DISJOINT_EXT","getQueryObjectEXT","QUERY_RESULT_AVAILABLE_EXT","ns","QUERY_RESULT_EXT","deleteQueryEXT","shift","ms","prev","enabled","minFps","targetFps","extraIters","adaptiveMin","state","stateClass","qualityPct","qualityClass","calculateMandelbrotZoomFromJulia","currentJuliaZoom","juliaDefaultZoom","analysis","maxIter","dzx","dzy","orbitHistory","escaped","escapeIter","finalMag","finalDerivMag","newDzy","newZy","mag2","_orbitHistory$j","hx","hy","period","recommendedZoom","iterZoom","distZoom","analyzeMandelbrotPoint","juliaZoomFactor","finalZoom","resizeTimeout","header","logo","mandelbrotSwitch","juliaSwitch","persistSwitch","resetButton","saveViewButton","screenshotButton","demoButton","saveViewDialog","saveViewNameInput","saveViewConfirmBtn","saveViewCancelBtn","editCoordsDialog","editPanXInput","editPanYInput","editZoomInput","editRotationInput","editCxInput","editCyInput","editJsonInput","editCoordsError","editCoordsApplyBtn","editCoordsCancelBtn","juliaCInputs","presetsToggle","presetsMenu","divesToggle","divesMenu","divesDropdown","paletteToggle","paletteMenu","infoLabel","infoText","fractalMode","midColor","bgColor","headerMinimizeTimeout","uiInitialized","headerVisible","animationActive","activeJuliaDiveIndex","activePresetIndex","presetButtons","diveButtons","paletteButtons","allButtons","lastInfoUpdate","infoUpdateThrottleLimit","pendingInfoTimer","keys","find","_switchFractalMode","_debugPanel","_debugPanel$setRender","_debugPanel2","_debugPanel2$setRende","exitAnimationMode","destroy","enableMandelbrotMode","enableJuliaMode","enableRiemannMode","setRenderer","initAnimationMode","_switchFractalTypeWithPersistence","targetType","_fractalApp$c","resetActivePresetIndex","initPresetButtonEvents","initPaletteButtonEvents","initDiveButtons","background","palettes","currentIndex","isCycling","currentPalette","title","btnIndex","_fractalApp","_fractalApp2","adjustChannel","brightnessFactor","root","querySelector","setProperty","recolorJuliaPreview","_ddValue","_ddValue2","_fractalApp$zoom","force","timeSinceLastUpdate","delay","text","panX","panY","_infoText","currentZoom","currentRotation","_fractalApp$c$","_fractalApp$c$2","_fractalApp3","shouldBeActive","isActive","_infoText2","_fractalApp4","disabled","_infoText3","closePresetsDropdown","closeDivesDropdown","_toggleDemo","_t2","stopDemo","startMandelbrotDemo","startJuliaDemo","_startMandelbrotDemo","animateDemo","getUserPresets","_startJuliaDive","dives","_diveButtons$index","dive","cxDirection","endC","startC","cyDirection","animateToZoomAndC","animateDive","animatePanZoomRotationTo","_startJuliaDemo","_callee15","_context15","_travelToPreset","_callee16","presets","_presetButtons$index","_context16","verticalLine","horizontalLine","_randomizeColors","_callee17","randomIndex","_context17","show","_reset","_callee18","_context18","getUserPresetsKey","stored","localStorage","getItem","saveUserPresets","setItem","saveCurrentViewAsPreset","deleteUserPreset","presetId","filter","focus","hideSaveViewDialog","initSaveViewDialog","trim","input","hideEditCoordsDialog","parseEditCoordsInput","jsonText","parsed","error","isNaN","result","panXStr","panYStr","zoomStr","rotationStr","cxStr","cyStr","validateEditCoordsInput","applyEditedCoords","_applyEditedCoords","_callee19","_context19","initEditCoordsDialog","filtered","dotParts","eParts","offset","prevChar","allInputs","initHeaderEvents","lastPointerType","pointerType","initControlButtonEvents","presetBlock","className","borderColor","appendChild","confirm","longPressTimer","touchMoved","_presetsMenu","initPresetsDropdown","closePaletteDropdown","isOpen","togglePresetsDropdown","_divesMenu","initDivesDropdown","toggleDivesDropdown","randomBtn","primaryColor","secondaryColor","kr","kg","kb","initPaletteDropdown","togglePaletteDropdown","initCommonButtonEvents","blur","diveBlock","initFractalSwitchButtons","_ref9","_ref0","initWindowEvents","dragElements","querySelectorAll","element","onMove","leftValue","getComputedStyle","topValue","movementX","movementY","move","once","initInfoText","longTouchTimer","randomTitle","bindHTMLElements","initUI","_initUI","_callee20","fractalRenderer","controlsHint","_context20","matchMedia","matches","ownKeys","getOwnPropertySymbols","_objectSpread","getOwnPropertyDescriptors","defineProperties","_data$views$","refZ0","refZ0DD","_prevPan0","_prevPan1","_prevZoom","_prevC0","_prevC1","firstPresetPaletteId","DEFAULT_PALETTE_INDEX","initialPalette","cAnimationActive","deltaZ0HLoc","deltaZ0LLoc","zx0","zy0","escapeItersJulia","bestX","bestY","deltaView","panMoved","zoomChanged","cChanged","isDeferringForAnimation","deltaZ0X","deltaZ0Y","resetPalette","stopCurrentCAnimation","_animateInnerStopsTransition","toPalette","callback","startStops","interpolated","animateInnerStopsTransition","_animateToC","targetC","easedProgress","_animateToZoomAndC","durationWithSpeed","targetPalette","mainDuration","easeFunc","interpolatedStops","_animateDive","phases","diveStep","_animateRandomDemo","initFractalApp","_initFractalApp","validMandelbrotTravelPreset","validJuliaTravelPreset","onDefault"],"ignoreList":[],"sourceRoot":""}