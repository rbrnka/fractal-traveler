(()=>{"use strict";var t=0,e=2,n=t||t,r="debug",o="error",i=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e&&"[".concat(e,"]")},a=1e3/60,s=n===t?-1500:-3e3,c={MANDELBROT:0,JULIA:1,RIEMANN:2},l={NONE:function(t){return t},QUAD:function(t){return t<.5?2*t*t:(4-2*t)*t-1},CUBIC:function(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2},QUINT:function(t){return t<.5?16*Math.pow(t,5):1-Math.pow(-2*t+2,5)/2}},u=-1,f=1,d="#B4FF6A",h="rgba(24, 48, 13, 0.2)",m=("color: ".concat(d),"color: ".concat("#fff"),{id:"Event Horizon",keyColor:"#c74a00",theme:[.859,.565,.306,.18,.129,.216,.067,.067,.082,.467,0,0,.78,.29,0]}),p=[95/255,134/255,56/255],v=Q(m.keyColor),y=Math.PI;function g(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var c=r&&r.prototype instanceof s?r:s,l=Object.create(c.prototype);return b(l,"_invoke",function(n,r,o){var i,s,c,l=0,u=o||[],f=!1,d={p:0,n:0,v:t,a:h,f:h.bind(t,4),d:function(e,n){return i=e,s=0,c=t,d.n=n,a}};function h(n,r){for(s=n,c=r,e=0;!f&&l&&!o&&e<u.length;e++){var o,i=u[e],h=d.p,m=i[2];n>3?(o=m===r)&&(c=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=t):i[0]<=h&&((o=n<2&&h<i[1])?(s=0,d.v=r,d.n=i[1]):h<m&&(o=n<3||i[0]>r||r>m)&&(i[4]=n,i[5]=r,d.n=m,s=0))}if(o||n>1)return a;throw f=!0,r}return function(o,u,m){if(l>1)throw TypeError("Generator is already running");for(f&&1===u&&h(u,m),s=u,c=m;(e=s<2?t:c)||!f;){i||(s?s<3?(s>1&&(d.n=-1),h(s,c)):d.n=c:d.v=c);try{if(l=2,i){if(s||(o="next"),e=i[o]){if(!(e=e.call(i,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,s<2&&(s=0)}else 1===s&&(e=i.return)&&e.call(i),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);i=t}else if((e=(f=d.n<0)?c:n.call(r,d))!==a)break}catch(e){i=t,s=1,c=e}finally{l=1}}return{value:e,done:f}}}(n,o,i),!0),l}var a={};function s(){}function c(){}function l(){}e=Object.getPrototypeOf;var u=[][r]?e(e([][r]())):(b(e={},r,function(){return this}),e),f=l.prototype=s.prototype=Object.create(u);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,b(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return c.prototype=l,b(f,"constructor",l),b(l,"constructor",c),c.displayName="GeneratorFunction",b(l,o,"GeneratorFunction"),b(f),b(f,o,"Generator"),b(f,r,function(){return this}),b(f,"toString",function(){return"[object Generator]"}),(g=function(){return{w:i,m:d}})()}function b(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}b=function(t,e,n,r){function i(e,n){b(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},b(t,e,n,r)}function _(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function T(t){return function(t){if(Array.isArray(t))return w(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||A(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,a,s=[],c=!0,l=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(s.push(r.value),s.length!==e);c=!0);}catch(t){l=!0,o=t}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return s}}(t,e)||A(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(t,e){if(t){if("string"==typeof t)return w(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(t,e):void 0}}function w(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var P=!1;function x(t,e,n,r,o){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=function(t){return null==t?null:Number(t).toPrecision(17)},u={mode:null!=t?t.toFixed(0):c.MANDELBROT,px:l(e),py:l(n),zoom:l(r),r:null!=o?Number(o).toPrecision(17):0,cx:l(i),cy:l(a),palette:s};if(!([e,n,r,o].some(function(t){return null==t})||t===c.JULIA&&[i,a].some(function(t){return null==t}))){var f=btoa(JSON.stringify(u)),d=t===c.JULIA?"#julia":"#";window.history.pushState({},"","".concat(d,"?view=").concat(f)),P=!0}}function L(){var t=new URL(window.location.href).hash;if(!t)return{mode:c.MANDELBROT};var e=E(t.slice(1).split("?"),2),n=e[0],r=e[1];if(!r)return{mode:"julia"===n?c.JULIA:c.MANDELBROT};var o=new URLSearchParams(r).get("view");try{var i=JSON.parse(atob(o));return P=!0,{mode:"julia"===n?c.JULIA:c.MANDELBROT,px:null!=i.px?parseFloat(i.px):null,py:null!=i.py?parseFloat(i.py):null,zoom:null!=i.zoom?parseFloat(i.zoom):null,r:null!=i.r?parseFloat(i.r):0,cx:null!=i.cx?parseFloat(i.cx):null,cy:null!=i.cy?parseFloat(i.cy):null,paletteId:i.palette||null}}catch(t){return P=!0,{mode:"julia"===n?c.JULIA:c.MANDELBROT}}}function S(){if(P){var t=window.location.hash.split("?")[0],e="".concat(window.location.origin,"/").concat(t);window.history.pushState({},"",e),P=!1}}var I=function(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0};function C(){return[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some(function(t){return navigator.userAgent.match(t)})}function D(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=[NaN,void 0,null,""],o=function(t){return"number"==typeof t&&isFinite(t)},i="[";if(r.some(function(e){return e===t[0]})||r.some(function(e){return e===t[1]})||!o(t[0])||!o(t[1]))return i+="?, ?]";var a=parseFloat(t[0].toFixed(e)).toString(),s=parseFloat(t[1].toFixed(e)).toString();return(i+="".concat(a,", ").concat(s))+(n&&0!==t[1]?"i]":"]")}var k="vd",F="ed",M=function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:k)===F?function(t){var e=Math.fround(t),n=Math.fround(t-e);return{high:e,low:n}}(t):function(t){var e=t*O,n=e-(e-t),r=t-n;return{high:n,low:r}}(t)},O=134217729;function R(){return{hi:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,lo:arguments.length>1&&void 0!==arguments[1]?arguments[1]:0}}function z(t,e){var n=t+e,r=n-t;return{s:n,err:t-(n-r)+(e-r)}}function N(t,e){var n=t+e;return{s:n,err:e-(n-t)}}function j(t,e){var n=z(t.hi,e),r=t.lo+n.err,o=N(n.s,r);return t.hi=o.s,t.lo=o.err,t}function U(t,e){return t.hi=e,t.lo=0,t}function B(t){return t.hi+t.lo}function X(t,e){return function(t,e){var n=z(t.hi,e.hi),r=t.lo+e.lo+n.err,o=N(n.s,r);return{hi:o.s,lo:o.err}}(t,{hi:-e.hi,lo:-e.lo})}var Z=function(t){return String(t).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")};function G(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12;return t[0].toFixed(n)===e[0].toFixed(n)&&t[1].toFixed(n)===e[1].toFixed(n)}function q(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6;return t[0].toFixed(n)===e[0].toFixed(n)&&t[1].toFixed(n)===e[1].toFixed(n)&&t[2].toFixed(n)===e[2].toFixed(n)}function H(t,e,n){var r,o,i;if(0===e)r=o=i=n;else{var a=function(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t},s=n<.5?n*(1+e):n+e-n*e,c=2*n-s;r=a(c,s,t+1/3),o=a(c,s,t),i=a(c,s,t-1/3)}return[r,o,i]}function J(t,e,n){var r,o,i=Math.max(t,e,n),a=Math.min(t,e,n),s=(i+a)/2;if(i===a)r=o=0;else{var c=i-a;o=s>.5?c/(2-i-a):c/(i+a),r=i===t?(e-n)/c+(e<n?6:0):i===e?(n-t)/c+2:(t-e)/c+4,r/=6}return[r,o,s]}function V(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:255;return 3===(t=t.toLowerCase().replace(/^#/,"")).length&&(t=t.split("").map(function(t){return t+t}).join("")),/^([\da-f]{6})$/i.test(t)?{r:parseInt(t.substring(0,2),16)/e,g:parseInt(t.substring(2,4),16)/e,b:parseInt(t.substring(4,6),16)/e}:null}function Q(t){var e=V(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:255);return[e.r,e.g,e.b]}function Y(t,e,n){return t+(e-t)*n}function K(t){return t*(y/180)}function W(t){var e=2*y;return(t%e+e)%e}function $(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=0,i=function(){if(Object.prototype.hasOwnProperty.call(n,a)){var t=void 0!==r[a]?r[a]:1,i=e[a],s=n[a],c=0;"number"==typeof s&&"number"==typeof i?c=Math.abs(s-i):Array.isArray(s)&&Array.isArray(i)&&(c=Math.hypot.apply(Math,T(s.map(function(t,e){return t-(i[e]||0)})))),o+=t*c}};for(var a in n)i();return Math.round(t*o)}function tt(t){return et.apply(this,arguments)}function et(){var t;return t=g().m(function t(e){return g().w(function(t){for(;;)if(0===t.n)return t.a(2,new Promise(function(t){return setTimeout(t,e)}))},t)}),et=function(){var e=this,n=arguments;return new Promise(function(r,o){var i=t.apply(e,n);function a(t){_(i,r,o,a,s,"next",t)}function s(t){_(i,r,o,a,s,"throw",t)}a(void 0)})},et.apply(this,arguments)}function nt(t){Array.isArray(t)&&(t.forEach(function(t){t.parentNode&&t.parentNode.removeChild(t)}),t.length=0)}function rt(t){return rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rt(t)}function ot(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,it(r.key),r)}}function it(t){var e=function(t,e){if("object"!=rt(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=rt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==rt(e)?e:e+""}var at=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvas=e,this.gl=this.canvas.getContext("webgl",{antialias:!1,alpha:!1,depth:!1,stencil:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance"}),this.gl?(this.onWebGLContextLost=this.onWebGLContextLost.bind(this),this.canvas.addEventListener("webglcontextlost",this.onWebGLContextLost)):alert("WebGL is not supported by your browser or crashed.")},(e=[{key:"onWebGLContextLost",value:function(t){t.preventDefault(),this.init()}},{key:"init",value:function(){throw new Error("Not implemented")}},{key:"draw",value:function(){throw new Error("Not implemented")}},{key:"reset",value:function(){throw new Error("Not implemented")}},{key:"destroy",value:function(){this.gl=null,this.canvas=null}}])&&ot(t.prototype,e),n&&ot(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n}();function st(t){return st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},st(t)}function ct(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var c=r&&r.prototype instanceof s?r:s,l=Object.create(c.prototype);return lt(l,"_invoke",function(n,r,o){var i,s,c,l=0,u=o||[],f=!1,d={p:0,n:0,v:t,a:h,f:h.bind(t,4),d:function(e,n){return i=e,s=0,c=t,d.n=n,a}};function h(n,r){for(s=n,c=r,e=0;!f&&l&&!o&&e<u.length;e++){var o,i=u[e],h=d.p,m=i[2];n>3?(o=m===r)&&(c=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=t):i[0]<=h&&((o=n<2&&h<i[1])?(s=0,d.v=r,d.n=i[1]):h<m&&(o=n<3||i[0]>r||r>m)&&(i[4]=n,i[5]=r,d.n=m,s=0))}if(o||n>1)return a;throw f=!0,r}return function(o,u,m){if(l>1)throw TypeError("Generator is already running");for(f&&1===u&&h(u,m),s=u,c=m;(e=s<2?t:c)||!f;){i||(s?s<3?(s>1&&(d.n=-1),h(s,c)):d.n=c:d.v=c);try{if(l=2,i){if(s||(o="next"),e=i[o]){if(!(e=e.call(i,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,s<2&&(s=0)}else 1===s&&(e=i.return)&&e.call(i),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);i=t}else if((e=(f=d.n<0)?c:n.call(r,d))!==a)break}catch(e){i=t,s=1,c=e}finally{l=1}}return{value:e,done:f}}}(n,o,i),!0),l}var a={};function s(){}function c(){}function l(){}e=Object.getPrototypeOf;var u=[][r]?e(e([][r]())):(lt(e={},r,function(){return this}),e),f=l.prototype=s.prototype=Object.create(u);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,lt(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return c.prototype=l,lt(f,"constructor",l),lt(l,"constructor",c),c.displayName="GeneratorFunction",lt(l,o,"GeneratorFunction"),lt(f),lt(f,o,"Generator"),lt(f,r,function(){return this}),lt(f,"toString",function(){return"[object Generator]"}),(ct=function(){return{w:i,m:d}})()}function lt(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}lt=function(t,e,n,r){function i(e,n){lt(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},lt(t,e,n,r)}function ut(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function ft(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var i=t.apply(e,n);function a(t){ut(i,r,o,a,s,"next",t)}function s(t){ut(i,r,o,a,s,"throw",t)}a(void 0)})}}function dt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,a,s=[],c=!0,l=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(s.push(r.value),s.length!==e);c=!0);}catch(t){l=!0,o=t}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return s}}(t,e)||mt(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ht(t){return function(t){if(Array.isArray(t))return pt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||mt(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function mt(t,e){if(t){if("string"==typeof t)return pt(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?pt(t,e):void 0}}function pt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function vt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,yt(r.key),r)}}function yt(t){var e=function(t,e){if("object"!=st(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=st(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==st(e)?e:e+""}function gt(t,e,n){return e=Tt(e),function(t,e){if(e&&("object"==st(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,bt()?Reflect.construct(e,n||[],Tt(t).constructor):e.apply(t,n))}function bt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(bt=function(){return!!t})()}function _t(){return _t="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=Tt(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},_t.apply(null,arguments)}function Tt(t){return Tt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Tt(t)}function Et(t,e){return Et=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Et(t,e)}var At=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=gt(this,e,[t])).MAX_ITER=2e3,n.DEFAULT_ROTATION=0,n.DEFAULT_ZOOM=3,n.DEFAULT_PAN=[0,0],n.DEFAULT_PALETTE=[1,1,1],n.MAX_ZOOM=1e-80,n.MIN_ZOOM=40,n.PRESETS=[],n.zoom=n.DEFAULT_ZOOM,n.pan=ht(n.DEFAULT_PAN),n.panDD={x:R(n.pan[0],0),y:R(n.pan[1],0)},n.rotation=n.DEFAULT_ROTATION,n.currentPanAnimationFrame=null,n.currentZoomAnimationFrame=null,n.currentRotationAnimationFrame=null,n.currentColorAnimationFrame=null,n._colorAnimationResolve=null,n.demoActive=!1,n.currentPresetIndex=0,n.interactionActive=!1,n.interactionTimer=null,n.iterations=0,n.extraIterations=0,n.adaptiveQualityLastAdjustment=0,n.adaptiveQualityEnabled=true,n.adaptiveQualityMin=s,n.colorPalette=ht(n.DEFAULT_PALETTE),n._uniformCache={resW:-1,resH:-1,pan0:NaN,pan1:NaN,zoom:NaN,rotation:NaN,iterations:NaN,color0:NaN,color1:NaN,color2:NaN},n.vertexShaderSource="/*\r\n * Vertex Shader Initializer\r\n * @author    Radim Brnka\r\n * @project   Synaptory Fractal Traveler\r\n * @copyright 2025-2026\r\n * @license   MIT\r\n */\r\n\r\nprecision mediump float;\r\nattribute vec4 a_position;\r\n\r\nvoid main() {\r\n    gl_Position = a_position;\r\n}",n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Et(t,e)}(e,t),n=e,r=[{key:"markOrbitDirty",value:function(){}},{key:"invalidateUniformCache",value:function(){this._uniformCache.resW=-1,this._uniformCache.resH=-1,this._uniformCache.pan0=NaN,this._uniformCache.pan1=NaN,this._uniformCache.zoom=NaN,this._uniformCache.rotation=NaN,this._uniformCache.iterations=NaN,this._uniformCache.color0=NaN,this._uniformCache.color1=NaN,this._uniformCache.color2=NaN}},{key:"getPan",value:function(){return[this.pan[0],this.pan[1]]}},{key:"setPan",value:function(t,e){U(this.panDD.x,t),U(this.panDD.y,e),this.pan[0]=B(this.panDD.x),this.pan[1]=B(this.panDD.y)}},{key:"addPan",value:function(t,e){j(this.panDD.x,t),j(this.panDD.y,e),this.pan[0]=B(this.panDD.x),this.pan[1]=B(this.panDD.y)}},{key:"setPanFromAnchor",value:function(t,e,n,r){var o=t-n*this.zoom,i=e-r*this.zoom;this.setPan(o,i)}},{key:"setZoomKeepingAnchor",value:function(t,e,n){var r=dt(this.screenToViewVector(e,n),2),o=r[0],i=r[1],a=this.zoom-t;this.addPan(o*a,i*a),this.zoom=t}},{key:"noteInteraction",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:160;this.interactionActive=!0,this._lastInteractionTime=performance.now(),this.interactionTimer&&(clearTimeout(this.interactionTimer),this.interactionTimer=null),this.interactionTimer=setTimeout(function(){t.interactionActive=!1,t.markOrbitDirty(),t.draw(),fi(!0)},e)}},{key:"destroy",value:function(){var t,n,r,o,i;this.stopAllNonColorAnimations(),this.stopCurrentColorAnimations(),this.canvas&&this.canvas.removeEventListener("webglcontextlost",this.onWebGLContextLost),this.program&&(this.gl.deleteProgram(this.program),this.program=null),this.vertexShader&&(this.gl.deleteShader(this.vertexShader),this.vertexShader=null),this.fragmentShader&&(this.gl.deleteShader(this.fragmentShader),this.fragmentShader=null),this.interactionTimer&&(clearTimeout(this.interactionTimer),this.interactionTimer=null),(t=e,n="destroy",r=this,i=_t(Tt(1&(o=3)?t.prototype:t),n,r),2&o&&"function"==typeof i?function(t){return i.apply(r,t)}:i)([])}},{key:"generatePresetIDs",value:function(){this.PRESETS.forEach(function(t,e){t.index=e})}},{key:"init",value:function(){this.generatePresetIDs(),this.initGLProgram(),this.draw()}},{key:"resizeCanvas",value:function(){i("resizeCanvas",this.constructor.name),this.gl.useProgram(this.program);var t=this.canvas.getBoundingClientRect(),e=t.width/2,n=t.height/2,r=dt(this.screenToFractal(e,n),2),o=r[0],a=r[1],s=window.devicePixelRatio||1;this.canvas.width=Math.floor(t.width*s),this.canvas.height=Math.floor(t.height*s),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.resolutionLoc&&this.gl.uniform2f(this.resolutionLoc,this.canvas.width,this.canvas.height);var c=dt(this.screenToViewVector(e,n),2),l=c[0],u=c[1];this.setPanFromAnchor(o,a,l,u),this.markOrbitDirty(),this.draw()}},{key:"createFragmentShaderSource",value:function(){throw new Error("The draw method must be implemented in child classes")}},{key:"compileShader",value:function(t,e){var n=this.gl.createShader(e);return this.gl.shaderSource(n,t),this.gl.compileShader(n),this.gl.getShaderParameter(n,this.gl.COMPILE_STATUS)?n:(this.gl.deleteShader(n),null)}},{key:"initGLProgram",value:function(){this.program&&this.gl.deleteProgram(this.program),this.fragmentShader&&this.gl.deleteShader(this.fragmentShader),this.vertexShader||(this.vertexShader=this.compileShader(this.vertexShaderSource,this.gl.VERTEX_SHADER)),this.fragmentShader=this.compileShader(this.createFragmentShaderSource(),this.gl.FRAGMENT_SHADER),this.program=this.gl.createProgram(),this.gl.attachShader(this.program,this.vertexShader),this.gl.attachShader(this.program,this.fragmentShader),this.gl.linkProgram(this.program),this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS),this.gl.useProgram(this.program);var t=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t);var e=new Float32Array([-1,-1,1,-1,-1,1,1,1]);this.gl.bufferData(this.gl.ARRAY_BUFFER,e,this.gl.STATIC_DRAW);var n=this.gl.getAttribLocation(this.program,"a_position");this.gl.enableVertexAttribArray(n),this.gl.vertexAttribPointer(n,2,this.gl.FLOAT,!1,0,0),this.updateUniforms(),this.invalidateUniformCache(),"function"==typeof this.onProgramCreated&&this.onProgramCreated()}},{key:"onProgramCreated",value:function(){throw new Error("The onProgramCreated method must be implemented in child classes")}},{key:"needsRebase",value:function(){throw new Error("The needsRebase method must be implemented in child classes")}},{key:"updateUniforms",value:function(){this.gl.useProgram(this.program),this.panLoc=this.gl.getUniformLocation(this.program,"u_pan"),this.zoomLoc=this.gl.getUniformLocation(this.program,"u_zoom"),this.iterLoc=this.gl.getUniformLocation(this.program,"u_iterations"),this.colorLoc=this.gl.getUniformLocation(this.program,"u_colorPalette"),this.rotationLoc=this.gl.getUniformLocation(this.program,"u_rotation"),this.resolutionLoc=this.gl.getUniformLocation(this.program,"u_resolution")}},{key:"draw",value:function(){this.gl.useProgram(this.program);var t=this.canvas.width,e=this.canvas.height,n=this._uniformCache;this.gl.viewport(0,0,t,e),!this.resolutionLoc||n.resW===t&&n.resH===e||(this.gl.uniform2f(this.resolutionLoc,t,e),n.resW=t,n.resH=e),!this.panLoc||n.pan0===this.pan[0]&&n.pan1===this.pan[1]||(this.gl.uniform2fv(this.panLoc,this.pan),n.pan0=this.pan[0],n.pan1=this.pan[1]),this.zoomLoc&&n.zoom!==this.zoom&&(this.gl.uniform1f(this.zoomLoc,this.zoom),n.zoom=this.zoom),this.rotationLoc&&n.rotation!==this.rotation&&(this.gl.uniform1f(this.rotationLoc,this.rotation),n.rotation=this.rotation),this.iterLoc&&n.iterations!==this.iterations&&(this.gl.uniform1f(this.iterLoc,this.iterations),n.iterations=this.iterations),!this.colorLoc||n.color0===this.colorPalette[0]&&n.color1===this.colorPalette[1]&&n.color2===this.colorPalette[2]||(this.gl.uniform3fv(this.colorLoc,this.colorPalette),n.color0=this.colorPalette[0],n.color1=this.colorPalette[1],n.color2=this.colorPalette[2]),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),null==Mo||Mo.beginGpuTimer(),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),null==Mo||Mo.endGpuTimer(),this.adjustAdaptiveQuality()}},{key:"adjustAdaptiveQuality",value:function(){if(this.adaptiveQualityEnabled&&null!=Mo&&Mo.perf){var t=Mo.perf.gpuMsSmoothed;if(Number.isFinite(t)&&!this.interactionActive){var e=performance.now();if(!(e-this.adaptiveQualityLastAdjustment<500))if(t>40){var n=Math.max(this.adaptiveQualityMin,this.extraIterations-50);n!==this.extraIterations&&(this.extraIterations=n,this.adaptiveQualityLastAdjustment=e)}else if(t<a&&this.extraIterations<0){var r=Math.min(0,this.extraIterations+50);r!==this.extraIterations&&(this.extraIterations=r,this.adaptiveQualityLastAdjustment=e)}}}}},{key:"toggleAdaptiveQuality",value:function(){this.adaptiveQualityEnabled=!this.adaptiveQualityEnabled,this.adaptiveQualityEnabled||(this.extraIterations=0),i("Adaptive quality: ".concat(this.adaptiveQualityEnabled?"ON":"OFF"),this.constructor.name),this.draw()}},{key:"adjustAdaptiveQualityMin",value:function(t){var e=this.adaptiveQualityMin;this.adaptiveQualityMin=Math.max(-3e3,Math.min(-100,this.adaptiveQualityMin+t)),this.extraIterations<this.adaptiveQualityMin&&(this.extraIterations=this.adaptiveQualityMin),i("Adaptive quality min: ".concat(e," → ").concat(this.adaptiveQualityMin," (delta: ").concat(t>0?"+":"").concat(t,")"),this.constructor.name),this.draw()}},{key:"adjustExtraIterations",value:function(t){var e=this.extraIterations,n=Math.abs(this.adaptiveQualityMin);this.extraIterations=Math.max(this.adaptiveQualityMin,Math.min(n,this.extraIterations+t)),e!==this.extraIterations&&(i("extraIterations: ".concat(e," → ").concat(this.extraIterations," (delta: ").concat(t>0?"+":"").concat(t,")"),this.constructor.name),this.draw())}},{key:"reset",value:function(){this.stopAllNonColorAnimations(),this.stopCurrentColorAnimations(),this.colorPalette=ht(this.DEFAULT_PALETTE),this.setPan(this.DEFAULT_PAN[0],this.DEFAULT_PAN[1]),this.zoom=this.DEFAULT_ZOOM,this.rotation=this.DEFAULT_ROTATION,this.extraIterations=0,this.currentPresetIndex=0,this.resizeCanvas(),this.markOrbitDirty(),this.draw(),fi()}},{key:"screenToFractal",value:function(t,e){var n=window.devicePixelRatio||1,r=this.canvas.getBoundingClientRect(),o=r.width*n,i=r.height*n,a=t*n/o-.5,s=1-e*n/i-.5;a*=o/i;var c=Math.cos(this.rotation),l=Math.sin(this.rotation),u=l*a+c*s;return[(c*a-l*s)*this.zoom+this.pan[0],u*this.zoom+this.pan[1]]}},{key:"screenToPanDelta",value:function(t,e){var n=dt(this.screenToViewVector(t,e),2),r=n[0],o=n[1];return[r*this.zoom,o*this.zoom]}},{key:"screenToViewVector",value:function(t,e){var n=window.devicePixelRatio||1,r=this.canvas.getBoundingClientRect(),o=r.width*n,i=r.height*n,a=t*n/o-.5,s=1-e*n/i-.5;a*=o/i;var c=Math.cos(this.rotation),l=Math.sin(this.rotation);return[c*a-l*s,l*a+c*s]}},{key:"getCanvasCssCenter",value:function(){var t=this.canvas.getBoundingClientRect();return[t.width/2,t.height/2]}},{key:"stopAllNonColorAnimations",value:function(){this.stopCurrentPanAnimation(),this.stopCurrentZoomAnimation(),this.stopCurrentRotationAnimation()}},{key:"stopCurrentPanAnimation",value:function(){null!==this.currentPanAnimationFrame&&(cancelAnimationFrame(this.currentPanAnimationFrame),this.currentPanAnimationFrame=null)}},{key:"stopCurrentZoomAnimation",value:function(){null!==this.currentZoomAnimationFrame&&(cancelAnimationFrame(this.currentZoomAnimationFrame),this.currentZoomAnimationFrame=null)}},{key:"stopCurrentRotationAnimation",value:function(){null!==this.currentRotationAnimationFrame&&(cancelAnimationFrame(this.currentRotationAnimationFrame),this.currentRotationAnimationFrame=null)}},{key:"stopCurrentColorAnimations",value:function(){var t=this.paletteCyclingActive&&!this._inPaletteCycleTransition;if(this.paletteCyclingActive&&!this._inPaletteCycleTransition&&(this.paletteCyclingActive=!1,this.paletteCyclingTimeoutId&&(clearTimeout(this.paletteCyclingTimeoutId),this.paletteCyclingTimeoutId=null)),null!==this.currentColorAnimationFrame&&(cancelAnimationFrame(this.currentColorAnimationFrame),clearTimeout(this.currentColorAnimationFrame),this.currentColorAnimationFrame=null),this._colorAnimationResolve&&(this._colorAnimationResolve(),this._colorAnimationResolve=null),t&&"undefined"!=typeof window){var e=document.getElementById("palette-cycle");e&&e.classList.remove("active")}}},{key:"stopDemo",value:function(){this.demoActive=!1,this.stopAllNonColorAnimations()}},{key:"onAnimationFinished",value:function(){setTimeout(function(){return fi()},50)}},{key:"animateColorPaletteTransition",value:(w=ft(ct().m(function t(e){var n,r,o,i=this,a=arguments;return ct().w(function(t){for(;;)switch(t.n){case 0:if(n=a.length>1&&void 0!==a[1]?a[1]:250,r=a.length>2&&void 0!==a[2]?a[2]:null,this.stopCurrentColorAnimations(),!q(this.colorPalette,e)){t.n=1;break}return t.a(2);case 1:return o=ht(this.colorPalette),t.n=2,new Promise(function(t){i._colorAnimationResolve=t;var a=null,s=function(c){a||(a=c);var l=Math.min((c-a)/n,1);i.colorPalette=[Y(o[0],e[0],l),Y(o[1],e[1],l),Y(o[2],e[2],l)],i.draw(),r&&r(),l<1?i.currentColorAnimationFrame=requestAnimationFrame(s):(i._colorAnimationResolve=null,i.stopCurrentColorAnimations(),t())};i.currentColorAnimationFrame=requestAnimationFrame(s)});case 2:return t.a(2)}},t,this)})),function(t){return w.apply(this,arguments)})},{key:"animateFullColorSpaceCycle",value:(A=ft(ct().m(function t(){var e,n,r,o,i,a=this,s=arguments;return ct().w(function(t){for(;;)switch(t.n){case 0:return e=s.length>0&&void 0!==s[0]?s[0]:15e3,n=s.length>1&&void 0!==s[1]?s[1]:null,this.stopCurrentColorAnimations(),r=this.colorPalette,o=J(r[0],r[1],r[2]),i=o[0],t.n=1,new Promise(function(){var t=null,r=function(o){t||(t=o);var s=Math.min((o-t)/e,1),c=(i+s)%1;a.colorPalette=H(c,1,.6),a.draw(),n&&n(),a.currentColorAnimationFrame=requestAnimationFrame(r)};a.currentColorAnimationFrame=requestAnimationFrame(r)});case 1:return t.a(2)}},t,this)})),function(){return A.apply(this,arguments)})},{key:"startPaletteCycling",value:(E=ft(ct().m(function t(){var e,n,r,o,i,a,s,c=this,l=arguments;return ct().w(function(t){for(;;)switch(t.n){case 0:if(e=l.length>0&&void 0!==l[0]?l[0]:2e3,n=l.length>1&&void 0!==l[1]?l[1]:3e3,r=l.length>2&&void 0!==l[2]?l[2]:null,o=l.length>3&&void 0!==l[3]?l[3]:null,this.stopCurrentColorAnimations(),this.PALETTES&&0!==this.PALETTES.length){t.n=1;break}return t.a(2);case 1:return this.paletteCyclingActive=!0,"undefined"!=typeof window&&(i=document.getElementById("palette-cycle"))&&!i.classList.contains("active")&&i.classList.add("active"),a=(this.currentPaletteIndex>=0?this.currentPaletteIndex+1:1)%this.PALETTES.length,s=function(){var t=ft(ct().m(function t(){return ct().w(function(t){for(;;)switch(t.n){case 0:if(c.paletteCyclingActive){t.n=1;break}return t.a(2);case 1:return c._inPaletteCycleTransition=!0,t.n=2,c.applyPaletteByIndex(a,e,r);case 2:if(c._inPaletteCycleTransition=!1,c.paletteCyclingActive&&o&&o(),c.paletteCyclingActive){t.n=3;break}return t.a(2);case 3:a=(a+1)%c.PALETTES.length,c.paletteCyclingTimeoutId=setTimeout(function(){c.paletteCyclingActive&&s()},n);case 4:return t.a(2)}},t)}));return function(){return t.apply(this,arguments)}}(),this.currentColorAnimationFrame=1,t.n=2,s();case 2:return t.a(2)}},t,this)})),function(){return E.apply(this,arguments)})},{key:"animatePaletteByIdTransition",value:(T=ft(ct().m(function t(e,n){var r,o,a=arguments;return ct().w(function(t){for(;;)switch(t.n){case 0:if(r=a.length>2&&void 0!==a[2]?a[2]:null,!e.paletteId){t.n=4;break}if(i('Preset palette definition found: "'.concat(e.paletteId,'"')),!((o=this.PALETTES.findIndex(function(t){return t.id===e.paletteId}))>=0)){t.n=2;break}return t.n=1,this.applyPaletteByIndex(o,n,r);case 1:t.n=3;break;case 2:case 3:t.n=5;break;case 4:i("Preset palette definition not found, keeping current palette.");case 5:case 6:return t.a(2)}},t,this)})),function(t,e){return T.apply(this,arguments)})},{key:"animatePanTo",value:(_=ft(ct().m(function t(e){var n,r,o,i=this,a=arguments;return ct().w(function(t){for(;;)switch(t.n){case 0:if(n=a.length>1&&void 0!==a[1]?a[1]:200,r=a.length>2&&void 0!==a[2]?a[2]:l.NONE,this.stopCurrentPanAnimation(),this.markOrbitDirty(),!G(this.pan,e,6)){t.n=1;break}return t.a(2);case 1:return o=ht(this.pan),t.n=2,new Promise(function(t){var a=null,s=function(c){a||(a=c);var l=Math.min((c-a)/n,1),u=r(l),f=Y(o[0],e[0],u),d=Y(o[1],e[1],u);i.setPan(f,d),i.draw(),fi(!0),l<1?i.currentPanAnimationFrame=requestAnimationFrame(s):(i.markOrbitDirty(),i.draw(),i.stopCurrentPanAnimation(),i.onAnimationFinished(),t())};i.currentPanAnimationFrame=requestAnimationFrame(s)});case 2:return t.a(2)}},t,this)})),function(t){return _.apply(this,arguments)})},{key:"animatePanBy",value:(b=ft(ct().m(function t(e){var n,r,o=this,i=arguments;return ct().w(function(t){for(;;)switch(t.n){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:200,r=i.length>2&&void 0!==i[2]?i[2]:l.NONE,this.stopCurrentPanAnimation(),this.markOrbitDirty(),!(Math.abs(e[0])<1e-30&&Math.abs(e[1])<1e-30)){t.n=1;break}return t.a(2);case 1:return t.n=2,new Promise(function(t){var i=null,a=0,s=function(c){i||(i=c);var l=Math.min((c-i)/n,1),u=r(l),f=u-a;a=u,0!==f&&o.addPan(e[0]*f,e[1]*f),o.draw(),fi(!0),l<1?o.currentPanAnimationFrame=requestAnimationFrame(s):(o.markOrbitDirty(),o.draw(),o.stopCurrentPanAnimation(),o.onAnimationFinished(),t())};o.currentPanAnimationFrame=requestAnimationFrame(s)});case 2:return t.a(2)}},t,this)})),function(t){return b.apply(this,arguments)})},{key:"animateZoomTo",value:(g=ft(ct().m(function t(e){var n,r,o,i,a,s,c,u,f,d,h,m,p,v,y,g,b=this,_=arguments;return ct().w(function(t){for(;;)switch(t.n){case 0:if(n=_.length>1&&void 0!==_[1]?_[1]:500,r=_.length>2&&void 0!==_[2]?_[2]:l.NONE,o=_.length>3&&void 0!==_[3]?_[3]:null,i=_.length>4&&void 0!==_[4]?_[4]:null,this.stopCurrentZoomAnimation(),this.zoom.toFixed(20)!==e.toFixed(20)){t.n=1;break}return t.a(2);case 1:return null!==o&&null!==i||(a=this.getCanvasCssCenter(),s=dt(a,2),c=s[0],u=s[1],o=c,i=u),f=this.zoom,d=e/f,h=this.screenToViewVector(o,i),m=dt(h,2),p=m[0],v=m[1],y=p*f+this.pan[0],g=v*f+this.pan[1],this.markOrbitDirty(),t.n=2,new Promise(function(t){var o=null,i=function(a){o||(o=a);var s=Math.min((a-o)/n,1);if(r!==l.NONE){var c=r(s);b.zoom=f+(e-f)*c}else b.zoom=f*Math.pow(d,s);b.setPanFromAnchor(y,g,p,v),b.markOrbitDirty(),b.draw(),fi(!0),s<1?b.currentZoomAnimationFrame=requestAnimationFrame(i):(b.markOrbitDirty(),b.draw(),b.stopCurrentZoomAnimation(),b.onAnimationFinished(),t())};b.currentZoomAnimationFrame=requestAnimationFrame(i)});case 2:return t.a(2)}},t,this)})),function(t){return g.apply(this,arguments)})},{key:"animateZoomToNoPan",value:(v=ft(ct().m(function t(e){var n,r,o,i=this,a=arguments;return ct().w(function(t){for(;;)switch(t.n){case 0:if(n=a.length>1&&void 0!==a[1]?a[1]:500,r=a.length>2&&void 0!==a[2]?a[2]:l.NONE,this.stopCurrentZoomAnimation(),this.markOrbitDirty(),this.zoom.toFixed(20)!==e.toFixed(20)){t.n=1;break}return t.a(2);case 1:return o=this.zoom,t.n=2,new Promise(function(t){var a=null,s=function(c){a||(a=c);var u=Math.min((c-a)/n,1);if(r!==l.NONE){var f=r(u);i.zoom=o+(e-o)*f}else i.zoom=o*Math.pow(e/o,u);i.draw(),fi(!0),u<1?i.currentZoomAnimationFrame=requestAnimationFrame(s):(i.markOrbitDirty(),i.draw(),i.stopCurrentZoomAnimation(),i.onAnimationFinished(),t())};i.currentZoomAnimationFrame=requestAnimationFrame(s)});case 2:return t.a(2)}},t,this)})),function(t){return v.apply(this,arguments)})},{key:"animateRotationTo",value:(p=ft(ct().m(function t(e){var n,r,o,i=this,a=arguments;return ct().w(function(t){for(;;)switch(t.n){case 0:if(n=a.length>1&&void 0!==a[1]?a[1]:500,r=a.length>2&&void 0!==a[2]?a[2]:l.NONE,this.stopCurrentRotationAnimation(),this.rotation.toFixed(6)!==e.toFixed(6)){t.n=1;break}return t.a(2);case 1:return o=this.rotation,t.n=2,new Promise(function(t){var a=null,s=function(c){a||(a=c);var l=Math.min((c-a)/n,1),u=r(l);i.rotation=Y(o,e,u),i.draw(),fi(!0),l<1?i.currentRotationAnimationFrame=requestAnimationFrame(s):(i.rotation=W(i.rotation),i.draw(),i.stopCurrentRotationAnimation(),i.onAnimationFinished(),t())};i.currentRotationAnimationFrame=requestAnimationFrame(s)});case 2:return t.a(2)}},t,this)})),function(t){return p.apply(this,arguments)})},{key:"animatePanThenZoomTo",value:(m=ft(ct().m(function t(e,n,r,o){var i,a=arguments;return ct().w(function(t){for(;;)switch(t.n){case 0:return i=a.length>4&&void 0!==a[4]?a[4]:l.NONE,t.n=1,this.animatePanTo(e,r,i);case 1:return t.n=2,this.animateZoomTo(n,o,i);case 2:case 3:return t.a(2)}},t,this)})),function(t,e,n,r){return m.apply(this,arguments)})},{key:"animatePanAndZoomTo",value:(h=ft(ct().m(function t(e,n){var r,o,i=arguments;return ct().w(function(t){for(;;)switch(t.n){case 0:return r=i.length>2&&void 0!==i[2]?i[2]:1e3,o=i.length>3&&void 0!==i[3]?i[3]:l.NONE,t.n=1,Promise.all([this.animatePanTo(e,r,o),this.animateZoomToNoPan(n,r,o)]);case 1:case 2:return t.a(2)}},t,this)})),function(t,e){return h.apply(this,arguments)})},{key:"animatePanByAndZoomTo",value:(d=ft(ct().m(function t(e,n){var r,o,i=arguments;return ct().w(function(t){for(;;)switch(t.n){case 0:return r=i.length>2&&void 0!==i[2]?i[2]:1e3,o=i.length>3&&void 0!==i[3]?i[3]:l.NONE,t.n=1,Promise.all([this.animatePanBy(e,r,o),this.animateZoomToNoPan(n,r,o)]);case 1:case 2:return t.a(2)}},t,this)})),function(t,e){return d.apply(this,arguments)})},{key:"animateZoomRotationTo",value:(f=ft(ct().m(function t(e,n){var r,o,i=arguments;return ct().w(function(t){for(;;)switch(t.n){case 0:return r=i.length>2&&void 0!==i[2]?i[2]:500,o=i.length>3&&void 0!==i[3]?i[3]:l.NONE,t.n=1,Promise.all([this.animateZoomTo(e,r,o),this.animateRotationTo(n,r,l.CUBIC)]);case 1:case 2:return t.a(2)}},t,this)})),function(t,e){return f.apply(this,arguments)})},{key:"animatePanZoomRotationTo",value:(u=ft(ct().m(function t(e,n,r){var o,i,a=arguments;return ct().w(function(t){for(;;)switch(t.n){case 0:return o=a.length>3&&void 0!==a[3]?a[3]:500,i=a.length>4&&void 0!==a[4]?a[4]:l.NONE,t.n=1,Promise.all([this.animatePanTo(e,o,i),this.animateZoomToNoPan(n,o,i),this.animateRotationTo(r,o,i)]);case 1:case 2:return t.a(2)}},t,this)})),function(t,e,n){return u.apply(this,arguments)})},{key:"animateInfiniteRotation",value:(c=ft(ct().m(function t(e){var n,r,o=this,i=arguments;return ct().w(function(t){for(;;)switch(t.n){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:.001,this.stopCurrentRotationAnimation(),r=e>=0?1:-1,t.n=1,new Promise(function(){var t=function(){o.rotation=W(o.rotation+r*n+2*y),o.draw(),fi(!0),o.currentRotationAnimationFrame=requestAnimationFrame(t)};o.currentRotationAnimationFrame=requestAnimationFrame(t)});case 1:case 2:return t.a(2)}},t,this)})),function(t){return c.apply(this,arguments)})}],r&&vt(n.prototype,r),o&&vt(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o,c,u,f,d,h,m,p,v,g,b,_,T,E,A,w}(at);const wt=At,Pt=JSON.parse('{"l8":[{"id":"Kissing Dragons","c":[-0.835,-0.232],"zoom":3.5,"rotation":150,"pan":[0,0],"paletteId":"Event Horizon"},{"id":"Tentacles","c":[-0.8,0.156],"zoom":3.5,"rotation":0,"pan":[0,0],"paletteId":"Supernova Remnant"},{"id":"Seahorses","c":[-0.7436399999999269,0.13182000000014282],"pan":[0,0],"rotation":0.0022885911618804045,"zoom":0.14420993610649507,"paletteId":"Ocean"},{"id":"Darkness","c":[0.3586059096423313,0.32287599414730545],"pan":[0.10410036735673252,-0.10610085351477151],"rotation":278.6,"zoom":1.8513247913869684},{"id":"Spiral Galaxies","c":[0.34,-0.05],"zoom":3.5,"rotation":90,"pan":[0,0],"paletteId":"Cosmos"},{"id":"Near Julia Border","c":[0.285,0.01],"zoom":3.5,"rotation":90,"pan":[-0.01,0.01],"paletteId":"Deep Nebula"},{"id":"Mandelbrothers","c":[-1.76733,0.00002],"zoom":0.5,"rotation":0,"pan":[0,0],"paletteId":"Electric"},{"id":"Eyes","c":[-0.8606524668610169,-0.2077298359125564],"pan":[0,0],"rotation":3.8711791851711137,"zoom":2.547372330225479,"paletteId":"Solar Flare"},{"id":"Black Holes","c":[-0.4,0.6],"zoom":3.5,"rotation":120,"pan":[0,0],"paletteId":"Event Horizon"},{"id":"Serpent","c":[-1.768967328653661,0.0019446820495425676],"pan":[0,0],"rotation":0,"zoom":0.2589096374896196},{"id":"Dancing Snowflakes","c":[-0.70176,-0.3842],"zoom":3.5,"rotation":150,"pan":[0,0],"paletteId":"Glacial"},{"id":"Brain","c":[-0.5925376099331446,0.6218581017272109],"pan":[0,0],"rotation":135.8,"zoom":0.12255613179332117},{"id":"Main Cardioid","c":[-0.75,0.1],"zoom":3.5,"rotation":150,"pan":[0,0],"paletteId":"Aurora"},{"id":"Clown","c":[-0.7500162952792153,0.0032826017747574765],"zoom":1.7,"rotation":0,"pan":[0,0],"paletteId":"Fire"},{"id":"Flash","c":[-0.281617101877492,0.8393694179369712],"pan":[0.04566737120932678,-0.03301504226768222],"rotation":2.039999999999994,"zoom":1.295789074877871,"paletteId":"Electric"},{"id":"Snowflakes","c":[-0.16475525235629437,0.8374038729291197],"pan":[0,0],"rotation":2.039999999999994,"zoom":2.0868812629815614,"paletteId":"Glacial"},{"id":"Cauliflower Medallion","c":[-1.74876455,0],"zoom":0.45,"rotation":90,"pan":[0,0],"paletteId":"Emerald"},{"id":"Mitochondria","c":[-0.1060055299522249,0.9257297130853293],"rotation":340,"pan":[0,0],"zoom":0.11,"paletteId":"Event Horizon"},{"id":"Mandebulbs","c":[-0.12129038469447653,0.649576297434808],"pan":[0.1045565992379065,0.0073015054986378],"rotation":313.6,"zoom":1.6581189769919353,"paletteId":"Cyber Sunset"},{"id":"Elephants","c":[-0.1,0.651],"zoom":3.5,"rotation":90,"pan":[0,0],"paletteId":"Electric"},{"id":"Sunflowers","c":[-0.246,0.64235],"zoom":2,"rotation":0,"pan":[0,0],"paletteId":"Solar Flare"},{"id":"Tree Snakes","c":[-1.25066,0.02012],"zoom":3.5,"rotation":0,"pan":[0,0],"paletteId":"Forest"},{"id":"Chromosome","c":[0.1294753560021048,0.6256313013048348],"pan":[0,0],"rotation":110.58,"zoom":1.322314018297482,"paletteId":"Electric"},{"id":"Misiurewicz Point","c":[0.3072075408559901,0.48395526205533185],"pan":[0,0],"rotation":310.15,"zoom":2.1068875547385417},{"id":"Flowers","c":[-1.768927341692215,-0.009640117346988308],"pan":[0,0],"rotation":0,"zoom":0.29302566239489597,"paletteId":"Deep Nebula"},{"id":"Black Holes","c":[0.3633977303405407,0.3166912692104581],"pan":[0.12908510596292824,-0.13588306846615342],"rotation":97.4,"zoom":0.12982442828873209,"paletteId":"Event Horizon"}],"gf":[{"id":"Orbiting Black holes","pan":[0,0],"rotation":0,"zoom":1.7,"startC":[-0.246,0.64],"step":0.000005,"cxDirection":1,"cyDirection":1,"endC":[-0.2298,0.67],"paletteId":"Event Horizon"},{"id":"Dimensional Collision","pan":[0,0],"startC":[-0.25190652273600045,0.637461568487061],"endC":[-0.2526,0.6355],"cxDirection":-1,"cyDirection":-1,"rotation":0,"zoom":0.05,"step":5e-8,"paletteId":"Deep Nebula"},{"id":"Life of a Star","pan":[-0.31106,0.3937],"rotation":85.9,"zoom":0.3829,"startC":[-0.2523,0.6386],"step":0.00001,"cxDirection":-1,"cyDirection":-1,"endC":[-0.335,0.62],"paletteId":"Supernova Remnant"},{"id":"Tipping points","pan":[-0.6838,0.4699],"rotation":0,"zoom":0.0447,"startC":[-0.246,0.6427],"step":5e-7,"cxDirection":-1,"cyDirection":-1,"endC":[-0.247,0.638],"paletteId":"Cosmos"},{"id":"Hypnosis","pan":[0.516,-0.0541],"rotation":150,"zoom":0.1107,"startC":[-0.78,0.11],"step":0.00001,"cxDirection":1,"cyDirection":1,"endC":[-0.7425,0.25],"paletteId":"Aurora"}],"BG":[{"id":"Blue Gold","keyColor":"#f0c219","theme":[0,0,0,1,0.647,0,0,0,0,1,1,1,0,0,0.5]},{"id":"Cosmos","keyColor":"#fefe66","theme":[0,0,0,1,0.647,0,0,0,0,1.2,1.2,1,0.1,0.1,0.1]},{"id":"Fire","keyColor":"#ff900a","theme":[0.4,0.2,0,1,0.565,0.039,0.2,0,0,0.8,0.702,0,0.525,0.122,0.043]},{"id":"Ocean","keyColor":"#e6f3ff","theme":[0.902,0.953,1,0.192,0.553,0.698,0,0.051,0.102,0.016,0.412,0.592,0,0.157,0.302]},{"id":"Forest","keyColor":"#818c3c","theme":[0.506,0.549,0.235,0.537,0.349,0.122,0.176,0.086,0.024,0.098,0.349,0.051,0,0.082,0]},{"id":"Electric","keyColor":"#00E5FF","theme":[0.737,1,1,0,0.6,0.8,0,0,0.2,0.302,1.2,1.4,0,0.102,0.302]},{"id":"Solar Flare","keyColor":"#FF8000","theme":[0,0,0,0.6,0.2,0,1,0.5,0,1.4,0.9,0.2,0.4,0.1,0]},{"id":"Deep Nebula","keyColor":"#e64dff","theme":[0,0,0,0.2,0,0.4,0,0,0,0.902,0.302,1.302,0.322,0.263,0.694]},{"id":"Emerald","keyColor":"#4dff80","theme":[0,0,0,0,0.3,0.1,0,0.1,0,0.3,1.2,0.5,0,0.2,0]},{"id":"Cyber Sunset","keyColor":"#F72585","theme":[0.647,0,0,0.4,0,0.502,0,0,0,1.302,0.6,0.102,0.4,0.102,0]},{"id":"Glacial","keyColor":"#e6ffff","theme":[0,0.1,0.2,0.3,0.5,0.7,0,0,0.1,0.9,1.1,1.3,0.5,0.7,0.9]},{"id":"Aurora","keyColor":"#1acc80","theme":[0.4,1,0.302,0.102,0.8,0.502,0,0,0.024,0.502,0.2,0.902,0,0.035,0.427]},{"id":"Supernova Remnant","keyColor":"#0099e6","theme":[0.247,0.165,0.537,0.902,0.302,0,0,0,0.102,0,0.6,0.902,0,0,0]},{"id":"Event Horizon","keyColor":"#c74a00","theme":[0.859,0.565,0.306,0.18,0.129,0.216,0.067,0.067,0.082,0.467,0,0,0.78,0.29,0]}]}');function xt(t){return xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xt(t)}function Lt(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var c=r&&r.prototype instanceof s?r:s,l=Object.create(c.prototype);return St(l,"_invoke",function(n,r,o){var i,s,c,l=0,u=o||[],f=!1,d={p:0,n:0,v:t,a:h,f:h.bind(t,4),d:function(e,n){return i=e,s=0,c=t,d.n=n,a}};function h(n,r){for(s=n,c=r,e=0;!f&&l&&!o&&e<u.length;e++){var o,i=u[e],h=d.p,m=i[2];n>3?(o=m===r)&&(c=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=t):i[0]<=h&&((o=n<2&&h<i[1])?(s=0,d.v=r,d.n=i[1]):h<m&&(o=n<3||i[0]>r||r>m)&&(i[4]=n,i[5]=r,d.n=m,s=0))}if(o||n>1)return a;throw f=!0,r}return function(o,u,m){if(l>1)throw TypeError("Generator is already running");for(f&&1===u&&h(u,m),s=u,c=m;(e=s<2?t:c)||!f;){i||(s?s<3?(s>1&&(d.n=-1),h(s,c)):d.n=c:d.v=c);try{if(l=2,i){if(s||(o="next"),e=i[o]){if(!(e=e.call(i,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,s<2&&(s=0)}else 1===s&&(e=i.return)&&e.call(i),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);i=t}else if((e=(f=d.n<0)?c:n.call(r,d))!==a)break}catch(e){i=t,s=1,c=e}finally{l=1}}return{value:e,done:f}}}(n,o,i),!0),l}var a={};function s(){}function c(){}function l(){}e=Object.getPrototypeOf;var u=[][r]?e(e([][r]())):(St(e={},r,function(){return this}),e),f=l.prototype=s.prototype=Object.create(u);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,St(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return c.prototype=l,St(f,"constructor",l),St(l,"constructor",c),c.displayName="GeneratorFunction",St(l,o,"GeneratorFunction"),St(f),St(f,o,"Generator"),St(f,r,function(){return this}),St(f,"toString",function(){return"[object Generator]"}),(Lt=function(){return{w:i,m:d}})()}function St(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}St=function(t,e,n,r){function i(e,n){St(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},St(t,e,n,r)}function It(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function Ct(t){return function(t){if(Array.isArray(t))return Dt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Dt(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Dt(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Dt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function kt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ft(r.key),r)}}function Ft(t){var e=function(t,e){if("object"!=xt(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=xt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==xt(e)?e:e+""}function Mt(t,e,n){return e=Nt(e),function(t,e){if(e&&("object"==xt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Ot()?Reflect.construct(e,n||[],Nt(t).constructor):e.apply(t,n))}function Ot(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Ot=function(){return!!t})()}function Rt(t,e,n,r){var o=zt(Nt(1&r?t.prototype:t),e,n);return 2&r&&"function"==typeof o?function(t){return o.apply(n,t)}:o}function zt(){return zt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=Nt(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},zt.apply(null,arguments)}function Nt(t){return Nt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Nt(t)}function jt(t,e){return jt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},jt(t,e)}var Ut=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Mt(this,e,[t])).MAX_ITER=500,n.extraIterations=0,n.DEFAULT_ZOOM=2.5,n.DEFAULT_C=[-.246,.64235],n.zoom=n.DEFAULT_ZOOM,n.pan=Ct(n.DEFAULT_PAN),n.rotation=n.DEFAULT_ROTATION,n.DEFAULT_PALETTE=Pt.BG[0].theme||m.theme,n.colorPalette=Ct(n.DEFAULT_PALETTE),n.c=Ct(n.DEFAULT_C),n.PRESETS=[],n.DIVES=[],n.innerStops=new Float32Array(n.DEFAULT_PALETTE),n.currentCAnimationFrame=null,n.demoTime=0,n.init(),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&jt(t,e)}(e,t),n=e,r=[{key:"createFragmentShaderSource",value:function(){return'/*\r\n * Julia Fragment Shader (Legacy, for preview purposes)\r\n * @author    Radim Brnka\r\n * @project   Synaptory Fractal Traveler\r\n * @copyright 2025-2026\r\n *\r\n * @description\r\n * Julia set basic implementation in mediump float precision\r\n *\r\n * @license   MIT\r\n */\r\n\r\n\r\n#ifdef GL_ES\r\nprecision mediump float;\r\n#endif\r\n\r\n// Uniforms\r\nuniform vec2 u_resolution;// Canvas resolution in pixels\r\nuniform vec2 u_pan;// Pan offset in fractal space\r\nuniform float u_zoom;// Zoom factor\r\nuniform float u_iterations;// For normalizing the smooth iteration count\r\nuniform float u_rotation;// Rotation (in radians)\r\nuniform vec2 u_c;// Julia set constant\r\nuniform vec3 u_colorPalette;// Color palette\r\nuniform vec3 u_innerStops[5];// Color palette inner stops\r\n\r\n// Maximum iterations (compile-time constant required by GLSL ES 1.00).\r\nconst int MAX_ITERATIONS = __MAX_ITER__;\r\n\r\n// Define color stops as individual constants (RGB values in [0,1]).\r\n// Default stops (black, orange, white, blue, dark blue).\r\n\r\n// Interpolates between the five color stops.\r\n// 5 stops = 4 segments.\r\nvec3 getColorFromMap(float t) {\r\n    float segment = 1.0 / 4.0;// 4 segments for 5 stops.\r\n    if (t <= segment) {\r\n        return mix(u_innerStops[0], u_innerStops[1], t / segment);\r\n    } else if (t <= 2.0 * segment) {\r\n        return mix(u_innerStops[1], u_innerStops[2], (t - segment) / segment);\r\n    } else if (t <= 3.0 * segment) {\r\n        return mix(u_innerStops[2], u_innerStops[3], (t - 2.0 * segment) / segment);\r\n    } else {\r\n        return mix(u_innerStops[3], u_innerStops[4], (t - 3.0 * segment) / segment);\r\n    }\r\n}\r\n\r\nvoid main() {\r\n    // Map fragment coordinates to normalized device coordinates\r\n    float aspect = u_resolution.x / u_resolution.y;\r\n    vec2 st = gl_FragCoord.xy / u_resolution;\r\n    st -= 0.5;// center at (0,0)\r\n    st.x *= aspect;// adjust x for aspect ratio\r\n\r\n    // Apply rotation\r\n    float cosR = cos(u_rotation);\r\n    float sinR = sin(u_rotation);\r\n    vec2 rotated = vec2(\r\n    st.x * cosR - st.y * sinR,\r\n    st.x * sinR + st.y * cosR\r\n    );\r\n\r\n    // Map screen coordinates to Julia space\r\n    vec2 z = rotated * u_zoom + u_pan;\r\n\r\n    // Determine escape iterations\r\n    int iterCount = MAX_ITERATIONS;\r\n    for (int i = 0; i < MAX_ITERATIONS; i++) {\r\n        if (dot(z, z) > 4.0) {\r\n            iterCount = i;\r\n            break;\r\n        }\r\n        // Julia set iteration.\r\n        z = vec2(z.x*z.x - z.y*z.y, 2.0*z.x*z.y) + u_c;\r\n    }\r\n\r\n    // If the point never escaped, render as simple color\r\n    if (iterCount == MAX_ITERATIONS) {\r\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\r\n    } else {\r\n        // Compute a smooth iteration value\r\n        float smoothColor = float(iterCount) - log2(log2(dot(z, z)));\r\n        float t = clamp(smoothColor / u_iterations, 0.0, 1.0);\r\n\r\n        // Apply a sine modulation to mimic the "sine" color mapping effect\r\n        // Frequency: 4π\r\n        t = 0.5 + 0.6 * sin(t * 4.0 * 3.14159265);\r\n\r\n        // Lookup the color from the map\r\n        vec3 col = getColorFromMap(t);\r\n\r\n        // Use the user-defined color palette as a tint\r\n        // col *= u_colorPalette;\r\n\r\n        gl_FragColor = vec4(col, 1.0);\r\n    }\r\n}'.replace("__MAX_ITER__",this.MAX_ITER).toString()}},{key:"updateUniforms",value:function(){Rt(e,"updateUniforms",this,3)([]),this.cLoc=this.gl.getUniformLocation(this.program,"u_c"),this.innerStopsLoc=this.gl.getUniformLocation(this.program,"u_innerStops")}},{key:"draw",value:function(){this.gl.useProgram(this.program);var t=Math.floor(3e3*Math.pow(2,-Math.log2(this.zoom)));this.iterations=Math.min(2e3,t+this.extraIterations),this.gl.uniform2fv(this.cLoc,this.c),this.gl.uniform3fv(this.innerStopsLoc,this.innerStops),Rt(e,"draw",this,3)([])}},{key:"reset",value:function(){this.c=Ct(this.DEFAULT_C),this.colorPalette=Ct(this.DEFAULT_PALETTE),this.innerStops=new Float32Array(this.colorPalette),this.extraIterations=0,this.draw()}},{key:"animateColorPaletteTransition",value:(i=Lt().m(function t(e){var n,r=arguments;return Lt().w(function(t){for(;;)switch(t.n){case 0:if(n=r.length>2&&void 0!==r[2]?r[2]:null,e){t.n=1;break}return t.a(2,Promise.resolve());case 1:return this.innerStops=new Float32Array(e),this.colorPalette=[1.5*e[9],1.5*e[10],1.5*e[11]],this.draw(),n&&n(),t.a(2,Promise.resolve())}},t,this)}),a=function(){var t=this,e=arguments;return new Promise(function(n,r){var o=i.apply(t,e);function a(t){It(o,n,r,a,s,"next",t)}function s(t){It(o,n,r,a,s,"throw",t)}a(void 0)})},function(t){return a.apply(this,arguments)})},{key:"needsRebase",value:function(){return!1}},{key:"onProgramCreated",value:function(){}}],r&&kt(n.prototype,r),o&&kt(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o,i,a}(wt),Bt=null,Xt=null,Zt=!1,Gt=null,qt=250,Ht=200;function Jt(){(Bt=document.getElementById("floatingCanvas"))&&(Bt.width=qt*window.devicePixelRatio,Bt.height=Ht*window.devicePixelRatio,Bt.style.width="".concat(qt,"px"),Bt.style.height="".concat(Ht,"px"))}function Vt(t,e){if(Bt){var n=window.innerWidth,r=window.innerHeight,o=t+20,i=e+20;o+qt>n&&(o=t-qt-20),i+Ht>r&&(i=e-Ht-20),o=Math.max(0,Math.min(o,n-qt)),i=Math.max(0,Math.min(i,r-Ht)),Bt.style.left="".concat(o,"px"),Bt.style.top="".concat(i,"px")}}function Qt(){Zt&&(Zt=!1,Bt&&(Bt.style.display="none"))}function Yt(){Xt&&Xt.reset()}function Kt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,a,s=[],c=!0,l=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(s.push(r.value),s.length!==e);c=!0);}catch(t){l=!0,o=t}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Wt(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Wt(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var $t,te,ee,ne,re,oe,ie,ae=300,se=.05,ce=400,le=!1,ue=0,fe=0,de=0,he=0,me=null,pe=null,ve=!1,ye=!1,ge=null,be=!1,_e=null,Te=0,Ee=0,Ae=null,we=!1,Pe=null,xe=0,Le=0,Se=!1,Ie=0,Ce=!1,De=0;function ke(t,e){var n=t[0]+e[0],r=t[1]+e[1],o=Math.sqrt(n*n+r*r);if(o<=3.5)return e;var i=3.5/o,a=r*i;return[n*i-t[0],a-t[1]]}var Fe=0,Me=!1,Oe=0,Re=0,ze=0,Ne=null,je=0,Ue=0,Be=!1;function Xe(){te&&"function"==typeof te.markOrbitDirty&&te.markOrbitDirty()}function Ze(t){te=t,($t=t.canvas).addEventListener("contextmenu",function(t){return t.preventDefault()}),Jt(),Ge()}function Ge(){le||(ee=function(t){return function(t){if(t.preventDefault(),!Be){var e=te.canvas.getBoundingClientRect();je=e.left,Ue=e.top,Be=!0}Oe+=t.deltaY,Re=t.clientX,ze=t.clientY,Ne||(Ne=requestAnimationFrame(Ve));pe&&clearTimeout(pe);pe=setTimeout(function(){Be=!1,ui()},150),te.noteInteraction(160)}(t)},ne=function(t){return function(t){if(0===t.button){ve=!1,ue=t.clientX,fe=t.clientY,de=t.clientX,he=t.clientY;var e=$t.getBoundingClientRect();De=e.left,Fe=e.top,Me=!0,Te=t.clientX-e.left,Ee=t.clientY-e.top,ge&&clearTimeout(ge),ge=setTimeout(function(){ve||function(){if(be)return;function t(){if(be&&te){var e=.985*te.zoom;e>te.MAX_ZOOM?(te.setZoomKeepingAnchor(e,Te,Ee),Xe(),te.draw(),fi(!0),_e=requestAnimationFrame(t)):He()}}be=!0,$t.style.cursor="zoom-in",_e=requestAnimationFrame(t),te.noteInteraction(160)}()},ce)}else if(2===t.button){Ie=t.clientX;var n=$t.getBoundingClientRect();xe=t.clientX-n.left,Le=t.clientY-n.top,Ae&&clearTimeout(Ae),Ae=setTimeout(function(){Se||function(){if(we)return;function t(){if(we&&te){var e=1.015*te.zoom;e<te.MIN_ZOOM?(te.setZoomKeepingAnchor(e,xe,Le),Xe(),te.draw(),fi(!0),Pe=requestAnimationFrame(t)):Je()}}we=!0,$t.style.cursor="zoom-out",Pe=requestAnimationFrame(t),te.noteInteraction(160)}()},ce)}else if(1===t.button&&(t.preventDefault(),!ri())){Ce=!0;var r=$t.getBoundingClientRect(),o=t.clientX-r.left,i=t.clientY-r.top,a=Kt(te.screenToFractal(o,i),2),s=a[0],c=a[1];l=t.clientX,u=t.clientY,f=s,d=c,Bt||Jt(),Xt||((Xt=new Ut(Bt)).MAX_ITER=500,Xt.extraIterations=0,Gt&&(Xt.innerStops=Gt,Gt=null)),Xt.c=[f,d],Xt.markOrbitDirty(),Vt(l,u),Bt.style.display="block",Zt=!0,Xt.draw()}var l,u,f,d}(t)},re=function(t){return function(t){var e=t.clientX-ue,n=t.clientY-fe;if(1===t.buttons){if(be){var r=$t.getBoundingClientRect();return Te=t.clientX-r.left,void(Ee=t.clientY-r.top)}if(!ve&&(Math.abs(e)>5||Math.abs(n)>5)&&(ve=!0,ge&&(clearTimeout(ge),ge=null)),ve){$t.style.cursor="move",me&&(clearTimeout(me),me=null);var o=De,i=Fe;if(!Me){var a=$t.getBoundingClientRect();o=a.left,i=a.top}var s=de-o,c=he-i,l=t.clientX-o,u=t.clientY-i,f=Kt(te.screenToViewVector(s,c),2),d=f[0],h=f[1],m=Kt(te.screenToViewVector(l,u),2),p=m[0],v=m[1];if(Number.isFinite(te.zoom)){var y=(d-p)*te.zoom,g=(h-v)*te.zoom;te.addPan(y,g),Xe(),te.noteInteraction(160)}de=t.clientX,he=t.clientY,te.draw(),fi(!0)}}if(2===t.buttons){if(we){var b=$t.getBoundingClientRect();return xe=t.clientX-b.left,void(Le=t.clientY-b.top)}if(!Se&&(Math.abs(e)>5||Math.abs(n)>5)&&(Se=!0,Ae&&(clearTimeout(Ae),Ae=null)),Se){t.preventDefault();var _=t.clientX-Ie;te.rotation=W(te.rotation+.01*_),te.draw(),Ie=t.clientX,ye=!0,$t.style.cursor="grabbing",fi()}}if(4===t.buttons&&Ce&&!ri()){var T=$t.getBoundingClientRect(),E=t.clientX-T.left,A=t.clientY-T.top,w=Kt(te.screenToFractal(E,A),2),P=w[0],x=w[1];L=t.clientX,S=t.clientY,I=P,C=x,Zt&&Xt&&(Xt.c=[I,C],Xt.markOrbitDirty(),Vt(L,S),Xt.draw())}var L,S,I,C}(t)},oe=function(t){return function(t){if(![0,1,2].includes(t.button))return;if(t.preventDefault(),t.stopPropagation(),0===t.button){if(be)return void He();ge&&(clearTimeout(ge),ge=null)}if(2===t.button){if(we)return void Je();Ae&&(clearTimeout(Ae),Ae=null)}if(1===t.button)return void(Ce&&(Ce=!1,Qt()));if(0===t.button)if(Me=!1,ve)ui(),ve=!1,Xe(),te.draw();else{var e=$t.getBoundingClientRect(),n=t.clientX-e.left,r=t.clientY-e.top;if(null!==me){clearTimeout(me),me=null;var o=te.zoom*se;if(o>te.MAX_ZOOM){var i=te.screenToPanDelta(n,r);i=ke(te.pan,i),te.animatePanByAndZoomTo(i,o,1e3,l.QUINT).then(ui)}}else me=setTimeout(function(){var t=te.screenToPanDelta(n,r);t=ke(te.pan,t),te.animatePanBy(t,500).then(function(){ui();var t=Kt(te.screenToFractal(n,r),2),e=t[0],o=t[1];ri()?x(c.JULIA,e,o,te.zoom,te.rotation,te.c[0],te.c[1],ci()):x(c.MANDELBROT,e,o,te.zoom,te.rotation,null,null,ci())}),navigator.clipboard.writeText(window.location.href).then(function(){},function(t){}),me=null},ae)}if(2===t.button){if(Se)return Se=!1,ye&&ui(),ye=!1,void($t.style.cursor="crosshair");var a=$t.getBoundingClientRect(),s=t.clientX-a.left,u=t.clientY-a.top;if(null!==me){clearTimeout(me),me=null;var f=te.zoom/se;if(f<te.MIN_ZOOM){var d=te.screenToPanDelta(s,u);d=ke(te.pan,d),te.animatePanByAndZoomTo(d,f,1e3,l.QUINT).then(ui)}}else me=setTimeout(function(){me=null},ae);Se=!1}$t.style.cursor="crosshair"}(t)},ie=function(){return He(),Je(),void(Ce&&(Ce=!1,Qt()))},$t.addEventListener("wheel",ee,{passive:!1}),$t.addEventListener("mousedown",ne),$t.addEventListener("mousemove",re),$t.addEventListener("mouseup",oe),$t.addEventListener("mouseleave",ie),le=!0)}function qe(){le&&($t.removeEventListener("wheel",ee,{passive:!1}),$t.removeEventListener("mousedown",ne),$t.removeEventListener("mousemove",re),$t.removeEventListener("mouseup",oe),$t.removeEventListener("mouseleave",ie),le=!1)}function He(){ge&&(clearTimeout(ge),ge=null),_e&&(cancelAnimationFrame(_e),_e=null),be&&(be=!1,$t.style.cursor="crosshair",ui())}function Je(){Ae&&(clearTimeout(Ae),Ae=null),Pe&&(cancelAnimationFrame(Pe),Pe=null),we&&(we=!1,$t.style.cursor="crosshair",ui())}function Ve(){if(Ne=null,te&&Number.isFinite(te.zoom)){var t=Re-je,e=ze-Ue,n=Math.pow(1.1,Oe/120),r=te.zoom*n;Oe=0,r<te.MAX_ZOOM||r>te.MIN_ZOOM||(te.setZoomKeepingAnchor(r,t,e),Xe(),fi(!0),te.draw())}}function Qe(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,a,s=[],c=!0,l=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(s.push(r.value),s.length!==e);c=!0);}catch(t){l=!0,o=t}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Ye(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ye(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ye(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var Ke,We,$e,tn,en,nn=!1,rn=0,on=0,an=0,sn=0,cn=null,ln=!1,un=0,fn=0,dn=!1,hn=!1,mn=null,pn=null,vn=null,yn=null,gn=null,bn=!1,_n=null,Tn=0,En=0;function An(){We&&"function"==typeof We.markOrbitDirty&&We.markOrbitDirty()}function wn(t){t&&t.canvas&&(We=t,(Ke=t.canvas).addEventListener("contextmenu",function(t){return t.preventDefault()}),Pn())}function Pn(){Ke&&(nn||($e=function(t){return function(t){if(!We)return;if(1===t.touches.length){t.preventDefault(),ln=!1,hn=!1,mn=null,pn=null;var e=t.touches[0];rn=e.clientX,on=e.clientY,an=e.clientX,sn=e.clientY;var n=Ke.getBoundingClientRect();return un=n.left,fn=n.top,dn=!0,Tn=e.clientX-n.left,En=e.clientY-n.top,gn&&clearTimeout(gn),void(gn=setTimeout(function(){ln||hn||function(){if(bn)return;function t(){if(bn&&We){var e=.965*We.zoom;e>We.MAX_ZOOM?(We.setZoomKeepingAnchor(e,Tn,En),An(),We.draw(),fi(!0),_n=requestAnimationFrame(t)):Ln()}}bn=!0,_n=requestAnimationFrame(t),We.noteInteraction(160)}()},400))}if(2===t.touches.length){t.preventDefault(),Ln(),hn=!0,ln=!1,dn=!1;var r=t.touches[0],o=t.touches[1];mn=Math.hypot(r.clientX-o.clientX,r.clientY-o.clientY),pn=Math.atan2(o.clientY-r.clientY,o.clientX-r.clientX);var i=Ke.getBoundingClientRect(),a=(r.clientX+o.clientX)/2,s=(r.clientY+o.clientY)/2;vn=a-i.left,yn=s-i.top,cn&&(clearTimeout(cn),cn=null),We.noteInteraction(160)}}(t)},tn=function(t){return function(t){if(!We)return;if(1===t.touches.length&&!hn){t.preventDefault();var e=t.touches[0];if(bn){var n=Ke.getBoundingClientRect();return Tn=e.clientX-n.left,void(En=e.clientY-n.top)}var r=e.clientX-rn,o=e.clientY-on;if(!ln&&(Math.abs(r)>5||Math.abs(o)>5)&&(ln=!0,gn&&(clearTimeout(gn),gn=null),cn&&(clearTimeout(cn),cn=null)),ln){var i=un,a=fn;if(!dn){var s=Ke.getBoundingClientRect();i=s.left,a=s.top}var c=an-i,l=sn-a,u=e.clientX-i,f=e.clientY-a,d=Qe(We.screenToViewVector(c,l),2),h=d[0],m=d[1],p=Qe(We.screenToViewVector(u,f),2),v=p[0],y=p[1];if(Number.isFinite(We.zoom)){var g=(h-v)*We.zoom,b=(m-y)*We.zoom;We.addPan(g,b),An(),We.noteInteraction(160)}an=e.clientX,sn=e.clientY,We.draw(),fi(!0)}return}if(2===t.touches.length){t.preventDefault(),hn=!0;var _=t.touches[0],T=t.touches[1],E=Math.hypot(_.clientX-T.clientX,_.clientY-T.clientY),A=Math.atan2(T.clientY-_.clientY,T.clientX-_.clientX),w=(_.clientX+T.clientX)/2,P=(_.clientY+T.clientY)/2,x=Ke.getBoundingClientRect(),L=w-x.left,S=P-x.top;if(!mn||!pn||null===vn||null===yn)return mn=E,pn=A,vn=L,void(yn=S);var I=L-vn,C=S-yn;if(Math.abs(I)>.1||Math.abs(C)>.1){var D=Qe(We.screenToViewVector(vn,yn),2),k=D[0],F=D[1],M=Qe(We.screenToViewVector(L,S),2),O=M[0],R=M[1];if(Number.isFinite(We.zoom)){var z=(k-O)*We.zoom,N=(F-R)*We.zoom;We.addPan(z,N)}}var j=We.zoom;if(E>0){var U=mn/E;j=We.zoom*U}j<We.MAX_ZOOM&&(j=We.MAX_ZOOM),j>We.MIN_ZOOM&&(j=We.MIN_ZOOM),We.zoom=j;var B=A-pn;Math.abs(B)>.05&&(We.rotation=W(We.rotation+1*B)),mn=E,pn=A,vn=L,yn=S,An(),We.noteInteraction(160),We.draw(),fi()}}(t)},en=function(t){return function(t){if(!We)return;t.touches.length<2&&(mn=null,pn=null,vn=null,yn=null);if(0===t.touches.length){if(bn)return void Ln();if(gn&&(clearTimeout(gn),gn=null),hn)return hn=!1,ui(),An(),void We.draw();if(dn=!1,ln)ui(),ln=!1,An(),We.draw();else{var e=t.changedTouches[0],n=Ke.getBoundingClientRect(),r=e.clientX-n.left,o=e.clientY-n.top;if(null!==cn){clearTimeout(cn),cn=null;var i=We.screenToPanDelta(r,o);i=ke(We.pan,i);var a=.05*We.zoom;a>We.MAX_ZOOM&&We.animatePanByAndZoomTo(i,a).then(ui)}else cn=setTimeout(function(){var t=We.screenToPanDelta(r,o);t=ke(We.pan,t),We.animatePanBy(t,400).then(function(){ui();var t=Qe(We.screenToFractal(r,o),2),e=t[0],n=t[1];ri()?x(c.JULIA,e,n,We.zoom,We.rotation,We.c[0],We.c[1],ci()):x(c.MANDELBROT,e,n,We.zoom,We.rotation,null,null,ci())}),cn=null},300)}ln=!1}}(t)},Ke.addEventListener("touchstart",$e,{passive:!1}),Ke.addEventListener("touchmove",tn,{passive:!1}),Ke.addEventListener("touchend",en,{passive:!1}),nn=!0))}function xn(){Ke&&nn&&(Ke.removeEventListener("touchstart",$e,{passive:!1}),Ke.removeEventListener("touchmove",tn,{passive:!1}),Ke.removeEventListener("touchend",en,{passive:!1}),nn=!1)}function Ln(){gn&&(clearTimeout(gn),gn=null),_n&&(cancelAnimationFrame(_n),_n=null),bn&&(bn=!1,ui())}function Sn(t,e,n){e.draw();var r=document.createElement("canvas");r.width=t.width,r.height=t.height;var o=r.getContext("2d");if(o){o.drawImage(t,0,0);var i=function(t){var e=ri()?"Julia":"Mandelbrot";return{line1:"Synaptory Fractal Traveler",line2:"".concat(e,": p=").concat(D(t.pan.slice(),6),", zoom=").concat(t.zoom.toExponential(2))+"".concat(t instanceof Ma?", c=".concat(D(t.c)):"")}}(e),a=i.line1,s=i.line2,c="italic ".concat(12,'px "Bruno Ace SC", sans-serif'),l="".concat(12,'px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace');o.textAlign="center",o.letterSpacing="1px",o.textBaseline="middle",o.font=c;var u=o.measureText(a).width;o.font=l;var f=o.measureText(s).width,d=Math.max(u,f)+12+2,h=r.width-d-6,m=r.height-42-6;o.fillStyle="rgba(0, 0, 0, 0.7)",function(t,e,n,r,o,i){t.beginPath(),t.moveTo(e+i,n),t.lineTo(e+r-i,n),t.quadraticCurveTo(e+r,n,e+r,n+i),t.lineTo(e+r,n+o-i),t.quadraticCurveTo(e+r,n+o,e+r-i,n+o),t.lineTo(e+i,n+o),t.quadraticCurveTo(e,n+o,e,n+o-i),t.lineTo(e,n+i),t.quadraticCurveTo(e,n,e+i,n),t.closePath()}(o,h,m,d,42,8),o.fill();var p=h+d/2,v=m+6+1+6,y=v+12+4;o.font=c,o.fillStyle=n,o.fillText(a,p,v),o.font=l,o.fillStyle=n,o.fillText(s,p,y);var g,b,_=document.createElement("a");_.setAttribute("download",(g=new Date,b=function(t){return String(t).padStart(2,"0")},"fractal-".concat(g.getFullYear(),"-").concat(b(g.getMonth()+1),"-").concat(b(g.getDate()),"_").concat(b(g.getHours()),"-").concat(b(g.getMinutes()),"-").concat(b(g.getSeconds()),".jpg"))),_.setAttribute("href",r.toDataURL("image/jpeg",.95)),_.click()}}function In(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var c=r&&r.prototype instanceof s?r:s,l=Object.create(c.prototype);return Cn(l,"_invoke",function(n,r,o){var i,s,c,l=0,u=o||[],f=!1,d={p:0,n:0,v:t,a:h,f:h.bind(t,4),d:function(e,n){return i=e,s=0,c=t,d.n=n,a}};function h(n,r){for(s=n,c=r,e=0;!f&&l&&!o&&e<u.length;e++){var o,i=u[e],h=d.p,m=i[2];n>3?(o=m===r)&&(c=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=t):i[0]<=h&&((o=n<2&&h<i[1])?(s=0,d.v=r,d.n=i[1]):h<m&&(o=n<3||i[0]>r||r>m)&&(i[4]=n,i[5]=r,d.n=m,s=0))}if(o||n>1)return a;throw f=!0,r}return function(o,u,m){if(l>1)throw TypeError("Generator is already running");for(f&&1===u&&h(u,m),s=u,c=m;(e=s<2?t:c)||!f;){i||(s?s<3?(s>1&&(d.n=-1),h(s,c)):d.n=c:d.v=c);try{if(l=2,i){if(s||(o="next"),e=i[o]){if(!(e=e.call(i,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,s<2&&(s=0)}else 1===s&&(e=i.return)&&e.call(i),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);i=t}else if((e=(f=d.n<0)?c:n.call(r,d))!==a)break}catch(e){i=t,s=1,c=e}finally{l=1}}return{value:e,done:f}}}(n,o,i),!0),l}var a={};function s(){}function c(){}function l(){}e=Object.getPrototypeOf;var u=[][r]?e(e([][r]())):(Cn(e={},r,function(){return this}),e),f=l.prototype=s.prototype=Object.create(u);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,Cn(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return c.prototype=l,Cn(f,"constructor",l),Cn(l,"constructor",c),c.displayName="GeneratorFunction",Cn(l,o,"GeneratorFunction"),Cn(f),Cn(f,o,"Generator"),Cn(f,r,function(){return this}),Cn(f,"toString",function(){return"[object Generator]"}),(In=function(){return{w:i,m:d}})()}function Cn(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Cn=function(t,e,n,r){function i(e,n){Cn(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Cn(t,e,n,r)}function Dn(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}var kn,Fn=["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Space","KeyQ","KeyW"],Mn=.1,On=.01,Rn=.001,zn=.1,Nn=!1,jn=!1;function Un(t){return Bn.apply(this,arguments)}function Bn(){var t;return t=In().m(function t(r){var o,a,s,l,d,h,m,p,v,y,g,b,_,T,E,A,w,P,x,L,S,I,C,D;return In().w(function(t){for(;;)switch(t.n){case 0:if(a=r.target,s=null==a||null===(o=a.tagName)||void 0===o?void 0:o.toLowerCase(),!a||"input"!==s&&"textarea"!==s&&"select"!==s&&!a.isContentEditable){t.n=1;break}return t.a(2);case 1:if(l=!1,d=r.shiftKey?.01:.1,h=f,m=0,p=0,v=0,y=0,g=r.altKey||"Alt"===r.code,!di()||!Fn.includes(r.code)){t.n=2;break}return r.preventDefault(),t.a(2);case 2:D=r.code,t.n="KeyQ"===D?3:"KeyW"===D?4:"KeyE"===D?7:"KeyR"===D?8:"KeyC"===D?10:"KeyL"===D?11:"KeyZ"===D?12:"KeyT"===D?15:"KeyA"===D?20:"KeyS"===D?21:"KeyB"===D?22:"KeyD"===D?24:"KeyM"===D?26:"KeyN"===D?28:"KeyF"===D?29:"NumpadAdd"===D||"Equal"===D?30:"NumpadSubtract"===D||"Minus"===D?31:"KeyP"===D?32:"ArrowLeft"===D?33:"ArrowRight"===D?34:"ArrowDown"===D?35:"ArrowUp"===D?36:"Space"===D?37:"Enter"===D?40:41;break;case 3:h=u;case 4:if(!Nn){t.n=5;break}kn.stopCurrentRotationAnimation(),Nn=!1,t.n=6;break;case 5:return Nn=!0,t.n=6,kn.animateInfiniteRotation(h,d);case 6:return l=!0,t.a(3,46);case 7:return Li(),l=!0,t.a(3,46);case 8:if(!r.shiftKey){t.n=9;break}return t.n=9,Mi();case 9:return l=!0,t.a(3,46);case 10:return da(),l=!0,t.a(3,46);case 11:return xi(),l=!0,t.a(3,46);case 12:t.n=13;break;case 13:return t.n=14,ei(ri()?c.MANDELBROT:c.JULIA);case 14:return l=!0,t.a(3,46);case 15:if(!g){t.n=17;break}return t.n=16,kn.applyPaletteByIndex(0,250,li);case 16:si(),hi(),t.n=19;break;case 17:if(!r.shiftKey){t.n=18;break}kn.paletteCyclingActive?kn.stopCurrentColorAnimations():kn.startPaletteCycling(2e3,3e3,li,si),hi(),t.n=19;break;case 18:return t.n=19,Ci();case 19:return l=!0,t.a(3,46);case 20:return kn.resizeCanvas(),l=!0,t.a(3,46);case 21:return g?Bi():r.shiftKey&&ki(),l=!0,t.a(3,46);case 22:if(!ri()||n!==e){t.n=23;break}return Ma.FF_LEGACY_JULIA_RENDERER=!Ma.FF_LEGACY_JULIA_RENDERER,t.n=23,$o(c.JULIA);case 23:return l=!0,t.a(3,46);case 24:return t.n=25,vi();case 25:return l=!0,t.a(3,46);case 26:if(n!==e){t.n=27;break}return t.n=27,$o(c.RIEMANN);case 27:return l=!0,t.a(3,46);case 28:return n&&(i("Analytic Extension toggled."),kn.useAnalyticExtension=!kn.useAnalyticExtension,kn.draw()),l=!0,t.a(3,46);case 29:return kn.toggleAdaptiveQuality(),l=!0,t.a(3,46);case 30:return kn.adaptiveQualityEnabled&&(b=r.shiftKey?25:100,kn.adjustExtraIterations(b)),l=!0,t.a(3,46);case 31:return kn.adaptiveQualityEnabled&&(_=r.shiftKey?-25:-100,kn.adjustExtraIterations(_)),l=!0,t.a(3,46);case 32:return Gi(),l=!0,t.a(3,46);case 33:return m=g?0:-(r.shiftKey?On:Mn),v=g?Rn*(r.shiftKey?zn:1):0,l=!0,t.a(3,46);case 34:return m=g?0:r.shiftKey?On:Mn,v=g?Rn*(r.shiftKey?-.1:-1):0,l=!0,t.a(3,46);case 35:return p=g?0:-(r.shiftKey?On:Mn),y=g?Rn*(r.shiftKey?-.1:-1):0,l=!0,t.a(3,46);case 36:return p=g?0:r.shiftKey?On:Mn,y=g?Rn*(r.shiftKey?zn:1):0,l=!0,t.a(3,46);case 37:if(T=r.shiftKey?.01:.1,E=r.ctrlKey||g?1+T:1-T,!((A=kn.zoom*E)>=kn.MAX_ZOOM&&A<=kn.MIN_ZOOM)){t.n=39;break}return t.n=38,kn.animateZoomToNoPan(A,20);case 38:ui();case 39:return l=!0,t.a(3,46);case 40:return Fi(),l=!0,t.a(3,46);case 41:if(!(w=r.code.match(/^(Digit|Numpad)(\d)$/))){t.n=45;break}if(P=parseInt(w[2],0),!r.shiftKey||!ri()){t.n=43;break}return t.n=42,_i(kn.DIVES,P);case 42:t.n=44;break;case 43:return t.n=44,wi(kn.PRESETS,P);case 44:l=!0;case 45:return t.a(3,46);case 46:if(!m&&!p){t.n=48;break}return x=kn.rotation,L=m*kn.zoom*Math.cos(x)-p*kn.zoom*Math.sin(x),S=m*kn.zoom*Math.sin(x)+p*kn.zoom*Math.cos(x),t.n=47,kn.animatePanBy([L,S],50);case 47:kn.noteInteraction(160),ui();case 48:if(!v&&!y||!ri()){t.n=50;break}return I=v*kn.zoom,C=y*kn.zoom,t.n=49,kn.animateToC([kn.c[0]+I,kn.c[1]+C],10);case 49:ui();case 50:l&&r.preventDefault();case 51:return t.a(2)}},t)}),Bn=function(){var e=this,n=arguments;return new Promise(function(r,o){var i=t.apply(e,n);function a(t){Dn(i,r,o,a,s,"next",t)}function s(t){Dn(i,r,o,a,s,"throw",t)}a(void 0)})},Bn.apply(this,arguments)}function Xn(t){jn||(kn=t,document.addEventListener("keydown",Un),jn=!0,i("Initialized.","initHotKeys"))}function Zn(){jn&&(kn=null,jn=!1,document.removeEventListener("keydown",Un))}const Gn=JSON.parse('{"l8":[{"id":"Default","pan":[-0.5,0],"zoom":3,"rotation":0,"paletteId":"Default"},{"id":"Corona","pan":[-1.6751190310023893,0.0002814850761671888],"rotation":2.744961621024302,"zoom":4.418867110314641e-14,"paletteId":"Neon","speed":10},{"id":"Misiurewicz Point 1","speed":20,"pan":[0.3514237590525219,0.06386655981329288],"rotation":0,"zoom":2.5763958982690256e-15,"paletteId":"Event Horizon"},{"id":"Kaleidoscope","speed":20,"pan":[0.2549996194371581,0.0005684340597555115],"rotation":0,"zoom":3.3489459482170825e-15,"paletteId":"Neon"},{"id":"Eyes","speed":10,"pan":[-0.8535650370330193,-0.21078134581125757],"rotation":5.457344329507158,"zoom":7.224653790512887e-15,"paletteId":"Solar Flare"},{"id":"Nova Core","speed":10,"pan":[0.11651278779150397,0.6625979215565224],"rotation":1.7216343574412782,"zoom":3.338699118604086e-14,"paletteId":"Default"},{"id":"Tentacles","speed":10,"pan":[-0.7687084589628804,0.11572944588933862],"rotation":6.238146928203884,"zoom":1.7516048231105188e-9,"paletteId":"Solar Flare"},{"id":"Spiral","speed":10,"pan":[-0.7668654471115031,-0.1074731006886796],"rotation":1.5065924365935786,"zoom":1.2015270980908582e-13,"paletteId":"Deep Magenta"},{"id":"Microbrot","speed":10,"pan":[0.11654740401415453,-0.6636148998875822],"rotation":2.610174541746648,"zoom":1.0267582908408742e-7,"paletteId":"Event Horizon"},{"id":"Spacetime Rupture","speed":10,"pan":[-0.19935736401541954,1.100085730219187],"rotation":0.9715696101360471,"zoom":3.845732562549906e-14,"paletteId":"Event Horizon"},{"id":"Owl","speed":10,"pan":[-1.860575101726604,0],"rotation":1.5699999999999932,"zoom":1.0653916071979119e-13,"paletteId":"Red Giant"},{"id":"Rabbits","speed":10,"pan":[-0.12479143490518177,0.8403941246801068],"rotation":2.9726613829226753,"zoom":5.2511748102956e-14,"paletteId":"Electric"},{"id":"Devil\'s Eye","speed":10,"pan":[-1.9990961121566282,5.29521586e-16],"rotation":0,"zoom":2.4551589208810202e-12,"paletteId":"Hell"},{"id":"Misiurewicz Point 2","speed":15,"pan":[0.11650145207876456,-0.6635454379133249],"rotation":2.610174541746648,"zoom":4.803195845253491e-15,"paletteId":"Neon"},{"id":"Tip","pan":[-1.6751190310023891,0.0002814850761612082],"rotation":2.744961621024302,"zoom":1.669974067516279e-35,"speed":10,"paletteId":"Default"},{"id":"Julia Core","speed":10,"pan":[0.3476345141527036,0.6441959432328163],"rotation":3.231857941193079,"zoom":4.842168158015056e-13,"paletteId":"Neon"},{"id":"Hyperspace","speed":20,"pan":[-0.1645421657093719,1.0384395470826784],"rotation":0.8994343632012249,"zoom":9.819695813881168e-15,"paletteId":"Obsidian Gold"},{"id":"Plasma Storm","speed":10,"pan":[0.2625017727522711,0.6113502800557138],"rotation":0.9088831624158438,"zoom":6.228752917993604e-14,"paletteId":"Event Horizon"},{"id":"Grain","speed":10,"pan":[0.06133242858181587,0.6348897501399751],"rotation":3.3400000000000034,"zoom":1.338075419754604e-7,"paletteId":"Hell"},{"id":"Where the Math Ends","speed":10,"pan":[-1.9999991175876528,-3.194092143034014e-39],"rotation":0,"zoom":6.130263511531091e-36,"paletteId":"Toxic Waste"},{"id":"Nucleus","speed":10,"pan":[0.11654740531325175,-0.6636149160665515],"rotation":0.42681868968169034,"zoom":2.318964706881093e-15,"paletteId":"Default"},{"id":"Julia Flower","speed":10,"pan":[-1.7695828784932537,-0.009474018873338621],"rotation":4.725475788649234,"zoom":1.0010523813628273e-14,"paletteId":"Hell"},{"id":"Seahorse Valley","speed":10,"pan":[-0.7436399999999269,0.13182000000014288],"rotation":2.063121784131649,"zoom":4.2563398808307913e-13,"paletteId":"Default"},{"id":"MRI","pan":[0.43243015487808223,0.22619742645171284],"rotation":3.2399999999999967,"zoom":3.4802055570369412e-15,"paletteId":"Default","speed":10},{"id":"Hemp","pan":[-0.10091441198011913,0.9563868634730066],"rotation":2.544073464101942,"zoom":1.0044912289089045e-14,"paletteId":"Grayscale","speed":5},{"id":"Wormhole","speed":10,"pan":[0.32600108014032353,0.05090212275634713],"rotation":3.695917207994011,"zoom":4.2351875777605435e-15,"paletteId":"Solar Flare"},{"id":"Julia World","speed":10,"pan":[-0.5925376025591568,0.6218580534998077],"rotation":1.2299999999999969,"zoom":1.538019369093248e-14,"paletteId":"Red Giant"},{"id":"Nebula","speed":10,"pan":[-1.419134128485657,0.007799768259907465],"rotation":3.2699999999999783,"zoom":1.1480535783598191e-10,"paletteId":"Default"},{"id":"8-16-32","speed":10,"pan":[-1.028931496698857,0.386339588530909],"rotation":3.3899999999999686,"zoom":1.846201642651418e-12,"paletteId":"Neon"},{"id":"Forest","speed":10,"pan":[-1.7487646747237737,0],"rotation":3.139999999999988,"zoom":7.783049226991474e-9,"paletteId":"Default"},{"id":"Spike Protein","speed":10,"pan":[0.1406863411553684,-0.6472459297513438],"rotation":5.772978091062493,"zoom":4.06509281465732e-12,"paletteId":"Event Hotizon"},{"id":"Cavern","pan":[0.017129685904424492,0.7601070710317832],"rotation":4.0899999999999785,"zoom":4.836413118759317e-13,"paletteId":"Toxic Waste","speed":5},{"id":"Keyhole","pan":[0.3249369400204646,0.583560029961837],"rotation":3.6899999999999835,"zoom":1.443963312482902e-12,"paletteId":"Default","speed":10}],"BG":[{"id":"Default","keyColor":"#96d954","theme":[1,1,1],"frequency":[3.1415,6.283,1.72],"phase":[0,0,0]},{"id":"Electric","keyColor":"#00E5FF","theme":[0.3,1.3,1.5],"frequency":[2,3.5,4],"phase":[0,0,0]},{"id":"Deep Magenta","keyColor":"#FF1A99","theme":[1.5,0.3,1.2],"frequency":[3.5,2,3],"phase":[0,0,0]},{"id":"Solar Flare","keyColor":"#FF8000","theme":[1.6,1,0.2],"frequency":[3,4,2],"phase":[0,0,0]},{"id":"Borealis Aurora","keyColor":"#33FF99","theme":[0.4,1.5,0.9],"frequency":[2.5,3,2],"phase":[0,0,0]},{"id":"Hell","keyColor":"#d82222","theme":[2.5,1,0],"frequency":[10,4.4,0],"phase":[2.8,3.5,0]},{"id":"Obsidian Gold","keyColor":"#FFD700","theme":[1.4,1.2,0.2],"frequency":[3,3.5,1.5],"phase":[0,0,0]},{"id":"Event Horizon","keyColor":"#e132ff","theme":[0.9,0.2,1.6],"frequency":[2.5,1.5,3.5],"phase":[0,0,0]},{"id":"Toxic Waste","keyColor":"#ADFF2F","theme":[1,1.2,0],"frequency":[9.3,1,0],"phase":[1.4,0,0.9]},{"id":"Grayscale","keyColor":"#888888","theme":[1,1,1],"frequency":[6.2,6.2,6.2],"phase":[0,0,0]},{"id":"Red Giant","keyColor":"#ca3d06","theme":[1.4,1.2,0.2],"frequency":[3,3.5,1.5],"phase":[0,4.7,0]},{"id":"Neon","keyColor":"#c872ff","theme":[0.8,1,2.9],"frequency":[6.2,5.1,1.5],"phase":[0,3,0]}]}');function qn(t){return qn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qn(t)}function Hn(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var c=r&&r.prototype instanceof s?r:s,l=Object.create(c.prototype);return Jn(l,"_invoke",function(n,r,o){var i,s,c,l=0,u=o||[],f=!1,d={p:0,n:0,v:t,a:h,f:h.bind(t,4),d:function(e,n){return i=e,s=0,c=t,d.n=n,a}};function h(n,r){for(s=n,c=r,e=0;!f&&l&&!o&&e<u.length;e++){var o,i=u[e],h=d.p,m=i[2];n>3?(o=m===r)&&(c=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=t):i[0]<=h&&((o=n<2&&h<i[1])?(s=0,d.v=r,d.n=i[1]):h<m&&(o=n<3||i[0]>r||r>m)&&(i[4]=n,i[5]=r,d.n=m,s=0))}if(o||n>1)return a;throw f=!0,r}return function(o,u,m){if(l>1)throw TypeError("Generator is already running");for(f&&1===u&&h(u,m),s=u,c=m;(e=s<2?t:c)||!f;){i||(s?s<3?(s>1&&(d.n=-1),h(s,c)):d.n=c:d.v=c);try{if(l=2,i){if(s||(o="next"),e=i[o]){if(!(e=e.call(i,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,s<2&&(s=0)}else 1===s&&(e=i.return)&&e.call(i),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);i=t}else if((e=(f=d.n<0)?c:n.call(r,d))!==a)break}catch(e){i=t,s=1,c=e}finally{l=1}}return{value:e,done:f}}}(n,o,i),!0),l}var a={};function s(){}function c(){}function l(){}e=Object.getPrototypeOf;var u=[][r]?e(e([][r]())):(Jn(e={},r,function(){return this}),e),f=l.prototype=s.prototype=Object.create(u);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,Jn(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return c.prototype=l,Jn(f,"constructor",l),Jn(l,"constructor",c),c.displayName="GeneratorFunction",Jn(l,o,"GeneratorFunction"),Jn(f),Jn(f,o,"Generator"),Jn(f,r,function(){return this}),Jn(f,"toString",function(){return"[object Generator]"}),(Hn=function(){return{w:i,m:d}})()}function Jn(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Jn=function(t,e,n,r){function i(e,n){Jn(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Jn(t,e,n,r)}function Vn(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function Qn(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var i=t.apply(e,n);function a(t){Vn(i,r,o,a,s,"next",t)}function s(t){Vn(i,r,o,a,s,"throw",t)}a(void 0)})}}function Yn(t){return function(t){if(Array.isArray(t))return Kn(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Kn(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Kn(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Kn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function Wn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ir(r.key),r)}}function $n(t,e,n){return e=rr(e),function(t,e){if(e&&("object"==qn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,tr()?Reflect.construct(e,n||[],rr(t).constructor):e.apply(t,n))}function tr(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(tr=function(){return!!t})()}function er(t,e,n,r){var o=nr(rr(1&r?t.prototype:t),e,n);return 2&r&&"function"==typeof o?function(t){return o.apply(n,t)}:o}function nr(){return nr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=rr(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},nr.apply(null,arguments)}function rr(t){return rr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},rr(t)}function or(t,e){return or=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},or(t,e)}function ir(t){var e=function(t,e){if("object"!=qn(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=qn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==qn(e)?e:e+""}var ar=function(t){function e(t){var n,r,o,i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),n=$n(this,e,[t]),r=n,i=function(){return n.orbitDirty=!0},(o=ir(o="markOrbitDirty"))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i,n.DEFAULT_PAN=[-.5,0],n.setPan(n.DEFAULT_PAN[0],n.DEFAULT_PAN[1]),n.refPan=Yn(n.DEFAULT_PAN),n.refPanDD={x:{hi:n.DEFAULT_PAN[0],lo:0},y:{hi:n.DEFAULT_PAN[1],lo:0}},n.orbitDirty=!0,n.MAX_ITER=5e3,n.REF_SEARCH_GRID=7,n.REF_SEARCH_RADIUS=.5,n.rebaseArmed=!0,n.orbitTex=null,n.orbitData=null,n.floatTexExt=null,n.PRESETS=Gn.l8,n.PALETTES=Gn.BG||[],n.currentPaletteIndex=0,n.DEFAULT_FREQUENCY=[3.1415,6.283,1.72],n.DEFAULT_PHASE=[0,0,0],n.frequency=Yn(n.DEFAULT_FREQUENCY),n.phase=Yn(n.DEFAULT_PHASE),n.init(),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&or(t,e)}(e,t),n=e,r=[{key:"onProgramCreated",value:function(){this.floatTexExt=this.gl.getExtension("OES_texture_float"),this.floatTexExt&&(this.orbitTex=this.gl.createTexture(),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.orbitTex),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.orbitData=new Float32Array(4*this.MAX_ITER),this.orbitTexLoc&&this.gl.uniform1i(this.orbitTexLoc,0),this.orbitWLoc&&this.gl.uniform1f(this.orbitWLoc,this.MAX_ITER),this.orbitDirty=!0)}},{key:"createFragmentShaderSource",value:function(){return"/*\r\n * Mandelbrot Fragment Shader (Rebased Perturbation)\r\n * @author    Radim Brnka\r\n * @project   Synaptory Fractal Traveler\r\n * @copyright 2025-2026\r\n * @description\r\n * High-precision Mandelbrot implementation using Double-Float (df) arithmetic.\r\n * Implements perturbation: dz_{n+1} = 2*zref*dz + dz^2 + dc.\r\n * Requires OES_texture_float for orbit reference sampling.\r\n *\r\n * @license   MIT\r\n */\r\n\r\nprecision highp float;\r\n\r\nuniform vec2 u_resolution;\r\n\r\n// delta pan (viewPan - refPan) computed on JS side for float64 precision\r\nuniform vec2 u_delta_pan_h;\r\nuniform vec2 u_delta_pan_l;\r\n\r\n// zoom (hi+lo)\r\nuniform float u_zoom_h;\r\nuniform float u_zoom_l;\r\n\r\nuniform float u_iterations;\r\nuniform vec3  u_colorPalette;\r\nuniform vec3  u_frequency;\r\nuniform vec3  u_phase;\r\nuniform float u_rotation;\r\n\r\nuniform sampler2D u_orbitTex;\r\nuniform float u_orbitW;\r\n\r\nconst int MAX_ITER = __MAX_ITER__;\r\n\r\n// --- df helpers ---\r\nstruct df  { float hi; float lo; };\r\nstruct df2 { df x; df y; };\r\n\r\ndf df_make(float hi, float lo){ df a; a.hi=hi; a.lo=lo; return a; }\r\ndf df_from(float a){ return df_make(a, 0.0); }\r\nfloat df_to_float(df a){ return a.hi + a.lo; }\r\n\r\ndf twoSum(float a, float b) {\r\n    float s  = a + b;\r\n    float bb = s - a;\r\n    float err = (a - (s - bb)) + (b - bb);\r\n    return df_make(s, err);\r\n}\r\n\r\ndf quickTwoSum(float a, float b) {\r\n    float s = a + b;\r\n    float err = b - (s - a);\r\n    return df_make(s, err);\r\n}\r\n\r\ndf df_add(df a, df b) {\r\n    df s = twoSum(a.hi, b.hi);\r\n    float t = a.lo + b.lo;\r\n    df u = twoSum(s.lo, t);\r\n    df v = twoSum(s.hi, u.hi);\r\n    float lo = u.lo + v.lo;\r\n    return quickTwoSum(v.hi, lo);\r\n}\r\n\r\ndf df_sub(df a, df b) { return df_add(a, df_make(-b.hi, -b.lo)); }\r\n\r\nconst float SPLIT = 4097.0;\r\n\r\ndf twoProd(float a, float b) {\r\n    float p = a * b;\r\n\r\n    float aSplit = a * SPLIT;\r\n    float aHi = aSplit - (aSplit - a);\r\n    float aLo = a - aHi;\r\n\r\n    float bSplit = b * SPLIT;\r\n    float bHi = bSplit - (bSplit - b);\r\n    float bLo = b - bHi;\r\n\r\n    float err = ((aHi * bHi - p) + aHi * bLo + aLo * bHi) + aLo * bLo;\r\n    return df_make(p, err);\r\n}\r\n\r\ndf df_mul(df a, df b) {\r\n    df p = twoProd(a.hi, b.hi);\r\n    float err = a.hi * b.lo + a.lo * b.hi + a.lo * b.lo;\r\n    df s = twoSum(p.lo, err);\r\n    df r = twoSum(p.hi, s.hi);\r\n    float lo = s.lo + r.lo;\r\n    return quickTwoSum(r.hi, lo);\r\n}\r\n\r\ndf df_mul_f(df a, float b) { return df_mul(a, df_from(b)); }\r\n\r\ndf2 df2_make(df x, df y){ df2 r; r.x=x; r.y=y; return r; }\r\ndf2 df2_add(df2 a, df2 b){ return df2_make(df_add(a.x, b.x), df_add(a.y, b.y)); }\r\n\r\ndf2 df2_mul(df2 a, df2 b){\r\n    // (ax + i ay)(bx + i by) = (axbx - ayby) + i(axby + aybx)\r\n    df axbx = df_mul(a.x, b.x);\r\n    df ayby = df_mul(a.y, b.y);\r\n    df axby = df_mul(a.x, b.y);\r\n    df aybx = df_mul(a.y, b.x);\r\n    return df2_make(df_sub(axbx, ayby), df_add(axby, aybx));\r\n}\r\n\r\ndf2 df2_sqr(df2 a){\r\n    df xx = df_mul(a.x, a.x);\r\n    df yy = df_mul(a.y, a.y);\r\n    df xy = df_mul(a.x, a.y);\r\n    return df2_make(df_sub(xx, yy), df_mul_f(xy, 2.0));\r\n}\r\n\r\ndf2 sampleZRef(int n){\r\n    float x = (float(n) + 0.5) / u_orbitW;\r\n    vec4 t = texture2D(u_orbitTex, vec2(x, 0.5));\r\n    return df2_make(df_make(t.r, t.g), df_make(t.b, t.a));\r\n}\r\n\r\nvoid main() {\r\n    float aspect = u_resolution.x / u_resolution.y;\r\n\r\n    vec2 st = gl_FragCoord.xy / u_resolution;\r\n    st -= 0.5;\r\n    st.x *= aspect;\r\n\r\n    float cosR = cos(u_rotation);\r\n    float sinR = sin(u_rotation);\r\n    vec2 r = vec2(\r\n    st.x * cosR - st.y * sinR,\r\n    st.x * sinR + st.y * cosR\r\n    );\r\n\r\n    df zoom = df_make(u_zoom_h, u_zoom_l);\r\n\r\n    // deltaPan = viewPan - refPan (computed on JS side with float64 precision)\r\n    df2 deltaPan = df2_make(\r\n        df_make(u_delta_pan_h.x, u_delta_pan_l.x),\r\n        df_make(u_delta_pan_h.y, u_delta_pan_l.y)\r\n    );\r\n\r\n    // dc = deltaPan + zoom * r\r\n    df2 dc = df2_make(df_mul_f(zoom, r.x), df_mul_f(zoom, r.y));\r\n    dc = df2_add(dc, deltaPan);\r\n\r\n    df2 dz = df2_make(df_from(0.0), df_from(0.0));\r\n\r\n    float it = 0.0;\r\n    float zx = 0.0;\r\n    float zy = 0.0;\r\n\r\n    for (int n = 0; n < MAX_ITER; n++) {\r\n        float fn = float(n);\r\n        if (fn >= u_iterations) { it = fn; break; }\r\n\r\n        df2 zref = sampleZRef(n);\r\n\r\n        // bailout approx using float\r\n        zx = df_to_float(zref.x) + df_to_float(dz.x);\r\n        zy = df_to_float(zref.y) + df_to_float(dz.y);\r\n        if (zx*zx + zy*zy > 4.0) { it = fn; break; }\r\n\r\n        // dz_{n+1} = 2*zref*dz + dz^2 + dc\r\n        df2 zref_dz = df2_mul(zref, dz);\r\n        zref_dz.x = df_mul_f(zref_dz.x, 2.0);\r\n        zref_dz.y = df_mul_f(zref_dz.y, 2.0);\r\n\r\n        df2 dz2 = df2_sqr(dz);\r\n\r\n        dz = df2_add(df2_add(zref_dz, dz2), dc);\r\n\r\n        if (n == MAX_ITER - 1) it = u_iterations;\r\n    }\r\n\r\n    if (it >= u_iterations) {\r\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\r\n    } else {\r\n        // Smooth coloring using |z|² for crisp edge detail\r\n        float r2 = max(zx*zx + zy*zy, 1e-30);\r\n        float smoothIt = it - log2(log2(r2));\r\n\r\n        // Sine-based coloring with configurable frequency and phase\r\n        float t = smoothIt / 100.0;\r\n        vec3 fractalColor = vec3(\r\n            sin(t * u_frequency.r + u_phase.r),\r\n            sin(t * u_frequency.g + u_phase.g),\r\n            sin(t * u_frequency.b + u_phase.b)\r\n        ) * u_colorPalette;\r\n\r\n        gl_FragColor = vec4(fractalColor, 1.0);\r\n    }\r\n}".replace("__MAX_ITER__",this.MAX_ITER).toString()}},{key:"updateUniforms",value:function(){er(e,"updateUniforms",this,3)([]),this.deltaPanHLoc=this.gl.getUniformLocation(this.program,"u_delta_pan_h"),this.deltaPanLLoc=this.gl.getUniformLocation(this.program,"u_delta_pan_l"),this.zoomHLoc=this.gl.getUniformLocation(this.program,"u_zoom_h"),this.zoomLLoc=this.gl.getUniformLocation(this.program,"u_zoom_l"),this.orbitTexLoc=this.gl.getUniformLocation(this.program,"u_orbitTex"),this.orbitWLoc=this.gl.getUniformLocation(this.program,"u_orbitW"),this.frequencyLoc=this.gl.getUniformLocation(this.program,"u_frequency"),this.phaseLoc=this.gl.getUniformLocation(this.program,"u_phase")}},{key:"escapeItersDouble",value:function(t,e,n){for(var r=0,o=0,i=0;i<n;i++){var a=2*r*o+e;if((r=r*r-o*o+t)*r+(o=a)*o>4)return i}return n}},{key:"pickReferenceNearViewCenter",value:function(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])return this.refPan[0]=this.pan[0],this.refPan[1]=this.pan[1],this.refPanDD.x.hi=this.panDD.x.hi,this.refPanDD.x.lo=this.panDD.x.lo,this.refPanDD.y.hi=this.panDD.y.hi,void(this.refPanDD.y.lo=this.panDD.y.lo);var t=this.REF_SEARCH_GRID,e=(t-1)/2,n=2*this.REF_SEARCH_RADIUS/(t-1),r=this.zoom,o=Math.min(this.MAX_ITER,Math.max(200,Math.floor(this.iterations))),i=-1;Math.hypot(this.refPan[0]-this.pan[0],this.refPan[1]-this.pan[1])<r*this.REF_SEARCH_RADIUS*2.5&&(i=this.escapeItersDouble(this.refPan[0],this.refPan[1],o));for(var a=this.pan[0],s=this.pan[1],c=this.escapeItersDouble(this.pan[0],this.pan[1],o),l=0;l<t;l++)for(var u=0;u<t;u++){var f=(u-e)*n,d=(l-e)*n,h=this.pan[0]+f*r,m=this.pan[1]+d*r,p=this.escapeItersDouble(h,m,o);p>c&&(c=p,a=h,s=m)}var v=Math.max(.1*i,50);(i<0||c-i>v)&&(this.refPan[0]=a,this.refPan[1]=s,this.refPanDD.x.hi=a,this.refPanDD.x.lo=0,this.refPanDD.y.hi=s,this.refPanDD.y.lo=0)}},{key:"computeReferenceOrbit",value:function(){if(this.orbitData&&this.orbitTex){for(var t=this.refPan[0],e=this.refPan[1],n=0,r=0,o=0;o<this.MAX_ITER;o++){var i=M(n),a=M(r),s=4*o;this.orbitData[s]=i.high,this.orbitData[s+1]=i.low,this.orbitData[s+2]=a.high,this.orbitData[s+3]=a.low;var c=2*n*r+e;if((n=n*n-r*r+t)*n+(r=c)*r>4){for(var l=M(n),u=M(r),f=o+1;f<this.MAX_ITER;f++){var d=4*f;this.orbitData[d]=l.high,this.orbitData[d+1]=l.low,this.orbitData[d+2]=u.high,this.orbitData[d+3]=u.low}break}}this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.orbitTex),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.MAX_ITER,1,0,this.gl.RGBA,this.gl.FLOAT,this.orbitData),this.orbitTexLoc&&this.gl.uniform1i(this.orbitTexLoc,0),this.orbitWLoc&&this.gl.uniform1f(this.orbitWLoc,this.MAX_ITER)}}},{key:"draw",value:function(){this.gl.useProgram(this.program);var t=Math.max(this.zoom,1e-300),n=Math.log2(this.DEFAULT_ZOOM/t),r=Math.floor(200+50*n);this.iterations=Math.max(50,Math.min(this.MAX_ITER,r+this.extraIterations));var o=this.needsRebase(),i=!this.interactionActive||o;this.orbitDirty&&i&&(this.pickReferenceNearViewCenter(),this.computeReferenceOrbit(),this.orbitDirty=!1);var a=X(this.panDD.x,this.refPanDD.x),s=X(this.panDD.y,this.refPanDD.y);this.deltaPanHLoc&&this.gl.uniform2f(this.deltaPanHLoc,a.hi,s.hi),this.deltaPanLLoc&&this.gl.uniform2f(this.deltaPanLLoc,a.lo,s.lo);var c=M(this.zoom);this.zoomHLoc&&this.gl.uniform1f(this.zoomHLoc,c.high),this.zoomLLoc&&this.gl.uniform1f(this.zoomLLoc,c.low),this.frequencyLoc&&this.gl.uniform3fv(this.frequencyLoc,this.frequency),this.phaseLoc&&this.gl.uniform3fv(this.phaseLoc,this.phase),er(e,"draw",this,3)([])}},{key:"needsRebase",value:function(){var t=this.pan[0]-this.refPan[0],e=this.pan[1]-this.refPan[1];return Math.hypot(t,e)>.75*this.zoom}},{key:"reset",value:function(){this.frequency=Yn(this.DEFAULT_FREQUENCY),this.phase=Yn(this.DEFAULT_PHASE),this.currentPaletteIndex=0,this.orbitDirty=!0,er(e,"reset",this,3)([])}},{key:"applyPaletteByIndex",value:(u=Qn(Hn().m(function t(e){var n,r,o,i,a=arguments;return Hn().w(function(t){for(;;)switch(t.n){case 0:if(n=a.length>1&&void 0!==a[1]?a[1]:250,r=a.length>2&&void 0!==a[2]?a[2]:null,this.currentPaletteIndex=e,!(e>=0&&e<this.PALETTES.length)){t.n=2;break}return o=this.PALETTES[e],i=r&&o.keyColor?function(){return r(Q(o.keyColor,255))}:r,t.n=1,this.animateColorPaletteTransition({theme:o.theme,frequency:o.frequency||this.DEFAULT_FREQUENCY,phase:o.phase||this.DEFAULT_PHASE},n,i);case 1:t.n=3;break;case 2:return t.n=3,this.animateColorPaletteTransition(null,n,r);case 3:return t.a(2)}},t,this)})),function(t){return u.apply(this,arguments)})},{key:"generateRandomPalette",value:function(){var t=Math.random()*Math.PI*2,e=Math.max(0,Math.cos(t)),n=Math.max(0,Math.cos(t-2*Math.PI/3)),r=Math.max(0,Math.cos(t+2*Math.PI/3)),o=.8+.4*Math.random(),i=1+.8*Math.random();return{theme:[o+e*i,o+n*i,o+r*i],frequency:[1+9*Math.random(),1+9*Math.random(),1+9*Math.random()],phase:[Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2]}}},{key:"animateColorPaletteTransition",value:(c=Qn(Hn().m(function t(e){var n,r,o,i,a,s,c,l,u=this,f=arguments;return Hn().w(function(t){for(;;)switch(t.n){case 0:return n=f.length>1&&void 0!==f[1]?f[1]:250,r=f.length>2&&void 0!==f[2]?f[2]:null,e?Array.isArray(e)&&(e={theme:e,frequency:Yn(this.frequency),phase:Yn(this.phase)}):e=this.generateRandomPalette(),this.stopCurrentColorAnimations(),o=Yn(this.colorPalette),i=Yn(this.frequency),a=Yn(this.phase),s=e.theme,c=e.frequency||this.DEFAULT_FREQUENCY,l=e.phase||this.DEFAULT_PHASE,t.n=1,new Promise(function(t){u._colorAnimationResolve=t;var e=null,f=function(d){e||(e=d);var h=Math.min((d-e)/n,1);u.colorPalette=[Y(o[0],s[0],h),Y(o[1],s[1],h),Y(o[2],s[2],h)],u.frequency=[Y(i[0],c[0],h),Y(i[1],c[1],h),Y(i[2],c[2],h)],u.phase=[Y(a[0],l[0],h),Y(a[1],l[1],h),Y(a[2],l[2],h)],u.draw(),r&&r(),h<1?u.currentColorAnimationFrame=requestAnimationFrame(f):(u._colorAnimationResolve=null,u.stopCurrentColorAnimations(),t())};u.currentColorAnimationFrame=requestAnimationFrame(f)});case 1:return t.a(2)}},t,this)})),function(t){return c.apply(this,arguments)})},{key:"animateTravelToPreset",value:(s=Qn(Hn().m(function t(e){var n,r,o,a,s,c,u,f,d,h,m,p,v,g,b,_,T,E,A,w,P,x,L,S,I,C,D,k,F,M=arguments;return Hn().w(function(t){for(;;)switch(t.n){case 0:if(o=M.length>1&&void 0!==M[1]?M[1]:2e3,a=M.length>2&&void 0!==M[2]?M[2]:1e3,s=M.length>3&&void 0!==M[3]?M[3]:3500,c=M.length>4&&void 0!==M[4]?M[4]:null,i("Traveling to preset: ".concat(JSON.stringify(e))),u=W(null!==(n=e.rotation)&&void 0!==n?n:this.DEFAULT_ROTATION),f=Math.abs(Math.log(this.zoom/e.zoom)),d=f<.01,h=f<2.5,m=Math.hypot(this.pan[0]-e.pan[0],this.pan[1]-e.pan[1]),p=e.zoom,g=(v=m/p)<.1,b=v<3,_=-1,T=!0,e.paletteId&&(_=this.PALETTES.findIndex(function(t){return t.id===e.paletteId}),T=_<0||_===this.currentPaletteIndex),E=s*(null!==(r=e.speed)&&void 0!==r?r:1),A=Math.max(500,Math.min(a,300+200*v+150*f)),!(d&&g&&T)){t.n=2;break}return t.n=1,this.animateRotationTo(u,o,l.QUINT);case 1:t.n=13;break;case 2:if(!d||!g){t.n=4;break}return w=[this.animateRotationTo(u,o,l.QUINT)],T||w.push(this.animatePaletteByIdTransition(e,o,c)),t.n=3,Promise.all(w);case 3:t.n=13;break;case 4:if(!h||!b){t.n=6;break}return i("Near preset, readjusting (zoomRatio=".concat(f.toFixed(2),", panRatio=").concat(v.toFixed(2),")")),P=[this.animatePanAndZoomTo(e.pan,e.zoom,A,l.CUBIC),this.animateRotationTo(u,A,l.CUBIC)],T||P.push(this.animatePaletteByIdTransition(e,A,c)),t.n=5,Promise.all(P);case 5:t.n=13;break;case 6:if(!d){t.n=8;break}return x=[this.animatePanTo(e.pan,a,l.CUBIC),this.animateRotationTo(u,a,l.CUBIC)],T||x.push(this.animatePaletteByIdTransition(e,a,c)),t.n=7,Promise.all(x);case 7:t.n=13;break;case 8:if(!g){t.n=10;break}return L=[this.animateZoomRotationTo(e.zoom,u,A,l.QUINT)],T||L.push(this.animatePaletteByIdTransition(e,A,c)),t.n=9,Promise.all(L);case 9:t.n=13;break;case 10:if(!(this.zoom<.9*this.DEFAULT_ZOOM)){t.n=11;break}return S=this.rotation+(Math.random()*y*2-y),t.n=11,this.animateZoomRotationTo(this.DEFAULT_ZOOM,S,o,l.QUINT);case 11:return t.n=12,this.animatePanTo(e.pan,a,l.CUBIC);case 12:for(I=Math.floor(2*Math.random()),C=Math.random()>.5?1:-1,D=u-this.rotation;D>y;)D-=2*y;for(;D<-y;)D+=2*y;return k=this.rotation+D+C*I*y*2,F=[this.animateZoomRotationTo(e.zoom,k,E,l.NONE)],T||F.push(this.animatePaletteByIdTransition(e,E,c)),t.n=13,Promise.all(F);case 13:this.rotation=W(this.rotation),this.currentPresetIndex=e.index||0,this.markOrbitDirty(),this.draw();case 14:return t.a(2)}},t,this)})),function(t){return s.apply(this,arguments)})},{key:"animateDemo",value:(a=Qn(Hn().m(function t(){var e,n,r,o,i,a,s,c,l=arguments;return Hn().w(function(t){for(;;)switch(t.n){case 0:if(e=!(l.length>0&&void 0!==l[0])||l[0],n=l.length>1&&void 0!==l[1]?l[1]:null,r=l.length>2&&void 0!==l[2]?l[2]:null,o=l.length>3&&void 0!==l[3]?l[3]:[],this.stopAllNonColorAnimations(),(i=[].concat(Yn(this.PRESETS),Yn(o))).length){t.n=1;break}return t.a(2);case 1:this.demoActive=!0,a=0,s=function(t){if(i.length<=1)return 0;if(t){var e;do{e=Math.floor(Math.random()*i.length)}while(e===a&&i.length>1);return e}return(a+1)%i.length};case 2:if(!this.demoActive){t.n=6;break}if(a=s(e),c=i[a]){t.n=3;break}return t.a(3,6);case 3:return t.n=4,this.animateTravelToPreset(c,3e3,1e3,3e3,n);case 4:return r&&r(),t.n=5,tt(3500);case 5:t.n=2;break;case 6:case 7:return t.a(2)}},t,this)})),function(){return a.apply(this,arguments)})}],r&&Wn(n.prototype,r),o&&Wn(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o,a,s,c,u}(wt);const sr=ar;function cr(t){return cr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cr(t)}function lr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ur(r.key),r)}}function ur(t){var e=function(t,e){if("object"!=cr(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=cr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==cr(e)?e:e+""}function fr(t,e,n){return e=pr(e),function(t,e){if(e&&("object"==cr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,dr()?Reflect.construct(e,n||[],pr(t).constructor):e.apply(t,n))}function dr(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(dr=function(){return!!t})()}function hr(t,e,n,r){var o=mr(pr(1&r?t.prototype:t),e,n);return 2&r&&"function"==typeof o?function(t){return o.apply(n,t)}:o}function mr(){return mr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=pr(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},mr.apply(null,arguments)}function pr(t){return pr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},pr(t)}function vr(t,e){return vr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},vr(t,e)}var yr=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=fr(this,e,[t])).termCount=1e3,n.MIN_ZOOM=4e3,n.DEFAULT_ZOOM=30,n.useAnalyticExtension=!0,n.init(),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&vr(t,e)}(e,t),n=e,(r=[{key:"updateUniforms",value:function(){this.termCountLoc=this.gl.getUniformLocation(this.program,"u_termCount"),this.useAnalyticExtensionLoc=this.gl.getUniformLocation(this.program,"u_useAnalyticExtension"),hr(e,"updateUniforms",this,3)([])}},{key:"draw",value:function(){this.gl.uniform1i(this.termCountLoc,this.termCount),this.gl.uniform1i(this.useAnalyticExtensionLoc,this.useAnalyticExtension?1:0),hr(e,"draw",this,3)([])}},{key:"createFragmentShaderSource",value:function(){return"precision highp float;\r\n\r\nuniform vec2 u_resolution;\r\nuniform float u_zoom;\r\nuniform vec2 u_pan;\r\nuniform int u_termCount;\r\nuniform bool u_useAnalyticExtension;// Toggle for analytic extension\r\n\r\nconst float PI = 3.14159265359;\r\n\r\n// HSL to RGB conversion function.\r\nvec3 hsl2rgb(vec3 hsl) {\r\n    float h = hsl.x, s = hsl.y, l = hsl.z;\r\n    float c = (1.0 - abs(2.0 * l - 1.0)) * s;\r\n    float hprime = h * 6.0;\r\n    float x = c * (1.0 - abs(mod(hprime, 2.0) - 1.0));\r\n    vec3 rgb;\r\n    if (0.0 <= hprime && hprime < 1.0) {\r\n        rgb = vec3(c, x, 0.0);\r\n    } else if (1.0 <= hprime && hprime < 2.0) {\r\n        rgb = vec3(x, c, 0.0);\r\n    } else if (2.0 <= hprime && hprime < 3.0) {\r\n        rgb = vec3(0.0, c, x);\r\n    } else if (3.0 <= hprime && hprime < 4.0) {\r\n        rgb = vec3(0.0, x, c);\r\n    } else if (4.0 <= hprime && hprime < 5.0) {\r\n        rgb = vec3(x, 0.0, c);\r\n    } else {\r\n        rgb = vec3(c, 0.0, x);\r\n    }\r\n    float m = l - 0.5 * c;\r\n    return rgb + vec3(m);\r\n}\r\n\r\n// Basic complex division.\r\nvec2 c_div(vec2 a, vec2 b) {\r\n    float denom = b.x * b.x + b.y * b.y;\r\n    return vec2((a.x * b.x + a.y * b.y) / denom, (a.y * b.x - a.x * b.y) / denom);\r\n}\r\n\r\n// Original zeta series (for Re(s) > 1)\r\nvec2 zeta(vec2 s) {\r\n    vec2 sum = vec2(0.0);\r\n    for (int n = 1; n <= 100; ++n) {\r\n        if (n > u_termCount) break;\r\n        float nf = float(n);\r\n        float scale = 1.0 / pow(nf, s.x);\r\n        float angle = -s.y * log(nf);\r\n        vec2 term = vec2(scale * cos(angle), scale * sin(angle));\r\n        if (length(term) < 1e-6) break;\r\n        sum += term;\r\n    }\r\n    return sum;\r\n}\r\n\r\n// Dirichlet eta series (alternating series)\r\nvec2 eta(vec2 s) {\r\n    vec2 sum = vec2(0.0);\r\n    for (int n = 1; n <= 100; ++n) {\r\n        if (n > u_termCount) break;\r\n        float nf = float(n);\r\n        float sign = (mod(nf, 2.0) < 1.0) ? -1.0 : 1.0;\r\n        float scale = 1.0 / pow(nf, s.x);\r\n        float angle = -s.y * log(nf);\r\n        vec2 term = sign * vec2(scale * cos(angle), scale * sin(angle));\r\n        if (length(term) < 1e-6) break;\r\n        sum += term;\r\n    }\r\n    return sum;\r\n}\r\n\r\n// Analytic continuation: ζ(s) = η(s) / (1 - 2^(1-s))\r\nvec2 analyticZeta(vec2 s) {\r\n    vec2 etaVal = eta(s);\r\n    float log2 = 0.69314718;// ln(2)\r\n    float expReal = exp((1.0 - s.x) * log2);\r\n    float expImag = -s.y * log2;\r\n    vec2 twoPow = vec2(expReal * cos(expImag), expReal * sin(expImag));\r\n    vec2 denom = vec2(1.0 - twoPow.x, 0.0 - twoPow.y);\r\n    return c_div(etaVal, denom);\r\n}\r\n\r\nvoid main() {\r\n    // Map pixel coordinates to the fractal plane.\r\n    vec2 uv = (gl_FragCoord.xy - 0.5 * u_resolution) / u_resolution.y;\r\n    vec2 coord = uv * u_zoom + u_pan;\r\n\r\n    // Choose zeta computation based on analytic extension toggle.\r\n    vec2 z;\r\n    if (u_useAnalyticExtension)\r\n    z = analyticZeta(coord);\r\n\r\n    else\r\n    z = zeta(coord);\r\n\r\n    float mag = length(z);\r\n    float phase = atan(z.y, z.x);\r\n\r\n    // Fractal-inspired HSL coloring:\r\n    // Map phase (angle) to hue (normalized to [0, 1]).\r\n    float hue = mod((phase / (2.0 * PI)) + 1.0, 1.0);\r\n    // Lightness based on the logarithm of the magnitude.\r\n    float lightness = smoothstep(0.0, 1.0, log(mag + 1.0));\r\n    // Full saturation for vivid colors.\r\n    float saturation = 1.0;\r\n\r\n    vec3 color = hsl2rgb(vec3(hue, saturation, lightness));\r\n    gl_FragColor = vec4(color, 1.0);\r\n}"}},{key:"onProgramCreated",value:function(){}},{key:"needsRebase",value:function(){}}])&&lr(n.prototype,r),o&&lr(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(wt);const gr=yr;var br,_r,Tr,Er,Ar,wr,Pr=0;function xr(t){t instanceof Ma&&(wr=t,_r=document.getElementById("realSlider"),Er=document.getElementById("realSliderValue"),Tr=document.getElementById("imagSlider"),Ar=document.getElementById("imagSliderValue"),_r.addEventListener("input",Cr),Tr.addEventListener("input",Dr),(br=document.getElementById("sliders")).style.display="flex")}function Lr(){wr.draw(),fi(),S(),Si(),wr.demoTime=0}function Sr(t,e){var n=Math.abs(e)<.01;t.classList.toggle("near-zero",n)}function Ir(t){return Math.abs(t)<.005?0:t}var Cr=function(){var t=Ir(parseFloat(_r.value));wr.c[0]=t,Er.textContent=t.toFixed(4),Sr(_r,t),Lr()},Dr=function(){var t=Ir(parseFloat(Tr.value));wr.c[1]=t,Ar.textContent="".concat(t.toFixed(4),"i"),Sr(Tr,t),Lr()};function kr(){ri()&&(_r.value=parseFloat(wr.c[0].toFixed(2)),Tr.value=parseFloat(wr.c[1].toFixed(2)),Er.innerText=_r.value,Ar.innerText=Tr.value+"i",wr.demoTime=0)}function Fr(){var t=performance.now();t-Pr<50||(Pr=t,Er.innerText=wr.c[0].toFixed(4),Ar.innerText=wr.c[1].toFixed(4)+"i",_r.value=parseFloat(wr.c[0].toFixed(4)),Tr.value=parseFloat(wr.c[1].toFixed(4)),Sr(_r,wr.c[0]),Sr(Tr,wr.c[1]))}function Mr(t){return Mr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mr(t)}function Or(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,zr(r.key),r)}}function Rr(t,e,n){return(e=zr(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function zr(t){var e=function(t,e){if("object"!=Mr(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=Mr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Mr(e)?e:e+""}var Nr,jr,Ur=function(){return t=function t(e,n){var a,s,c,l=this;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Rr(this,"panelSelector","debugInfo"),Rr(this,"update",function(t){var e,n,r,o,i,a,s;if(l.debugInfo&&l.fractalApp){var c=performance.now();l.pollGpuTimers();var u=t-l.perf.lastRafTs;l.perf.lastRafTs=t,l.perf.frameMs=u,l.perf.frameMsSmoothed=l.smooth(l.perf.frameMsSmoothed,u,.1),l.perf.fps=u>0?1e3/u:0;var f=performance.now(),d=f-l.perf.lastDrawCountReset;d>=1e3&&(l.perf.renderFps=1e3*l.perf.drawCount/d,l.perf.drawCount=0,l.perf.lastDrawCountReset=f);var h=window.devicePixelRatio||1,m=l.gl;if(m&&"function"==typeof m.getShaderPrecisionFormat){var p=m.getShaderPrecisionFormat(m.FRAGMENT_SHADER,m.HIGH_FLOAT),v={precision:p.precision,rangeMin:p.rangeMin,rangeMax:p.rangeMax},y=B(l.fractalApp.panDD.x),g=B(l.fractalApp.panDD.y),b=ri()?l.fractalApp.c[0]:0,_=ri()?l.fractalApp.c[1]:0,T=l.fractalApp.pan[0],E=l.fractalApp.pan[1],A=l.fractalApp.zoom,w=Math.max(A,1e-300),P=l.canvas.width/w,x=Math.hypot(y,g)/w,L=Math.log2(Math.max(x,1e-300)),S=Math.hypot(y-T,g-E)/w,I=l.fractalApp.orbitDirty?"DIRTY":"cached",C=Math.floor(-Math.log10(w)),D=function(t){return"bad"===t?"dbg-bad":"warn"===t?"dbg-warn":"dbg-ok"},k=100,F="ok";L>44?(F="bad",k-=40):L>34?(F="warn",k-=20):L>28&&(F="warn",k-=10);var M="ok";S>1?(M="bad",k-=25):S>.5?(M="warn",k-=12):S>.25&&(M="warn",k-=6);var O="ok";P<.75&&(O="warn",k-=10),P<.25&&(O="bad",k-=20);var R="ok";(k=Math.max(0,Math.min(100,Math.round(k))))<70&&(R="warn"),k<45&&(R="bad");var z="bad"===R||"warn"===R?" (pan:".concat(F,", drift:").concat(M,", scale:").concat(O,")"):"",N=l.perf.gpuMsSmoothed,j=Number.isFinite(N)?N>22?"bad":N>14?"warn":"ok":"ok",U=l.perf.renderFps<30?"bad":l.perf.renderFps<50?"warn":"ok",X=performance.now()-c;l.perf.panelCpuMs=X,l.perf.panelCpuMsSmoothed=l.smooth(l.perf.panelCpuMsSmoothed,X,.2);var G=performance.now()-l.perf.gpuLastUpdateTs>500,q=l.perf.gpuSupported?Number.isFinite(N)?G?"static":N>1e3/60?"GPU-bound":"OK":"awaiting measurement":"No GPU timer",H=[];l.fractalApp.currentPanAnimationFrame&&H.push("pan"),l.fractalApp.currentZoomAnimationFrame&&H.push("zoom"),l.fractalApp.currentRotationAnimationFrame&&H.push("rotation"),l.fractalApp.currentColorAnimationFrame&&H.push("color"),l.fractalApp.currentCAnimationFrame&&H.push("c");var J=H.length>0?H.join(", "):"none",V=di(),Q=l.fractalApp.rotation||0,Y=180*Q/Math.PI%360,K=l.fractalApp.currentPaletteIndex,W=K>=0&&null!==(e=l.fractalApp.PALETTES)&&void 0!==e&&null!==(e=e[K])&&void 0!==e&&e.id?l.fractalApp.PALETTES[K].id:-1===K?"Random/Cycling":"n/a",$=l.fractalApp.colorPalette||[0,0,0],tt=l.fractalApp.frequency&&l.fractalApp.phase,et=tt?"[".concat(l.fractalApp.frequency.map(function(t){return t.toFixed(2)}).join(", "),"]"):"n/a",nt=tt?"[".concat(l.fractalApp.phase.map(function(t){return t.toFixed(2)}).join(", "),"]"):"n/a",rt=null===(n=l.fractalApp.panDD)||void 0===n?void 0:n.x,ot=null===(r=l.fractalApp.panDD)||void 0===r?void 0:r.y,it=null!==(o=null==rt?void 0:rt.hi)&&void 0!==o?o:0,at=null!==(i=null==rt?void 0:rt.lo)&&void 0!==i?i:0,st=null!==(a=null==ot?void 0:ot.hi)&&void 0!==a?a:0,ct=null!==(s=null==ot?void 0:ot.lo)&&void 0!==s?s:0,lt=l.fractalApp._lastInteractionTime,ut=lt?((performance.now()-lt)/1e3).toFixed(1)+"s ago":"n/a",ft=l.gpu.unmaskedVendor||l.gpu.vendor||"unknown",dt=l.gpu.unmaskedRenderer||l.gpu.renderer||"unknown";l.debugInfo.innerHTML='\n            <span class="dbg-title" id="copyDebugInfo">DEBUG PANEL</span><span class="dbg-dim"> (\'L\' to toggle, middle-click to copy)</span><br/>\n            <span class="dbg-dim">───────────────────────────────────────────────────────</span><br/>\n            <span class="dbg-title">FRAG highp</span>: precision='.concat(Z(v.precision)," range=[").concat(Z(v.rangeMin),", ").concat(Z(v.rangeMax),']<br/>\n            <span class="dbg-title">GPU</span>: ').concat(Z(dt),' <span class="dbg-dim">(').concat(Z(ft),')</span><br/>\n            <span class="dbg-title">Mode:</span> ').concat(Z(Wo()),' <span class="dbg-dim">|</span> <span class="dbg-title">Canvas:</span> ').concat(Z(l.canvas.width),"x").concat(Z(l.canvas.height),' <span class="dbg-dim">(dpr=').concat(Z(h),')</span><br/>\n            <br/>\n            <span class="dbg-title">———— Transform ————</span><br/>\n            <span class="dbg-title">pan</span>=[').concat(Z(y.toFixed(18)),", ").concat(Z(g.toFixed(18)),']<br/>\n            <span class="dbg-dim">  DD.x: hi=').concat(Z(it.toExponential(6))," lo=").concat(Z(at.toExponential(6)),'</span><br/>\n            <span class="dbg-dim">  DD.y: hi=').concat(Z(st.toExponential(6))," lo=").concat(Z(ct.toExponential(6)),'</span><br/>\n            <span class="dbg-title">zoom</span>=').concat(Z(A.toExponential(6)),' <span class="dbg-dim">(1e-').concat(Z(C),')</span><br/>\n            <span class="dbg-title">rotation</span>=').concat(Z(Y.toFixed(2)),'° <span class="dbg-dim">(').concat(Z(Q.toFixed(4))," rad)</span><br/>\n            ").concat(ri()?'<span class="dbg-title">c</span>=['.concat(Z(b.toFixed(12)),", ").concat(Z(_.toFixed(12)),"]<br/>"):"",'\n            <br/>\n            <span class="dbg-title">———— Coloring ————</span><br/>\n            <span class="dbg-title">palette</span>: <span class="').concat(-1===K?"dbg-warn":"dbg-ok",'">').concat(Z(W),'</span> <span class="dbg-dim">(idx=').concat(Z(K),')</span><br/>\n            <span class="dbg-title">theme</span>=[').concat($.map(function(t){return t.toFixed(3)}).join(", "),"]<br/>\n            ").concat(tt?'<span class="dbg-title">freq</span>='.concat(Z(et),' <span class="dbg-title">phase</span>=').concat(Z(nt),"<br/>"):"",'\n            <br/>\n            <span class="dbg-title">———— State ————</span><br/>\n            <span class="dbg-title">animations</span>: <span class="').concat(H.length>0?"dbg-warn":"dbg-ok",'">').concat(Z(J),"</span> ").concat(V?'<span class="dbg-badge dbg-warn">ANIM</span>':"",'<br/>\n            <span class="dbg-title">iters</span>=').concat(Z(l.fractalApp.iterations),' <span class="dbg-dim">(max=').concat(Z(l.fractalApp.MAX_ITER),')</span><br/>\n            <span class="dbg-title">orbit</span>=<span class="').concat(l.fractalApp.orbitDirty?"dbg-warn":"dbg-ok",'">').concat(Z(I),'</span><br/>\n            <span class="dbg-title">lastInput</span>: <span class="dbg-dim">').concat(Z(ut),'</span><br/>\n            <br/>\n            <span class="dbg-title">———— Precision ————</span><br/>\n            <span class="dbg-title">health</span>:<span class="dbg-badge ').concat(D(R),'">').concat(k,'/100</span><span class="dbg-dim">').concat(Z(z),'</span><br/>\n            px/unit=<span class="').concat(D(O),'">').concat(Z(P.toExponential(2)),'</span> <span class="dbg-dim">|</span> log2(pan/z)=<span class="').concat(D(F),'">').concat(Z(L.toFixed(1)),'</span><br/>\n            ref drift=<span class="').concat(D(M),'">').concat(Z(S.toFixed(4)),'</span> <span class="dbg-dim">view-units</span><br/>\n            <br/>\n            <span class="dbg-title">———— Performance ————</span><br/>\n            <span class="dbg-title">renderFPS</span>=<span class="').concat(D(U),'">').concat(Z(l.perf.renderFps.toFixed(1)),'</span> <span class="dbg-dim">(rAF=').concat(Z(l.perf.fps.toFixed(0)),')</span><br/>\n            <span class="dbg-title">GPU</span>=<span class="').concat(D(j),'">').concat(l._renderGpuTime(N),'</span> <span class="dbg-dim">').concat(Z(q),"</span><br/>\n            ").concat(l._renderAdaptiveQuality(),"<br/>\n            "),requestAnimationFrame(l.update)}}}),Rr(this,"toggle",function(){l.debugInfo&&(l.debugInfo.style.display="block"===l.debugInfo.style.display?"none":"block")}),this.canvas=e,this.fractalApp=n,this.gl=null==n?void 0:n.gl,this.debugInfo=document.getElementById(this.panelSelector),this.debugInfo){if(I()){var u=0;this.debugInfo.addEventListener("pointerdown",function(t){var e=Date.now();e-u<300&&l.toggle(),u=e,t.preventDefault()})}this.debugInfo.addEventListener("auxclick",function(t){if(1===t.button){i(l.debugInfo.innerText,l.constructor.name,r);var e=l.debugInfo.innerText.substring(l.debugInfo.innerText.indexOf("FRAG"));navigator.clipboard.writeText(e).then(function(){i("Debug dump copied to clipboard!")},function(t){i("Debug dump not copied to clipboard! "+t.toString(),"",o)})}}),this.extTimer=(null===(a=this.gl)||void 0===a?void 0:a.getExtension("EXT_disjoint_timer_query"))||(null===(s=this.gl)||void 0===s?void 0:s.getExtension("EXT_disjoint_timer_query_webgl2"))||null,this.extRendererInfo=(null===(c=this.gl)||void 0===c?void 0:c.getExtension("WEBGL_debug_renderer_info"))||null,this.gpu={vendor:"unknown",renderer:"unknown",unmaskedVendor:null,unmaskedRenderer:null,webglVersion:"unknown",shadingLanguageVersion:"unknown",maxTextureSize:null,maxVaryings:null,maxFragUniforms:null,maxVertUniforms:null,maxViewportDims:null},this._initGpuInfo(),this.perf={lastRafTs:performance.now(),fps:0,frameMs:0,frameMsSmoothed:NaN,drawCount:0,lastDrawCountReset:performance.now(),renderFps:0,panelCpuMs:0,panelCpuMsSmoothed:NaN,gpuSupported:!!this.extTimer,gpuMs:NaN,gpuMsSmoothed:NaN,gpuDisjoint:!1,gpuLastUpdateTs:0,queryInFlight:null,pendingQueries:[]},this.toggle(),requestAnimationFrame(this.update)}},e=[{key:"setRenderer",value:function(t){this.fractalApp=t||null,this.gl=(null==t?void 0:t.gl)||null}},{key:"_initGpuInfo",value:function(){var t=this.gl;if(t)try{if(this.gpu.webglVersion=t.getParameter(t.VERSION)||"unknown",this.gpu.shadingLanguageVersion=t.getParameter(t.SHADING_LANGUAGE_VERSION)||"unknown",this.gpu.vendor=t.getParameter(t.VENDOR)||"unknown",this.gpu.renderer=t.getParameter(t.RENDERER)||"unknown",this.gpu.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.gpu.maxVaryings=t.getParameter(t.MAX_VARYING_VECTORS),this.gpu.maxFragUniforms=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),this.gpu.maxVertUniforms=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),this.gpu.maxViewportDims=t.getParameter(t.MAX_VIEWPORT_DIMS),this.extRendererInfo){var e=t.getParameter(this.extRendererInfo.UNMASKED_VENDOR_WEBGL),n=t.getParameter(this.extRendererInfo.UNMASKED_RENDERER_WEBGL);this.gpu.unmaskedVendor=e||null,this.gpu.unmaskedRenderer=n||null}}catch(t){}}},{key:"beginGpuTimer",value:function(){if(this.extTimer&&this.gl&&!this.perf.queryInFlight){this.perf.drawCount++;var t=this.extTimer.createQueryEXT();this.extTimer.beginQueryEXT(this.extTimer.TIME_ELAPSED_EXT,t),this.perf.queryInFlight=t}}},{key:"endGpuTimer",value:function(){this.extTimer&&this.gl&&this.perf.queryInFlight&&(this.extTimer.endQueryEXT(this.extTimer.TIME_ELAPSED_EXT),this.perf.pendingQueries.push(this.perf.queryInFlight),this.perf.queryInFlight=null)}},{key:"pollGpuTimers",value:function(){if(this.extTimer&&this.gl){var t=this.gl.getParameter(this.extTimer.GPU_DISJOINT_EXT);if(this.perf.gpuDisjoint=!!t,0!==this.perf.pendingQueries.length){var e=this.perf.pendingQueries[0];if(this.extTimer.getQueryObjectEXT(e,this.extTimer.QUERY_RESULT_AVAILABLE_EXT)){var n=this.extTimer.getQueryObjectEXT(e,this.extTimer.QUERY_RESULT_EXT);if(this.extTimer.deleteQueryEXT(e),this.perf.pendingQueries.shift(),this.perf.gpuDisjoint)this.perf.gpuMs=NaN;else{var r=n/1e6;this.perf.gpuMs=r,this.perf.gpuMsSmoothed=this.smooth(this.perf.gpuMsSmoothed,r,.15),this.perf.gpuLastUpdateTs=performance.now()}}}}}},{key:"smooth",value:function(t,e,n){return Number.isFinite(e)?Number.isFinite(t)?t+(e-t)*n:e:t}},{key:"_renderAdaptiveQuality",value:function(){var t=this.fractalApp.adaptiveQualityEnabled,e=Math.round(25),n=Math.round(59.99999999999999);if(!t)return'<span class="dbg-title">adaptQ</span>: <span class="dbg-dim">OFF</span> <span class="dbg-dim">(F to toggle)</span>';var r=this.fractalApp.extraIterations||0,o=this.fractalApp.adaptiveQualityMin||s,i=this.perf.gpuMsSmoothed,c="stable",l="dbg-ok";this.fractalApp.interactionActive?(c="paused",l="dbg-dim"):Number.isFinite(i)&&(i>40&&r>o?(c="reducing",l="dbg-warn"):i<a&&r<0&&(c="restoring",l="dbg-ok"));var u=100+Math.round(100*r/Math.abs(o)),f=r<0?u<50?"dbg-bad":"dbg-warn":r>0?"dbg-ok":"dbg-dim",d=Math.abs(o);return'<span class="dbg-title">adaptQ</span>: <span class="'.concat(f,'">').concat(r>0?"+":"").concat(r,'</span> <span class="dbg-dim">[').concat(o,"..+").concat(d,']</span> <span class="dbg-dim">(').concat(u,'%)</span> <span class="').concat(l,'">[').concat(c,']</span> <span class="dbg-dim">[').concat(e,"&larr;").concat(n," FPS]</span>")}},{key:"_renderGpuTime",value:function(t){return Number.isFinite(t)?performance.now()-this.perf.gpuLastUpdateTs>500?'<span class="dbg-dim">'.concat(t.toFixed(2),"ms (stale)</span>"):"".concat(t.toFixed(2),"ms"):"n/a"}}],e&&Or(t.prototype,e),n&&Or(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n}();function Br(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,a,s=[],c=!0,l=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(s.push(r.value),s.length!==e);c=!0);}catch(t){l=!0,o=t}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Xr(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Xr(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function Zr(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3.5,o=function(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,r=0,o=0,i=0,a=0,s=[],c=!1,l=n,u=0,f=0,d=0;d<n;d++){var h=2*(r*a+o*i);i=2*(r*i-o*a)+1,a=h;var m=2*r*o+e,p=(r=r*r-o*o+t)*r+(o=m)*o;if(d>=50&&d%10==0){for(var v=0;v<s.length;v++){var y=Br(s[v],3),g=y[0],b=y[1],_=y[2],T=r-g,E=o-b;if(T*T+E*E<1e-10){var A=d-_;return{escaped:!1,iterations:n,distance:0,period:A,recommendedZoom:Math.max(.01,Math.min(1.5,1.5/Math.pow(A,.7)))}}}s.push([r,o,d]),s.length>100&&s.shift()}if(p>1e8){c=!0,l=d,u=Math.sqrt(p),f=Math.sqrt(i*i+a*a);break}}if(c&&f>0){var w=u*Math.log(u)/f,P=Math.pow(10,-l/300),x=Math.pow(w,.7);return{escaped:!0,iterations:l,distance:w,period:0,recommendedZoom:Math.max(1e-8,Math.min(2,Math.min(P,x)))}}return{escaped:!1,iterations:n,distance:0,period:0,recommendedZoom:.5}}(t,e,2e3),i=r/Math.max(n,.001),a=o.recommendedZoom;return i>1&&(a=o.recommendedZoom/Math.sqrt(i)),Math.max(1e-6,Math.min(2,a))}function Gr(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,a,s=[],c=!0,l=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(s.push(r.value),s.length!==e);c=!0);}catch(t){l=!0,o=t}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return s}}(t,e)||Vr(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qr(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var c=r&&r.prototype instanceof s?r:s,l=Object.create(c.prototype);return Hr(l,"_invoke",function(n,r,o){var i,s,c,l=0,u=o||[],f=!1,d={p:0,n:0,v:t,a:h,f:h.bind(t,4),d:function(e,n){return i=e,s=0,c=t,d.n=n,a}};function h(n,r){for(s=n,c=r,e=0;!f&&l&&!o&&e<u.length;e++){var o,i=u[e],h=d.p,m=i[2];n>3?(o=m===r)&&(c=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=t):i[0]<=h&&((o=n<2&&h<i[1])?(s=0,d.v=r,d.n=i[1]):h<m&&(o=n<3||i[0]>r||r>m)&&(i[4]=n,i[5]=r,d.n=m,s=0))}if(o||n>1)return a;throw f=!0,r}return function(o,u,m){if(l>1)throw TypeError("Generator is already running");for(f&&1===u&&h(u,m),s=u,c=m;(e=s<2?t:c)||!f;){i||(s?s<3?(s>1&&(d.n=-1),h(s,c)):d.n=c:d.v=c);try{if(l=2,i){if(s||(o="next"),e=i[o]){if(!(e=e.call(i,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,s<2&&(s=0)}else 1===s&&(e=i.return)&&e.call(i),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);i=t}else if((e=(f=d.n<0)?c:n.call(r,d))!==a)break}catch(e){i=t,s=1,c=e}finally{l=1}}return{value:e,done:f}}}(n,o,i),!0),l}var a={};function s(){}function c(){}function l(){}e=Object.getPrototypeOf;var u=[][r]?e(e([][r]())):(Hr(e={},r,function(){return this}),e),f=l.prototype=s.prototype=Object.create(u);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,Hr(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return c.prototype=l,Hr(f,"constructor",l),Hr(l,"constructor",c),c.displayName="GeneratorFunction",Hr(l,o,"GeneratorFunction"),Hr(f),Hr(f,o,"Generator"),Hr(f,r,function(){return this}),Hr(f,"toString",function(){return"[object Generator]"}),(qr=function(){return{w:i,m:d}})()}function Hr(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Hr=function(t,e,n,r){function i(e,n){Hr(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Hr(t,e,n,r)}function Jr(t){return function(t){if(Array.isArray(t))return Qr(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||Vr(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Vr(t,e){if(t){if("string"==typeof t)return Qr(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Qr(t,e):void 0}}function Qr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function Yr(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function Kr(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var i=t.apply(e,n);function a(t){Yr(i,r,o,a,s,"next",t)}function s(t){Yr(i,r,o,a,s,"throw",t)}a(void 0)})}}var Wr,$r,to,eo,no,ro,oo,io,ao,so,co,lo,uo,fo,ho,mo,po,vo,yo,go,bo,_o,To,Eo,Ao,wo,Po,xo,Lo,So,Io,Co,Do,ko,Fo,Mo,Oo=c.MANDELBROT,Ro=d,zo=h,No=h,jo=null,Uo=!1,Bo=!0,Xo=!1,Zo=-1,Go=0,qo=[],Ho=[],Jo=[],Vo=[],Qo=0,Yo=100,Ko=null,Wo=function(){return t=Oo,Object.keys(c).find(function(e){return c[e]===t})||"UNKNOWN";var t};function $o(t){return ti.apply(this,arguments)}function ti(){return ti=Kr(qr().m(function e(r){var o,i,a,s,l,u,f=arguments;return qr().w(function(e){for(;;)switch(e.n){case 0:if(l=f.length>1&&void 0!==f[1]?f[1]:null,r!==Oo){e.n=1;break}if(n!==t){e.n=1;break}return e.a(2);case 1:mi(),jr.destroy(),u=r,e.n=u===c.MANDELBROT?2:u===c.JULIA?3:u===c.RIEMANN?4:5;break;case 2:return oi(),e.a(3,6);case 3:return ii(),e.a(3,6);case 4:return ai(),e.a(3,6);case 5:return e.a(2);case 6:if(null===(o=Mo)||void 0===o||null===(i=o.setRenderer)||void 0===i||i.call(o,null),null===(a=Mo)||void 0===a||null===(s=a.setRenderer)||void 0===s||s.call(a,jr),I()?(xn(),wn(jr)):(Zn(),Xn(jr),qe(),Ze(jr)),jr.reset(),!l){e.n=10;break}if(Si(),pi(),!ri()){e.n=8;break}return e.n=7,jr.animateTravelToPreset({pan:[0,0],c:l.c,zoom:l.zoom,rotation:0},500);case 7:e.n=9;break;case 8:return e.n=9,jr.animateTravelToPreset({pan:l.pan,zoom:l.zoom,rotation:0},500,500,500);case 9:mi(),x(Oo,jr.pan[0],jr.pan[1],jr.zoom,jr.rotation,jr.c?jr.c[0]:null,jr.c?jr.c[1]:null,ci());case 10:case 11:return e.a(2)}},e)})),ti.apply(this,arguments)}function ei(t){return ni.apply(this,arguments)}function ni(){return(ni=Kr(qr().m(function t(e){var n,r,o,i;return qr().w(function(t){for(;;)switch(t.n){case 0:if(e!==Oo){t.n=1;break}return t.a(2);case 1:if(e!==c.MANDELBROT){t.n=3;break}return n=Gr(jr.c,2),r=n[0],o=n[1],i=Zr(r,o,jr.zoom,3.5),t.n=2,$o(c.MANDELBROT,{pan:jr.c.slice(),zoom:i,rotation:0});case 2:t.n=4;break;case 3:return t.n=4,$o(c.JULIA,{pan:[0,0],c:jr.pan.slice(),zoom:3.5,rotation:0});case 4:case 5:return t.a(2)}},t)}))).apply(this,arguments)}var ri=function(){return Oo===c.JULIA};function oi(){no.classList.remove("active"),eo.classList.add("active"),nt(Ho),Io.style.display="none",_r&&Tr&&br&&(_r.removeEventListener("input",Cr),Tr.removeEventListener("input",Dr),br.style.display="none"),Qt(),Xt&&(Xt.destroy(),Xt=null),jr.destroy(),jr=new sr(Nr),Oo=c.MANDELBROT,nt(qo),0!==Go&&Ii(),$i(),ia(),li(p),si(),window.location.hash=""}function ii(){jr.destroy(),jr=new Ma(Nr),Oo=c.JULIA,no.classList.add("active"),eo.classList.remove("active"),nt(qo),$i(),xr(jr),Fr(),nt(Ho),ca(),ia(),0!==Go&&Ii(),li(v),$r.style.background="rgba(20, 20, 20, 0.8)",ko.style.background="rgba(20, 20, 20, 0.8)",si(),window.location.hash="#julia"}function ai(){(jr=new gr(Nr)).useAnalyticExtension=!1,Oo=c.RIEMANN,nt(qo),window.location.hash="#zeta"}function si(){if(Co){var t=jr.PALETTES||[],e=jr.currentPaletteIndex,n=jr.paletteCyclingActive;if(t.length>0&&e>=0){var r=t[e];Co.title='Current: "'.concat(r.id,'" (T to cycle)')}else Co.title="Change Color Palette (T)";Jo.forEach(function(t,r){if(1===r)t.classList.toggle("active",n);else if(r>=2){var o=r-2;t.classList.toggle("active",e===o)}})}}function ci(){var t,e,n=(null===(t=jr)||void 0===t?void 0:t.PALETTES)||[],r=null===(e=jr)||void 0===e?void 0:e.currentPaletteIndex;return n.length>0&&r>=0&&r<n.length?n[r].id:null}function li(t){t||(t=Jr(jr.colorPalette));var e=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1.9;return Math.min(255,Math.floor(255*t*e))};Ro="rgba(".concat(e(t[0]),", ").concat(e(t[1]),", ").concat(e(t[2]),", 1)"),zo="rgba(".concat(e(t[0],.5),", ").concat(e(t[1],.5),", ").concat(e(t[2],.5),", 0.2)"),No="rgba(".concat(Math.floor(200*t[0]),", ").concat(Math.floor(200*t[1]),", ").concat(Math.floor(200*t[2]),", 0.1)");var n=document.querySelector(":root");n.style.setProperty("--bg-color",No),n.style.setProperty("--mid-color",zo),n.style.setProperty("--accent-color",Ro),function(t){if(t&&!(t.length<3)){var e=new Float32Array([0,0,0,t[0],t[1],t[2],0,0,0,1.2*t[0],1.2*t[1],1.2*t[2],.1,.1,.1]);Xt?Xt.animateColorPaletteTransition(e).then():Gt=e}}(t)}function ui(){Si(),Ii(),S()}function fi(){var t,e,n,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=performance.now(),i=o-Qo;if(i<Yo){if(r&&!Ko){var a=Math.max(Yo-i,0);Ko=setTimeout(function(){Ko=null,fi(!0)},a)}}else if(Qo=o,Nr&&jr){var s=Xo?' <span class="middot">🎬</span> ':"",l=null!==(t=B(jr.panDD.x))&&void 0!==t?t:0,u=null!==(e=B(jr.panDD.y))&&void 0!==e?e:0;s+="p:&nbsp;[".concat(l.toFixed(8),", ").concat(u.toFixed(8),'i] <span class="middot">&middot;</span> ');var f,d=null!==(n=jr.zoom)&&void 0!==n?n:0,h=180*jr.rotation/y%360;if(s+="r:&nbsp;".concat((h<0?h+360:h).toFixed(0),'° <span class="middot">&middot;</span> zoom:&nbsp;').concat(d.toExponential(0)),Oo===c.JULIA){var m,p,v=null!==(m=jr.c[0])&&void 0!==m?m:0,g=null!==(p=jr.c[1])&&void 0!==p?p:0;s+="<br/>c:&nbsp;[".concat(v.toFixed(4),", ").concat(g.toFixed(4),"i]")}if(Xo)Fo&&!Fo.classList.contains("animationActive")&&Fo.classList.add("animationActive");else null!==(f=Fo)&&void 0!==f&&f.classList.contains("animationActive")&&Fo.classList.remove("animationActive");Fo.innerHTML!==s&&(Fo.innerHTML=s)}}var di=function(){return Xo};function hi(){var t,e=document.getElementById("palette-cycle");if(e){var n=(null===(t=jr)||void 0===t?void 0:t.paletteCyclingActive)||!1,r=e.classList.contains("active");n&&!r?e.classList.add("active"):!n&&r&&e.classList.remove("active")}}function mi(){var t,e;Xo&&(Xo=!1,null===(t=Fo)||void 0===t||t.classList.remove("animation"),null===(e=jr)||void 0===e||e.stopAllNonColorAnimations(),so&&(so.innerText="Demo",so.classList.remove("active")),Po&&(Po.disabled=!1),Lo&&(Lo.disabled=!1),I()?Pn():Ge(),ri()&&(Tr.disabled=_r.disabled=!1,_r.classList.remove("thumbDisabled"),Tr.classList.remove("thumbDisabled")),setTimeout(function(){fi()},150))}function pi(){var t;Xo||(Xo=!0,null===(t=Fo)||void 0===t||t.classList.add("animation"),so&&(so.innerText="Stop",so.classList.add("active")),ta(),Po&&(Po.disabled=!0),na(),Lo&&(Lo.disabled=!0),I()?xn():qe(),ri()&&(Tr.disabled=_r.disabled=!0,_r.classList.add("thumbDisabled"),Tr.classList.add("thumbDisabled")),S())}function vi(){return yi.apply(this,arguments)}function yi(){return(yi=Kr(qr().m(function t(){var e;return qr().w(function(t){for(;;)switch(t.n){case 0:if(!Xo){t.n=1;break}return Si(),Zo=-1,jr.stopDemo(),mi(),t.a(2);case 1:Si(),pi(),jr.paletteCyclingActive&&(jr.stopCurrentColorAnimations(),hi()),e=Oo,t.n=e===c.MANDELBROT?2:e===c.JULIA?4:6;break;case 2:return t.n=3,gi();case 3:case 5:return t.a(3,7);case 4:return t.n=5,Ei();case 6:return mi(),t.a(3,7);case 7:case 8:return t.a(2)}},t)}))).apply(this,arguments)}function gi(){return bi.apply(this,arguments)}function bi(){return(bi=Kr(qr().m(function t(){return qr().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,jr.animateDemo(!0,li,si,zi());case 1:case 2:return t.a(2)}},t)}))).apply(this,arguments)}function _i(t,e){return Ti.apply(this,arguments)}function Ti(){return(Ti=Kr(qr().m(function t(e,n){var r,o;return qr().w(function(t){for(;;)switch(t.n){case 0:if(!Xo||n!==Zo){t.n=1;break}return t.a(2);case 1:if(Xo&&mi(),Si(),Zo=n,null===(r=Ho[n])||void 0===r||r.classList.add("active"),(o=e[n]).paletteId&&(jr.stopCurrentColorAnimations(),hi()),!(o.cxDirection<0&&o.endC[0]>=o.startC[0])){t.n=2;break}return t.a(2);case 2:if(!(o.cxDirection>0&&o.endC[0]<=o.startC[0])){t.n=3;break}return t.a(2);case 3:if(!(o.cyDirection<0&&o.endC[1]>=o.startC[1])){t.n=4;break}return t.a(2);case 4:if(!(o.cyDirection>0&&o.endC[1]<=o.startC[1])){t.n=5;break}return t.a(2);case 5:return pi(),$(500,jr,{c:o.startC,pan:o.pan,zoom:o.zoom},{pan:.5,zoom:2,c:1}),t.n=6,Promise.all([jr.animateToZoomAndC(jr.DEFAULT_ZOOM,o.startC,1500),jr.animatePaletteByIdTransition(o,2500,li)]);case 6:return si(),t.n=7,Promise.all([jr.animateDive(o),jr.animatePanZoomRotationTo(o.pan,o.zoom,o.rotation,1500)]);case 7:return t.a(2)}},t)}))).apply(this,arguments)}function Ei(){return Ai.apply(this,arguments)}function Ai(){return(Ai=Kr(qr().m(function t(){return qr().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,jr.animateDemo(!1,li,si,zi());case 1:case 2:return t.a(2)}},t)}))).apply(this,arguments)}function wi(t,e){return Pi.apply(this,arguments)}function Pi(){return(Pi=Kr(qr().m(function t(e,n){var r;return qr().w(function(t){for(;;)switch(t.n){case 0:if(Xo&&mi(),n!==Go){t.n=1;break}return t.a(2);case 1:if(Si(),pi(),null===(r=qo[n])||void 0===r||r.classList.add("active"),!ri()){t.n=3;break}return jr.demoTime=0,t.n=2,jr.animateTravelToPreset(e[n],1500,li);case 2:t.n=4;break;case 3:return t.n=4,jr.animateTravelToPreset(e[n],2e3,500,1500,li);case 4:hi(),Go=n,si(),mi(),x(Oo,jr.pan[0],jr.pan[1],jr.zoom,jr.rotation,jr.c?jr.c[0]:null,jr.c?jr.c[1]:null,ci());case 5:return t.a(2)}},t)}))).apply(this,arguments)}function xi(){Mo?Mo.toggle():(Mo=new Ur(Nr,jr,Ro),Li())}function Li(){var t=document.getElementById("verticalLine"),e=document.getElementById("horizontalLine");"block"===t.style.display&&"block"===e.style.display?(t.style.display="none",e.style.display="none"):(t.style.display="block",e.style.display="block")}function Si(){qo.concat(Ho).forEach(function(t){return null==t?void 0:t.classList.remove("active")})}function Ii(){Go=-1}function Ci(){return Di.apply(this,arguments)}function Di(){return(Di=Kr(qr().m(function t(){var e,n;return qr().w(function(t){for(;;)switch(t.n){case 0:if(0!==(e=jr.PALETTES||[]).length){t.n=1;break}return t.a(2);case 1:if(1===e.length)n=0;else do{n=Math.floor(Math.random()*e.length)}while(n===jr.currentPaletteIndex);return t.n=2,jr.applyPaletteByIndex(n,250,li);case 2:si(),hi();case 3:return t.a(2)}},t)}))).apply(this,arguments)}function ki(){Sn(Nr,jr,Ro)}function Fi(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=document.getElementById("headerContainer");null===t&&(t=!Bo),t?e.classList.remove("minimized"):e.classList.add("minimized"),Bo=t}function Mi(){return Oi.apply(this,arguments)}function Oi(){return(Oi=Kr(qr().m(function t(){return qr().w(function(t){for(;;)switch(t.n){case 0:li(ri()?v:p),mi(),jr.reset(),ri()?kr():Yt(),ui(),si(),hi(),qo[0].classList.add("active");case 1:return t.a(2)}},t)}))).apply(this,arguments)}function Ri(){return ri()?"u_julia_presets":"u_mandelbrot_presets"}function zi(){try{var t=localStorage.getItem(Ri());return t?JSON.parse(t):[]}catch(t){return[]}}function Ni(t){try{localStorage.setItem(Ri(),JSON.stringify(t))}catch(t){}}function ji(t){var e=zi(),n={id:t,pan:[B(jr.panDD.x),B(jr.panDD.y)],zoom:jr.zoom,rotation:jr.rotation,speed:10};ri()&&jr.c&&(n.c=Jr(jr.c)),jr.PALETTES&&jr.currentPaletteIndex>=0&&jr.currentPaletteIndex<jr.PALETTES.length&&(n.paletteId=jr.PALETTES[jr.currentPaletteIndex].id),e.push(n),Ni(e),nt(qo),$i(),i("Saved user preset: ".concat(t),"saveCurrentViewAsPreset")}function Ui(t){var e=zi();Ni(e=e.filter(function(e){return e.id!==t})),nt(qo),$i(),i("Deleted user preset: ".concat(t),"deleteUserPreset")}function Bi(){co&&(lo.value="",uo.disabled=!0,co.classList.add("show"),lo.focus())}function Xi(){co&&co.classList.remove("show")}function Zi(){co&&(lo.addEventListener("input",function(){uo.disabled=!lo.value.trim()}),uo.addEventListener("click",function(){var t=lo.value.trim();t&&(ji(t),Xi())}),fo.addEventListener("click",function(){Xi()}),co.addEventListener("click",function(t){t.target===co&&Xi()}),lo.addEventListener("keydown",function(t){if(t.stopPropagation(),"Enter"===t.key){var e=lo.value.trim();e&&(ji(e),Xi())}else"Escape"===t.key&&Xi()}),i("Initialized.","initSaveViewDialog"))}function Gi(){if(ho){wo&&(wo.style.display=ri()?"contents":"none");var t=B(jr.panDD.x),e=B(jr.panDD.y);mo.value=t.toFixed(8),po.value=e.toFixed(8),vo.value=jr.zoom.toExponential(6),yo.value=(180*jr.rotation/Math.PI).toFixed(2),ri()&&(go.value=jr.c[0].toFixed(8),bo.value=jr.c[1].toFixed(8)),_o.value="",To.textContent="",[mo,po,vo,yo,go,bo,_o].forEach(function(t){t&&t.classList.remove("invalid")}),ho.classList.add("show"),mo.focus()}}function qi(){ho&&ho.classList.remove("show")}function Hi(){var t=_o.value.trim();if(t)try{var e=JSON.parse(t);if(!e.pan||!Array.isArray(e.pan)||2!==e.pan.length)return{error:'JSON must include "pan" as array [x, y]'};if("number"!=typeof e.pan[0]||isNaN(e.pan[0]))return{error:'JSON "pan[0]" must be a valid number'};if("number"!=typeof e.pan[1]||isNaN(e.pan[1]))return{error:'JSON "pan[1]" must be a valid number'};if("number"!=typeof e.zoom||isNaN(e.zoom))return{error:'JSON "zoom" must be a valid number'};if(e.zoom<=0)return{error:'JSON "zoom" must be positive'};if("number"!=typeof e.rotation||isNaN(e.rotation))return{error:'JSON "rotation" must be a valid number (in radians)'};if(ri()){if(!e.c||!Array.isArray(e.c)||2!==e.c.length)return{error:'JSON must include "c" as array [real, imag] in Julia mode'};if("number"!=typeof e.c[0]||isNaN(e.c[0]))return{error:'JSON "c[0]" must be a valid number'};if("number"!=typeof e.c[1]||isNaN(e.c[1]))return{error:'JSON "c[1]" must be a valid number'}}var n={pan:[e.pan[0],e.pan[1]],zoom:e.zoom,rotation:e.rotation};return e.c&&Array.isArray(e.c)&&2===e.c.length&&(n.c=[e.c[0],e.c[1]]),e.paletteId&&e.paletteId.trim()&&(n.paletteId=e.paletteId),n}catch(t){return{error:"Invalid JSON: ".concat(t.message)}}var r=mo.value.trim(),o=po.value.trim(),i=vo.value.trim(),a=yo.value.trim();if(!r)return{error:"Pan X is required"};if(!o)return{error:"Pan Y is required"};if(!i)return{error:"Zoom is required"};if(!a)return{error:"Rotation is required"};var s=parseFloat(r),c=parseFloat(o),l=parseFloat(i),u=parseFloat(a);if(isNaN(s))return{error:'Pan X "'.concat(r,'" is not a valid number')};if(isNaN(c))return{error:'Pan Y "'.concat(o,'" is not a valid number')};if(isNaN(l))return{error:'Zoom "'.concat(i,'" is not a valid number')};if(l<=0)return{error:"Zoom must be a positive number"};if(isNaN(u))return{error:'Rotation "'.concat(a,'" is not a valid number')};var f={pan:[s,c],zoom:l,rotation:W(u*Math.PI/180)};if(ri()){var d=go.value.trim(),h=bo.value.trim();if(!d)return{error:"C Real is required in Julia mode"};if(!h)return{error:"C Imag is required in Julia mode"};var m=parseFloat(d),p=parseFloat(h);if(isNaN(m))return{error:'C Real "'.concat(d,'" is not a valid number')};if(isNaN(p))return{error:'C Imag "'.concat(h,'" is not a valid number')};f.c=[m,p]}return f}function Ji(){var t=Hi();return[mo,po,vo,yo,go,bo,_o].forEach(function(t){t&&t.classList.remove("invalid")}),t.error?(To.textContent=t.error,Eo.disabled=!0,_o.value.trim()?_o.classList.add("invalid"):t.error.includes("Pan X")?mo.classList.add("invalid"):t.error.includes("Pan Y")?po.classList.add("invalid"):t.error.includes("Zoom")?vo.classList.add("invalid"):t.error.includes("Rotation")?yo.classList.add("invalid"):t.error.includes("C Real")?go.classList.add("invalid"):t.error.includes("C Imag")&&bo.classList.add("invalid"),!1):(To.textContent="",Eo.disabled=!1,!0)}function Vi(){return Qi.apply(this,arguments)}function Qi(){return(Qi=Kr(qr().m(function t(){var e;return qr().w(function(t){for(;;)switch(t.n){case 0:if(!(e=Hi()).error){t.n=1;break}return To.textContent=e.error,t.a(2);case 1:if(qi(),pi(),!ri()){t.n=3;break}return t.n=2,jr.animateTravelToPreset(e,1500,li);case 2:t.n=4;break;case 3:return t.n=4,jr.animateTravelToPreset(e,1e3,500,1e3,li);case 4:mi();case 5:return t.a(2)}},t)}))).apply(this,arguments)}function Yi(){if(ho){[mo,po,vo,yo,go,bo].forEach(function(t){t&&t.addEventListener("input",function(t){var e=t.target.value,n=e.replace(/[^0-9.\-eE]/g,""),r=n.split(".");r.length>2&&(n=r[0]+"."+r.slice(1).join(""));var o=(n=n.replace(/-/g,function(t,e){if(0===e)return t;var r=n[e-1];return"e"===r||"E"===r?t:""})).split(/[eE]/);o.length>2&&(n=o[0]+"e"+o[1]),e!==n&&(t.target.value=n)})});var t=[mo,po,vo,yo,go,bo,_o];t.forEach(function(t){t&&t.addEventListener("input",Ji)}),Eo.addEventListener("click",Kr(qr().m(function t(){return qr().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,Vi();case 1:return t.a(2)}},t)}))),Ao.addEventListener("click",function(){qi()}),ho.addEventListener("click",function(t){t.target===ho&&qi()}),t.forEach(function(t){t&&t.addEventListener("keydown",function(t){t.stopPropagation(),"Enter"===t.key?Ji()&&Vi():"Escape"===t.key&&qi()})}),i("Initialized.","initEditCoordsDialog")}}function Ki(){var e="mouse";to.addEventListener("pointerdown",function(t){e=t.pointerType}),to.addEventListener("pointerenter",function(t){"touch"!==t.pointerType&&(jo&&(clearTimeout(jo),jo=null),Fi(!0))}),to.addEventListener("click",function(){("touch"===e||n>t)&&Fi()}),$r.addEventListener("pointerleave",function(t){"touch"!==t.pointerType&&Bo&&!n&&(jo=setTimeout(function(){Fi(!1),jo=null},3e3))}),Nr.addEventListener("pointerdown",function(){n||Fi(!1)}),i("Initialized.","initHeaderEvents")}function Wi(){oo.addEventListener("click",Kr(qr().m(function t(){return qr().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,Mi();case 1:return t.a(2)}},t)}))),io.addEventListener("click",Bi),so.addEventListener("click",vi),ao.addEventListener("click",ki),i("Initialized.","initControlButtonEvents")}function $i(){var t=document.getElementById("presets");qo=[];var e=Jr(jr.PRESETS);e.forEach(function(n){var r=document.createElement("button");if(r.id="preset-"+n.index,r.className="preset",r.title="".concat(n.id||"Preset "+n.index," ")+"".concat(n.index<10?"(Num ":"(").concat(n.index,")"),r.textContent=(n.id||n.index).toString(),n.paletteId&&jr.PALETTES){var o=jr.PALETTES.find(function(t){return t.id===n.paletteId});o&&o.keyColor&&(r.style.borderColor=o.keyColor,r.style.setProperty("--palette-color",o.keyColor),r.classList.add("has-palette"))}r.addEventListener("click",Kr(qr().m(function t(){return qr().w(function(t){for(;;)switch(t.n){case 0:return ta(),t.n=1,wi(e,n.index);case 1:return t.a(2)}},t)}))),t.appendChild(r),qo.push(r)}),zi().forEach(function(e){var n=document.createElement("button");if(n.id="preset-"+e.id,n.className="preset user-preset",n.title="".concat(e.id," (User) - Right-click to delete"),n.textContent=e.id,e.paletteId&&jr.PALETTES){var r=jr.PALETTES.find(function(t){return t.id===e.paletteId});r&&r.keyColor&&(n.style.borderColor=r.keyColor,n.style.setProperty("--palette-color",r.keyColor),n.classList.add("has-palette"))}n.addEventListener("click",Kr(qr().m(function t(){return qr().w(function(t){for(;;)switch(t.n){case 0:if(ta(),Si(),pi(),n.classList.add("active"),!ri()){t.n=2;break}return t.n=1,jr.animateTravelToPreset(e,1500,li);case 1:t.n=3;break;case 2:return t.n=3,jr.animateTravelToPreset(e,2e3,500,1500,li);case 3:mi(),x(Oo,jr.pan[0],jr.pan[1],jr.zoom,jr.rotation,jr.c?jr.c[0]:null,jr.c?jr.c[1]:null,ci());case 4:return t.a(2)}},t)}))),n.addEventListener("contextmenu",function(t){t.preventDefault(),confirm('Delete view "'.concat(e.id,'"?'))&&Ui(e.id)});var o=null,i=!1;n.addEventListener("touchstart",function(t){i=!1,o=setTimeout(function(){i||(t.preventDefault(),confirm('Delete view "'.concat(e.id,'"?'))&&Ui(e.id))},600)},{passive:!1}),n.addEventListener("touchmove",function(){i=!0,o&&(clearTimeout(o),o=null)}),n.addEventListener("touchend",function(){o&&(clearTimeout(o),o=null)}),t.appendChild(n),qo.push(n)}),qo.length>0&&qo[0].classList.add("active"),i("Initialized.","initPresetButtonEvents")}function ta(){var t;null===(t=xo)||void 0===t||t.classList.remove("show"),Po&&(Po.textContent="View ▾")}function ea(){Po.addEventListener("click",function(t){t.stopPropagation(),na(),oa(),function(){xo.classList.toggle("show");var t=xo.classList.contains("show");Po.textContent=t?"View ▴":"View ▾"}()}),document.addEventListener("click",function(t){xo.contains(t.target)||t.target===Po||ta()}),i("Initialized.","initPresetsDropdown")}function na(){var t;null===(t=So)||void 0===t||t.classList.remove("show"),Lo&&(Lo.textContent="Dive ▾")}function ra(){Lo.addEventListener("click",function(t){t.stopPropagation(),ta(),oa(),function(){So.classList.toggle("show");var t=So.classList.contains("show");Lo.textContent=t?"Dive ▴":"Dive ▾"}()}),document.addEventListener("click",function(t){So.contains(t.target)||t.target===Lo||na()}),i("Initialized.","initDivesDropdown")}function oa(){Do.classList.remove("show"),Co.textContent="Palette ▾"}function ia(){Jo=[],Do.innerHTML="";var t=jr.PALETTES||[],e=document.createElement("button");e.id="palette-random",e.className="palette",e.title="Pick a random palette (T)",e.innerHTML='<span class="color-swatch" style="background: linear-gradient(135deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3);"></span>Random',e.addEventListener("click",Kr(qr().m(function t(){return qr().w(function(t){for(;;)switch(t.n){case 0:return oa(),t.n=1,Ci();case 1:return t.a(2)}},t)}))),Do.appendChild(e),Jo.push(e);var n=document.createElement("button");n.id="palette-cycle",n.className="palette",n.title="Cycle through palettes sequentially (Shift+T)",n.innerHTML='<span class="color-swatch color-cycle-swatch"></span>Palette Cycle',n.addEventListener("click",Kr(qr().m(function t(){return qr().w(function(t){for(;;)switch(t.n){case 0:if(!jr.paletteCyclingActive){t.n=1;break}jr.stopCurrentColorAnimations(),t.n=2;break;case 1:return oa(),t.n=2,jr.startPaletteCycling(5e3,2e3,li,si);case 2:hi();case 3:return t.a(2)}},t)}))),Do.appendChild(n),Jo.push(n),t.forEach(function(t,e){var n=document.createElement("button");n.id="palette-"+e,n.className="palette",n.title=t.id;var r=t.keyColor||"#888",o=r;if(t.theme)if(15===t.theme.length){var i=Math.min(255,Math.round(255*t.theme[9])),a=Math.min(255,Math.round(255*t.theme[10])),s=Math.min(255,Math.round(255*t.theme[11]));o="rgb(".concat(i,", ").concat(a,", ").concat(s,")")}else if(3===t.theme.length){var c=r.replace("#",""),l=parseInt(c.substring(0,2),16),u=parseInt(c.substring(2,4),16),f=parseInt(c.substring(4,6),16),d=Math.min(255,Math.round(l*t.theme[0]*.7)),h=Math.min(255,Math.round(u*t.theme[1]*.7)),m=Math.min(255,Math.round(f*t.theme[2]*.7));o="rgb(".concat(d,", ").concat(h,", ").concat(m,")")}n.innerHTML='<span class="color-swatch" style="background: linear-gradient(135deg, '.concat(r," 50%, ").concat(o,' 50%);"></span>').concat(t.id),n.addEventListener("click",Kr(qr().m(function t(){return qr().w(function(t){for(;;)switch(t.n){case 0:return oa(),t.n=1,jr.applyPaletteByIndex(e,250,li);case 1:si(),hi();case 2:return t.a(2)}},t)}))),Do.appendChild(n),Jo.push(n)}),si(),i("Initialized.","initPaletteButtonEvents")}function aa(){Co.addEventListener("click",function(t){t.stopPropagation(),ta(),na(),function(){Do.classList.toggle("show");var t=Do.classList.contains("show");Co.textContent=t?"Palette ▴":"Palette ▾"}()}),document.addEventListener("click",function(t){Do.contains(t.target)||t.target===Co||oa()}),i("Initialized.","initPaletteDropdown")}function sa(){(Vo=Ho.concat(qo).concat(Jo)).push(oo,io,ao,so),Vo.forEach(function(t){t.addEventListener("mouseleave",function(){t.blur()}),t.addEventListener("mouseup",function(){t.blur()})}),i("Initialized.","initCommonButtonEvents")}function ca(){if(ri()){var t=document.getElementById("dives");Ho=[];var e=Jr(jr.DIVES);e.forEach(function(n,r){var o=document.createElement("button");if(o.id="dive"+r,o.className="dive",o.title=(n.id||"Preset "+r)+" (Shift+".concat(r,")"),o.textContent=n.id||r.toString(),n.paletteId&&jr.PALETTES){var i=jr.PALETTES.find(function(t){return t.id===n.paletteId});i&&i.keyColor&&(o.style.borderColor=i.keyColor,o.style.setProperty("--palette-color",i.keyColor),o.classList.add("has-palette"))}o.addEventListener("click",Kr(qr().m(function t(){return qr().w(function(t){for(;;)switch(t.n){case 0:return na(),t.n=1,_i(e,r);case 1:return t.a(2)}},t)}))),t.appendChild(o),Ho.push(o)}),Io.style.display="inline-block"}i("Initialized.","initDiveButtons")}function la(){eo.addEventListener("click",function(){var t=Kr(qr().m(function t(e){return qr().w(function(t){for(;;)switch(t.n){case 0:if(!e.ctrlKey){t.n=2;break}return t.n=1,ei(c.MANDELBROT);case 1:t.n=3;break;case 2:return t.n=3,$o(c.MANDELBROT);case 3:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}()),no.addEventListener("click",function(){var t=Kr(qr().m(function t(e){return qr().w(function(t){for(;;)switch(t.n){case 0:if(!e.ctrlKey){t.n=2;break}return t.n=1,ei(c.JULIA);case 1:t.n=3;break;case 2:return t.n=3,$o(c.JULIA);case 3:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}()),ro.addEventListener("click",Kr(qr().m(function t(){return qr().w(function(t){for(;;)switch(t.n){case 0:if(ro.blur(),!ri()){t.n=2;break}return t.n=1,ei(c.MANDELBROT);case 1:t.n=3;break;case 2:return t.n=3,ei(c.JULIA);case 3:return t.a(2)}},t)}))),ro.style.display="inline-flex",i("Initialized.","initFractalSwitchButtons")}function ua(){window.addEventListener("resize",function(){clearTimeout(Wr),Wr=setTimeout(function(){jr.resizeCanvas()},200)});var t=document.querySelectorAll(".draggable");t.forEach(function(t){t.addEventListener("mousedown",function(){var e=function(e){return function(t,e){var n=parseInt(window.getComputedStyle(e).left),r=parseInt(window.getComputedStyle(e).top);e.style.left="".concat(n+t.movementX,"px"),e.style.top="".concat(r+t.movementY,"px")}(e,t)};document.addEventListener("mousemove",e),document.addEventListener("mouseup",function(){document.removeEventListener("mousemove",e)},{once:!0})})}),i("Initialized.","initWindowEvents")}function fa(){Fo.addEventListener("mouseenter",function(){Xo||(Fo.innerHTML="Left click to copy, Right click to edit.")}),Fo.addEventListener("mouseleave",function(){Xo||fi()}),Fo.addEventListener("click",function(){Xo||da()}),Fo.addEventListener("contextmenu",function(t){t.preventDefault(),Xo||Gi()});var t=null;Fo.addEventListener("touchstart",function(e){Xo||(t=setTimeout(function(){e.preventDefault(),Gi(),t=null},500))},{passive:!1}),Fo.addEventListener("touchend",function(){t&&(clearTimeout(t),t=null)}),Fo.addEventListener("touchmove",function(){t&&(clearTimeout(t),t=null)})}function da(){var t=B(jr.panDD.x),e=B(jr.panDD.y),n=Math.random().toString(36).slice(2).substring(2,6),r=ci()||"",o='{"id": "'.concat(n,'", ')+(ri()?'"c": ['.concat(jr.c,"], "):"")+'"pan": ['.concat(Z(t.toFixed(24)),", ").concat(Z(e.toFixed(24)),"], ")+'"rotation": '.concat(W(jr.rotation),', "zoom": ').concat(jr.zoom,', "paletteId": "').concat(r,'"}');navigator.clipboard.writeText(o).then(function(){Fo.innerHTML="Copied to clipboard!"},function(t){})}function ha(){eo=document.getElementById("mandelbrotSwitch"),no=document.getElementById("juliaSwitch"),ro=document.getElementById("persistSwitch"),$r=document.getElementById("headerContainer"),to=document.getElementById("logo"),ko=document.getElementById("infoLabel"),Fo=document.getElementById("infoText"),oo=document.getElementById("reset"),io=document.getElementById("saveView"),ao=document.getElementById("screenshot"),so=document.getElementById("demo"),Po=document.getElementById("presets-toggle"),xo=document.getElementById("presets"),Lo=document.getElementById("dives-toggle"),So=document.getElementById("dives"),Io=document.getElementById("dives-dropdown"),Co=document.getElementById("palette-toggle"),Do=document.getElementById("palettes"),document.getElementById("palette-dropdown"),co=document.getElementById("saveViewDialog"),lo=document.getElementById("saveViewName"),uo=document.getElementById("saveViewConfirm"),fo=document.getElementById("saveViewCancel"),ho=document.getElementById("editCoordsDialog"),mo=document.getElementById("editPanX"),po=document.getElementById("editPanY"),vo=document.getElementById("editZoom"),yo=document.getElementById("editRotation"),go=document.getElementById("editCx"),bo=document.getElementById("editCy"),_o=document.getElementById("editJsonInput"),To=document.getElementById("editCoordsError"),Eo=document.getElementById("editCoordsApply"),Ao=document.getElementById("editCoordsCancel"),wo=document.getElementById("juliaCInputs")}function ma(t){return pa.apply(this,arguments)}function pa(){return pa=Kr(qr().m(function t(r){var o;return qr().w(function(t){for(;;)switch(t.n){case 0:if(!Uo){t.n=1;break}return t.a(2);case 1:Nr=(jr=r).canvas,ha(),r instanceof Ma?(Oo=c.JULIA,no.classList.add("active"),eo.classList.remove("active"),xr(jr),Fr(),ca(),li(v),$r.style.background="rgba(20, 20, 20, 0.8)",ko.style.background="rgba(20, 20, 20, 0.8)",window.location.hash="#julia"):Jt(),$i(),ea(),ra(),ia(),aa(),ua(),Ki(),Wi(),Zi(),Yi(),fa(),la(),sa(),I()?wn(jr):(Xn(jr),Ze(jr)),si(),n!==e||C()||xi(),document.getElementById("versionLink").innerHTML="v".concat("2.1"),(o=document.getElementById("controlsHint"))&&(o.addEventListener("click",function(t){window.matchMedia("(pointer: coarse)").matches&&(t.preventDefault(),t.stopPropagation(),o.classList.toggle("active"))}),document.addEventListener("click",function(t){o.contains(t.target)||o.classList.remove("active")})),Uo=!0;case 2:return t.a(2)}},t)})),pa.apply(this,arguments)}function va(t){return va="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},va(t)}function ya(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var c=r&&r.prototype instanceof s?r:s,l=Object.create(c.prototype);return ga(l,"_invoke",function(n,r,o){var i,s,c,l=0,u=o||[],f=!1,d={p:0,n:0,v:t,a:h,f:h.bind(t,4),d:function(e,n){return i=e,s=0,c=t,d.n=n,a}};function h(n,r){for(s=n,c=r,e=0;!f&&l&&!o&&e<u.length;e++){var o,i=u[e],h=d.p,m=i[2];n>3?(o=m===r)&&(c=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=t):i[0]<=h&&((o=n<2&&h<i[1])?(s=0,d.v=r,d.n=i[1]):h<m&&(o=n<3||i[0]>r||r>m)&&(i[4]=n,i[5]=r,d.n=m,s=0))}if(o||n>1)return a;throw f=!0,r}return function(o,u,m){if(l>1)throw TypeError("Generator is already running");for(f&&1===u&&h(u,m),s=u,c=m;(e=s<2?t:c)||!f;){i||(s?s<3?(s>1&&(d.n=-1),h(s,c)):d.n=c:d.v=c);try{if(l=2,i){if(s||(o="next"),e=i[o]){if(!(e=e.call(i,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,s<2&&(s=0)}else 1===s&&(e=i.return)&&e.call(i),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);i=t}else if((e=(f=d.n<0)?c:n.call(r,d))!==a)break}catch(e){i=t,s=1,c=e}finally{l=1}}return{value:e,done:f}}}(n,o,i),!0),l}var a={};function s(){}function c(){}function l(){}e=Object.getPrototypeOf;var u=[][r]?e(e([][r]())):(ga(e={},r,function(){return this}),e),f=l.prototype=s.prototype=Object.create(u);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,ga(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return c.prototype=l,ga(f,"constructor",l),ga(l,"constructor",c),c.displayName="GeneratorFunction",ga(l,o,"GeneratorFunction"),ga(f),ga(f,o,"Generator"),ga(f,r,function(){return this}),ga(f,"toString",function(){return"[object Generator]"}),(ya=function(){return{w:i,m:d}})()}function ga(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}ga=function(t,e,n,r){function i(e,n){ga(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},ga(t,e,n,r)}function ba(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function _a(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var i=t.apply(e,n);function a(t){ba(i,r,o,a,s,"next",t)}function s(t){ba(i,r,o,a,s,"throw",t)}a(void 0)})}}function Ta(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function Ea(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ta(Object(n),!0).forEach(function(e){ka(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ta(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function Aa(t){return function(t){if(Array.isArray(t))return wa(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return wa(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?wa(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wa(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function Pa(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Fa(r.key),r)}}function xa(t,e,n){return e=Ca(e),function(t,e){if(e&&("object"==va(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,La()?Reflect.construct(e,n||[],Ca(t).constructor):e.apply(t,n))}function La(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(La=function(){return!!t})()}function Sa(t,e,n,r){var o=Ia(Ca(1&r?t.prototype:t),e,n);return 2&r&&"function"==typeof o?function(t){return o.apply(n,t)}:o}function Ia(){return Ia="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=Ca(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Ia.apply(null,arguments)}function Ca(t){return Ca=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ca(t)}function Da(t,e){return Da=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Da(t,e)}function ka(t,e,n){return(e=Fa(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Fa(t){var e=function(t,e){if("object"!=va(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=va(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==va(e)?e:e+""}var Ma=function(t){function e(t){var n,r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),ka(r=xa(this,e,[t]),"markOrbitDirty",function(){return r.orbitDirty=!0}),r.DEFAULT_ZOOM=Pt.l8[0].zoom,r.MAX_ZOOM=e.FF_LEGACY_JULIA_RENDERER?.003:1e-17,r.zoom=r.DEFAULT_ZOOM,r.DEFAULT_ROTATION=K(Pt.l8[0].rotation||0),r.rotation=r.DEFAULT_ROTATION,r.DEFAULT_C=[Pt.l8[0].c[0],Pt.l8[0].c[1]],r.c=Aa(r.DEFAULT_C),r.setPan(r.DEFAULT_PAN[0],r.DEFAULT_PAN[1]),r.refZ0=[0,0],r.refZ0DD={x:{hi:0,lo:0},y:{hi:0,lo:0}},r.refPan=Aa(r.DEFAULT_PAN),r.refPanDD={x:{hi:r.DEFAULT_PAN[0],lo:0},y:{hi:r.DEFAULT_PAN[1],lo:0}},r.orbitDirty=!0,r._prevPan0=NaN,r._prevPan1=NaN,r._prevZoom=NaN,r._prevC0=NaN,r._prevC1=NaN,r.MAX_ITER=5e3,r.REF_SEARCH_GRID=7,r.REF_SEARCH_RADIUS=.5,r.orbitTex=null,r.orbitData=null,r.floatTexExt=null,r.rebaseArmed=!0,r.PRESETS=Pt.l8.map(function(t){return Ea(Ea({},t),{},{rotation:K(t.rotation||0)})}),r.DIVES=Pt.gf.map(function(t){return Ea(Ea({},t),{},{rotation:K(t.rotation||0)})}),r.PALETTES=Pt.BG||[];var o=null===(n=Pt.l8[0])||void 0===n?void 0:n.paletteId;r.DEFAULT_PALETTE_INDEX=o?r.PALETTES.findIndex(function(t){return t.id===o}):0,r.DEFAULT_PALETTE_INDEX<0&&(r.DEFAULT_PALETTE_INDEX=0),r.currentPaletteIndex=r.DEFAULT_PALETTE_INDEX,r.innerStops=r.PALETTES.length>0?new Float32Array(r.PALETTES[r.currentPaletteIndex].theme):new Float32Array(m.theme);var i=r.PALETTES[r.currentPaletteIndex]||m,a=i.keyColor?V(i.keyColor):null;return r.colorPalette=a?[a.r,a.g,a.b]:[i.theme[9],i.theme[10],i.theme[11]],r.currentCAnimationFrame=null,r.cAnimationActive=!1,r.demoTime=0,r.init(),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Da(t,e)}(e,t),n=e,r=[{key:"onProgramCreated",value:function(){this.floatTexExt=this.gl.getExtension("OES_texture_float"),this.floatTexExt&&(this.orbitTex=this.gl.createTexture(),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.orbitTex),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.orbitData=new Float32Array(4*this.MAX_ITER),this.orbitTexLoc&&this.gl.uniform1i(this.orbitTexLoc,0),this.orbitWLoc&&this.gl.uniform1f(this.orbitWLoc,this.MAX_ITER),this.orbitDirty=!0)}},{key:"createFragmentShaderSource",value:function(){return(e.FF_LEGACY_JULIA_RENDERER?'#ifdef GL_ES\r\nprecision mediump float;\r\n#endif\r\n\r\n// Uniforms\r\nuniform vec2 u_resolution;    // Canvas resolution in pixels\r\nuniform vec2 u_pan;           // Pan offset in fractal space\r\nuniform float u_zoom;         // Zoom factor\r\nuniform float u_iterations;   // For normalizing the smooth iteration count\r\nuniform float u_rotation;     // Rotation (in radians)\r\nuniform vec2 u_c;             // Julia set constant\r\nuniform vec3 u_colorPalette;  // Color palette\r\nuniform vec3 u_innerStops[5]; // Color palette inner stops\r\n\r\n// Maximum iterations (compile-time constant required by GLSL ES 1.00).\r\nconst int MAX_ITERATIONS = __MAX_ITER__;\r\n\r\n// Define color stops as individual constants (RGB values in [0,1]).\r\n// Default stops (black, orange, white, blue, dark blue).\r\n\r\n// Interpolates between the five color stops.\r\n// 5 stops = 4 segments.\r\nvec3 getColorFromMap(float t) {\r\n    float segment = 1.0 / 4.0;\r\n    if (t <= segment) {\r\n        return mix(u_innerStops[0], u_innerStops[1], t / segment);\r\n    } else if (t <= 2.0 * segment) {\r\n        return mix(u_innerStops[1], u_innerStops[2], (t - segment) / segment);\r\n    } else if (t <= 3.0 * segment) {\r\n        return mix(u_innerStops[2], u_innerStops[3], (t - 2.0 * segment) / segment);\r\n    } else {\r\n        return mix(u_innerStops[3], u_innerStops[4], (t - 3.0 * segment) / segment);\r\n    }\r\n}\r\n\r\nvoid main() {\r\n    // Map fragment coordinates to normalized device coordinates\r\n    float aspect = u_resolution.x / u_resolution.y;\r\n    vec2 st = gl_FragCoord.xy / u_resolution;\r\n    st -= 0.5;       // center at (0,0)\r\n    st.x *= aspect;  // adjust x for aspect ratio\r\n\r\n    // Apply rotation\r\n    float cosR = cos(u_rotation);\r\n    float sinR = sin(u_rotation);\r\n    vec2 rotated = vec2(\r\n    st.x * cosR - st.y * sinR,\r\n    st.x * sinR + st.y * cosR\r\n    );\r\n\r\n    // Map screen coordinates to Julia space\r\n    vec2 z = rotated * u_zoom + u_pan;\r\n\r\n    // Determine escape iterations\r\n    int iterCount = MAX_ITERATIONS;\r\n    for (int i = 0; i < MAX_ITERATIONS; i++) {\r\n        if (dot(z, z) > 4.0) {\r\n            iterCount = i;\r\n            break;\r\n        }\r\n        // Julia set iteration.\r\n        z = vec2(z.x*z.x - z.y*z.y, 2.0*z.x*z.y) + u_c;\r\n    }\r\n\r\n    // If the point never escaped, render as simple color\r\n    if (iterCount == MAX_ITERATIONS) {\r\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\r\n    } else {\r\n        // Compute a smooth iteration value\r\n        float smoothColor = float(iterCount) - log2(log2(dot(z, z)));\r\n        float t = clamp(smoothColor / u_iterations, 0.0, 1.0);\r\n\r\n        // Apply a sine modulation to mimic the "sine" color mapping effect\r\n        // Frequency: 4π\r\n        // After the sine modulation\r\n        t = 0.5 + 0.6 * sin(t * 4.0 * 3.14159265);\r\n\r\n        // Lookup the color from the map\r\n        vec3 col = getColorFromMap(t);\r\n\r\n        // Use the user-defined color palette as a tint\r\n        // col *= u_colorPalette;\r\n\r\n        gl_FragColor = vec4(col, 1.0);\r\n    }\r\n}':"/*\r\n * Julia Fragment Shader (Rebased Perturbation)\r\n * @author    Radim Brnka\r\n * @project   Synaptory Fractal Traveler\r\n * @copyright 2025-2026\r\n *\r\n * @description\r\n * Julia set implementation using perturbation math relative to a\r\n * pre-calculated Mandelbrot reference orbit.\r\n * Formula: dz_{n+1} = 2*zref*dz + dz^2 + (c_julia - c_ref).\r\n *\r\n * @license   MIT\r\n */\r\n\r\nprecision highp float;\r\n\r\nuniform vec2  u_resolution;\r\nuniform float u_rotation;\r\n\r\n// delta z0 (pan - refZ0) computed on JS side for float64 precision\r\nuniform vec2  u_delta_z0_h;\r\nuniform vec2  u_delta_z0_l;\r\n\r\n// zoom hi/lo\r\nuniform float u_zoom_h;\r\nuniform float u_zoom_l;\r\n\r\n// Julia constant\r\nuniform vec2  u_c;\r\n\r\nuniform float u_iterations;\r\nuniform vec3  u_innerStops[5];\r\n\r\nuniform sampler2D u_orbitTex;\r\nuniform float     u_orbitW;\r\n\r\nconst int MAX_ITER = __MAX_ITER__;\r\n\r\n// --- df helpers ---\r\nstruct df  { float hi; float lo; };\r\nstruct df2 { df x; df y; };\r\n\r\ndf df_make(float hi, float lo){ df a; a.hi=hi; a.lo=lo; return a; }\r\ndf df_from(float a){ return df_make(a, 0.0); }\r\nfloat df_to_float(df a){ return a.hi + a.lo; }\r\n\r\ndf twoSum(float a, float b) {\r\n    float s  = a + b;\r\n    float bb = s - a;\r\n    float err = (a - (s - bb)) + (b - bb);\r\n    return df_make(s, err);\r\n}\r\n\r\ndf quickTwoSum(float a, float b) {\r\n    float s = a + b;\r\n    float err = b - (s - a);\r\n    return df_make(s, err);\r\n}\r\n\r\ndf df_add(df a, df b) {\r\n    df s = twoSum(a.hi, b.hi);\r\n    float t = a.lo + b.lo;\r\n    df u = twoSum(s.lo, t);\r\n    df v = twoSum(s.hi, u.hi);\r\n    float lo = u.lo + v.lo;\r\n    return quickTwoSum(v.hi, lo);\r\n}\r\n\r\ndf df_sub(df a, df b) { return df_add(a, df_make(-b.hi, -b.lo)); }\r\n\r\nconst float SPLIT = 4097.0;\r\n\r\ndf twoProd(float a, float b) {\r\n    float p = a * b;\r\n\r\n    float aSplit = a * SPLIT;\r\n    float aHi = aSplit - (aSplit - a);\r\n    float aLo = a - aHi;\r\n\r\n    float bSplit = b * SPLIT;\r\n    float bHi = bSplit - (bSplit - b);\r\n    float bLo = b - bHi;\r\n\r\n    float err = ((aHi * bHi - p) + aHi * bLo + aLo * bHi) + aLo * bLo;\r\n    return df_make(p, err);\r\n}\r\n\r\ndf df_mul(df a, df b) {\r\n    df p = twoProd(a.hi, b.hi);\r\n    float err = a.hi * b.lo + a.lo * b.hi + a.lo * b.lo;\r\n    df s = twoSum(p.lo, err);\r\n    df r = twoSum(p.hi, s.hi);\r\n    float lo = s.lo + r.lo;\r\n    return quickTwoSum(r.hi, lo);\r\n}\r\n\r\ndf df_mul_f(df a, float b) { return df_mul(a, df_from(b)); }\r\n\r\ndf2 df2_make(df x, df y){ df2 r; r.x=x; r.y=y; return r; }\r\ndf2 df2_add(df2 a, df2 b){ return df2_make(df_add(a.x, b.x), df_add(a.y, b.y)); }\r\n\r\ndf2 df2_mul(df2 a, df2 b) {\r\n    df axbx = df_mul(a.x, b.x);\r\n    df ayby = df_mul(a.y, b.y);\r\n    df axby = df_mul(a.x, b.y);\r\n    df aybx = df_mul(a.y, b.x);\r\n    return df2_make(df_sub(axbx, ayby), df_add(axby, aybx));\r\n}\r\n\r\ndf2 df2_sqr(df2 a){\r\n    df xx = df_mul(a.x, a.x);\r\n    df yy = df_mul(a.y, a.y);\r\n    df xy = df_mul(a.x, a.y);\r\n    return df2_make(df_sub(xx, yy), df_mul_f(xy, 2.0));\r\n}\r\n\r\nvec3 getColorFromMap(float t) {\r\n    float segment = 1.0 / 4.0;\r\n    if (t <= segment) {\r\n        return mix(u_innerStops[0], u_innerStops[1], t / segment);\r\n    } else if (t <= 2.0 * segment) {\r\n        return mix(u_innerStops[1], u_innerStops[2], (t - segment) / segment);\r\n    } else if (t <= 3.0 * segment) {\r\n        return mix(u_innerStops[2], u_innerStops[3], (t - 2.0 * segment) / segment);\r\n    } else {\r\n        return mix(u_innerStops[3], u_innerStops[4], (t - 3.0 * segment) / segment);\r\n    }\r\n}\r\n\r\ndf2 sampleZRef(int n) {\r\n    float x = (float(n) + 0.5) / u_orbitW;\r\n    vec4 t = texture2D(u_orbitTex, vec2(x, 0.5));\r\n    return df2_make(df_make(t.r, t.g), df_make(t.b, t.a));\r\n}\r\n\r\nvoid main() {\r\n    float aspect = u_resolution.x / u_resolution.y;\r\n\r\n    vec2 st = gl_FragCoord.xy / u_resolution;\r\n    st -= 0.5;\r\n    st.x *= aspect;\r\n\r\n    float cosR = cos(u_rotation);\r\n    float sinR = sin(u_rotation);\r\n    vec2 r = vec2(\r\n    st.x * cosR - st.y * sinR,\r\n    st.x * sinR + st.y * cosR\r\n    );\r\n\r\n    df zoom = df_make(u_zoom_h, u_zoom_l);\r\n\r\n    // deltaZ0 = pan - refZ0 (computed on JS side with float64 precision)\r\n    df2 deltaZ0 = df2_make(\r\n        df_make(u_delta_z0_h.x, u_delta_z0_l.x),\r\n        df_make(u_delta_z0_h.y, u_delta_z0_l.y)\r\n    );\r\n\r\n    // dz0 = deltaZ0 + zoom * r\r\n    df2 dz = df2_add(\r\n        deltaZ0,\r\n        df2_make(df_mul_f(zoom, r.x), df_mul_f(zoom, r.y))\r\n    );\r\n\r\n    float it = 0.0;\r\n    float zx = 0.0;\r\n    float zy = 0.0;\r\n\r\n    for (int n = 0; n < MAX_ITER; n++) {\r\n        float fn = float(n);\r\n        if (fn >= u_iterations) { it = fn; break; }\r\n\r\n        df2 zref = sampleZRef(n);\r\n\r\n        zx = df_to_float(zref.x) + df_to_float(dz.x);\r\n        zy = df_to_float(zref.y) + df_to_float(dz.y);\r\n        if (zx*zx + zy*zy > 4.0) { it = fn; break; }\r\n\r\n        // Correct Julia perturbation:\r\n        // dz_{n+1} = 2*zref*dz + dz^2   (NO +dc term)\r\n        df2 zref_dz = df2_mul(zref, dz);\r\n        zref_dz.x = df_mul_f(zref_dz.x, 2.0);\r\n        zref_dz.y = df_mul_f(zref_dz.y, 2.0);\r\n\r\n        df2 dz2 = df2_sqr(dz);\r\n\r\n        dz = df2_add(zref_dz, dz2);\r\n\r\n        if (n == MAX_ITER - 1) it = u_iterations;\r\n    }\r\n\r\n    if (it >= u_iterations) {\r\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\r\n    } else {\r\n        float r2 = max(zx*zx + zy*zy, 1e-30);\r\n        float smoothColor = it - log2(log2(r2));\r\n\r\n        // Normalize\r\n        float t = clamp(smoothColor / u_iterations, 0.0, 1.0);\r\n\r\n        t = 0.5 + 0.6 * sin(t * 4.0 * 3.14159265);\r\n\r\n        vec3 col = getColorFromMap(t);\r\n        gl_FragColor = vec4(col, 1.0);\r\n    }\r\n}").replace("__MAX_ITER__",this.MAX_ITER).toString()}},{key:"updateUniforms",value:function(){Sa(e,"updateUniforms",this,3)([]),this.cLoc=this.gl.getUniformLocation(this.program,"u_c"),this.innerStopsLoc=this.gl.getUniformLocation(this.program,"u_innerStops"),this.deltaZ0HLoc=this.gl.getUniformLocation(this.program,"u_delta_z0_h"),this.deltaZ0LLoc=this.gl.getUniformLocation(this.program,"u_delta_z0_l"),this.zoomHLoc=this.gl.getUniformLocation(this.program,"u_zoom_h"),this.zoomLLoc=this.gl.getUniformLocation(this.program,"u_zoom_l"),this.orbitTexLoc=this.gl.getUniformLocation(this.program,"u_orbitTex"),this.orbitWLoc=this.gl.getUniformLocation(this.program,"u_orbitW")}},{key:"escapeItersJulia",value:function(t,e,n){for(var r=t,o=e,i=this.c[0],a=this.c[1],s=0;s<n;s++){var c=2*r*o+a;if((r=r*r-o*o+i)*r+(o=c)*o>4)return s}return n}},{key:"pickReferenceNearViewCenter",value:function(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])return this.refZ0[0]=this.pan[0],this.refZ0[1]=this.pan[1],this.refZ0DD.x.hi=this.panDD.x.hi,this.refZ0DD.x.lo=this.panDD.x.lo,this.refZ0DD.y.hi=this.panDD.y.hi,this.refZ0DD.y.lo=this.panDD.y.lo,this.refPan[0]=this.pan[0],this.refPan[1]=this.pan[1],this.refPanDD.x.hi=this.panDD.x.hi,this.refPanDD.x.lo=this.panDD.x.lo,this.refPanDD.y.hi=this.panDD.y.hi,void(this.refPanDD.y.lo=this.panDD.y.lo);var t=this.REF_SEARCH_GRID,e=(t-1)/2,n=2*this.REF_SEARCH_RADIUS/(t-1),r=this.zoom,o=Math.min(this.MAX_ITER,Math.max(200,Math.floor(this.iterations))),i=-1;Math.hypot(this.refZ0[0]-this.pan[0],this.refZ0[1]-this.pan[1])<r*this.REF_SEARCH_RADIUS*2.5&&(i=this.escapeItersJulia(this.refZ0[0],this.refZ0[1],o));for(var a=this.pan[0],s=this.pan[1],c=this.escapeItersJulia(this.pan[0],this.pan[1],o),l=0;l<t;l++)for(var u=0;u<t;u++){var f=(u-e)*n,d=(l-e)*n,h=this.pan[0]+f*r,m=this.pan[1]+d*r,p=this.escapeItersJulia(h,m,o);p>c&&(c=p,a=h,s=m)}var v=Math.max(.1*i,50);(i<0||c-i>v)&&(this.refZ0[0]=a,this.refZ0[1]=s,this.refZ0DD.x.hi=a,this.refZ0DD.x.lo=0,this.refZ0DD.y.hi=s,this.refZ0DD.y.lo=0,this.refPan[0]=a,this.refPan[1]=s,this.refPanDD.x.hi=a,this.refPanDD.x.lo=0,this.refPanDD.y.hi=s,this.refPanDD.y.lo=0)}},{key:"computeReferenceOrbit",value:function(){if(this.orbitData&&this.orbitTex){for(var t=this.c[0],e=this.c[1],n=this.refZ0[0],r=this.refZ0[1],o=0;o<this.MAX_ITER;o++){var i=M(n),a=M(r),s=4*o;this.orbitData[s]=i.high,this.orbitData[s+1]=i.low,this.orbitData[s+2]=a.high,this.orbitData[s+3]=a.low;var c=2*n*r+e;if((n=n*n-r*r+t)*n+(r=c)*r>4){for(var l=M(n),u=M(r),f=o+1;f<this.MAX_ITER;f++){var d=4*f;this.orbitData[d]=l.high,this.orbitData[d+1]=l.low,this.orbitData[d+2]=u.high,this.orbitData[d+3]=u.low}break}}this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.orbitTex),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.MAX_ITER,1,0,this.gl.RGBA,this.gl.FLOAT,this.orbitData),this.orbitTexLoc&&this.gl.uniform1i(this.orbitTexLoc,0),this.orbitWLoc&&this.gl.uniform1f(this.orbitWLoc,this.MAX_ITER)}}},{key:"needsRebase",value:function(){if(void 0===this.rebaseArmed&&(this.rebaseArmed=!0),!this.refPan)return!0;if(!Number.isFinite(this.zoom))return!1;var t=Math.max(this.zoom,1e-300),e=this.pan[0]-this.refPan[0],n=this.pan[1]-this.refPan[1],r=Math.hypot(e,n)/t;return!this.rebaseArmed&&r<.9?(this.rebaseArmed=!0,!1):!!(this.rebaseArmed&&r>1.75)&&(this.rebaseArmed=!1,!0)}},{key:"draw",value:function(){this.gl.useProgram(this.program);var t=Math.floor(3e3*Math.pow(2,-Math.log2(this.zoom)));this.iterations=Math.min(2e3,t+this.extraIterations);var n=!Number.isFinite(this._prevPan0)||!Number.isFinite(this._prevPan1)||Math.abs(this.pan[0]-this._prevPan0)+Math.abs(this.pan[1]-this._prevPan1)>1e-6*this.zoom,r=!Number.isFinite(this._prevZoom)||Math.abs(this.zoom-this._prevZoom)>1e-8*this.zoom,o=!Number.isFinite(this._prevC0)||!Number.isFinite(this._prevC1)||Math.abs(this.c[0]-this._prevC0)+Math.abs(this.c[1]-this._prevC1)>0;(n||r||o)&&(this.orbitDirty=!0,this._prevPan0=this.pan[0],this._prevPan1=this.pan[1],this._prevZoom=this.zoom,this._prevC0=this.c[0],this._prevC1=this.c[1]);var i=o||this.needsRebase(),a=this.cAnimationActive||this.interactionActive,s=!a||i;this.orbitDirty&&s&&(this.pickReferenceNearViewCenter(a),this.computeReferenceOrbit(),this.orbitDirty=!1);var c=X(this.panDD.x,this.refZ0DD.x),l=X(this.panDD.y,this.refZ0DD.y);this.deltaZ0HLoc&&this.gl.uniform2f(this.deltaZ0HLoc,c.hi,l.hi),this.deltaZ0LLoc&&this.gl.uniform2f(this.deltaZ0LLoc,c.lo,l.lo);var u=M(this.zoom);this.zoomHLoc&&this.gl.uniform1f(this.zoomHLoc,u.high),this.zoomLLoc&&this.gl.uniform1f(this.zoomLLoc,u.low),this.cLoc&&this.gl.uniform2fv(this.cLoc,this.c),this.innerStopsLoc&&this.gl.uniform3fv(this.innerStopsLoc,this.innerStops),Sa(e,"draw",this,3)([])}},{key:"reset",value:function(){this.c=Aa(this.DEFAULT_C),this.currentPaletteIndex=this.DEFAULT_PALETTE_INDEX;var t=this.PALETTES[this.currentPaletteIndex]||m;this.innerStops=new Float32Array(t.theme);var n=t.keyColor?V(t.keyColor):null;this.colorPalette=n?[n.r,n.g,n.b]:[t.theme[9],t.theme[10],t.theme[11]],this.orbitDirty=!0,this._prevPan0=NaN,this._prevPan1=NaN,this._prevZoom=NaN,this._prevC0=NaN,this._prevC1=NaN,Sa(e,"reset",this,3)([])}},{key:"stopCurrentCAnimation",value:function(){null!==this.currentCAnimationFrame&&(cancelAnimationFrame(this.currentCAnimationFrame),this.currentCAnimationFrame=null),this.cAnimationActive&&(this.cAnimationActive=!1,this.markOrbitDirty())}},{key:"stopAllNonColorAnimations",value:function(){this.stopCurrentCAnimation(),Sa(e,"stopAllNonColorAnimations",this,3)([])}},{key:"animateInnerStopsTransition",value:(v=_a(ya().m(function t(e){var n,r,o,i=this,a=arguments;return ya().w(function(t){for(;;)switch(t.n){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:250,r=a.length>2&&void 0!==a[2]?a[2]:null,this.stopCurrentColorAnimations(),o=Array.from(this.innerStops),t.n=1,new Promise(function(t){i._colorAnimationResolve=t;var a=null,s=function(c){a||(a=c);var l,u=Math.min((c-a)/n,1),f=o.map(function(t,n){return Y(t,e.theme[n],u)});i.innerStops=new Float32Array(f),e.keyColor&&(l=V(e.keyColor))&&(i.colorPalette=[l.r,l.g,l.b]),l||(i.colorPalette=[1.5*e.theme[9],1.5*e.theme[10],1.5*e.theme[11]]),i.draw(),r&&r(),u<1?i.currentColorAnimationFrame=requestAnimationFrame(s):(i._colorAnimationResolve=null,i.stopCurrentColorAnimations(),t())};i.currentColorAnimationFrame=requestAnimationFrame(s)});case 1:return t.a(2)}},t,this)})),function(t){return v.apply(this,arguments)})},{key:"animateColorPaletteTransition",value:(p=_a(ya().m(function t(){var n,r,o=arguments;return ya().w(function(t){for(;;)switch(t.n){case 0:if(n=o.length>0&&void 0!==o[0]?o[0]:250,r=o.length>1&&void 0!==o[1]?o[1]:null,0!==this.PALETTES.length){t.n=1;break}return t.a(2,Sa(e,"animateColorPaletteTransition",this,3)([n,r]));case 1:return this.currentPaletteIndex=(this.currentPaletteIndex+1)%this.PALETTES.length,t.n=2,this.animateInnerStopsTransition(this.PALETTES[this.currentPaletteIndex],n,r);case 2:return t.a(2)}},t,this)})),function(){return p.apply(this,arguments)})},{key:"applyPaletteByIndex",value:(h=_a(ya().m(function t(e){var n,r,o=arguments;return ya().w(function(t){for(;;)switch(t.n){case 0:if(n=o.length>1&&void 0!==o[1]?o[1]:250,r=o.length>2&&void 0!==o[2]?o[2]:null,!(0===this.PALETTES.length||e<0||e>=this.PALETTES.length)){t.n=1;break}return t.a(2);case 1:return this.currentPaletteIndex=e,t.n=2,this.animateInnerStopsTransition(this.PALETTES[e],n,r);case 2:return t.a(2)}},t,this)})),function(t){return h.apply(this,arguments)})},{key:"animateFullColorSpaceCycle",value:(d=_a(ya().m(function t(){var e,n,r=this,o=arguments;return ya().w(function(t){for(;;)switch(t.n){case 0:return e=o.length>0&&void 0!==o[0]?o[0]:15e3,n=o.length>1&&void 0!==o[1]?o[1]:null,t.n=1,new Promise(function(){r.animateColorPaletteTransition(e,n)});case 1:return t.a(2)}},t)})),function(){return d.apply(this,arguments)})},{key:"animateToC",value:(f=_a(ya().m(function t(){var e,n,r,o,i=this,a=arguments;return ya().w(function(t){for(;;)switch(t.n){case 0:if(e=a.length>0&&void 0!==a[0]?a[0]:Aa(this.DEFAULT_C),n=a.length>1&&void 0!==a[1]?a[1]:500,r=a.length>2&&void 0!==a[2]?a[2]:l.QUINT,this.stopCurrentCAnimation(),!G(this.c,e)){t.n=1;break}return t.a(2);case 1:return o=Aa(this.c),this.cAnimationActive=!0,t.n=2,new Promise(function(t){var a=null,s=function(c){a||(a=c);var l=Math.min((c-a)/n,1),u=r(l);i.c[0]=Y(o[0],e[0],u),i.c[1]=Y(o[1],e[1],u),i.draw(),fi(!0),Fr(),l<1?i.currentCAnimationFrame=requestAnimationFrame(s):(i.cAnimationActive=!1,i.markOrbitDirty(),i.draw(),i.stopCurrentCAnimation(),i.onAnimationFinished(),t())};i.currentCAnimationFrame=requestAnimationFrame(s)});case 2:return t.a(2)}},t,this)})),function(){return f.apply(this,arguments)})},{key:"animateToZoomAndC",value:(u=_a(ya().m(function t(e){var n,r,o,i=arguments;return ya().w(function(t){for(;;)switch(t.n){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:Aa(this.DEFAULT_C),r=i.length>2&&void 0!==i[2]?i[2]:500,o=i.length>3&&void 0!==i[3]?i[3]:l.QUINT,this.stopCurrentCAnimation(),t.n=1,Promise.all([this.animateZoomTo(e,r,o),this.animateToC(n,r,o)]);case 1:case 2:return t.a(2)}},t,this)})),function(t){return u.apply(this,arguments)})},{key:"animateTravelToPreset",value:(c=_a(ya().m(function t(e){var n,r,o,i,a,s,c,u,f,d,h,m,p,v,y,g,b,_,T=this,E=arguments;return ya().w(function(t){for(;;)switch(t.n){case 0:return o=E.length>1&&void 0!==E[1]?E[1]:500,i=E.length>2&&void 0!==E[2]?E[2]:null,this.stopAllNonColorAnimations(),this.stopCurrentColorAnimations(),a=o*(null!==(n=e.speed)&&void 0!==n?n:1),t.n=1,this.animatePanAndZoomTo(this.DEFAULT_PAN,this.DEFAULT_ZOOM,1e3);case 1:return s=Aa(this.c),c=Aa(this.pan),u=this.zoom,f=this.rotation,d=Array.from(this.innerStops),h=e.c||this.DEFAULT_C,m=e.pan||this.DEFAULT_PAN,p=e.zoom||this.DEFAULT_ZOOM,v=null!==(r=e.rotation)&&void 0!==r?r:0,y=null,e.paletteId&&(g=this.PALETTES.findIndex(function(t){return t.id===e.paletteId}))>=0&&(y=this.PALETTES[g],this.currentPaletteIndex=g),b=Math.max(o,a),_=l.QUINT,this.cAnimationActive=!0,this.markOrbitDirty(),t.n=2,new Promise(function(t){var n=null,r=function(o){n||(n=o);var a=Math.min((o-n)/b,1),l=_(a);if(T.c[0]=Y(s[0],h[0],l),T.c[1]=Y(s[1],h[1],l),T.setPan(Y(c[0],m[0],l),Y(c[1],m[1],l)),T.zoom=u*Math.pow(p/u,l),T.rotation=Y(f,v,l),y){var g=d.map(function(t,e){return Y(t,y.theme[e],l)});if(T.innerStops=new Float32Array(g),y.keyColor){var E=V(y.keyColor);E&&(T.colorPalette=[E.r,E.g,E.b])}}T.draw(),fi(!0),Fr(),i&&i(),a<1?T.currentCAnimationFrame=requestAnimationFrame(r):(T.cAnimationActive=!1,T.markOrbitDirty(),T.draw(),T.currentPresetIndex=e.index,t())};T.currentCAnimationFrame=requestAnimationFrame(r)});case 2:return t.a(2)}},t,this)})),function(t){return c.apply(this,arguments)})},{key:"animateDive",value:(s=_a(ya().m(function t(e){var n=this;return ya().w(function(t){for(;;)switch(t.n){case 0:return this.stopCurrentCAnimation(),t.n=1,new Promise(function(){e.phases||(e.phases=[1,2,3,4]);var t=e.phases[0],r=function(){var o=e.step;1===t?(n.c[0]+=e.cxDirection*o,(e.cxDirection<0&&n.c[0]<=e.endC[0]||e.cxDirection>0&&n.c[0]>=e.endC[0])&&(n.c[0]=e.endC[0],t=2)):2===t?(n.c[1]+=e.cyDirection*o,(e.cyDirection<0&&n.c[1]<=e.endC[1]||e.cyDirection>0&&n.c[1]>=e.endC[1])&&(n.c[1]=e.endC[1],t=3)):3===t?(n.c[0]-=e.cxDirection*o,(e.cxDirection<0&&n.c[0]>=e.startC[0]||e.cxDirection>0&&n.c[0]<=e.startC[0])&&(n.c[0]=e.startC[0],t=4)):4===t&&(n.c[1]-=e.cyDirection*o,(e.cyDirection<0&&n.c[1]>=e.startC[1]||e.cyDirection>0&&n.c[1]<=e.startC[1])&&(n.c[1]=e.startC[1],t=1)),n.draw(),fi(!0),Fr(),n.currentCAnimationFrame=requestAnimationFrame(r)};n.currentCAnimationFrame=requestAnimationFrame(r)});case 1:return t.a(2)}},t,this)})),function(t){return s.apply(this,arguments)})},{key:"animateRandomDemo",value:(a=_a(ya().m(function t(){var e=this;return ya().w(function(t){for(;;)switch(t.n){case 0:return this.stopAllNonColorAnimations(),this.demoActive=!0,t.n=1,new Promise(function(){var t=function(){e.c=[(Math.sin(e.demoTime)+1)/2*1.5-1,(Math.cos(e.demoTime)+1)/2*1.4-.7],e.rotation=W(e.rotation-.001),e.demoTime+=5e-4,e.draw(),fi(!0),Fr(),e.currentCAnimationFrame=requestAnimationFrame(t)};e.currentCAnimationFrame=requestAnimationFrame(t)});case 1:return t.a(2)}},t,this)})),function(){return a.apply(this,arguments)})},{key:"animateDemo",value:(i=_a(ya().m(function t(){var e,n,r,o,i,a,s,c,l=arguments;return ya().w(function(t){for(;;)switch(t.n){case 0:if(e=!(l.length>0&&void 0!==l[0])||l[0],n=l.length>1&&void 0!==l[1]?l[1]:null,r=l.length>2&&void 0!==l[2]?l[2]:null,o=l.length>3&&void 0!==l[3]?l[3]:[],this.stopAllNonColorAnimations(),(i=[].concat(Aa(this.PRESETS),Aa(o))).length){t.n=1;break}return t.a(2);case 1:this.demoActive=!0,a=0,s=function(t){if(i.length<=1)return 0;if(t){var e;do{e=Math.floor(Math.random()*i.length)}while(e===a&&i.length>1);return e}return(a+1)%i.length};case 2:if(!this.demoActive){t.n=6;break}if(a=s(e),c=i[a]){t.n=3;break}return t.a(3,6);case 3:return t.n=4,this.animateTravelToPreset(c,4e3,n);case 4:return r&&r(),t.n=5,tt(500);case 5:t.n=2;break;case 6:case 7:return t.a(2)}},t,this)})),function(){return i.apply(this,arguments)})}],r&&Pa(n.prototype,r),o&&Pa(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o,i,a,s,c,u,f,d,h,p,v}(wt);function Oa(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var c=r&&r.prototype instanceof s?r:s,l=Object.create(c.prototype);return Ra(l,"_invoke",function(n,r,o){var i,s,c,l=0,u=o||[],f=!1,d={p:0,n:0,v:t,a:h,f:h.bind(t,4),d:function(e,n){return i=e,s=0,c=t,d.n=n,a}};function h(n,r){for(s=n,c=r,e=0;!f&&l&&!o&&e<u.length;e++){var o,i=u[e],h=d.p,m=i[2];n>3?(o=m===r)&&(c=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=t):i[0]<=h&&((o=n<2&&h<i[1])?(s=0,d.v=r,d.n=i[1]):h<m&&(o=n<3||i[0]>r||r>m)&&(i[4]=n,i[5]=r,d.n=m,s=0))}if(o||n>1)return a;throw f=!0,r}return function(o,u,m){if(l>1)throw TypeError("Generator is already running");for(f&&1===u&&h(u,m),s=u,c=m;(e=s<2?t:c)||!f;){i||(s?s<3?(s>1&&(d.n=-1),h(s,c)):d.n=c:d.v=c);try{if(l=2,i){if(s||(o="next"),e=i[o]){if(!(e=e.call(i,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,s<2&&(s=0)}else 1===s&&(e=i.return)&&e.call(i),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);i=t}else if((e=(f=d.n<0)?c:n.call(r,d))!==a)break}catch(e){i=t,s=1,c=e}finally{l=1}}return{value:e,done:f}}}(n,o,i),!0),l}var a={};function s(){}function c(){}function l(){}e=Object.getPrototypeOf;var u=[][r]?e(e([][r]())):(Ra(e={},r,function(){return this}),e),f=l.prototype=s.prototype=Object.create(u);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,Ra(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return c.prototype=l,Ra(f,"constructor",l),Ra(l,"constructor",c),c.displayName="GeneratorFunction",Ra(l,o,"GeneratorFunction"),Ra(f),Ra(f,o,"Generator"),Ra(f,r,function(){return this}),Ra(f,"toString",function(){return"[object Generator]"}),(Oa=function(){return{w:i,m:d}})()}function Ra(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Ra=function(t,e,n,r){function i(e,n){Ra(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Ra(t,e,n,r)}function za(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function Na(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var i=t.apply(e,n);function a(t){za(i,r,o,a,s,"next",t)}function s(t){za(i,r,o,a,s,"throw",t)}a(void 0)})}}function ja(){return Ua.apply(this,arguments)}function Ua(){return Ua=Na(Oa().m(function t(){var e,n,r,o,i,a,s,l;return Oa().w(function(t){for(;;)switch(t.n){case 0:(e=document.getElementById("fractalCanvas")).width=window.innerWidth,e.height=window.innerHeight,n=L(),r=null!=n.px&&null!=n.py&&null!=n.zoom&&null!=n.r,o=r&&null!=n.cx&&null!=n.cy,i={pan:[n.px,n.py],zoom:n.zoom,c:[n.cx,n.cy],rotation:n.r,paletteId:n.paletteId},a=function(){s.resizeCanvas(),S()},l=n.mode,t.n=l===c.JULIA?1:l===c.MANDELBROT?2:l===c.RIEMANN?3:4;break;case 1:return s=new Ma(e),t.a(3,5);case 2:return s=new sr(e),t.a(3,5);case 3:return s=new gr(e),t.a(3,5);case 4:return t.a(3,5);case 5:return t.n=6,tt(100);case 6:return t.n=7,ma(s);case 7:if(!o){t.n=9;break}return t.n=8,s.animateTravelToPreset(i,1e3);case 8:t.n=12;break;case 9:if(!r){t.n=11;break}return t.n=10,s.animateTravelToPreset(i,100,400,1e3);case 10:t.n=12;break;case 11:a();case 12:return t.n=13,tt(100);case 13:return t.n=14,new Promise(function(t){document.getElementById("headerContainer").classList.add("ready"),document.getElementById("infoLabel").classList.add("ready"),t()});case 14:(r||o)&&(Si(),Ii());case 15:return t.a(2)}},t)})),Ua.apply(this,arguments)}ka(Ma,"FF_LEGACY_JULIA_RENDERER",!0),document.addEventListener("DOMContentLoaded",Na(Oa().m(function t(){return Oa().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,ja();case 1:return t.n=2,tt(2e3);case 2:fi();case 3:return t.a(2)}},t)})),{once:!0})})();
//# sourceMappingURL=bundle.009170e0d42d9bf59d98.js.map